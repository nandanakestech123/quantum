{"ast":null,"code":"/**\r\n * DevExtreme (ui/html_editor/ui.html_editor.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _element = require(\"../../core/element\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _component_registrator = _interopRequireDefault(require(\"../../core/component_registrator\"));\n\nvar _empty_template = require(\"../../core/templates/empty_template\");\n\nvar _editor = _interopRequireDefault(require(\"../editor/editor\"));\n\nvar _ui = _interopRequireDefault(require(\"../widget/ui.errors\"));\n\nvar _callbacks = _interopRequireDefault(require(\"../../core/utils/callbacks\"));\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _events_engine = _interopRequireDefault(require(\"../../events/core/events_engine\"));\n\nvar _index = require(\"../../events/utils/index\");\n\nvar _uiEventsEmitterGesture = _interopRequireDefault(require(\"../scroll_view/ui.events.emitter.gesture.scroll\"));\n\nvar _utils = require(\"../text_box/utils.scroll\");\n\nvar _quill_registrator = _interopRequireDefault(require(\"./quill_registrator\"));\n\nrequire(\"./converters/delta\");\n\nvar _converterController = _interopRequireDefault(require(\"./converterController\"));\n\nvar _wordLists = _interopRequireDefault(require(\"./matchers/wordLists\"));\n\nvar _formDialog = _interopRequireDefault(require(\"./ui/formDialog\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar HTML_EDITOR_CLASS = \"dx-htmleditor\";\nvar QUILL_CONTAINER_CLASS = \"dx-quill-container\";\nvar QUILL_CLIPBOARD_CLASS = \"ql-clipboard\";\nvar HTML_EDITOR_SUBMIT_ELEMENT_CLASS = \"dx-htmleditor-submit-element\";\nvar HTML_EDITOR_CONTENT_CLASS = \"dx-htmleditor-content\";\nvar MARKDOWN_VALUE_TYPE = \"markdown\";\nvar ANONYMOUS_TEMPLATE_NAME = \"htmlContent\";\n\nvar HtmlEditor = _editor.default.inherit({\n  _getDefaultOptions: function () {\n    return (0, _extend.extend)(this.callBase(), {\n      focusStateEnabled: true,\n      valueType: \"html\",\n      placeholder: \"\",\n      toolbar: null,\n      variables: null,\n      mediaResizing: null,\n      mentions: null,\n      customizeModules: null,\n      formDialogOptions: null\n    });\n  },\n  _init: function () {\n    this.callBase();\n    this._cleanCallback = (0, _callbacks.default)();\n    this._contentInitializedCallback = (0, _callbacks.default)();\n  },\n  _getAnonymousTemplateName: function () {\n    return ANONYMOUS_TEMPLATE_NAME;\n  },\n  _initTemplates: function () {\n    this._templateManager.addDefaultTemplates(_defineProperty({}, ANONYMOUS_TEMPLATE_NAME, new _empty_template.EmptyTemplate()));\n\n    this.callBase();\n  },\n  _focusTarget: function () {\n    return this._getContent();\n  },\n  _getContent: function () {\n    return this.$element().find(\".\".concat(HTML_EDITOR_CONTENT_CLASS));\n  },\n  _focusInHandler: function (_ref) {\n    var relatedTarget = _ref.relatedTarget;\n\n    if (this._shouldSkipFocusEvent(relatedTarget)) {\n      return;\n    }\n\n    this._toggleFocusClass(true, this.$element());\n\n    this.callBase.apply(this, arguments);\n  },\n  _focusOutHandler: function (_ref2) {\n    var relatedTarget = _ref2.relatedTarget;\n\n    if (this._shouldSkipFocusEvent(relatedTarget)) {\n      return;\n    }\n\n    this._toggleFocusClass(false, this.$element());\n\n    this.callBase.apply(this, arguments);\n  },\n  _shouldSkipFocusEvent: function (relatedTarget) {\n    return (0, _renderer.default)(relatedTarget).hasClass(QUILL_CLIPBOARD_CLASS);\n  },\n  _initMarkup: function () {\n    this._$htmlContainer = (0, _renderer.default)(\"<div>\").addClass(QUILL_CONTAINER_CLASS);\n    this.$element().addClass(HTML_EDITOR_CLASS).wrapInner(this._$htmlContainer);\n\n    var template = this._getTemplate(ANONYMOUS_TEMPLATE_NAME);\n\n    var transclude = true;\n    this._$templateResult = template && template.render({\n      container: (0, _element.getPublicElement)(this._$htmlContainer),\n      noModel: true,\n      transclude: transclude\n    });\n\n    this._renderSubmitElement();\n\n    this.callBase();\n\n    this._updateContainerMarkup();\n  },\n  _renderSubmitElement: function () {\n    this._$submitElement = (0, _renderer.default)(\"<textarea>\").addClass(HTML_EDITOR_SUBMIT_ELEMENT_CLASS).attr(\"hidden\", true).appendTo(this.$element());\n\n    this._setSubmitValue(this.option(\"value\"));\n  },\n  _setSubmitValue: function (value) {\n    this._getSubmitElement().val(value);\n  },\n  _getSubmitElement: function () {\n    return this._$submitElement;\n  },\n  _updateContainerMarkup: function () {\n    var markup = this.option(\"value\");\n\n    if (this._isMarkdownValue()) {\n      this._prepareMarkdownConverter();\n\n      markup = this._markdownConverter.toHtml(markup);\n    }\n\n    if (markup) {\n      this._$htmlContainer.html(markup);\n    }\n  },\n  _prepareMarkdownConverter: function () {\n    var MarkdownConverter = _converterController.default.getConverter(\"markdown\");\n\n    if (MarkdownConverter) {\n      this._markdownConverter = new MarkdownConverter();\n    } else {\n      throw _ui.default.Error(\"E1051\", \"markdown\");\n    }\n  },\n  _render: function () {\n    this._prepareConverters();\n\n    this.callBase();\n  },\n  _prepareQuillRegistrator: function () {\n    if (!this._quillRegistrator) {\n      this._quillRegistrator = new _quill_registrator.default();\n    }\n  },\n  _getRegistrator: function () {\n    this._prepareQuillRegistrator();\n\n    return this._quillRegistrator;\n  },\n  _prepareConverters: function () {\n    if (!this._deltaConverter) {\n      var DeltaConverter = _converterController.default.getConverter(\"delta\");\n\n      if (DeltaConverter) {\n        this._deltaConverter = new DeltaConverter();\n      }\n    }\n\n    if (this.option(\"valueType\") === MARKDOWN_VALUE_TYPE && !this._markdownConverter) {\n      this._prepareMarkdownConverter();\n    }\n  },\n  _renderContentImpl: function () {\n    this._contentRenderedDeferred = new _deferred.Deferred();\n\n    var renderContentPromise = this._contentRenderedDeferred.promise();\n\n    this.callBase();\n\n    this._renderHtmlEditor();\n\n    this._renderFormDialog();\n\n    this._addKeyPressHandler();\n\n    return renderContentPromise;\n  },\n  _attachFocusEvents: function () {\n    (0, _common.deferRender)(this.callBase.bind(this));\n  },\n  _addKeyPressHandler: function () {\n    var keyDownEvent = (0, _index.addNamespace)(\"keydown\", \"\".concat(this.NAME, \"TextChange\"));\n\n    _events_engine.default.on(this._$htmlContainer, keyDownEvent, this._keyDownHandler.bind(this));\n  },\n  _keyDownHandler: function (e) {\n    this._saveValueChangeEvent(e);\n  },\n  _renderHtmlEditor: function () {\n    var _this = this;\n\n    var customizeModules = this.option(\"customizeModules\");\n\n    var modulesConfig = this._getModulesConfig();\n\n    if ((0, _type.isFunction)(customizeModules)) {\n      customizeModules(modulesConfig);\n    }\n\n    this._quillInstance = this._getRegistrator().createEditor(this._$htmlContainer[0], {\n      placeholder: this.option(\"placeholder\"),\n      readOnly: this.option(\"readOnly\") || this.option(\"disabled\"),\n      modules: modulesConfig,\n      theme: \"basic\"\n    });\n\n    this._deltaConverter.setQuillInstance(this._quillInstance);\n\n    this._textChangeHandlerWithContext = this._textChangeHandler.bind(this);\n\n    this._quillInstance.on(\"text-change\", this._textChangeHandlerWithContext);\n\n    this._renderScrollHandler();\n\n    if (this._hasTranscludedContent()) {\n      this._updateContentTask = (0, _common.executeAsync)(function () {\n        _this._applyTranscludedContent();\n      });\n    } else {\n      this._finalizeContentRendering();\n    }\n  },\n  _renderScrollHandler: function () {\n    var $scrollContainer = this._getContent();\n\n    var initScrollData = (0, _utils.prepareScrollData)($scrollContainer);\n\n    _events_engine.default.on($scrollContainer, (0, _index.addNamespace)(_uiEventsEmitterGesture.default.init, this.NAME), initScrollData, _common.noop);\n  },\n  _applyTranscludedContent: function () {\n    var valueOption = this.option(\"value\");\n\n    if (!(0, _type.isDefined)(valueOption)) {\n      var html = this._deltaConverter.toHtml();\n\n      var newDelta = this._quillInstance.clipboard.convert({\n        html: html\n      });\n\n      if (newDelta.ops.length) {\n        this._quillInstance.setContents(newDelta);\n\n        return;\n      }\n    }\n\n    this._finalizeContentRendering();\n  },\n  _hasTranscludedContent: function () {\n    return this._$templateResult && this._$templateResult.length;\n  },\n  _getModulesConfig: function () {\n    var _this2 = this;\n\n    var quill = this._getRegistrator().getQuill();\n\n    var wordListMatcher = (0, _wordLists.default)(quill);\n    var modulesConfig = (0, _extend.extend)({}, {\n      table: true,\n      toolbar: this._getModuleConfigByOption(\"toolbar\"),\n      variables: this._getModuleConfigByOption(\"variables\"),\n      resizing: this._getModuleConfigByOption(\"mediaResizing\"),\n      mentions: this._getModuleConfigByOption(\"mentions\"),\n      uploader: {\n        onDrop: function (e) {\n          return _this2._saveValueChangeEvent(e);\n        },\n        imageBlot: \"extendedImage\"\n      },\n      clipboard: {\n        onPaste: function (e) {\n          return _this2._saveValueChangeEvent(e);\n        },\n        onCut: function (e) {\n          return _this2._saveValueChangeEvent(e);\n        },\n        matchers: [[\"p.MsoListParagraphCxSpFirst\", wordListMatcher], [\"p.MsoListParagraphCxSpMiddle\", wordListMatcher], [\"p.MsoListParagraphCxSpLast\", wordListMatcher]]\n      }\n    }, this._getCustomModules());\n    return modulesConfig;\n  },\n  _getModuleConfigByOption: function (userOptionName) {\n    var optionValue = this.option(userOptionName);\n    var config = {};\n\n    if (!(0, _type.isDefined)(optionValue)) {\n      return;\n    }\n\n    if (Array.isArray(optionValue)) {\n      config[userOptionName] = optionValue;\n    } else {\n      config = optionValue;\n    }\n\n    return (0, _extend.extend)(this._getBaseModuleConfig(), config);\n  },\n  _getBaseModuleConfig: function () {\n    return {\n      editorInstance: this\n    };\n  },\n  _getCustomModules: function () {\n    var _this3 = this;\n\n    var modules = {};\n\n    var moduleNames = this._getRegistrator().getRegisteredModuleNames();\n\n    moduleNames.forEach(function (modulePath) {\n      modules[modulePath] = _this3._getBaseModuleConfig();\n    });\n    return modules;\n  },\n  _textChangeHandler: function (newDelta, oldDelta, source) {\n    var htmlMarkup = this._deltaConverter.toHtml();\n\n    var convertedValue = this._isMarkdownValue() ? this._updateValueByType(MARKDOWN_VALUE_TYPE, htmlMarkup) : htmlMarkup;\n    var currentValue = this.option(\"value\");\n\n    if (currentValue !== convertedValue && !this._isNullValueConverted(currentValue, convertedValue)) {\n      this._isEditorUpdating = true;\n      this.option(\"value\", convertedValue);\n    }\n\n    this._finalizeContentRendering();\n  },\n  _isNullValueConverted: function (currentValue, convertedValue) {\n    return null === currentValue && \"\" === convertedValue;\n  },\n  _finalizeContentRendering: function () {\n    if (this._contentRenderedDeferred) {\n      this.clearHistory();\n\n      this._contentInitializedCallback.fire();\n\n      this._contentRenderedDeferred.resolve();\n\n      this._contentRenderedDeferred = void 0;\n    }\n  },\n  _updateValueByType: function (valueType, value) {\n    var converter = this._markdownConverter;\n\n    if (!(0, _type.isDefined)(converter)) {\n      return;\n    }\n\n    var currentValue = (0, _common.ensureDefined)(value, this.option(\"value\"));\n    return valueType === MARKDOWN_VALUE_TYPE ? converter.toMarkdown(currentValue) : converter.toHtml(currentValue);\n  },\n  _isMarkdownValue: function () {\n    return this.option(\"valueType\") === MARKDOWN_VALUE_TYPE;\n  },\n  _resetEnabledState: function () {\n    if (this._quillInstance) {\n      var isEnabled = !(this.option(\"readOnly\") || this.option(\"disabled\"));\n\n      this._quillInstance.enable(isEnabled);\n    }\n  },\n  _renderFormDialog: function () {\n    var userOptions = (0, _extend.extend)(true, {\n      width: \"auto\",\n      height: \"auto\",\n      closeOnOutsideClick: true\n    }, this.option(\"formDialogOptions\"));\n    this._formDialog = new _formDialog.default(this, userOptions);\n  },\n  _getQuillContainer: function () {\n    return this._$htmlContainer;\n  },\n  _optionChanged: function (args) {\n    switch (args.name) {\n      case \"value\":\n        if (this._quillInstance) {\n          if (this._isEditorUpdating) {\n            this._isEditorUpdating = false;\n          } else {\n            var updatedValue = this._isMarkdownValue() ? this._updateValueByType(\"HTML\", args.value) : args.value;\n\n            this._updateHtmlContent(updatedValue);\n          }\n        } else {\n          this._$htmlContainer.html(args.value);\n        }\n\n        this._setSubmitValue(args.value);\n\n        this.callBase(args);\n        break;\n\n      case \"placeholder\":\n      case \"variables\":\n      case \"toolbar\":\n      case \"mentions\":\n      case \"customizeModules\":\n        this._invalidate();\n\n        break;\n\n      case \"valueType\":\n        this._prepareConverters();\n\n        var newValue = this._updateValueByType(args.value);\n\n        if (\"html\" === args.value && this._quillInstance) {\n          this._updateHtmlContent(newValue);\n        } else {\n          this.option(\"value\", newValue);\n        }\n\n        break;\n\n      case \"readOnly\":\n      case \"disabled\":\n        this.callBase(args);\n\n        this._resetEnabledState();\n\n        break;\n\n      case \"formDialogOptions\":\n        this._renderFormDialog();\n\n        break;\n\n      case \"mediaResizing\":\n        if (!args.previousValue || !args.value) {\n          this._invalidate();\n        } else {\n          this._quillInstance.getModule(\"resizing\").option(args.name, args.value);\n        }\n\n        break;\n\n      case \"width\":\n        this.callBase(args);\n\n        this._repaintToolbar();\n\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _repaintToolbar: function () {\n    var toolbar = this._quillInstance.getModule(\"toolbar\");\n\n    toolbar && toolbar.repaint();\n  },\n  _updateHtmlContent: function (html) {\n    var newDelta = this._quillInstance.clipboard.convert({\n      html: html\n    });\n\n    this._quillInstance.setContents(newDelta);\n  },\n  _clean: function () {\n    if (this._quillInstance) {\n      _events_engine.default.off(this._getContent(), \".\".concat(this.NAME));\n\n      this._quillInstance.off(\"text-change\", this._textChangeHandlerWithContext);\n\n      this._cleanCallback.fire();\n    }\n\n    this._abortUpdateContentTask();\n\n    this._cleanCallback.empty();\n\n    this._contentInitializedCallback.empty();\n\n    this.callBase();\n  },\n  _abortUpdateContentTask: function () {\n    if (this._updateContentTask) {\n      this._updateContentTask.abort();\n\n      this._updateContentTask = void 0;\n    }\n  },\n  _applyQuillMethod: function (methodName, args) {\n    if (this._quillInstance) {\n      return this._quillInstance[methodName].apply(this._quillInstance, args);\n    }\n  },\n  _applyQuillHistoryMethod: function (methodName) {\n    if (this._quillInstance && this._quillInstance.history) {\n      this._quillInstance.history[methodName]();\n    }\n  },\n  addCleanCallback: function (callback) {\n    this._cleanCallback.add(callback);\n  },\n  addContentInitializedCallback: function (callback) {\n    this._contentInitializedCallback.add(callback);\n  },\n  register: function (components) {\n    this._getRegistrator().registerModules(components);\n\n    if (this._quillInstance) {\n      this.repaint();\n    }\n  },\n  get: function (modulePath) {\n    return this._getRegistrator().getQuill().import(modulePath);\n  },\n  getModule: function (moduleName) {\n    return this._applyQuillMethod(\"getModule\", arguments);\n  },\n  getQuillInstance: function () {\n    return this._quillInstance;\n  },\n  getSelection: function () {\n    return this._applyQuillMethod(\"getSelection\");\n  },\n  setSelection: function (index, length) {\n    this._applyQuillMethod(\"setSelection\", arguments);\n  },\n  format: function (formatName, formatValue) {\n    this._applyQuillMethod(\"format\", arguments);\n  },\n  formatText: function (index, length, formatName, formatValue) {\n    this._applyQuillMethod(\"formatText\", arguments);\n  },\n  formatLine: function (index, length, formatName, formatValue) {\n    this._applyQuillMethod(\"formatLine\", arguments);\n  },\n  getFormat: function (index, length) {\n    return this._applyQuillMethod(\"getFormat\", arguments);\n  },\n  removeFormat: function (index, length) {\n    return this._applyQuillMethod(\"removeFormat\", arguments);\n  },\n  clearHistory: function () {\n    this._applyQuillHistoryMethod(\"clear\");\n  },\n  undo: function () {\n    this._applyQuillHistoryMethod(\"undo\");\n  },\n  redo: function () {\n    this._applyQuillHistoryMethod(\"redo\");\n  },\n  getLength: function () {\n    return this._applyQuillMethod(\"getLength\");\n  },\n  \"delete\": function (index, length) {\n    this._applyQuillMethod(\"deleteText\", arguments);\n  },\n  insertText: function (index, text, formats) {\n    this._applyQuillMethod(\"insertText\", arguments);\n  },\n  insertEmbed: function (index, type, config) {\n    this._applyQuillMethod(\"insertEmbed\", arguments);\n  },\n  showFormDialog: function (formConfig) {\n    return this._formDialog.show(formConfig);\n  },\n  formDialogOption: function (optionName, optionValue) {\n    return this._formDialog.popupOption.apply(this._formDialog, arguments);\n  },\n  focus: function () {\n    this.callBase();\n\n    this._applyQuillMethod(\"focus\");\n  }\n});\n\n(0, _component_registrator.default)(\"dxHtmlEditor\", HtmlEditor);\nvar _default = HtmlEditor;\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["E:/newfrontend/webfe/node_modules/devextreme/ui/html_editor/ui.html_editor.js"],"names":["exports","default","_renderer","_interopRequireDefault","require","_extend","_type","_element","_common","_component_registrator","_empty_template","_editor","_ui","_callbacks","_deferred","_events_engine","_index","_uiEventsEmitterGesture","_utils","_quill_registrator","_converterController","_wordLists","_formDialog","obj","__esModule","_defineProperty","key","value","Object","defineProperty","enumerable","configurable","writable","HTML_EDITOR_CLASS","QUILL_CONTAINER_CLASS","QUILL_CLIPBOARD_CLASS","HTML_EDITOR_SUBMIT_ELEMENT_CLASS","HTML_EDITOR_CONTENT_CLASS","MARKDOWN_VALUE_TYPE","ANONYMOUS_TEMPLATE_NAME","HtmlEditor","inherit","_getDefaultOptions","extend","callBase","focusStateEnabled","valueType","placeholder","toolbar","variables","mediaResizing","mentions","customizeModules","formDialogOptions","_init","_cleanCallback","_contentInitializedCallback","_getAnonymousTemplateName","_initTemplates","_templateManager","addDefaultTemplates","EmptyTemplate","_focusTarget","_getContent","$element","find","concat","_focusInHandler","_ref","relatedTarget","_shouldSkipFocusEvent","_toggleFocusClass","apply","arguments","_focusOutHandler","_ref2","hasClass","_initMarkup","_$htmlContainer","addClass","wrapInner","template","_getTemplate","transclude","_$templateResult","render","container","getPublicElement","noModel","_renderSubmitElement","_updateContainerMarkup","_$submitElement","attr","appendTo","_setSubmitValue","option","_getSubmitElement","val","markup","_isMarkdownValue","_prepareMarkdownConverter","_markdownConverter","toHtml","html","MarkdownConverter","getConverter","Error","_render","_prepareConverters","_prepareQuillRegistrator","_quillRegistrator","_getRegistrator","_deltaConverter","DeltaConverter","_renderContentImpl","_contentRenderedDeferred","Deferred","renderContentPromise","promise","_renderHtmlEditor","_renderFormDialog","_addKeyPressHandler","_attachFocusEvents","deferRender","bind","keyDownEvent","addNamespace","NAME","on","_keyDownHandler","e","_saveValueChangeEvent","_this","modulesConfig","_getModulesConfig","isFunction","_quillInstance","createEditor","readOnly","modules","theme","setQuillInstance","_textChangeHandlerWithContext","_textChangeHandler","_renderScrollHandler","_hasTranscludedContent","_updateContentTask","executeAsync","_applyTranscludedContent","_finalizeContentRendering","$scrollContainer","initScrollData","prepareScrollData","init","noop","valueOption","isDefined","newDelta","clipboard","convert","ops","length","setContents","_this2","quill","getQuill","wordListMatcher","table","_getModuleConfigByOption","resizing","uploader","onDrop","imageBlot","onPaste","onCut","matchers","_getCustomModules","userOptionName","optionValue","config","Array","isArray","_getBaseModuleConfig","editorInstance","_this3","moduleNames","getRegisteredModuleNames","forEach","modulePath","oldDelta","source","htmlMarkup","convertedValue","_updateValueByType","currentValue","_isNullValueConverted","_isEditorUpdating","clearHistory","fire","resolve","converter","ensureDefined","toMarkdown","_resetEnabledState","isEnabled","enable","userOptions","width","height","closeOnOutsideClick","_getQuillContainer","_optionChanged","args","name","updatedValue","_updateHtmlContent","_invalidate","newValue","previousValue","getModule","_repaintToolbar","repaint","_clean","off","_abortUpdateContentTask","empty","abort","_applyQuillMethod","methodName","_applyQuillHistoryMethod","history","addCleanCallback","callback","add","addContentInitializedCallback","register","components","registerModules","get","import","moduleName","getQuillInstance","getSelection","setSelection","index","format","formatName","formatValue","formatText","formatLine","getFormat","removeFormat","undo","redo","getLength","insertText","text","formats","insertEmbed","type","showFormDialog","formConfig","show","formDialogOption","optionName","popupOption","focus","_default","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/html_editor/ui.html_editor.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _element = require(\"../../core/element\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _component_registrator = _interopRequireDefault(require(\"../../core/component_registrator\"));\r\nvar _empty_template = require(\"../../core/templates/empty_template\");\r\nvar _editor = _interopRequireDefault(require(\"../editor/editor\"));\r\nvar _ui = _interopRequireDefault(require(\"../widget/ui.errors\"));\r\nvar _callbacks = _interopRequireDefault(require(\"../../core/utils/callbacks\"));\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _events_engine = _interopRequireDefault(require(\"../../events/core/events_engine\"));\r\nvar _index = require(\"../../events/utils/index\");\r\nvar _uiEventsEmitterGesture = _interopRequireDefault(require(\"../scroll_view/ui.events.emitter.gesture.scroll\"));\r\nvar _utils = require(\"../text_box/utils.scroll\");\r\nvar _quill_registrator = _interopRequireDefault(require(\"./quill_registrator\"));\r\nrequire(\"./converters/delta\");\r\nvar _converterController = _interopRequireDefault(require(\"./converterController\"));\r\nvar _wordLists = _interopRequireDefault(require(\"./matchers/wordLists\"));\r\nvar _formDialog = _interopRequireDefault(require(\"./ui/formDialog\"));\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _defineProperty(obj, key, value) {\r\n    if (key in obj) {\r\n        Object.defineProperty(obj, key, {\r\n            value: value,\r\n            enumerable: true,\r\n            configurable: true,\r\n            writable: true\r\n        })\r\n    } else {\r\n        obj[key] = value\r\n    }\r\n    return obj\r\n}\r\nvar HTML_EDITOR_CLASS = \"dx-htmleditor\";\r\nvar QUILL_CONTAINER_CLASS = \"dx-quill-container\";\r\nvar QUILL_CLIPBOARD_CLASS = \"ql-clipboard\";\r\nvar HTML_EDITOR_SUBMIT_ELEMENT_CLASS = \"dx-htmleditor-submit-element\";\r\nvar HTML_EDITOR_CONTENT_CLASS = \"dx-htmleditor-content\";\r\nvar MARKDOWN_VALUE_TYPE = \"markdown\";\r\nvar ANONYMOUS_TEMPLATE_NAME = \"htmlContent\";\r\nvar HtmlEditor = _editor.default.inherit({\r\n    _getDefaultOptions: function() {\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            focusStateEnabled: true,\r\n            valueType: \"html\",\r\n            placeholder: \"\",\r\n            toolbar: null,\r\n            variables: null,\r\n            mediaResizing: null,\r\n            mentions: null,\r\n            customizeModules: null,\r\n            formDialogOptions: null\r\n        })\r\n    },\r\n    _init: function() {\r\n        this.callBase();\r\n        this._cleanCallback = (0, _callbacks.default)();\r\n        this._contentInitializedCallback = (0, _callbacks.default)()\r\n    },\r\n    _getAnonymousTemplateName: function() {\r\n        return ANONYMOUS_TEMPLATE_NAME\r\n    },\r\n    _initTemplates: function() {\r\n        this._templateManager.addDefaultTemplates(_defineProperty({}, ANONYMOUS_TEMPLATE_NAME, new _empty_template.EmptyTemplate));\r\n        this.callBase()\r\n    },\r\n    _focusTarget: function() {\r\n        return this._getContent()\r\n    },\r\n    _getContent: function() {\r\n        return this.$element().find(\".\".concat(HTML_EDITOR_CONTENT_CLASS))\r\n    },\r\n    _focusInHandler: function(_ref) {\r\n        var relatedTarget = _ref.relatedTarget;\r\n        if (this._shouldSkipFocusEvent(relatedTarget)) {\r\n            return\r\n        }\r\n        this._toggleFocusClass(true, this.$element());\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _focusOutHandler: function(_ref2) {\r\n        var relatedTarget = _ref2.relatedTarget;\r\n        if (this._shouldSkipFocusEvent(relatedTarget)) {\r\n            return\r\n        }\r\n        this._toggleFocusClass(false, this.$element());\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _shouldSkipFocusEvent: function(relatedTarget) {\r\n        return (0, _renderer.default)(relatedTarget).hasClass(QUILL_CLIPBOARD_CLASS)\r\n    },\r\n    _initMarkup: function() {\r\n        this._$htmlContainer = (0, _renderer.default)(\"<div>\").addClass(QUILL_CONTAINER_CLASS);\r\n        this.$element().addClass(HTML_EDITOR_CLASS).wrapInner(this._$htmlContainer);\r\n        var template = this._getTemplate(ANONYMOUS_TEMPLATE_NAME);\r\n        var transclude = true;\r\n        this._$templateResult = template && template.render({\r\n            container: (0, _element.getPublicElement)(this._$htmlContainer),\r\n            noModel: true,\r\n            transclude: transclude\r\n        });\r\n        this._renderSubmitElement();\r\n        this.callBase();\r\n        this._updateContainerMarkup()\r\n    },\r\n    _renderSubmitElement: function() {\r\n        this._$submitElement = (0, _renderer.default)(\"<textarea>\").addClass(HTML_EDITOR_SUBMIT_ELEMENT_CLASS).attr(\"hidden\", true).appendTo(this.$element());\r\n        this._setSubmitValue(this.option(\"value\"))\r\n    },\r\n    _setSubmitValue: function(value) {\r\n        this._getSubmitElement().val(value)\r\n    },\r\n    _getSubmitElement: function() {\r\n        return this._$submitElement\r\n    },\r\n    _updateContainerMarkup: function() {\r\n        var markup = this.option(\"value\");\r\n        if (this._isMarkdownValue()) {\r\n            this._prepareMarkdownConverter();\r\n            markup = this._markdownConverter.toHtml(markup)\r\n        }\r\n        if (markup) {\r\n            this._$htmlContainer.html(markup)\r\n        }\r\n    },\r\n    _prepareMarkdownConverter: function() {\r\n        var MarkdownConverter = _converterController.default.getConverter(\"markdown\");\r\n        if (MarkdownConverter) {\r\n            this._markdownConverter = new MarkdownConverter\r\n        } else {\r\n            throw _ui.default.Error(\"E1051\", \"markdown\")\r\n        }\r\n    },\r\n    _render: function() {\r\n        this._prepareConverters();\r\n        this.callBase()\r\n    },\r\n    _prepareQuillRegistrator: function() {\r\n        if (!this._quillRegistrator) {\r\n            this._quillRegistrator = new _quill_registrator.default\r\n        }\r\n    },\r\n    _getRegistrator: function() {\r\n        this._prepareQuillRegistrator();\r\n        return this._quillRegistrator\r\n    },\r\n    _prepareConverters: function() {\r\n        if (!this._deltaConverter) {\r\n            var DeltaConverter = _converterController.default.getConverter(\"delta\");\r\n            if (DeltaConverter) {\r\n                this._deltaConverter = new DeltaConverter\r\n            }\r\n        }\r\n        if (this.option(\"valueType\") === MARKDOWN_VALUE_TYPE && !this._markdownConverter) {\r\n            this._prepareMarkdownConverter()\r\n        }\r\n    },\r\n    _renderContentImpl: function() {\r\n        this._contentRenderedDeferred = new _deferred.Deferred;\r\n        var renderContentPromise = this._contentRenderedDeferred.promise();\r\n        this.callBase();\r\n        this._renderHtmlEditor();\r\n        this._renderFormDialog();\r\n        this._addKeyPressHandler();\r\n        return renderContentPromise\r\n    },\r\n    _attachFocusEvents: function() {\r\n        (0, _common.deferRender)(this.callBase.bind(this))\r\n    },\r\n    _addKeyPressHandler: function() {\r\n        var keyDownEvent = (0, _index.addNamespace)(\"keydown\", \"\".concat(this.NAME, \"TextChange\"));\r\n        _events_engine.default.on(this._$htmlContainer, keyDownEvent, this._keyDownHandler.bind(this))\r\n    },\r\n    _keyDownHandler: function(e) {\r\n        this._saveValueChangeEvent(e)\r\n    },\r\n    _renderHtmlEditor: function() {\r\n        var _this = this;\r\n        var customizeModules = this.option(\"customizeModules\");\r\n        var modulesConfig = this._getModulesConfig();\r\n        if ((0, _type.isFunction)(customizeModules)) {\r\n            customizeModules(modulesConfig)\r\n        }\r\n        this._quillInstance = this._getRegistrator().createEditor(this._$htmlContainer[0], {\r\n            placeholder: this.option(\"placeholder\"),\r\n            readOnly: this.option(\"readOnly\") || this.option(\"disabled\"),\r\n            modules: modulesConfig,\r\n            theme: \"basic\"\r\n        });\r\n        this._deltaConverter.setQuillInstance(this._quillInstance);\r\n        this._textChangeHandlerWithContext = this._textChangeHandler.bind(this);\r\n        this._quillInstance.on(\"text-change\", this._textChangeHandlerWithContext);\r\n        this._renderScrollHandler();\r\n        if (this._hasTranscludedContent()) {\r\n            this._updateContentTask = (0, _common.executeAsync)(function() {\r\n                _this._applyTranscludedContent()\r\n            })\r\n        } else {\r\n            this._finalizeContentRendering()\r\n        }\r\n    },\r\n    _renderScrollHandler: function() {\r\n        var $scrollContainer = this._getContent();\r\n        var initScrollData = (0, _utils.prepareScrollData)($scrollContainer);\r\n        _events_engine.default.on($scrollContainer, (0, _index.addNamespace)(_uiEventsEmitterGesture.default.init, this.NAME), initScrollData, _common.noop)\r\n    },\r\n    _applyTranscludedContent: function() {\r\n        var valueOption = this.option(\"value\");\r\n        if (!(0, _type.isDefined)(valueOption)) {\r\n            var html = this._deltaConverter.toHtml();\r\n            var newDelta = this._quillInstance.clipboard.convert({\r\n                html: html\r\n            });\r\n            if (newDelta.ops.length) {\r\n                this._quillInstance.setContents(newDelta);\r\n                return\r\n            }\r\n        }\r\n        this._finalizeContentRendering()\r\n    },\r\n    _hasTranscludedContent: function() {\r\n        return this._$templateResult && this._$templateResult.length\r\n    },\r\n    _getModulesConfig: function() {\r\n        var _this2 = this;\r\n        var quill = this._getRegistrator().getQuill();\r\n        var wordListMatcher = (0, _wordLists.default)(quill);\r\n        var modulesConfig = (0, _extend.extend)({}, {\r\n            table: true,\r\n            toolbar: this._getModuleConfigByOption(\"toolbar\"),\r\n            variables: this._getModuleConfigByOption(\"variables\"),\r\n            resizing: this._getModuleConfigByOption(\"mediaResizing\"),\r\n            mentions: this._getModuleConfigByOption(\"mentions\"),\r\n            uploader: {\r\n                onDrop: function(e) {\r\n                    return _this2._saveValueChangeEvent(e)\r\n                },\r\n                imageBlot: \"extendedImage\"\r\n            },\r\n            clipboard: {\r\n                onPaste: function(e) {\r\n                    return _this2._saveValueChangeEvent(e)\r\n                },\r\n                onCut: function(e) {\r\n                    return _this2._saveValueChangeEvent(e)\r\n                },\r\n                matchers: [\r\n                    [\"p.MsoListParagraphCxSpFirst\", wordListMatcher],\r\n                    [\"p.MsoListParagraphCxSpMiddle\", wordListMatcher],\r\n                    [\"p.MsoListParagraphCxSpLast\", wordListMatcher]\r\n                ]\r\n            }\r\n        }, this._getCustomModules());\r\n        return modulesConfig\r\n    },\r\n    _getModuleConfigByOption: function(userOptionName) {\r\n        var optionValue = this.option(userOptionName);\r\n        var config = {};\r\n        if (!(0, _type.isDefined)(optionValue)) {\r\n            return\r\n        }\r\n        if (Array.isArray(optionValue)) {\r\n            config[userOptionName] = optionValue\r\n        } else {\r\n            config = optionValue\r\n        }\r\n        return (0, _extend.extend)(this._getBaseModuleConfig(), config)\r\n    },\r\n    _getBaseModuleConfig: function() {\r\n        return {\r\n            editorInstance: this\r\n        }\r\n    },\r\n    _getCustomModules: function() {\r\n        var _this3 = this;\r\n        var modules = {};\r\n        var moduleNames = this._getRegistrator().getRegisteredModuleNames();\r\n        moduleNames.forEach(function(modulePath) {\r\n            modules[modulePath] = _this3._getBaseModuleConfig()\r\n        });\r\n        return modules\r\n    },\r\n    _textChangeHandler: function(newDelta, oldDelta, source) {\r\n        var htmlMarkup = this._deltaConverter.toHtml();\r\n        var convertedValue = this._isMarkdownValue() ? this._updateValueByType(MARKDOWN_VALUE_TYPE, htmlMarkup) : htmlMarkup;\r\n        var currentValue = this.option(\"value\");\r\n        if (currentValue !== convertedValue && !this._isNullValueConverted(currentValue, convertedValue)) {\r\n            this._isEditorUpdating = true;\r\n            this.option(\"value\", convertedValue)\r\n        }\r\n        this._finalizeContentRendering()\r\n    },\r\n    _isNullValueConverted: function(currentValue, convertedValue) {\r\n        return null === currentValue && \"\" === convertedValue\r\n    },\r\n    _finalizeContentRendering: function() {\r\n        if (this._contentRenderedDeferred) {\r\n            this.clearHistory();\r\n            this._contentInitializedCallback.fire();\r\n            this._contentRenderedDeferred.resolve();\r\n            this._contentRenderedDeferred = void 0\r\n        }\r\n    },\r\n    _updateValueByType: function(valueType, value) {\r\n        var converter = this._markdownConverter;\r\n        if (!(0, _type.isDefined)(converter)) {\r\n            return\r\n        }\r\n        var currentValue = (0, _common.ensureDefined)(value, this.option(\"value\"));\r\n        return valueType === MARKDOWN_VALUE_TYPE ? converter.toMarkdown(currentValue) : converter.toHtml(currentValue)\r\n    },\r\n    _isMarkdownValue: function() {\r\n        return this.option(\"valueType\") === MARKDOWN_VALUE_TYPE\r\n    },\r\n    _resetEnabledState: function() {\r\n        if (this._quillInstance) {\r\n            var isEnabled = !(this.option(\"readOnly\") || this.option(\"disabled\"));\r\n            this._quillInstance.enable(isEnabled)\r\n        }\r\n    },\r\n    _renderFormDialog: function() {\r\n        var userOptions = (0, _extend.extend)(true, {\r\n            width: \"auto\",\r\n            height: \"auto\",\r\n            closeOnOutsideClick: true\r\n        }, this.option(\"formDialogOptions\"));\r\n        this._formDialog = new _formDialog.default(this, userOptions)\r\n    },\r\n    _getQuillContainer: function() {\r\n        return this._$htmlContainer\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"value\":\r\n                if (this._quillInstance) {\r\n                    if (this._isEditorUpdating) {\r\n                        this._isEditorUpdating = false\r\n                    } else {\r\n                        var updatedValue = this._isMarkdownValue() ? this._updateValueByType(\"HTML\", args.value) : args.value;\r\n                        this._updateHtmlContent(updatedValue)\r\n                    }\r\n                } else {\r\n                    this._$htmlContainer.html(args.value)\r\n                }\r\n                this._setSubmitValue(args.value);\r\n                this.callBase(args);\r\n                break;\r\n            case \"placeholder\":\r\n            case \"variables\":\r\n            case \"toolbar\":\r\n            case \"mentions\":\r\n            case \"customizeModules\":\r\n                this._invalidate();\r\n                break;\r\n            case \"valueType\":\r\n                this._prepareConverters();\r\n                var newValue = this._updateValueByType(args.value);\r\n                if (\"html\" === args.value && this._quillInstance) {\r\n                    this._updateHtmlContent(newValue)\r\n                } else {\r\n                    this.option(\"value\", newValue)\r\n                }\r\n                break;\r\n            case \"readOnly\":\r\n            case \"disabled\":\r\n                this.callBase(args);\r\n                this._resetEnabledState();\r\n                break;\r\n            case \"formDialogOptions\":\r\n                this._renderFormDialog();\r\n                break;\r\n            case \"mediaResizing\":\r\n                if (!args.previousValue || !args.value) {\r\n                    this._invalidate()\r\n                } else {\r\n                    this._quillInstance.getModule(\"resizing\").option(args.name, args.value)\r\n                }\r\n                break;\r\n            case \"width\":\r\n                this.callBase(args);\r\n                this._repaintToolbar();\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    _repaintToolbar: function() {\r\n        var toolbar = this._quillInstance.getModule(\"toolbar\");\r\n        toolbar && toolbar.repaint()\r\n    },\r\n    _updateHtmlContent: function(html) {\r\n        var newDelta = this._quillInstance.clipboard.convert({\r\n            html: html\r\n        });\r\n        this._quillInstance.setContents(newDelta)\r\n    },\r\n    _clean: function() {\r\n        if (this._quillInstance) {\r\n            _events_engine.default.off(this._getContent(), \".\".concat(this.NAME));\r\n            this._quillInstance.off(\"text-change\", this._textChangeHandlerWithContext);\r\n            this._cleanCallback.fire()\r\n        }\r\n        this._abortUpdateContentTask();\r\n        this._cleanCallback.empty();\r\n        this._contentInitializedCallback.empty();\r\n        this.callBase()\r\n    },\r\n    _abortUpdateContentTask: function() {\r\n        if (this._updateContentTask) {\r\n            this._updateContentTask.abort();\r\n            this._updateContentTask = void 0\r\n        }\r\n    },\r\n    _applyQuillMethod: function(methodName, args) {\r\n        if (this._quillInstance) {\r\n            return this._quillInstance[methodName].apply(this._quillInstance, args)\r\n        }\r\n    },\r\n    _applyQuillHistoryMethod: function(methodName) {\r\n        if (this._quillInstance && this._quillInstance.history) {\r\n            this._quillInstance.history[methodName]()\r\n        }\r\n    },\r\n    addCleanCallback: function(callback) {\r\n        this._cleanCallback.add(callback)\r\n    },\r\n    addContentInitializedCallback: function(callback) {\r\n        this._contentInitializedCallback.add(callback)\r\n    },\r\n    register: function(components) {\r\n        this._getRegistrator().registerModules(components);\r\n        if (this._quillInstance) {\r\n            this.repaint()\r\n        }\r\n    },\r\n    get: function(modulePath) {\r\n        return this._getRegistrator().getQuill().import(modulePath)\r\n    },\r\n    getModule: function(moduleName) {\r\n        return this._applyQuillMethod(\"getModule\", arguments)\r\n    },\r\n    getQuillInstance: function() {\r\n        return this._quillInstance\r\n    },\r\n    getSelection: function() {\r\n        return this._applyQuillMethod(\"getSelection\")\r\n    },\r\n    setSelection: function(index, length) {\r\n        this._applyQuillMethod(\"setSelection\", arguments)\r\n    },\r\n    format: function(formatName, formatValue) {\r\n        this._applyQuillMethod(\"format\", arguments)\r\n    },\r\n    formatText: function(index, length, formatName, formatValue) {\r\n        this._applyQuillMethod(\"formatText\", arguments)\r\n    },\r\n    formatLine: function(index, length, formatName, formatValue) {\r\n        this._applyQuillMethod(\"formatLine\", arguments)\r\n    },\r\n    getFormat: function(index, length) {\r\n        return this._applyQuillMethod(\"getFormat\", arguments)\r\n    },\r\n    removeFormat: function(index, length) {\r\n        return this._applyQuillMethod(\"removeFormat\", arguments)\r\n    },\r\n    clearHistory: function() {\r\n        this._applyQuillHistoryMethod(\"clear\")\r\n    },\r\n    undo: function() {\r\n        this._applyQuillHistoryMethod(\"undo\")\r\n    },\r\n    redo: function() {\r\n        this._applyQuillHistoryMethod(\"redo\")\r\n    },\r\n    getLength: function() {\r\n        return this._applyQuillMethod(\"getLength\")\r\n    },\r\n    \"delete\": function(index, length) {\r\n        this._applyQuillMethod(\"deleteText\", arguments)\r\n    },\r\n    insertText: function(index, text, formats) {\r\n        this._applyQuillMethod(\"insertText\", arguments)\r\n    },\r\n    insertEmbed: function(index, type, config) {\r\n        this._applyQuillMethod(\"insertEmbed\", arguments)\r\n    },\r\n    showFormDialog: function(formConfig) {\r\n        return this._formDialog.show(formConfig)\r\n    },\r\n    formDialogOption: function(optionName, optionValue) {\r\n        return this._formDialog.popupOption.apply(this._formDialog, arguments)\r\n    },\r\n    focus: function() {\r\n        this.callBase();\r\n        this._applyQuillMethod(\"focus\")\r\n    }\r\n});\r\n(0, _component_registrator.default)(\"dxHtmlEditor\", HtmlEditor);\r\nvar _default = HtmlEditor;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}