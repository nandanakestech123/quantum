{"ast":null,"code":"/**\r\n * DevExtreme (viz/vector_map/tracker.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.Tracker = Tracker;\n\nvar _events_engine = _interopRequireDefault(require(\"../../events/core/events_engine\"));\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _dom_adapter = _interopRequireDefault(require(\"../../core/dom_adapter\"));\n\nvar _event_emitter = require(\"./event_emitter\");\n\nvar _index = require(\"../../events/utils/index\");\n\nvar _wheel = require(\"../../events/core/wheel\");\n\nvar _utils = require(\"../core/utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar navigator = (0, _window.getNavigator)();\nvar _math = Math;\nvar _abs = _math.abs;\nvar _sqrt = _math.sqrt;\nvar _round = _math.round;\nvar _addNamespace = _index.addNamespace;\nvar _NAME = \"dxVectorMap\";\nvar EVENT_START = \"start\";\nvar EVENT_MOVE = \"move\";\nvar EVENT_END = \"end\";\nvar EVENT_ZOOM = \"zoom\";\nvar EVENT_HOVER_ON = \"hover-on\";\nvar EVENT_HOVER_OFF = \"hover-off\";\nvar EVENT_CLICK = \"click\";\nvar EVENT_FOCUS_ON = \"focus-on\";\nvar EVENT_FOCUS_MOVE = \"focus-move\";\nvar EVENT_FOCUS_OFF = \"focus-off\";\nvar CLICK_TIME_THRESHOLD = 500;\nvar CLICK_COORD_THRESHOLD_MOUSE = 5;\nvar CLICK_COORD_THRESHOLD_TOUCH = 20;\nvar DRAG_COORD_THRESHOLD_MOUSE = 5;\nvar DRAG_COORD_THRESHOLD_TOUCH = 10;\nvar FOCUS_OFF_DELAY = 100;\nvar WHEEL_COOLDOWN = 50;\nvar WHEEL_DIRECTION_COOLDOWN = 300;\nvar EVENTS;\nvar Focus;\nsetupEvents();\n\nfunction Tracker(parameters) {\n  var that = this;\n  that._root = parameters.root;\n\n  that._createEventHandlers(parameters.dataKey);\n\n  that._createProjectionHandlers(parameters.projection);\n\n  that._initEvents();\n\n  that._focus = new Focus(function (name, arg) {\n    that._fire(name, arg);\n  });\n\n  that._attachHandlers();\n}\n\nTracker.prototype = {\n  constructor: Tracker,\n  dispose: function () {\n    var that = this;\n\n    that._detachHandlers();\n\n    that._disposeEvents();\n\n    that._focus.dispose();\n\n    that._root = that._focus = that._docHandlers = that._rootHandlers = null;\n  },\n  _eventNames: [EVENT_START, EVENT_MOVE, EVENT_END, EVENT_ZOOM, EVENT_CLICK, EVENT_HOVER_ON, EVENT_HOVER_OFF, EVENT_FOCUS_ON, EVENT_FOCUS_OFF, EVENT_FOCUS_MOVE],\n  _startClick: function (event, data) {\n    if (!data) {\n      return;\n    }\n\n    var coords = getEventCoords(event);\n    this._clickState = {\n      x: coords.x,\n      y: coords.y,\n      threshold: isTouchEvent(event) ? CLICK_COORD_THRESHOLD_TOUCH : CLICK_COORD_THRESHOLD_MOUSE,\n      time: Date.now()\n    };\n  },\n  _endClick: function (event, data) {\n    var state = this._clickState;\n    var threshold;\n    var coords;\n\n    if (!state) {\n      return;\n    }\n\n    if (data && Date.now() - state.time <= CLICK_TIME_THRESHOLD) {\n      threshold = state.threshold;\n      coords = getEventCoords(event);\n\n      if (_abs(coords.x - state.x) <= threshold && _abs(coords.y - state.y) <= threshold) {\n        this._fire(EVENT_CLICK, {\n          data: data,\n          x: coords.x,\n          y: coords.y,\n          $event: event\n        });\n      }\n    }\n\n    this._clickState = null;\n  },\n  _startDrag: function (event, data) {\n    if (!data) {\n      return;\n    }\n\n    var coords = getEventCoords(event);\n    var state = this._dragState = {\n      x: coords.x,\n      y: coords.y,\n      data: data\n    };\n\n    this._fire(EVENT_START, {\n      x: state.x,\n      y: state.y,\n      data: state.data\n    });\n  },\n  _moveDrag: function (event, data) {\n    var state = this._dragState;\n\n    if (!state) {\n      return;\n    }\n\n    var coords = getEventCoords(event);\n    var threshold = isTouchEvent(event) ? DRAG_COORD_THRESHOLD_TOUCH : DRAG_COORD_THRESHOLD_MOUSE;\n\n    if (state.active || _abs(coords.x - state.x) > threshold || _abs(coords.y - state.y) > threshold) {\n      state.x = coords.x;\n      state.y = coords.y;\n      state.active = true;\n      state.data = data || {};\n\n      this._fire(EVENT_MOVE, {\n        x: state.x,\n        y: state.y,\n        data: state.data\n      });\n    }\n  },\n  _endDrag: function () {\n    var state = this._dragState;\n\n    if (!state) {\n      return;\n    }\n\n    this._dragState = null;\n\n    this._fire(EVENT_END, {\n      x: state.x,\n      y: state.y,\n      data: state.data\n    });\n  },\n  _wheelZoom: function (event, data) {\n    if (!data) {\n      return;\n    }\n\n    var that = this;\n    var lock = that._wheelLock;\n    var time = Date.now();\n\n    if (time - lock.time <= WHEEL_COOLDOWN) {\n      return;\n    }\n\n    if (time - lock.dirTime > WHEEL_DIRECTION_COOLDOWN) {\n      lock.dir = 0;\n    }\n\n    var delta = adjustWheelDelta(event.delta / 120 || 0, lock);\n\n    if (0 === delta) {\n      return;\n    }\n\n    var coords = getEventCoords(event);\n\n    that._fire(EVENT_ZOOM, {\n      delta: delta,\n      x: coords.x,\n      y: coords.y\n    });\n\n    lock.time = lock.dirTime = time;\n  },\n  _startZoom: function (event, data) {\n    if (!isTouchEvent(event) || !data) {\n      return;\n    }\n\n    var state = this._zoomState = this._zoomState || {};\n    var coords;\n    var pointer2;\n\n    if (state.pointer1 && state.pointer2) {\n      return;\n    }\n\n    if (void 0 === state.pointer1) {\n      state.pointer1 = getPointerId(event) || 0;\n      coords = getMultitouchEventCoords(event, state.pointer1);\n      state.x1 = state.x1_0 = coords.x;\n      state.y1 = state.y1_0 = coords.y;\n    }\n\n    if (void 0 === state.pointer2) {\n      pointer2 = getPointerId(event) || 1;\n\n      if (pointer2 !== state.pointer1) {\n        coords = getMultitouchEventCoords(event, pointer2);\n\n        if (coords) {\n          state.x2 = state.x2_0 = coords.x;\n          state.y2 = state.y2_0 = coords.y;\n          state.pointer2 = pointer2;\n          state.ready = true;\n\n          this._endDrag();\n        }\n      }\n    }\n  },\n  _moveZoom: function (event) {\n    var state = this._zoomState;\n    var coords;\n\n    if (!state || !isTouchEvent(event)) {\n      return;\n    }\n\n    if (void 0 !== state.pointer1) {\n      coords = getMultitouchEventCoords(event, state.pointer1);\n\n      if (coords) {\n        state.x1 = coords.x;\n        state.y1 = coords.y;\n      }\n    }\n\n    if (void 0 !== state.pointer2) {\n      coords = getMultitouchEventCoords(event, state.pointer2);\n\n      if (coords) {\n        state.x2 = coords.x;\n        state.y2 = coords.y;\n      }\n    }\n  },\n  _endZoom: function (event) {\n    var state = this._zoomState;\n    var startDistance;\n    var currentDistance;\n\n    if (!state || !isTouchEvent(event)) {\n      return;\n    }\n\n    if (state.ready) {\n      startDistance = getDistance(state.x1_0, state.y1_0, state.x2_0, state.y2_0);\n      currentDistance = getDistance(state.x1, state.y1, state.x2, state.y2);\n\n      this._fire(EVENT_ZOOM, {\n        ratio: currentDistance / startDistance,\n        x: (state.x1_0 + state.x2_0) / 2,\n        y: (state.y1_0 + state.y2_0) / 2\n      });\n    }\n\n    this._zoomState = null;\n  },\n  _startHover: function (event, data) {\n    this._doHover(event, data, true);\n  },\n  _moveHover: function (event, data) {\n    this._doHover(event, data, false);\n  },\n  _doHover: function (event, data, isTouch) {\n    var that = this;\n\n    if (that._dragState && that._dragState.active || that._zoomState && that._zoomState.ready) {\n      that._cancelHover();\n\n      return;\n    }\n\n    if (isTouchEvent(event) !== isTouch || that._hoverTarget === event.target || that._hoverState && that._hoverState.data === data) {\n      return;\n    }\n\n    that._cancelHover();\n\n    if (data) {\n      that._hoverState = {\n        data: data\n      };\n\n      that._fire(EVENT_HOVER_ON, {\n        data: data\n      });\n    }\n\n    that._hoverTarget = event.target;\n  },\n  _cancelHover: function () {\n    var state = this._hoverState;\n    this._hoverState = this._hoverTarget = null;\n\n    if (state) {\n      this._fire(EVENT_HOVER_OFF, {\n        data: state.data\n      });\n    }\n  },\n  _startFocus: function (event, data) {\n    this._doFocus(event, data, true);\n  },\n  _moveFocus: function (event, data) {\n    this._doFocus(event, data, false);\n  },\n  _doFocus: function (event, data, isTouch) {\n    var that = this;\n\n    if (that._dragState && that._dragState.active || that._zoomState && that._zoomState.ready) {\n      that._cancelFocus();\n\n      return;\n    }\n\n    if (isTouchEvent(event) !== isTouch) {\n      return;\n    }\n\n    that._focus.turnOff();\n\n    data && that._focus.turnOn(data, getEventCoords(event));\n  },\n  _cancelFocus: function () {\n    this._focus.cancel();\n  },\n  _createEventHandlers: function (DATA_KEY) {\n    var that = this;\n    that._docHandlers = {};\n    that._rootHandlers = {};\n\n    that._rootHandlers[EVENTS.start] = that._docHandlers[EVENTS.start] = function (event) {\n      var isTouch = isTouchEvent(event);\n      var data = getData(event);\n\n      if (isTouch && !that._isTouchEnabled) {\n        return;\n      }\n\n      if (data) {\n        event.preventDefault();\n        event.stopPropagation();\n      }\n\n      that._startClick(event, data);\n\n      that._startDrag(event, data);\n\n      that._startZoom(event, data);\n\n      that._startHover(event, data);\n\n      that._startFocus(event, data);\n    };\n\n    that._docHandlers[EVENTS.move] = function (event) {\n      var isTouch = isTouchEvent(event);\n      var data = getData(event);\n\n      if (isTouch && !that._isTouchEnabled) {\n        return;\n      }\n\n      that._moveDrag(event, data);\n\n      that._moveZoom(event, data);\n\n      that._moveHover(event, data);\n\n      that._moveFocus(event, data);\n    };\n\n    that._docHandlers[EVENTS.end] = function (event) {\n      var isTouch = isTouchEvent(event);\n      var data = getData(event);\n\n      if (isTouch && !that._isTouchEnabled) {\n        return;\n      }\n\n      that._endClick(event, data);\n\n      that._endDrag(event, data);\n\n      that._endZoom(event, data);\n    };\n\n    that._rootHandlers[EVENTS.wheel] = function (event) {\n      that._cancelFocus();\n\n      if (!that._isWheelEnabled) {\n        return;\n      }\n\n      var data = getData(event);\n\n      if (data) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        that._wheelZoom(event, data);\n      }\n    };\n\n    that._wheelLock = {\n      dir: 0\n    };\n\n    function getData(event) {\n      var target = event.target;\n      return (\"tspan\" === target.tagName ? target.parentNode : target)[DATA_KEY];\n    }\n  },\n  _createProjectionHandlers: function (projection) {\n    var that = this;\n    projection.on({\n      center: handler,\n      zoom: handler\n    });\n\n    function handler() {\n      that._cancelFocus();\n    }\n  },\n  reset: function () {\n    var that = this;\n    that._clickState = null;\n\n    that._endDrag();\n\n    that._cancelHover();\n\n    that._cancelFocus();\n  },\n  setOptions: function (options) {\n    var that = this;\n    that.reset();\n\n    that._detachHandlers();\n\n    that._isTouchEnabled = !!(0, _utils.parseScalar)(options.touchEnabled, true);\n    that._isWheelEnabled = !!(0, _utils.parseScalar)(options.wheelEnabled, true);\n\n    that._attachHandlers();\n  },\n  _detachHandlers: function () {\n    var that = this;\n\n    if (that._isTouchEnabled) {\n      that._root.css({\n        \"touch-action\": \"\",\n        \"-webkit-user-select\": \"\"\n      }).off(_addNamespace(\"MSHoldVisual\", _NAME)).off(_addNamespace(\"contextmenu\", _NAME));\n    }\n\n    _events_engine.default.off(_dom_adapter.default.getDocument(), that._docHandlers);\n\n    that._root.off(that._rootHandlers);\n  },\n  _attachHandlers: function () {\n    var that = this;\n\n    if (that._isTouchEnabled) {\n      that._root.css({\n        \"touch-action\": \"none\",\n        \"-webkit-user-select\": \"none\"\n      }).on(_addNamespace(\"MSHoldVisual\", _NAME), function (event) {\n        event.preventDefault();\n      }).on(_addNamespace(\"contextmenu\", _NAME), function (event) {\n        isTouchEvent(event) && event.preventDefault();\n      });\n    }\n\n    _events_engine.default.on(_dom_adapter.default.getDocument(), that._docHandlers);\n\n    that._root.on(that._rootHandlers);\n  }\n};\n\nFocus = function (fire) {\n  var that = this;\n  var _activeData = null;\n  var _data = null;\n  var _disabled = false;\n  var _offTimer = null;\n\n  var _x;\n\n  var _y;\n\n  that.dispose = function () {\n    clearTimeout(_offTimer);\n    that.turnOn = that.turnOff = that.cancel = that.dispose = that = fire = _activeData = _data = _offTimer = null;\n  };\n\n  that.turnOn = function (data, coords) {\n    if (data === _data && _disabled) {\n      return;\n    }\n\n    _disabled = false;\n    _data = data;\n\n    if (_activeData) {\n      _x = coords.x;\n      _y = coords.y;\n\n      if (_data === _activeData) {\n        fire(EVENT_FOCUS_MOVE, {\n          data: _data,\n          x: _x,\n          y: _y\n        });\n        onCheck(true);\n      } else {\n        fire(EVENT_FOCUS_ON, {\n          data: _data,\n          x: _x,\n          y: _y,\n          done: onCheck\n        });\n      }\n    } else {\n      _x = coords.x;\n      _y = coords.y;\n      fire(EVENT_FOCUS_ON, {\n        data: _data,\n        x: _x,\n        y: _y,\n        done: onCheck\n      });\n    }\n\n    function onCheck(result) {\n      _disabled = !result;\n\n      if (result) {\n        _activeData = _data;\n        clearTimeout(_offTimer);\n        _offTimer = null;\n      }\n    }\n  };\n\n  that.turnOff = function () {\n    _data = null;\n\n    if (_activeData && !_disabled) {\n      _offTimer = _offTimer || setTimeout(function () {\n        _offTimer = null;\n        fire(EVENT_FOCUS_OFF, {\n          data: _activeData\n        });\n        _activeData = null;\n      }, FOCUS_OFF_DELAY);\n    }\n  };\n\n  that.cancel = function () {\n    clearTimeout(_offTimer);\n\n    if (_activeData) {\n      fire(EVENT_FOCUS_OFF, {\n        data: _activeData\n      });\n    }\n\n    _activeData = _data = _offTimer = null;\n  };\n};\n\n(0, _event_emitter.makeEventEmitter)(Tracker);\n\nfunction getDistance(x1, y1, x2, y2) {\n  return _sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));\n}\n\nfunction isTouchEvent(event) {\n  var type = event.originalEvent.type;\n  var pointerType = event.originalEvent.pointerType;\n  return /^touch/.test(type) || /^MSPointer/.test(type) && 4 !== pointerType || /^pointer/.test(type) && \"mouse\" !== pointerType;\n}\n\nfunction selectItem(flags, items) {\n  var i = 0;\n  var ii = flags.length;\n  var item;\n\n  for (; i < ii; ++i) {\n    if (flags[i]) {\n      item = items[i];\n      break;\n    }\n  }\n\n  return _addNamespace(item || items[i], _NAME);\n}\n\nfunction setupEvents() {\n  var flags = [navigator.pointerEnabled, navigator.msPointerEnabled, (0, _window.hasProperty)(\"ontouchstart\")];\n  EVENTS = {\n    start: selectItem(flags, [\"pointerdown\", \"MSPointerDown\", \"touchstart mousedown\", \"mousedown\"]),\n    move: selectItem(flags, [\"pointermove\", \"MSPointerMove\", \"touchmove mousemove\", \"mousemove\"]),\n    end: selectItem(flags, [\"pointerup\", \"MSPointerUp\", \"touchend mouseup\", \"mouseup\"]),\n    wheel: _addNamespace(_wheel.name, _NAME)\n  };\n}\n\nfunction getEventCoords(event) {\n  var originalEvent = event.originalEvent;\n  var touch = originalEvent.touches && originalEvent.touches[0] || {};\n  return {\n    x: touch.pageX || originalEvent.pageX || event.pageX,\n    y: touch.pageY || originalEvent.pageY || event.pageY\n  };\n}\n\nfunction getPointerId(event) {\n  return event.originalEvent.pointerId;\n}\n\nfunction getMultitouchEventCoords(event, pointerId) {\n  var originalEvent = event.originalEvent;\n\n  if (void 0 !== originalEvent.pointerId) {\n    originalEvent = originalEvent.pointerId === pointerId ? originalEvent : null;\n  } else {\n    originalEvent = originalEvent.touches[pointerId];\n  }\n\n  return originalEvent ? {\n    x: originalEvent.pageX || event.pageX,\n    y: originalEvent.pageY || event.pageY\n  } : null;\n}\n\nfunction adjustWheelDelta(delta, lock) {\n  if (0 === delta) {\n    return 0;\n  }\n\n  var _delta = _abs(delta);\n\n  var sign = _round(delta / _delta);\n\n  if (lock.dir && sign !== lock.dir) {\n    return 0;\n  }\n\n  lock.dir = sign;\n\n  if (_delta < .1) {\n    _delta = 0;\n  } else {\n    if (_delta < 1) {\n      _delta = 1;\n    } else {\n      if (_delta > 4) {\n        _delta = 4;\n      } else {\n        _delta = _round(_delta);\n      }\n    }\n  }\n\n  return sign * _delta;\n}","map":{"version":3,"sources":["E:/newfrontend/webfe/node_modules/devextreme/viz/vector_map/tracker.js"],"names":["exports","Tracker","_events_engine","_interopRequireDefault","require","_window","_dom_adapter","_event_emitter","_index","_wheel","_utils","obj","__esModule","navigator","getNavigator","_math","Math","_abs","abs","_sqrt","sqrt","_round","round","_addNamespace","addNamespace","_NAME","EVENT_START","EVENT_MOVE","EVENT_END","EVENT_ZOOM","EVENT_HOVER_ON","EVENT_HOVER_OFF","EVENT_CLICK","EVENT_FOCUS_ON","EVENT_FOCUS_MOVE","EVENT_FOCUS_OFF","CLICK_TIME_THRESHOLD","CLICK_COORD_THRESHOLD_MOUSE","CLICK_COORD_THRESHOLD_TOUCH","DRAG_COORD_THRESHOLD_MOUSE","DRAG_COORD_THRESHOLD_TOUCH","FOCUS_OFF_DELAY","WHEEL_COOLDOWN","WHEEL_DIRECTION_COOLDOWN","EVENTS","Focus","setupEvents","parameters","that","_root","root","_createEventHandlers","dataKey","_createProjectionHandlers","projection","_initEvents","_focus","name","arg","_fire","_attachHandlers","prototype","constructor","dispose","_detachHandlers","_disposeEvents","_docHandlers","_rootHandlers","_eventNames","_startClick","event","data","coords","getEventCoords","_clickState","x","y","threshold","isTouchEvent","time","Date","now","_endClick","state","$event","_startDrag","_dragState","_moveDrag","active","_endDrag","_wheelZoom","lock","_wheelLock","dirTime","dir","delta","adjustWheelDelta","_startZoom","_zoomState","pointer2","pointer1","getPointerId","getMultitouchEventCoords","x1","x1_0","y1","y1_0","x2","x2_0","y2","y2_0","ready","_moveZoom","_endZoom","startDistance","currentDistance","getDistance","ratio","_startHover","_doHover","_moveHover","isTouch","_cancelHover","_hoverTarget","target","_hoverState","_startFocus","_doFocus","_moveFocus","_cancelFocus","turnOff","turnOn","cancel","DATA_KEY","start","getData","_isTouchEnabled","preventDefault","stopPropagation","move","end","wheel","_isWheelEnabled","tagName","parentNode","on","center","handler","zoom","reset","setOptions","options","parseScalar","touchEnabled","wheelEnabled","css","off","default","getDocument","fire","_activeData","_data","_disabled","_offTimer","_x","_y","clearTimeout","onCheck","done","result","setTimeout","makeEventEmitter","type","originalEvent","pointerType","test","selectItem","flags","items","i","ii","length","item","pointerEnabled","msPointerEnabled","hasProperty","touch","touches","pageX","pageY","pointerId","_delta","sign"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/vector_map/tracker.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.Tracker = Tracker;\r\nvar _events_engine = _interopRequireDefault(require(\"../../events/core/events_engine\"));\r\nvar _window = require(\"../../core/utils/window\");\r\nvar _dom_adapter = _interopRequireDefault(require(\"../../core/dom_adapter\"));\r\nvar _event_emitter = require(\"./event_emitter\");\r\nvar _index = require(\"../../events/utils/index\");\r\nvar _wheel = require(\"../../events/core/wheel\");\r\nvar _utils = require(\"../core/utils\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar navigator = (0, _window.getNavigator)();\r\nvar _math = Math;\r\nvar _abs = _math.abs;\r\nvar _sqrt = _math.sqrt;\r\nvar _round = _math.round;\r\nvar _addNamespace = _index.addNamespace;\r\nvar _NAME = \"dxVectorMap\";\r\nvar EVENT_START = \"start\";\r\nvar EVENT_MOVE = \"move\";\r\nvar EVENT_END = \"end\";\r\nvar EVENT_ZOOM = \"zoom\";\r\nvar EVENT_HOVER_ON = \"hover-on\";\r\nvar EVENT_HOVER_OFF = \"hover-off\";\r\nvar EVENT_CLICK = \"click\";\r\nvar EVENT_FOCUS_ON = \"focus-on\";\r\nvar EVENT_FOCUS_MOVE = \"focus-move\";\r\nvar EVENT_FOCUS_OFF = \"focus-off\";\r\nvar CLICK_TIME_THRESHOLD = 500;\r\nvar CLICK_COORD_THRESHOLD_MOUSE = 5;\r\nvar CLICK_COORD_THRESHOLD_TOUCH = 20;\r\nvar DRAG_COORD_THRESHOLD_MOUSE = 5;\r\nvar DRAG_COORD_THRESHOLD_TOUCH = 10;\r\nvar FOCUS_OFF_DELAY = 100;\r\nvar WHEEL_COOLDOWN = 50;\r\nvar WHEEL_DIRECTION_COOLDOWN = 300;\r\nvar EVENTS;\r\nvar Focus;\r\nsetupEvents();\r\n\r\nfunction Tracker(parameters) {\r\n    var that = this;\r\n    that._root = parameters.root;\r\n    that._createEventHandlers(parameters.dataKey);\r\n    that._createProjectionHandlers(parameters.projection);\r\n    that._initEvents();\r\n    that._focus = new Focus(function(name, arg) {\r\n        that._fire(name, arg)\r\n    });\r\n    that._attachHandlers()\r\n}\r\nTracker.prototype = {\r\n    constructor: Tracker,\r\n    dispose: function() {\r\n        var that = this;\r\n        that._detachHandlers();\r\n        that._disposeEvents();\r\n        that._focus.dispose();\r\n        that._root = that._focus = that._docHandlers = that._rootHandlers = null\r\n    },\r\n    _eventNames: [EVENT_START, EVENT_MOVE, EVENT_END, EVENT_ZOOM, EVENT_CLICK, EVENT_HOVER_ON, EVENT_HOVER_OFF, EVENT_FOCUS_ON, EVENT_FOCUS_OFF, EVENT_FOCUS_MOVE],\r\n    _startClick: function(event, data) {\r\n        if (!data) {\r\n            return\r\n        }\r\n        var coords = getEventCoords(event);\r\n        this._clickState = {\r\n            x: coords.x,\r\n            y: coords.y,\r\n            threshold: isTouchEvent(event) ? CLICK_COORD_THRESHOLD_TOUCH : CLICK_COORD_THRESHOLD_MOUSE,\r\n            time: Date.now()\r\n        }\r\n    },\r\n    _endClick: function(event, data) {\r\n        var state = this._clickState;\r\n        var threshold;\r\n        var coords;\r\n        if (!state) {\r\n            return\r\n        }\r\n        if (data && Date.now() - state.time <= CLICK_TIME_THRESHOLD) {\r\n            threshold = state.threshold;\r\n            coords = getEventCoords(event);\r\n            if (_abs(coords.x - state.x) <= threshold && _abs(coords.y - state.y) <= threshold) {\r\n                this._fire(EVENT_CLICK, {\r\n                    data: data,\r\n                    x: coords.x,\r\n                    y: coords.y,\r\n                    $event: event\r\n                })\r\n            }\r\n        }\r\n        this._clickState = null\r\n    },\r\n    _startDrag: function(event, data) {\r\n        if (!data) {\r\n            return\r\n        }\r\n        var coords = getEventCoords(event);\r\n        var state = this._dragState = {\r\n            x: coords.x,\r\n            y: coords.y,\r\n            data: data\r\n        };\r\n        this._fire(EVENT_START, {\r\n            x: state.x,\r\n            y: state.y,\r\n            data: state.data\r\n        })\r\n    },\r\n    _moveDrag: function(event, data) {\r\n        var state = this._dragState;\r\n        if (!state) {\r\n            return\r\n        }\r\n        var coords = getEventCoords(event);\r\n        var threshold = isTouchEvent(event) ? DRAG_COORD_THRESHOLD_TOUCH : DRAG_COORD_THRESHOLD_MOUSE;\r\n        if (state.active || _abs(coords.x - state.x) > threshold || _abs(coords.y - state.y) > threshold) {\r\n            state.x = coords.x;\r\n            state.y = coords.y;\r\n            state.active = true;\r\n            state.data = data || {};\r\n            this._fire(EVENT_MOVE, {\r\n                x: state.x,\r\n                y: state.y,\r\n                data: state.data\r\n            })\r\n        }\r\n    },\r\n    _endDrag: function() {\r\n        var state = this._dragState;\r\n        if (!state) {\r\n            return\r\n        }\r\n        this._dragState = null;\r\n        this._fire(EVENT_END, {\r\n            x: state.x,\r\n            y: state.y,\r\n            data: state.data\r\n        })\r\n    },\r\n    _wheelZoom: function(event, data) {\r\n        if (!data) {\r\n            return\r\n        }\r\n        var that = this;\r\n        var lock = that._wheelLock;\r\n        var time = Date.now();\r\n        if (time - lock.time <= WHEEL_COOLDOWN) {\r\n            return\r\n        }\r\n        if (time - lock.dirTime > WHEEL_DIRECTION_COOLDOWN) {\r\n            lock.dir = 0\r\n        }\r\n        var delta = adjustWheelDelta(event.delta / 120 || 0, lock);\r\n        if (0 === delta) {\r\n            return\r\n        }\r\n        var coords = getEventCoords(event);\r\n        that._fire(EVENT_ZOOM, {\r\n            delta: delta,\r\n            x: coords.x,\r\n            y: coords.y\r\n        });\r\n        lock.time = lock.dirTime = time\r\n    },\r\n    _startZoom: function(event, data) {\r\n        if (!isTouchEvent(event) || !data) {\r\n            return\r\n        }\r\n        var state = this._zoomState = this._zoomState || {};\r\n        var coords;\r\n        var pointer2;\r\n        if (state.pointer1 && state.pointer2) {\r\n            return\r\n        }\r\n        if (void 0 === state.pointer1) {\r\n            state.pointer1 = getPointerId(event) || 0;\r\n            coords = getMultitouchEventCoords(event, state.pointer1);\r\n            state.x1 = state.x1_0 = coords.x;\r\n            state.y1 = state.y1_0 = coords.y\r\n        }\r\n        if (void 0 === state.pointer2) {\r\n            pointer2 = getPointerId(event) || 1;\r\n            if (pointer2 !== state.pointer1) {\r\n                coords = getMultitouchEventCoords(event, pointer2);\r\n                if (coords) {\r\n                    state.x2 = state.x2_0 = coords.x;\r\n                    state.y2 = state.y2_0 = coords.y;\r\n                    state.pointer2 = pointer2;\r\n                    state.ready = true;\r\n                    this._endDrag()\r\n                }\r\n            }\r\n        }\r\n    },\r\n    _moveZoom: function(event) {\r\n        var state = this._zoomState;\r\n        var coords;\r\n        if (!state || !isTouchEvent(event)) {\r\n            return\r\n        }\r\n        if (void 0 !== state.pointer1) {\r\n            coords = getMultitouchEventCoords(event, state.pointer1);\r\n            if (coords) {\r\n                state.x1 = coords.x;\r\n                state.y1 = coords.y\r\n            }\r\n        }\r\n        if (void 0 !== state.pointer2) {\r\n            coords = getMultitouchEventCoords(event, state.pointer2);\r\n            if (coords) {\r\n                state.x2 = coords.x;\r\n                state.y2 = coords.y\r\n            }\r\n        }\r\n    },\r\n    _endZoom: function(event) {\r\n        var state = this._zoomState;\r\n        var startDistance;\r\n        var currentDistance;\r\n        if (!state || !isTouchEvent(event)) {\r\n            return\r\n        }\r\n        if (state.ready) {\r\n            startDistance = getDistance(state.x1_0, state.y1_0, state.x2_0, state.y2_0);\r\n            currentDistance = getDistance(state.x1, state.y1, state.x2, state.y2);\r\n            this._fire(EVENT_ZOOM, {\r\n                ratio: currentDistance / startDistance,\r\n                x: (state.x1_0 + state.x2_0) / 2,\r\n                y: (state.y1_0 + state.y2_0) / 2\r\n            })\r\n        }\r\n        this._zoomState = null\r\n    },\r\n    _startHover: function(event, data) {\r\n        this._doHover(event, data, true)\r\n    },\r\n    _moveHover: function(event, data) {\r\n        this._doHover(event, data, false)\r\n    },\r\n    _doHover: function(event, data, isTouch) {\r\n        var that = this;\r\n        if (that._dragState && that._dragState.active || that._zoomState && that._zoomState.ready) {\r\n            that._cancelHover();\r\n            return\r\n        }\r\n        if (isTouchEvent(event) !== isTouch || that._hoverTarget === event.target || that._hoverState && that._hoverState.data === data) {\r\n            return\r\n        }\r\n        that._cancelHover();\r\n        if (data) {\r\n            that._hoverState = {\r\n                data: data\r\n            };\r\n            that._fire(EVENT_HOVER_ON, {\r\n                data: data\r\n            })\r\n        }\r\n        that._hoverTarget = event.target\r\n    },\r\n    _cancelHover: function() {\r\n        var state = this._hoverState;\r\n        this._hoverState = this._hoverTarget = null;\r\n        if (state) {\r\n            this._fire(EVENT_HOVER_OFF, {\r\n                data: state.data\r\n            })\r\n        }\r\n    },\r\n    _startFocus: function(event, data) {\r\n        this._doFocus(event, data, true)\r\n    },\r\n    _moveFocus: function(event, data) {\r\n        this._doFocus(event, data, false)\r\n    },\r\n    _doFocus: function(event, data, isTouch) {\r\n        var that = this;\r\n        if (that._dragState && that._dragState.active || that._zoomState && that._zoomState.ready) {\r\n            that._cancelFocus();\r\n            return\r\n        }\r\n        if (isTouchEvent(event) !== isTouch) {\r\n            return\r\n        }\r\n        that._focus.turnOff();\r\n        data && that._focus.turnOn(data, getEventCoords(event))\r\n    },\r\n    _cancelFocus: function() {\r\n        this._focus.cancel()\r\n    },\r\n    _createEventHandlers: function(DATA_KEY) {\r\n        var that = this;\r\n        that._docHandlers = {};\r\n        that._rootHandlers = {};\r\n        that._rootHandlers[EVENTS.start] = that._docHandlers[EVENTS.start] = function(event) {\r\n            var isTouch = isTouchEvent(event);\r\n            var data = getData(event);\r\n            if (isTouch && !that._isTouchEnabled) {\r\n                return\r\n            }\r\n            if (data) {\r\n                event.preventDefault();\r\n                event.stopPropagation()\r\n            }\r\n            that._startClick(event, data);\r\n            that._startDrag(event, data);\r\n            that._startZoom(event, data);\r\n            that._startHover(event, data);\r\n            that._startFocus(event, data)\r\n        };\r\n        that._docHandlers[EVENTS.move] = function(event) {\r\n            var isTouch = isTouchEvent(event);\r\n            var data = getData(event);\r\n            if (isTouch && !that._isTouchEnabled) {\r\n                return\r\n            }\r\n            that._moveDrag(event, data);\r\n            that._moveZoom(event, data);\r\n            that._moveHover(event, data);\r\n            that._moveFocus(event, data)\r\n        };\r\n        that._docHandlers[EVENTS.end] = function(event) {\r\n            var isTouch = isTouchEvent(event);\r\n            var data = getData(event);\r\n            if (isTouch && !that._isTouchEnabled) {\r\n                return\r\n            }\r\n            that._endClick(event, data);\r\n            that._endDrag(event, data);\r\n            that._endZoom(event, data)\r\n        };\r\n        that._rootHandlers[EVENTS.wheel] = function(event) {\r\n            that._cancelFocus();\r\n            if (!that._isWheelEnabled) {\r\n                return\r\n            }\r\n            var data = getData(event);\r\n            if (data) {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                that._wheelZoom(event, data)\r\n            }\r\n        };\r\n        that._wheelLock = {\r\n            dir: 0\r\n        };\r\n\r\n        function getData(event) {\r\n            var target = event.target;\r\n            return (\"tspan\" === target.tagName ? target.parentNode : target)[DATA_KEY]\r\n        }\r\n    },\r\n    _createProjectionHandlers: function(projection) {\r\n        var that = this;\r\n        projection.on({\r\n            center: handler,\r\n            zoom: handler\r\n        });\r\n\r\n        function handler() {\r\n            that._cancelFocus()\r\n        }\r\n    },\r\n    reset: function() {\r\n        var that = this;\r\n        that._clickState = null;\r\n        that._endDrag();\r\n        that._cancelHover();\r\n        that._cancelFocus()\r\n    },\r\n    setOptions: function(options) {\r\n        var that = this;\r\n        that.reset();\r\n        that._detachHandlers();\r\n        that._isTouchEnabled = !!(0, _utils.parseScalar)(options.touchEnabled, true);\r\n        that._isWheelEnabled = !!(0, _utils.parseScalar)(options.wheelEnabled, true);\r\n        that._attachHandlers()\r\n    },\r\n    _detachHandlers: function() {\r\n        var that = this;\r\n        if (that._isTouchEnabled) {\r\n            that._root.css({\r\n                \"touch-action\": \"\",\r\n                \"-webkit-user-select\": \"\"\r\n            }).off(_addNamespace(\"MSHoldVisual\", _NAME)).off(_addNamespace(\"contextmenu\", _NAME))\r\n        }\r\n        _events_engine.default.off(_dom_adapter.default.getDocument(), that._docHandlers);\r\n        that._root.off(that._rootHandlers)\r\n    },\r\n    _attachHandlers: function() {\r\n        var that = this;\r\n        if (that._isTouchEnabled) {\r\n            that._root.css({\r\n                \"touch-action\": \"none\",\r\n                \"-webkit-user-select\": \"none\"\r\n            }).on(_addNamespace(\"MSHoldVisual\", _NAME), function(event) {\r\n                event.preventDefault()\r\n            }).on(_addNamespace(\"contextmenu\", _NAME), function(event) {\r\n                isTouchEvent(event) && event.preventDefault()\r\n            })\r\n        }\r\n        _events_engine.default.on(_dom_adapter.default.getDocument(), that._docHandlers);\r\n        that._root.on(that._rootHandlers)\r\n    }\r\n};\r\nFocus = function(fire) {\r\n    var that = this;\r\n    var _activeData = null;\r\n    var _data = null;\r\n    var _disabled = false;\r\n    var _offTimer = null;\r\n    var _x;\r\n    var _y;\r\n    that.dispose = function() {\r\n        clearTimeout(_offTimer);\r\n        that.turnOn = that.turnOff = that.cancel = that.dispose = that = fire = _activeData = _data = _offTimer = null\r\n    };\r\n    that.turnOn = function(data, coords) {\r\n        if (data === _data && _disabled) {\r\n            return\r\n        }\r\n        _disabled = false;\r\n        _data = data;\r\n        if (_activeData) {\r\n            _x = coords.x;\r\n            _y = coords.y;\r\n            if (_data === _activeData) {\r\n                fire(EVENT_FOCUS_MOVE, {\r\n                    data: _data,\r\n                    x: _x,\r\n                    y: _y\r\n                });\r\n                onCheck(true)\r\n            } else {\r\n                fire(EVENT_FOCUS_ON, {\r\n                    data: _data,\r\n                    x: _x,\r\n                    y: _y,\r\n                    done: onCheck\r\n                })\r\n            }\r\n        } else {\r\n            _x = coords.x;\r\n            _y = coords.y;\r\n            fire(EVENT_FOCUS_ON, {\r\n                data: _data,\r\n                x: _x,\r\n                y: _y,\r\n                done: onCheck\r\n            })\r\n        }\r\n\r\n        function onCheck(result) {\r\n            _disabled = !result;\r\n            if (result) {\r\n                _activeData = _data;\r\n                clearTimeout(_offTimer);\r\n                _offTimer = null\r\n            }\r\n        }\r\n    };\r\n    that.turnOff = function() {\r\n        _data = null;\r\n        if (_activeData && !_disabled) {\r\n            _offTimer = _offTimer || setTimeout(function() {\r\n                _offTimer = null;\r\n                fire(EVENT_FOCUS_OFF, {\r\n                    data: _activeData\r\n                });\r\n                _activeData = null\r\n            }, FOCUS_OFF_DELAY)\r\n        }\r\n    };\r\n    that.cancel = function() {\r\n        clearTimeout(_offTimer);\r\n        if (_activeData) {\r\n            fire(EVENT_FOCUS_OFF, {\r\n                data: _activeData\r\n            })\r\n        }\r\n        _activeData = _data = _offTimer = null\r\n    }\r\n};\r\n(0, _event_emitter.makeEventEmitter)(Tracker);\r\n\r\nfunction getDistance(x1, y1, x2, y2) {\r\n    return _sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2))\r\n}\r\n\r\nfunction isTouchEvent(event) {\r\n    var type = event.originalEvent.type;\r\n    var pointerType = event.originalEvent.pointerType;\r\n    return /^touch/.test(type) || /^MSPointer/.test(type) && 4 !== pointerType || /^pointer/.test(type) && \"mouse\" !== pointerType\r\n}\r\n\r\nfunction selectItem(flags, items) {\r\n    var i = 0;\r\n    var ii = flags.length;\r\n    var item;\r\n    for (; i < ii; ++i) {\r\n        if (flags[i]) {\r\n            item = items[i];\r\n            break\r\n        }\r\n    }\r\n    return _addNamespace(item || items[i], _NAME)\r\n}\r\n\r\nfunction setupEvents() {\r\n    var flags = [navigator.pointerEnabled, navigator.msPointerEnabled, (0, _window.hasProperty)(\"ontouchstart\")];\r\n    EVENTS = {\r\n        start: selectItem(flags, [\"pointerdown\", \"MSPointerDown\", \"touchstart mousedown\", \"mousedown\"]),\r\n        move: selectItem(flags, [\"pointermove\", \"MSPointerMove\", \"touchmove mousemove\", \"mousemove\"]),\r\n        end: selectItem(flags, [\"pointerup\", \"MSPointerUp\", \"touchend mouseup\", \"mouseup\"]),\r\n        wheel: _addNamespace(_wheel.name, _NAME)\r\n    }\r\n}\r\n\r\nfunction getEventCoords(event) {\r\n    var originalEvent = event.originalEvent;\r\n    var touch = originalEvent.touches && originalEvent.touches[0] || {};\r\n    return {\r\n        x: touch.pageX || originalEvent.pageX || event.pageX,\r\n        y: touch.pageY || originalEvent.pageY || event.pageY\r\n    }\r\n}\r\n\r\nfunction getPointerId(event) {\r\n    return event.originalEvent.pointerId\r\n}\r\n\r\nfunction getMultitouchEventCoords(event, pointerId) {\r\n    var originalEvent = event.originalEvent;\r\n    if (void 0 !== originalEvent.pointerId) {\r\n        originalEvent = originalEvent.pointerId === pointerId ? originalEvent : null\r\n    } else {\r\n        originalEvent = originalEvent.touches[pointerId]\r\n    }\r\n    return originalEvent ? {\r\n        x: originalEvent.pageX || event.pageX,\r\n        y: originalEvent.pageY || event.pageY\r\n    } : null\r\n}\r\n\r\nfunction adjustWheelDelta(delta, lock) {\r\n    if (0 === delta) {\r\n        return 0\r\n    }\r\n    var _delta = _abs(delta);\r\n    var sign = _round(delta / _delta);\r\n    if (lock.dir && sign !== lock.dir) {\r\n        return 0\r\n    }\r\n    lock.dir = sign;\r\n    if (_delta < .1) {\r\n        _delta = 0\r\n    } else {\r\n        if (_delta < 1) {\r\n            _delta = 1\r\n        } else {\r\n            if (_delta > 4) {\r\n                _delta = 4\r\n            } else {\r\n                _delta = _round(_delta)\r\n            }\r\n        }\r\n    }\r\n    return sign * _delta\r\n}\r\n"]},"metadata":{},"sourceType":"script"}