{"ast":null,"code":"var _jsxFileName = \"E:\\\\newfrontend\\\\webfe\\\\src\\\\component\\\\Admin\\\\Reports\\\\Types\\\\UnearnedRevenueReport.js\";\nimport { NormalButton, NormalCheckbox, NormalDateTime, NormalMultiSelect, NormalSelect } from \"component/common\";\nimport React, { Component } from \"react\";\nimport { withTranslation } from \"react-i18next\";\nimport { connect } from \"react-redux\";\nimport { bindActionCreators } from \"redux\";\nimport { getCommonApi } from \"redux/actions/common\";\nimport { getReport, updateReport } from \"redux/actions/reports\";\nimport { Viewer, Designer } from \"@grapecity/activereports-react\";\nimport \"../style.scss\";\nimport { Fragment } from \"react\";\n\nclass UnearnedRevenueReportClass extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      showUnearned: false,\n      selectedSites: \"\",\n      siteOptions: [],\n      selectedSiteGroup: \"\",\n      siteGroupOptions: [],\n      isEdit: false,\n      isMounted: true,\n      isLoading: true,\n      start: Date.now(),\n      inOptions: [{\n        label: \"Month\",\n        value: \"month\"\n      }, {\n        label: \"Week\",\n        value: \"week\"\n      }, {\n        label: \"Day\",\n        value: \"day\"\n      }],\n      selectedInOption: \"week\",\n      data: null\n    };\n\n    this.updateState = state => {\n      if (this.state.isMounted) this.setState(state);\n    };\n\n    this.getData = async () => {\n      let {\n        siteOptions,\n        siteGroupOptions\n      } = this.state;\n      await this.props.getReport(\"\");\n      let branchRes = await this.props.getCommonApi(\"branchlist/\");\n      let siteGroupRes = await this.props.getCommonApi(\"site_group_list/\");\n\n      for (let key of branchRes.data) {\n        siteOptions.push({\n          value: key.itemsite_code,\n          label: key.itemsite_desc\n        });\n      }\n\n      for (let key of siteGroupRes.data.groups) {\n        siteGroupOptions.push({\n          value: key.code,\n          label: key.description\n        });\n      }\n\n      this.updateState({\n        siteOptions,\n        siteGroupOptions,\n        isLoading: false\n      });\n    };\n\n    this.getFormatedDate = input => {\n      let date = new Date(input);\n      let d = date.getDate();\n      let day = d < 10 ? \"0\" + d : d;\n      let a = date.getMonth() + 1;\n      let month = a < 10 ? \"0\" + a : a;\n      let year = date.getFullYear();\n      return `${year}-${month}-${day}`;\n    };\n\n    this.handleChanges = e => {\n      this.state[e.target.name] = e.target.value;\n      this.updateState({});\n    };\n\n    this.handleMultiSelect = (data = []) => {\n      if (data.length == 0) return this.updateState({\n        selectedSites: \"\"\n      });\n      let {\n        selectedSites\n      } = this.state;\n      selectedSites = [];\n      data.forEach(element => {\n        selectedSites.push(element.value);\n      });\n      selectedSites = selectedSites.reduce((a, e) => a + \",\" + e);\n      this.updateState({\n        selectedSites\n      });\n    };\n\n    this.handleDatePick = (name, value) => {\n      this.state[name] = value;\n      this.updateState({});\n    };\n\n    this.onRun = async () => {\n      this.updateState({\n        isLoading: true\n      });\n      let {\n        data,\n        selectedSites,\n        selectedInOption,\n        selectedSiteGroup,\n        start,\n        showUnearned\n      } = this.state;\n      let additionalParams = \"\";\n      if (selectedSiteGroup) additionalParams = `&siteGroup=${selectedSiteGroup}`;else additionalParams = `&siteCodes=${selectedSites}`;\n      if (showUnearned) additionalParams += `&showUnearned=${showUnearned}`;\n      let res = await this.props.getCommonApi(`SalesDailyReporting?start=${this.getFormatedDate(start)}&in=${selectedInOption}${additionalParams}`);\n      console.log(res);\n      data = res.data;\n      this.updateState({\n        data,\n        isLoading: false\n      });\n    };\n\n    this.onSaveReport = async info => {\n      this.updateReport({\n        isLoading: true\n      });\n      await this.props.updateReport(\"\", info.definition);\n      this.updateReport({\n        isLoading: false\n      });\n    };\n  }\n\n  componentWillUnmount() {\n    this.state.isMounted = false;\n  }\n\n  componentDidMount() {\n    this.getData();\n  }\n\n  render() {\n    let {\n      t,\n      report\n    } = this.props;\n    let {\n      inOptions\n    } = this.state;\n    inOptions = inOptions.map(e => {\n      return { ...e,\n        label: t(e.label)\n      };\n    });\n    if (report.DataSources) report.DataSources[0].ConnectionProperties.ConnectString = `jsondata=${JSON.stringify({\n      data: this.state.data\n    })}`;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid report-types\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 13\n      }\n    }, t(\"Unearned Revenue Report\")))), this.state.isLoading ? /*#__PURE__*/React.createElement(\"div\", {\n      class: \"d-flex mt-5 align-items-center justify-content-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"spinner-border\",\n      role: \"status\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      class: \"sr-only\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 15\n      }\n    }, \"Loading...\"))) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-3 col-lg-2 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(NormalButton, {\n      label: t(\"Run\"),\n      mainbg: \"true\",\n      onClick: this.onRun,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-4 col-lg-3 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(NormalButton, {\n      label: this.state.isEdit ? t(\"Switch to View Mode\") : t(\"Switch to Edit Mode\"),\n      mainbg: \"true\",\n      onClick: () => this.updateState({\n        isEdit: !this.state.isEdit\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 17\n      }\n    }))), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-4 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-left text-black common-label-text fs-17 pb-1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 17\n      }\n    }, t(\"From Date\")), /*#__PURE__*/React.createElement(NormalDateTime, {\n      onChange: this.handleDatePick,\n      value: this.state.start,\n      name: \"start\",\n      showYearDropdown: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-4 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-left text-black common-label-text fs-17 pb-1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 17\n      }\n    }, t(\"In\")), /*#__PURE__*/React.createElement(NormalSelect, {\n      onChange: this.handleChanges,\n      options: inOptions,\n      value: this.state.selectedInOption,\n      name: \"selectedInOption\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-4 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-left text-black common-label-text fs-17 pb-1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 17\n      }\n    }, t(\"Site Group\")), /*#__PURE__*/React.createElement(NormalSelect, {\n      onChange: this.handleChanges,\n      options: this.state.siteGroupOptions,\n      value: this.state.selectedSiteGroup,\n      name: \"selectedSiteGroup\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-4 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-left text-black common-label-text fs-17 pb-1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 17\n      }\n    }, t(\"Sites\")), /*#__PURE__*/React.createElement(NormalMultiSelect, {\n      handleMultiSelect: this.handleMultiSelect,\n      options: this.state.siteOptions,\n      value: this.state.selectedSites,\n      name: \"selectedSites\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-4 mb-4 pt-md-5\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(NormalCheckbox, {\n      onChange: this.handleChanges,\n      checked: this.state.showUnearned,\n      value: this.state.showUnearned,\n      labelClass: \"text-black common-label-text fs-17\",\n      label: \"Show Unearned\",\n      name: \"showUnearned\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 17\n      }\n    }))), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 13\n      }\n    }, this.state.data ? /*#__PURE__*/React.createElement(Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 17\n      }\n    }, this.state.isEdit ? /*#__PURE__*/React.createElement(\"div\", {\n      id: \"designer-host\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Designer, {\n      report: {\n        displayName: t(\"report\"),\n        definition: report\n      },\n      language: localStorage.getItem(\"lang\"),\n      onSave: this.onSaveReport,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 23\n      }\n    })) : /*#__PURE__*/React.createElement(\"div\", {\n      id: \"viewer-host\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Viewer, {\n      report: {\n        Uri: report\n      },\n      availableExports: [],\n      sidebarVisible: true,\n      language: localStorage.getItem(\"lang\"),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 23\n      }\n    }))) : null)));\n  }\n\n}\n\nconst mapStateToProps = state => ({\n  report: state.reporting.reportLayout\n});\n\nconst mapDispatchToProps = dispatch => {\n  return bindActionCreators({\n    getCommonApi,\n    getReport,\n    updateReport\n  }, dispatch);\n};\n\nexport const UnearnedRevenueReport = withTranslation()(connect(mapStateToProps, mapDispatchToProps)(UnearnedRevenueReportClass));","map":{"version":3,"sources":["E:/newfrontend/webfe/src/component/Admin/Reports/Types/UnearnedRevenueReport.js"],"names":["NormalButton","NormalCheckbox","NormalDateTime","NormalMultiSelect","NormalSelect","React","Component","withTranslation","connect","bindActionCreators","getCommonApi","getReport","updateReport","Viewer","Designer","Fragment","UnearnedRevenueReportClass","state","showUnearned","selectedSites","siteOptions","selectedSiteGroup","siteGroupOptions","isEdit","isMounted","isLoading","start","Date","now","inOptions","label","value","selectedInOption","data","updateState","setState","getData","props","branchRes","siteGroupRes","key","push","itemsite_code","itemsite_desc","groups","code","description","getFormatedDate","input","date","d","getDate","day","a","getMonth","month","year","getFullYear","handleChanges","e","target","name","handleMultiSelect","length","forEach","element","reduce","handleDatePick","onRun","additionalParams","res","console","log","onSaveReport","info","definition","componentWillUnmount","componentDidMount","render","t","report","map","DataSources","ConnectionProperties","ConnectString","JSON","stringify","displayName","localStorage","getItem","Uri","mapStateToProps","reporting","reportLayout","mapDispatchToProps","dispatch","UnearnedRevenueReport"],"mappings":"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","sourcesContent":["import {\n  NormalButton,\n  NormalCheckbox,\n  NormalDateTime,\n  NormalMultiSelect,\n  NormalSelect,\n} from \"component/common\";\nimport React, { Component } from \"react\";\nimport { withTranslation } from \"react-i18next\";\nimport { connect } from \"react-redux\";\nimport { bindActionCreators } from \"redux\";\nimport { getCommonApi } from \"redux/actions/common\";\nimport { getReport, updateReport } from \"redux/actions/reports\";\nimport { Viewer, Designer } from \"@grapecity/activereports-react\";\nimport \"../style.scss\";\nimport { Fragment } from \"react\";\n\nclass UnearnedRevenueReportClass extends Component {\n  state = {\n    showUnearned: false,\n    selectedSites: \"\",\n    siteOptions: [],\n    selectedSiteGroup: \"\",\n    siteGroupOptions: [],\n    isEdit: false,\n    isMounted: true,\n    isLoading: true,\n    start: Date.now(),\n    inOptions: [\n      { label: \"Month\", value: \"month\" },\n      { label: \"Week\", value: \"week\" },\n      { label: \"Day\", value: \"day\" },\n    ],\n    selectedInOption: \"week\",\n    data: null,\n  };\n\n  updateState = (state) => {\n    if (this.state.isMounted) this.setState(state);\n  };\n\n  componentWillUnmount() {\n    this.state.isMounted = false;\n  }\n\n  componentDidMount() {\n    this.getData();\n  }\n\n  getData = async () => {\n    let { siteOptions, siteGroupOptions } = this.state;\n    await this.props.getReport(\"\");\n    let branchRes = await this.props.getCommonApi(\"branchlist/\");\n    let siteGroupRes = await this.props.getCommonApi(\"site_group_list/\");\n    for (let key of branchRes.data) {\n      siteOptions.push({\n        value: key.itemsite_code,\n        label: key.itemsite_desc,\n      });\n    }\n    for (let key of siteGroupRes.data.groups) {\n      siteGroupOptions.push({ value: key.code, label: key.description });\n    }\n    this.updateState({\n      siteOptions,\n      siteGroupOptions,\n      isLoading: false,\n    });\n  };\n\n  getFormatedDate = (input) => {\n    let date = new Date(input);\n    let d = date.getDate();\n    let day = d < 10 ? \"0\" + d : d;\n    let a = date.getMonth() + 1;\n    let month = a < 10 ? \"0\" + a : a;\n    let year = date.getFullYear();\n    return `${year}-${month}-${day}`;\n  };\n\n  handleChanges = (e) => {\n    this.state[e.target.name] = e.target.value;\n    this.updateState({});\n  };\n\n  handleMultiSelect = (data = []) => {\n    if (data.length == 0) return this.updateState({ selectedSites: \"\" });\n    let { selectedSites } = this.state;\n    selectedSites = [];\n    data.forEach((element) => {\n      selectedSites.push(element.value);\n    });\n    selectedSites = selectedSites.reduce((a, e) => a + \",\" + e);\n    this.updateState({ selectedSites });\n  };\n\n  handleDatePick = (name, value) => {\n    this.state[name] = value;\n    this.updateState({});\n  };\n\n  onRun = async () => {\n    this.updateState({ isLoading: true });\n    let {\n      data,\n      selectedSites,\n      selectedInOption,\n      selectedSiteGroup,\n      start,\n      showUnearned,\n    } = this.state;\n    let additionalParams = \"\";\n    if (selectedSiteGroup) additionalParams = `&siteGroup=${selectedSiteGroup}`;\n    else additionalParams = `&siteCodes=${selectedSites}`;\n    if (showUnearned) additionalParams += `&showUnearned=${showUnearned}`;\n    let res = await this.props.getCommonApi(\n      `SalesDailyReporting?start=${this.getFormatedDate(\n        start\n      )}&in=${selectedInOption}${additionalParams}`\n    );\n    console.log(res);\n    data = res.data;\n    this.updateState({ data, isLoading: false });\n  };\n\n  onSaveReport = async (info) => {\n    this.updateReport({ isLoading: true });\n    await this.props.updateReport(\"\", info.definition);\n    this.updateReport({ isLoading: false });\n  };\n\n  render() {\n    let { t, report } = this.props;\n    let { inOptions } = this.state;\n    inOptions = inOptions.map((e) => {\n      return { ...e, label: t(e.label) };\n    });\n\n    if (report.DataSources)\n      report.DataSources[0].ConnectionProperties.ConnectString = `jsondata=${JSON.stringify(\n        { data: this.state.data }\n      )}`;\n    return (\n      <div className=\"container-fluid report-types\">\n        <div className=\"row mb-4\">\n          <div className=\"col\">\n            <h3>{t(\"Unearned Revenue Report\")}</h3>\n          </div>\n        </div>\n        {this.state.isLoading ? (\n          <div class=\"d-flex mt-5 align-items-center justify-content-center\">\n            <div class=\"spinner-border\" role=\"status\">\n              <span class=\"sr-only\">Loading...</span>\n            </div>\n          </div>\n        ) : (\n          <>\n            <div className=\"row\">\n              <div className=\"col-md-3 col-lg-2 mb-4\">\n                <NormalButton\n                  label={t(\"Run\")}\n                  mainbg=\"true\"\n                  onClick={this.onRun}\n                />\n              </div>\n              <div className=\"col-md-4 col-lg-3 mb-4\">\n                <NormalButton\n                  label={\n                    this.state.isEdit\n                      ? t(\"Switch to View Mode\")\n                      : t(\"Switch to Edit Mode\")\n                  }\n                  mainbg=\"true\"\n                  onClick={() =>\n                    this.updateState({ isEdit: !this.state.isEdit })\n                  }\n                />\n              </div>\n            </div>\n            <hr />\n            <div className=\"row\">\n              <div className=\"col-md-4 mb-4\">\n                <label className=\"text-left text-black common-label-text fs-17 pb-1\">\n                  {t(\"From Date\")}\n                </label>\n                <NormalDateTime\n                  onChange={this.handleDatePick}\n                  value={this.state.start}\n                  name=\"start\"\n                  showYearDropdown={true}\n                />\n              </div>\n              <div className=\"col-md-4 mb-4\">\n                <label className=\"text-left text-black common-label-text fs-17 pb-1\">\n                  {t(\"In\")}\n                </label>\n                <NormalSelect\n                  onChange={this.handleChanges}\n                  options={inOptions}\n                  value={this.state.selectedInOption}\n                  name=\"selectedInOption\"\n                />\n              </div>\n              <div className=\"col-md-4 mb-4\">\n                <label className=\"text-left text-black common-label-text fs-17 pb-1\">\n                  {t(\"Site Group\")}\n                </label>\n                <NormalSelect\n                  onChange={this.handleChanges}\n                  options={this.state.siteGroupOptions}\n                  value={this.state.selectedSiteGroup}\n                  name=\"selectedSiteGroup\"\n                />\n              </div>\n              <div className=\"col-md-4 mb-4\">\n                <label className=\"text-left text-black common-label-text fs-17 pb-1\">\n                  {t(\"Sites\")}\n                </label>\n                <NormalMultiSelect\n                  handleMultiSelect={this.handleMultiSelect}\n                  options={this.state.siteOptions}\n                  value={this.state.selectedSites}\n                  name=\"selectedSites\"\n                />\n              </div>\n              <div className=\"col-md-4 mb-4 pt-md-5\">\n                <NormalCheckbox\n                  onChange={this.handleChanges}\n                  checked={this.state.showUnearned}\n                  value={this.state.showUnearned}\n                  labelClass=\"text-black common-label-text fs-17\"\n                  label=\"Show Unearned\"\n                  name=\"showUnearned\"\n                />\n              </div>\n            </div>\n            <hr />\n            <div className=\"row mb-4\">\n              {this.state.data ? (\n                <Fragment>\n                  {this.state.isEdit ? (\n                    <div id=\"designer-host\">\n                      <Designer\n                        report={{\n                          displayName: t(\"report\"),\n                          definition: report,\n                        }}\n                        language={localStorage.getItem(\"lang\")}\n                        onSave={this.onSaveReport}\n                      />\n                    </div>\n                  ) : (\n                    <div id=\"viewer-host\">\n                      <Viewer\n                        report={{ Uri: report }}\n                        availableExports={[]}\n                        sidebarVisible={true}\n                        language={localStorage.getItem(\"lang\")}\n                      />\n                    </div>\n                  )}\n                </Fragment>\n              ) : null}\n            </div>\n          </>\n        )}\n      </div>\n    );\n  }\n}\nconst mapStateToProps = (state) => ({\n  report: state.reporting.reportLayout,\n});\n\nconst mapDispatchToProps = (dispatch) => {\n  return bindActionCreators(\n    {\n      getCommonApi,\n      getReport,\n      updateReport,\n    },\n    dispatch\n  );\n};\n\nexport const UnearnedRevenueReport = withTranslation()(\n  connect(mapStateToProps, mapDispatchToProps)(UnearnedRevenueReportClass)\n);\n"]},"metadata":{},"sourceType":"module"}