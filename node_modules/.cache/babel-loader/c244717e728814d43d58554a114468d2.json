{"ast":null,"code":"import _createForOfIteratorHelper from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createForOfIteratorHelper\";import _classCallCheck from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _assertThisInitialized from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from'react';import'./style.scss';import{NormalButton,NormalInput,NormalSelect,InputSearch,NormalModal,TableWrapper}from'component/common';import{dateFormat}from'service/helperFunctions';import _ from'lodash';import{connect}from'react-redux';import{bindActionCreators}from\"redux\";import{getCommonApi,updateForm,commonCreateApi,commonDeleteApi,commonPatchApi}from\"redux/actions/common\";import SimpleReactValidator from'simple-react-validator';import{FormGroup,Label,Input}from'reactstrap';export var TopupTreatmentClass=/*#__PURE__*/function(_Component){_inherits(TopupTreatmentClass,_Component);var _super=_createSuper(TopupTreatmentClass);function TopupTreatmentClass(){var _this;_classCallCheck(this,TopupTreatmentClass);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={treatmentList:[],cartData:{},formFields:{customer_name:\"\",new_outstanding:\"\",old_outstanding:\"\",topup_amount:\"\"},headerDetails:[{label:'Invoice No',sortKey:false,width:\"120px\"},{label:'Treatment Name',sortKey:false,width:\"120px\"},{label:'Qty',sortKey:false,width:\"50px\"},{label:'Treatment Code',width:\"72px\"},{label:'Deposit Balance',sortKey:false,width:\"100px\"},{label:'Outstanding',sortKey:false,width:\"100px\"},{label:'Pay amount',width:\"100px\"},{label:'Staff',width:\"120px\"}]};_this.componentWillMount=function(){_this.validator=new SimpleReactValidator({element:function element(message){return/*#__PURE__*/React.createElement(\"span\",{className:\"error-message text-danger validNo fs14\"},message);},autoForceUpdate:_assertThisInitialized(_this)});var _this$state=_this.state,roomList=_this$state.roomList,sourceList=_this$state.sourceList,staffList=_this$state.staffList,cartData=_this$state.cartData,duration=_this$state.duration,treatmentList=_this$state.treatmentList;_this.getCart();};_this.getCart=function(){var _this$state2=_this.state,roomList=_this$state2.roomList,sourceList=_this$state2.sourceList,staffList=_this$state2.staffList,cartData=_this$state2.cartData,duration=_this$state2.duration,treatmentList=_this$state2.treatmentList;_this.props.getCommonApi(\"topuptreatment/?cust_id=\".concat(_this.props.id)).then(function(key){// let { status, data } = key;\n// if (status === 200) {\ncartData=key;treatmentList=key.data;_this.setState({cartData:cartData,treatmentList:treatmentList});_this.getDataFromRes(key);// }\n});};_this.getDataFromRes=function(data){var header_data=data.header_data;var formFields=_this.state.formFields;formFields['customer_name']=header_data?header_data.customer_name:\"\";formFields['new_outstanding']=header_data?header_data.new_outstanding:\"\";formFields['old_outstanding']=header_data?header_data.old_outstanding:\"\";formFields['topup_amount']=header_data?header_data.topup_amount:\"\";_this.setState({formFields:formFields});};_this.handleCreateCart=function(){var basicApptDetail=_this.props.basicApptDetail;var treatmentList=_this.state.treatmentList;var payload=[];if(_this.validator.allValid()){var _iterator=_createForOfIteratorHelper(treatmentList),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var key=_step.value;if(key.pay_amount>0){var obj={\"cust_noid\":basicApptDetail.custId,\"cart_date\":dateFormat(new Date(),\"yyyy-mm-dd\"),\"itemcodeid\":key.stock_id,\"price\":key.pay_amount,\"item_uom\":null,\"treatment_account\":key.TreatmentAccountid,\"deposit_account\":null,\"prepaid_account\":null};payload.push(obj);}}}catch(err){_iterator.e(err);}finally{_iterator.f();}_this.props.getCommonApi(\"itemcart/Check/?cart_date=\".concat(dateFormat(new Date(),\"yyyy-mm-dd\"),\"&cust_noid=\").concat(basicApptDetail.custId)).then(function(res){if(res.data.length===0){_this.props.commonCreateApi(\"itemcart/TopUpCartCreate/\",payload).then(function(res){// this.props.handleCartCreated()\n_this.props.handleModal();});}else{_this.props.commonCreateApi(\"itemcart/TopUpCartCreate/?cart_id=\".concat(res.cart_id),payload).then(function(res){_this.props.handleModal();});}});}else{_this.validator.showMessages();}};_this.handleClearLine=function(){_this.props.commonDeleteApi(\"tmpitemhelper/delete/?clear_all=0&cartid=\".concat(_this.props.cartId)).then(function(){_this.getCart();});};_this.handleClearAll=function(){_this.props.commonDeleteApi(\"tmpitemhelper/delete/?clear_all=1&cartid=\".concat(_this.props.cartId)).then(function(){var _this$state3=_this.state,formFields=_this$state3.formFields,postFields=_this$state3.postFields;_this.setState({formFields:formFields,postFields:postFields});_this.getCart();});};_this.handlePayAmount=function(event,data,index){var treatmentList=_this.state.treatmentList;treatmentList[index][event.target.name]=event.target.value;_this.setState({treatmentList:treatmentList});};return _this;}_createClass(TopupTreatmentClass,[{key:\"render\",value:function render(){var _this2=this;var _this$state4=this.state,_this$state4$workpoin=_this$state4.workpoint,workpoint=_this$state4$workpoin===void 0?\"\":_this$state4$workpoin,_this$state4$treatmen=_this$state4.treatmentList,treatmentList=_this$state4$treatmen===void 0?[]:_this$state4$treatmen,headerDetails=_this$state4.headerDetails,formFields=_this$state4.formFields;var customer_name=formFields.customer_name,new_outstanding=formFields.new_outstanding,old_outstanding=formFields.old_outstanding,topup_amount=formFields.topup_amount;return/*#__PURE__*/React.createElement(\"div\",{className:\"row new-cart treatment-done top-up\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-5\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-left w-100 text-black common-label-text mr-2\"},\"Customer\"),/*#__PURE__*/React.createElement(\"div\",{className:\"input-group\"},/*#__PURE__*/React.createElement(NormalInput,{value:customer_name,name:\"customer_name\",onChange:this.handlePostChange,className:\"customer-name\",disabled:true}))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-left w-100 text-black common-label-text mr-2\"},\"Outstanding\"),/*#__PURE__*/React.createElement(\"div\",{className:\"input-group\"},/*#__PURE__*/React.createElement(NormalInput,{value:old_outstanding,name:\"old_outstanding\",onChange:this.handlePostChange,className:\"customer-name\",disabled:true})))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-3\"},/*#__PURE__*/React.createElement(FormGroup,{check:true,className:\"m-0\"},/*#__PURE__*/React.createElement(Label,{check:true},/*#__PURE__*/React.createElement(Input,{type:\"checkbox\",onChange:this.props.handleChangeBox,name:\"cust_maillist\"}),' ',\" Auto\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-left w-100 text-black common-label-text mr-2\"},\"Top Up Amount\"),/*#__PURE__*/React.createElement(\"div\",{className:\"input-group\"},/*#__PURE__*/React.createElement(NormalInput,{value:topup_amount,name:\"topup_amount\",onChange:this.handlePostChange,className:\"customer-name\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-left w-100 text-black common-label-text mr-2\"},\"New Outstanging\"),/*#__PURE__*/React.createElement(\"div\",{className:\"input-group\"},/*#__PURE__*/React.createElement(NormalInput,{value:new_outstanding,name:\"new_outstanding\",onChange:this.handlePostChange,className:\"customer-name\"})))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 cart-item mt-2\"},/*#__PURE__*/React.createElement(\"div\",{className:\"item-list\"},/*#__PURE__*/React.createElement(\"div\",{className:\"table\"},/*#__PURE__*/React.createElement(TableWrapper,{headerDetails:headerDetails,queryHandler:this.handlePagination},treatmentList.length>0?treatmentList.map(function(item,index){return/*#__PURE__*/React.createElement(\"tr\",{key:index},/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},item.sa_transacno)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-left justify-content-center\"},item.description)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},item.qty)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},item.treatment_parentcode)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},item.balance)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},item.outstanding)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center payment-input justify-content-center\"},/*#__PURE__*/React.createElement(NormalInput,{value:item.pay_amount,name:\"pay_amount\",onChange:function onChange(e){return _this2.handlePayAmount(e,item,index);},className:\"customer-name\"}),item.pay_amount?_this2.validator.message('pay_amount',item.pay_amount,\"required|max:\".concat(Number(item.outstanding),\",num\")):\"\")),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},item.sa_staffname)));}):\"\")))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 pt-4 action-bar\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-6 d-flex\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"col-4 text-right\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"col-2 text-right\"},/*#__PURE__*/React.createElement(NormalButton,{buttonClass:\"mx-2\",mainbg:true,className:\" fs-15 confirm\",label:\"Confirm\",outline:false,onClick:this.handleCreateCart})))));}}]);return TopupTreatmentClass;}(Component);var mapStateToProps=function mapStateToProps(state){return{selected_cstomer:state.common.selected_cstomer,basicApptDetail:state.appointment.basicApptDetail};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return bindActionCreators({// getCustomer,\ngetCommonApi:getCommonApi,updateForm:updateForm,commonCreateApi:commonCreateApi,commonPatchApi:commonPatchApi,commonDeleteApi:commonDeleteApi},dispatch);};export var TopupTreatment=connect(mapStateToProps,mapDispatchToProps)(TopupTreatmentClass);","map":{"version":3,"sources":["E:/newfrontend/webfe/src/component/Admin/Cart/topup/treatment.js"],"names":["React","Component","NormalButton","NormalInput","NormalSelect","InputSearch","NormalModal","TableWrapper","dateFormat","_","connect","bindActionCreators","getCommonApi","updateForm","commonCreateApi","commonDeleteApi","commonPatchApi","SimpleReactValidator","FormGroup","Label","Input","TopupTreatmentClass","state","treatmentList","cartData","formFields","customer_name","new_outstanding","old_outstanding","topup_amount","headerDetails","label","sortKey","width","componentWillMount","validator","element","message","autoForceUpdate","roomList","sourceList","staffList","duration","getCart","props","id","then","key","data","setState","getDataFromRes","header_data","handleCreateCart","basicApptDetail","payload","allValid","pay_amount","obj","custId","Date","stock_id","TreatmentAccountid","push","res","length","handleModal","cart_id","showMessages","handleClearLine","cartId","handleClearAll","postFields","handlePayAmount","event","index","target","name","value","workpoint","handlePostChange","handleChangeBox","handlePagination","map","item","sa_transacno","description","qty","treatment_parentcode","balance","outstanding","e","Number","sa_staffname","mapStateToProps","selected_cstomer","common","appointment","mapDispatchToProps","dispatch","TopupTreatment"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport './style.scss';\r\nimport { NormalButton, NormalInput, NormalSelect, InputSearch, NormalModal, TableWrapper } from 'component/common';\r\nimport { dateFormat } from 'service/helperFunctions';\r\nimport _ from 'lodash';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from \"redux\";\r\nimport { getCommonApi, updateForm, commonCreateApi, commonDeleteApi, commonPatchApi } from \"redux/actions/common\"\r\nimport SimpleReactValidator from 'simple-react-validator';\r\nimport { FormGroup, Label, Input } from 'reactstrap';\r\n\r\n\r\nexport class TopupTreatmentClass extends Component {\r\n    state = {\r\n        treatmentList: [],\r\n        cartData: {},\r\n        formFields: {\r\n            customer_name: \"\",\r\n            new_outstanding: \"\",\r\n            old_outstanding: \"\",\r\n            topup_amount: \"\"\r\n        },\r\n        headerDetails: [\r\n            { label: 'Invoice No', sortKey: false, width: \"120px\" },\r\n            { label: 'Treatment Name', sortKey: false, width: \"120px\" },\r\n            { label: 'Qty', sortKey: false, width: \"50px\" },\r\n            { label: 'Treatment Code', width: \"72px\" },\r\n            { label: 'Deposit Balance', sortKey: false, width: \"100px\" },\r\n            { label: 'Outstanding', sortKey: false, width: \"100px\" },\r\n            { label: 'Pay amount', width: \"100px\" },\r\n            { label: 'Staff', width: \"120px\" },\r\n        ],\r\n    }\r\n\r\n    componentWillMount = () => {\r\n        this.validator = new SimpleReactValidator({\r\n            element: message => <span className=\"error-message text-danger validNo fs14\">{message}</span>,\r\n            autoForceUpdate: this,\r\n        });\r\n        let { roomList, sourceList, staffList, cartData, duration, treatmentList } = this.state;\r\n        this.getCart();\r\n    }\r\n\r\n    getCart = () => {\r\n        let { roomList, sourceList, staffList, cartData, duration, treatmentList } = this.state;\r\n        this.props.getCommonApi(`topuptreatment/?cust_id=${this.props.id}`).then((key) => {\r\n            // let { status, data } = key;\r\n            // if (status === 200) {\r\n            cartData = key;\r\n            treatmentList = key.data;\r\n            this.setState({ cartData, treatmentList })\r\n            this.getDataFromRes(key)\r\n            // }\r\n        })\r\n    }\r\n\r\n    getDataFromRes = (data) => {\r\n        let { header_data } = data;\r\n        let { formFields } = this.state;\r\n        formFields['customer_name'] = header_data ? header_data.customer_name:\"\";\r\n        formFields['new_outstanding'] = header_data ? header_data.new_outstanding:\"\";\r\n        formFields['old_outstanding'] = header_data ? header_data.old_outstanding:\"\";\r\n        formFields['topup_amount'] = header_data ? header_data.topup_amount:\"\";\r\n        this.setState({\r\n            formFields\r\n        })\r\n    }\r\n\r\n    handleCreateCart = () => {\r\n        let { basicApptDetail } = this.props;\r\n        let { treatmentList } = this.state;\r\n        let payload = []\r\n        if (this.validator.allValid()) {\r\n            \r\n        for(let key of treatmentList){\r\n            if(key.pay_amount > 0){\r\n                let obj = {\r\n                    \"cust_noid\": basicApptDetail.custId,\r\n                    \"cart_date\" : dateFormat(new Date(), \"yyyy-mm-dd\"),\r\n                    \"itemcodeid\": key.stock_id,\r\n                    \"price\" : key.pay_amount,\r\n                    \"item_uom\" : null,\r\n                    \"treatment_account\" : key.TreatmentAccountid,\r\n                    \"deposit_account\" : null,\r\n                    \"prepaid_account\":  null\r\n                }\r\n                payload.push(obj);\r\n            }\r\n            \r\n        }\r\n\r\n        this.props.getCommonApi(`itemcart/Check/?cart_date=${dateFormat(new Date(), \"yyyy-mm-dd\")}&cust_noid=${basicApptDetail.custId}`).then((res) => {\r\n            if (res.data.length === 0) {\r\n                this.props.commonCreateApi(\"itemcart/TopUpCartCreate/\", payload).then((res) => {\r\n                    // this.props.handleCartCreated()\r\n                    this.props.handleModal();\r\n                })\r\n            } else {\r\n                this.props.commonCreateApi(`itemcart/TopUpCartCreate/?cart_id=${res.cart_id}`, payload).then((res) => {\r\n                    this.props.handleModal();\r\n                })\r\n            }\r\n        })\r\n       \r\n\r\n        } else {\r\n            this.validator.showMessages();\r\n        }\r\n    }\r\n\r\n    handleClearLine = () => {\r\n        this.props.commonDeleteApi(`tmpitemhelper/delete/?clear_all=0&cartid=${this.props.cartId}`).then(() => {\r\n            this.getCart();\r\n        })\r\n    }\r\n\r\n    handleClearAll = () => {\r\n        this.props.commonDeleteApi(`tmpitemhelper/delete/?clear_all=1&cartid=${this.props.cartId}`).then(() => {\r\n            let { formFields, postFields } = this.state;\r\n            this.setState({\r\n                formFields,\r\n                postFields\r\n            });\r\n            this.getCart();\r\n\r\n        })\r\n    }\r\n\r\n    handlePayAmount = (event, data, index) => {\r\n        let { treatmentList } = this.state;\r\n        treatmentList[index][event.target.name] = event.target.value;\r\n        this.setState({\r\n            treatmentList\r\n        })\r\n    }\r\n\r\n    render() {\r\n        let { workpoint = \"\", treatmentList = [], headerDetails, formFields } = this.state;\r\n        let { customer_name, new_outstanding, old_outstanding, topup_amount } = formFields\r\n        return (\r\n            <div className=\"row new-cart treatment-done top-up\">\r\n                <div className=\"col-5\">\r\n                    <div className=\"d-flex\">\r\n                        <label className=\"text-left w-100 text-black common-label-text mr-2\">\r\n                            Customer\r\n                        </label>\r\n                        <div className=\"input-group\">\r\n                            <NormalInput\r\n                                value={customer_name}\r\n                                name=\"customer_name\"\r\n                                onChange={this.handlePostChange}\r\n                                className={`customer-name`}\r\n                                disabled\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"d-flex\">\r\n                        <label className=\"text-left w-100 text-black common-label-text mr-2\">\r\n                            Outstanding\r\n                        </label>\r\n                        <div className=\"input-group\">\r\n                            <NormalInput\r\n                                value={old_outstanding}\r\n                                name=\"old_outstanding\"\r\n                                onChange={this.handlePostChange}\r\n                                className={`customer-name`}\r\n                                disabled\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"col-3\">\r\n                    <FormGroup check className=\"m-0\">\r\n                        <Label check>\r\n                            <Input\r\n                                type=\"checkbox\"\r\n                                onChange={this.props.handleChangeBox}\r\n                                name=\"cust_maillist\" />{' '} Auto\r\n                        </Label>\r\n                    </FormGroup>\r\n                </div>\r\n                <div className=\"col-4\">\r\n                    <div className=\"d-flex\">\r\n                        <label className=\"text-left w-100 text-black common-label-text mr-2\">\r\n                            Top Up Amount\r\n                        </label>\r\n                        <div className=\"input-group\">\r\n                            <NormalInput\r\n                                value={topup_amount}\r\n                                name=\"topup_amount\"\r\n                                onChange={this.handlePostChange}\r\n                                className={`customer-name`}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"d-flex\">\r\n                        <label className=\"text-left w-100 text-black common-label-text mr-2\">\r\n                            New Outstanging\r\n                        </label>\r\n                        <div className=\"input-group\">\r\n                            <NormalInput\r\n                                value={new_outstanding}\r\n                                name=\"new_outstanding\"\r\n                                onChange={this.handlePostChange}\r\n                                className={`customer-name`}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={`col-12 cart-item mt-2`}>\r\n                    <div className={`item-list`}>\r\n\r\n                        <div className=\"table\">\r\n                            <TableWrapper\r\n                                headerDetails={headerDetails}\r\n                                queryHandler={this.handlePagination}\r\n                            >\r\n                                {treatmentList.length > 0 ? treatmentList.map((item, index) => {\r\n                                return (\r\n                                    <tr key={index}>\r\n\r\n                                        <td><div className=\"d-flex align-items-center justify-content-center\">{item.sa_transacno}</div></td>\r\n                                        <td><div className=\"d-flex align-items-left justify-content-center\">{item.description}</div></td>\r\n                                        <td><div className=\"d-flex align-items-center justify-content-center\">{item.qty}</div></td>\r\n                                        <td><div className=\"d-flex align-items-center justify-content-center\">{item.treatment_parentcode}</div></td>\r\n                                        <td><div className=\"d-flex align-items-center justify-content-center\">{item.balance}</div></td>\r\n                                        <td><div className=\"d-flex align-items-center justify-content-center\">{item.outstanding}</div></td>\r\n                                        <td>\r\n                                            <div className=\"d-flex align-items-center payment-input justify-content-center\">\r\n                                                <NormalInput\r\n                                                    value={item.pay_amount} \r\n                                                    name=\"pay_amount\"\r\n                                                    onChange={(e)=>this.handlePayAmount(e, item, index)}\r\n                                                    className={`customer-name`}\r\n                                                />\r\n                                                {item.pay_amount ? this.validator.message('pay_amount', item.pay_amount, `required|max:${Number(item.outstanding)},num`):\"\"}\r\n                                            </div> \r\n                                        </td>\r\n                                        <td><div className=\"d-flex align-items-center justify-content-center\">{item.sa_staffname}</div></td>\r\n                                    </tr>\r\n                                )\r\n                            }) : \"\"\r\n                                }\r\n\r\n                            </TableWrapper>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"col-12 pt-4 action-bar\">\r\n                    <div className=\"row\">\r\n                        <div className=\"col-6 d-flex\">\r\n                            {/* <NormalButton\r\n                                buttonClass={\"mx-2\"}\r\n                                mainbg={true}\r\n                                className=\"fs-15 clear-line\"\r\n                                label=\"Clear Line\"\r\n                                outline={false}\r\n                                onClick={this.handleClearLine}\r\n                            />\r\n                            <NormalButton\r\n                                buttonClass={\"mx-2\"}\r\n                                mainbg={true}\r\n                                className=\"fs-15 clear-all\"\r\n                                label=\"Clear All\"\r\n                                outline={false}\r\n                                onClick={this.handleClearAll}\r\n                            /> */}\r\n                        </div>\r\n                        <div className=\"col-4 text-right\">\r\n\r\n                        </div>\r\n                        <div className=\"col-2 text-right\">\r\n                            <NormalButton\r\n                                buttonClass={\"mx-2\"}\r\n                                mainbg={true}\r\n                                className=\" fs-15 confirm\"\r\n                                label=\"Confirm\"\r\n                                outline={false}\r\n                                onClick={this.handleCreateCart}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\nconst mapStateToProps = (state) => ({\r\n    selected_cstomer: state.common.selected_cstomer,\r\n    basicApptDetail: state.appointment.basicApptDetail,\r\n})\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return bindActionCreators({\r\n        // getCustomer,\r\n        getCommonApi,\r\n        updateForm,\r\n        commonCreateApi,\r\n        commonPatchApi,\r\n        commonDeleteApi\r\n    }, dispatch)\r\n}\r\n\r\nexport const TopupTreatment = connect(mapStateToProps, mapDispatchToProps)(TopupTreatmentClass)"]},"metadata":{},"sourceType":"module"}