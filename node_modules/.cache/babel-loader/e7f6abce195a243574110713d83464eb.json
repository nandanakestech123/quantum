{"ast":null,"code":"import _regeneratorRuntime from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _createForOfIteratorHelper from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createForOfIteratorHelper\";import _asyncToGenerator from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{TableWrapper,NormalSelect}from\"component/common\";import{updateForm,getCommonApi}from\"redux/actions/common\";import{connect}from\"react-redux\";import{bindActionCreators}from\"redux\";import _ from\"lodash\";import{TreatmentUsagePopup}from\"./TreatmentUsagePopup\";import{withTranslation}from\"react-i18next\";import{Toast}from\"service/toast\";export var ListTreatmentHistoryCartClass=/*#__PURE__*/function(_Component){_inherits(ListTreatmentHistoryCartClass,_Component);var _super=_createSuper(ListTreatmentHistoryCartClass);function ListTreatmentHistoryCartClass(){var _this;_classCallCheck(this,ListTreatmentHistoryCartClass);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={headerDetails:[{label:\"Branch\"},{label:\"Trans Date\",divClass:\"justify-content-end text-right\"},{label:\"Purc Date\",divClass:\"justify-content-end text-right\"},{label:\"Transac #\"},{label:\"Treatment ID\"},{label:\"Link Code\"},{label:\"Treatment\"},{label:\"Status\"},{label:\"Record Status\"},{label:\"Remarks\"},{label:\"Customer Remarks\"},{label:\"Type\"}],TreatmentHistory:[],treatmentList:[],meta:{},customerNumber:0,yearList:[],selectedYear:new Date().getFullYear(),isTreatmentUsagePopup:false,TreatmentHistoryId:0,cust_data:{}};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _this.setState({customerNumber:_this.props.customerNumber});case 2:_this.props.getCommonApi(\"treatmentdone/Year/\").then(function(key){var status=key.status,data=key.data;var yearList=_this.state.yearList;var _iterator=_createForOfIteratorHelper(data),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var value=_step.value;yearList.push({value:value,label:value});}}catch(err){_iterator.e(err);}finally{_iterator.f();}_this.setState({yearList:yearList});});_this.getTreatmentHistoryList({});case 4:case\"end\":return _context.stop();}}},_callee);}));_this.getTreatmentHistoryList=function(data){var _this$state=_this.state,customerNumber=_this$state.customerNumber,selectedYear=_this$state.selectedYear,TreatmentHistory=_this$state.TreatmentHistory;if(customerNumber>0){var _data$page=data.page,page=_data$page===void 0?1:_data$page,_data$limit=data.limit,limit=_data$limit===void 0?10:_data$limit,_data$search=data.search,search=_data$search===void 0?\"\":_data$search;_this.props.getCommonApi(\"treatmenthistory/?year=\".concat(selectedYear,\"&cust_id=\").concat(customerNumber,\"&page=\").concat(page,\"&limit=\").concat(limit)).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(res){var data,status,cust;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _this.setState({treatmentList:[],meta:{}});case 2:data=res.data,status=res.status,cust=res.cust;console.log(res,\"treatmenthistorycart\");if(status===200){if(data.dataList){_this.setState({treatmentList:data.dataList,meta:data.meta.pagination,cust_data:cust});}}case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}());}};_this.handlehistoryYearChange=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref3){var _ref3$target,value,name,selectedYear;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_ref3$target=_ref3.target,value=_ref3$target.value,name=_ref3$target.name;selectedYear=_this.state.selectedYear;selectedYear=value;_context3.next=5;return _this.setState({selectedYear:selectedYear});case 5:_this.getTreatmentHistoryList({});case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref4.apply(this,arguments);};}();_this.handlePagination=function(page){_this.getTreatmentHistoryList(page);};_this.treatmentUsagePopupclose=function(){_this.setState(function(prevState){return{isTreatmentUsagePopup:!prevState.isTreatmentUsagePopup};});};_this.treatmentUsagePopup=function(data){if(data.is_allow){if(data.status==\"Done\"){_this.setState(function(prevState){return{TreatmentHistoryId:data.id,isTreatmentUsagePopup:!prevState.isTreatmentUsagePopup};});}}else{Toast({type:\"error\",message:\"Treatment usage is not allowed in other outlets\"});}};return _this;}_createClass(ListTreatmentHistoryCartClass,[{key:\"render\",value:function render(){var _this2=this;var _this$state2=this.state,headerDetails=_this$state2.headerDetails,treatmentList=_this$state2.treatmentList,meta=_this$state2.meta,yearList=_this$state2.yearList,selectedYear=_this$state2.selectedYear,isTreatmentUsagePopup=_this$state2.isTreatmentUsagePopup,TreatmentHistoryId=_this$state2.TreatmentHistoryId,cust_data=_this$state2.cust_data;var t=this.props.t;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex treatment-done-new p-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12 col-12 header\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex flex-wrap select-year\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 col-md-3 pl-0 mb-2 name py-2\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-5\"},/*#__PURE__*/React.createElement(\"label\",null,t(\"Select Year\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-6\"},/*#__PURE__*/React.createElement(NormalSelect// placeholder=\"Enter here\"\n,{options:yearList,value:selectedYear,name:\"selectedYear\",onChange:this.handlehistoryYearChange,className:\"selected-year mb-2 py-0\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4 col-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12\"},/*#__PURE__*/React.createElement(\"p\",null,t(\"Customer Name\"),\" : \",cust_data.cust_name),/*#__PURE__*/React.createElement(\"p\",null,t(\"Reference\"),\" : \",cust_data.cust_refer)))))),/*#__PURE__*/React.createElement(\"div\",{className:\"table-container\"},/*#__PURE__*/React.createElement(TableWrapper,{headerDetails:headerDetails,queryHandler:this.handlePagination,pageMeta:meta},treatmentList&&treatmentList.length>0?treatmentList.map(function(item,index){var trasac_date=item.trasac_date,purchase_date=item.purchase_date,transac=item.transac,treatment_code=item.treatment_code,link_code=item.link_code,course=item.course,status=item.status,record_status=item.record_status,remarks=item.remarks,cust_remark=item.cust_remark,type=item.type,site_code=item.site_code,is_current=item.is_current;return/*#__PURE__*/React.createElement(\"tr\",{key:index,onClick:function onClick(){return _this2.treatmentUsagePopup(item);}},/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-left \".concat(!is_current?\"other-branch\":\"\")},site_code)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-right\"},trasac_date)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-right\"},purchase_date)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"\\\"text-left\"},transac)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"\\\"text-left\"},treatment_code)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"\\\"text-left\"},link_code)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"\\\"text-left\"},course)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"\\\"text-left\"},status)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"\\\"text-left\"},record_status)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"\\\"text-left\"},remarks)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"\\\"text-left\"},cust_remark)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"\\\"text-left\"},type)));}):/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",{colSpan:\"12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},t(\"No Data Available\")))))),isTreatmentUsagePopup?/*#__PURE__*/React.createElement(TreatmentUsagePopup,{isTreatmentUsagePopup:isTreatmentUsagePopup,treatmentUsagePopup:this.treatmentUsagePopup,treatmentUsagePopupclose:this.treatmentUsagePopupclose,TreatmentHistoryId:TreatmentHistoryId}):null);}}]);return ListTreatmentHistoryCartClass;}(Component);var mapStateToProps=function mapStateToProps(state){return{// filter: state.dashboard\n};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return bindActionCreators({updateForm:updateForm,getCommonApi:getCommonApi},dispatch);};export var TreatmentHistoryCart=withTranslation()(connect(mapStateToProps,mapDispatchToProps)(ListTreatmentHistoryCartClass));","map":{"version":3,"sources":["F:/webfe/src/component/Admin/Cart/treatmentDone/TreatmentHistoryCart.js"],"names":["React","Component","TableWrapper","NormalSelect","updateForm","getCommonApi","connect","bindActionCreators","_","TreatmentUsagePopup","withTranslation","Toast","ListTreatmentHistoryCartClass","state","headerDetails","label","divClass","TreatmentHistory","treatmentList","meta","customerNumber","yearList","selectedYear","Date","getFullYear","isTreatmentUsagePopup","TreatmentHistoryId","cust_data","componentDidMount","setState","props","then","key","status","data","value","push","getTreatmentHistoryList","page","limit","search","res","cust","console","log","dataList","pagination","handlehistoryYearChange","target","name","handlePagination","treatmentUsagePopupclose","prevState","treatmentUsagePopup","is_allow","id","type","message","t","cust_name","cust_refer","length","map","item","index","trasac_date","purchase_date","transac","treatment_code","link_code","course","record_status","remarks","cust_remark","site_code","is_current","mapStateToProps","mapDispatchToProps","dispatch","TreatmentHistoryCart"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { TableWrapper, NormalSelect } from \"component/common\";\r\nimport { updateForm, getCommonApi } from \"redux/actions/common\";\r\nimport { connect } from \"react-redux\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport _ from \"lodash\";\r\nimport { TreatmentUsagePopup } from \"./TreatmentUsagePopup\";\r\nimport { withTranslation } from \"react-i18next\";\r\nimport { Toast } from \"service/toast\";\r\n\r\nexport class ListTreatmentHistoryCartClass extends Component {\r\n  state = {\r\n    headerDetails: [\r\n      { label: \"Branch\" },\r\n      { label: \"Trans Date\", divClass: \"justify-content-end text-right\" },\r\n      { label: \"Purc Date\", divClass: \"justify-content-end text-right\" },\r\n      { label: \"Transac #\" },\r\n      { label: \"Treatment ID\" },\r\n      { label: \"Link Code\" },\r\n      { label: \"Treatment\" },\r\n      { label: \"Status\" },\r\n      { label: \"Record Status\" },\r\n      { label: \"Remarks\" },\r\n      { label: \"Customer Remarks\" },\r\n      { label: \"Type\" },\r\n    ],\r\n    TreatmentHistory: [],\r\n    treatmentList: [],\r\n    meta: {},\r\n    customerNumber: 0,\r\n    yearList: [],\r\n    selectedYear: new Date().getFullYear(),\r\n    isTreatmentUsagePopup: false,\r\n    TreatmentHistoryId: 0,\r\n    cust_data: {},\r\n  };\r\n\r\n  componentDidMount = async () => {\r\n    await this.setState({\r\n      customerNumber: this.props.customerNumber,\r\n    });\r\n    this.props.getCommonApi(\"treatmentdone/Year/\").then(key => {\r\n      let { status, data } = key;\r\n      let { yearList } = this.state;\r\n      for (let value of data) {\r\n        yearList.push({ value: value, label: value });\r\n      }\r\n      this.setState({ yearList });\r\n    });\r\n\r\n    this.getTreatmentHistoryList({});\r\n  };\r\n\r\n  getTreatmentHistoryList = data => {\r\n    let { customerNumber, selectedYear, TreatmentHistory } = this.state;\r\n    if (customerNumber > 0) {\r\n      let { page = 1, limit = 10, search = \"\" } = data;\r\n      this.props\r\n        .getCommonApi(\r\n          `treatmenthistory/?year=${selectedYear}&cust_id=${customerNumber}&page=${page}&limit=${limit}`\r\n        )\r\n        .then(async res => {\r\n          await this.setState({ treatmentList: [], meta: {} });\r\n          let { data, status, cust } = res;\r\n          console.log(res, \"treatmenthistorycart\");\r\n          if (status === 200) {\r\n            if (data.dataList) {\r\n              this.setState({\r\n                treatmentList: data.dataList,\r\n                meta: data.meta.pagination,\r\n                cust_data: cust,\r\n              });\r\n            }\r\n          }\r\n        });\r\n    }\r\n  };\r\n\r\n  handlehistoryYearChange = async ({ target: { value, name } }) => {\r\n    let { selectedYear } = this.state;\r\n    selectedYear = value;\r\n    await this.setState({\r\n      selectedYear,\r\n    });\r\n    this.getTreatmentHistoryList({});\r\n  };\r\n\r\n  handlePagination = page => {\r\n    this.getTreatmentHistoryList(page);\r\n  };\r\n\r\n  treatmentUsagePopupclose = () => {\r\n    this.setState(prevState => ({\r\n      isTreatmentUsagePopup: !prevState.isTreatmentUsagePopup,\r\n    }));\r\n  };\r\n  treatmentUsagePopup = data => {\r\n    if (data.is_allow) {\r\n      if (data.status == \"Done\") {\r\n        this.setState(prevState => ({\r\n          TreatmentHistoryId: data.id,\r\n          isTreatmentUsagePopup: !prevState.isTreatmentUsagePopup,\r\n        }));\r\n      }\r\n    } else {\r\n      Toast({\r\n        type: \"error\",\r\n        message: \"Treatment usage is not allowed in other outlets\",\r\n      });\r\n    }\r\n  };\r\n\r\n  render() {\r\n    let {\r\n      headerDetails,\r\n      treatmentList,\r\n      meta,\r\n      yearList,\r\n      selectedYear,\r\n      isTreatmentUsagePopup,\r\n      TreatmentHistoryId,\r\n      cust_data,\r\n    } = this.state;\r\n    let { t } = this.props;\r\n    return (\r\n      <>\r\n        <div className=\"d-flex treatment-done-new p-3\">\r\n          <div className=\"col-md-12 col-12 header\">\r\n            <div className=\"d-flex flex-wrap select-year\">\r\n              <div className=\"col-12 col-md-3 pl-0 mb-2 name py-2\">\r\n                <div className=\"col-md-5\">\r\n                  <label>{t(\"Select Year\")}</label>\r\n                </div>\r\n\r\n                <div className=\"col-md-6\">\r\n                  <NormalSelect\r\n                    // placeholder=\"Enter here\"\r\n                    options={yearList}\r\n                    value={selectedYear}\r\n                    name=\"selectedYear\"\r\n                    onChange={this.handlehistoryYearChange}\r\n                    className=\"selected-year mb-2 py-0\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"col-md-4 col-12\">\r\n                <div className=\"col-md-12\">\r\n                  <p>\r\n                    {t(\"Customer Name\")} : {cust_data.cust_name}\r\n                  </p>\r\n                  <p>\r\n                    {t(\"Reference\")} : {cust_data.cust_refer}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"table-container\">\r\n          <TableWrapper\r\n            headerDetails={headerDetails}\r\n            queryHandler={this.handlePagination}\r\n            pageMeta={meta}\r\n          >\r\n            {treatmentList && treatmentList.length > 0 ? (\r\n              treatmentList.map((item, index) => {\r\n                let {\r\n                  trasac_date,\r\n                  purchase_date,\r\n                  transac,\r\n                  treatment_code,\r\n                  link_code,\r\n                  course,\r\n                  status,\r\n                  record_status,\r\n                  remarks,\r\n                  cust_remark,\r\n                  type,\r\n                  site_code,\r\n                  is_current,\r\n                } = item;\r\n                return (\r\n                  <tr\r\n                    key={index}\r\n                    onClick={() => this.treatmentUsagePopup(item)}\r\n                  >\r\n                    <td>\r\n                      <div\r\n                        className={`text-left ${\r\n                          !is_current ? \"other-branch\" : \"\"\r\n                        }`}\r\n                      >\r\n                        {site_code}\r\n                      </div>\r\n                    </td>\r\n                    <td>\r\n                      <div className={`text-right`}>{trasac_date}</div>\r\n                    </td>\r\n                    <td>\r\n                      <div className={`text-right`}>{purchase_date}</div>\r\n                    </td>\r\n                    <td>\r\n                      <div className={`\"text-left`}>{transac}</div>\r\n                    </td>\r\n                    <td>\r\n                      <div className={`\"text-left`}>{treatment_code}</div>\r\n                    </td>\r\n                    <td>\r\n                      <div className={`\"text-left`}>{link_code}</div>\r\n                    </td>\r\n                    <td>\r\n                      <div className={`\"text-left`}>{course}</div>\r\n                    </td>\r\n                    <td>\r\n                      <div className={`\"text-left`}>{status}</div>\r\n                    </td>\r\n                    <td>\r\n                      <div className={`\"text-left`}>{record_status}</div>\r\n                    </td>\r\n                    <td>\r\n                      <div className={`\"text-left`}>{remarks}</div>\r\n                    </td>\r\n                    <td>\r\n                      <div className={`\"text-left`}>{cust_remark}</div>\r\n                    </td>\r\n                    <td>\r\n                      <div className={`\"text-left`}>{type}</div>\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })\r\n            ) : (\r\n              <tr>\r\n                <td colSpan=\"12\">\r\n                  <div className=\"d-flex align-items-center justify-content-center\">\r\n                    {t(\"No Data Available\")}\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            )}\r\n          </TableWrapper>\r\n        </div>\r\n        {isTreatmentUsagePopup ? (\r\n          <TreatmentUsagePopup\r\n            isTreatmentUsagePopup={isTreatmentUsagePopup}\r\n            treatmentUsagePopup={this.treatmentUsagePopup}\r\n            treatmentUsagePopupclose={this.treatmentUsagePopupclose}\r\n            TreatmentHistoryId={TreatmentHistoryId}\r\n          />\r\n        ) : null}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n  // filter: state.dashboard\r\n});\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return bindActionCreators(\r\n    {\r\n      updateForm,\r\n      getCommonApi,\r\n    },\r\n    dispatch\r\n  );\r\n};\r\n\r\nexport const TreatmentHistoryCart = withTranslation()(\r\n  connect(mapStateToProps, mapDispatchToProps)(ListTreatmentHistoryCartClass)\r\n);\r\n"]},"metadata":{},"sourceType":"module"}