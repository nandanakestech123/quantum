{"ast":null,"code":"/**\r\n * DevExtreme (ui/drop_down_box.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _ui = _interopRequireDefault(require(\"./drop_down_editor/ui.drop_down_editor\"));\n\nvar _ui2 = _interopRequireDefault(require(\"./editor/ui.data_expression\"));\n\nvar _common = require(\"../core/utils/common\");\n\nvar _type = require(\"../core/utils/type\");\n\nvar _iterator = require(\"../core/utils/iterator\");\n\nvar _selectors = require(\"./widget/selectors\");\n\nvar _deferred = require(\"../core/utils/deferred\");\n\nvar _renderer = _interopRequireDefault(require(\"../core/renderer\"));\n\nvar _events_engine = _interopRequireDefault(require(\"../events/core/events_engine\"));\n\nvar _extend = require(\"../core/utils/extend\");\n\nvar _utils = require(\"../ui/overlay/utils\");\n\nvar _component_registrator = _interopRequireDefault(require(\"../core/component_registrator\"));\n\nvar _index = require(\"../events/utils/index\");\n\nvar _short = require(\"../events/short\");\n\nvar _devices = _interopRequireDefault(require(\"../core/devices\"));\n\nvar _dom_adapter = _interopRequireDefault(require(\"../core/dom_adapter\"));\n\nvar _element = require(\"../core/element\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar getActiveElement = _dom_adapter.default.getActiveElement;\nvar DROP_DOWN_BOX_CLASS = \"dx-dropdownbox\";\nvar ANONYMOUS_TEMPLATE_NAME = \"content\";\n\nvar realDevice = _devices.default.real();\n\nvar DropDownBox = _ui.default.inherit({\n  _supportedKeys: function () {\n    return (0, _extend.extend)({}, this.callBase(), {\n      tab: function (e) {\n        if (!this.option(\"opened\")) {\n          return;\n        }\n\n        var $tabbableElements = this._getTabbableElements();\n\n        var $focusableElement = e.shiftKey ? $tabbableElements.last() : $tabbableElements.first();\n        $focusableElement && _events_engine.default.trigger($focusableElement, \"focus\");\n        e.preventDefault();\n      }\n    });\n  },\n  _getTabbableElements: function () {\n    return this._getElements().filter(_selectors.tabbable);\n  },\n  _getElements: function () {\n    return (0, _renderer.default)(this.content()).find(\"*\");\n  },\n  _getDefaultOptions: function () {\n    return (0, _extend.extend)(this.callBase(), {\n      acceptCustomValue: false,\n      contentTemplate: ANONYMOUS_TEMPLATE_NAME,\n      openOnFieldClick: true,\n      displayValueFormatter: function (value) {\n        return Array.isArray(value) ? value.join(\", \") : value;\n      },\n      useHiddenSubmitElement: true\n    });\n  },\n  _getAnonymousTemplateName: function () {\n    return ANONYMOUS_TEMPLATE_NAME;\n  },\n  _initTemplates: function () {\n    this.callBase();\n  },\n  _initMarkup: function () {\n    this._initDataExpressions();\n\n    this.$element().addClass(DROP_DOWN_BOX_CLASS);\n    this.callBase();\n  },\n  _setSubmitValue: function () {\n    var value = this.option(\"value\");\n    var submitValue = this._shouldUseDisplayValue(value) ? this._displayGetter(value) : value;\n\n    this._getSubmitElement().val(submitValue);\n  },\n  _shouldUseDisplayValue: function (value) {\n    return \"this\" === this.option(\"valueExpr\") && (0, _type.isObject)(value);\n  },\n  _renderInputValue: function () {\n    var callBase = this.callBase.bind(this);\n    var values = [];\n\n    if (!this._dataSource) {\n      callBase(values);\n      return new _deferred.Deferred().resolve();\n    }\n\n    var currentValue = this._getCurrentValue();\n\n    var keys = (0, _common.ensureDefined)(currentValue, []);\n    keys = Array.isArray(keys) ? keys : [keys];\n    var itemLoadDeferreds = (0, _iterator.map)(keys, function (key) {\n      return this._loadItem(key).always(function (item) {\n        var displayValue = this._displayGetter(item);\n\n        values.push((0, _common.ensureDefined)(displayValue, key));\n      }.bind(this));\n    }.bind(this));\n    return _deferred.when.apply(this, itemLoadDeferreds).always(function () {\n      this.option(\"displayValue\", values);\n      callBase(values.length && values);\n    }.bind(this));\n  },\n  _loadItem: function (value) {\n    var deferred = new _deferred.Deferred();\n    var that = this;\n    var selectedItem = (0, _common.grep)(this.option(\"items\") || [], function (item) {\n      return this._isValueEquals(this._valueGetter(item), value);\n    }.bind(this))[0];\n\n    if (void 0 !== selectedItem) {\n      deferred.resolve(selectedItem);\n    } else {\n      this._loadValue(value).done(function (item) {\n        deferred.resolve(item);\n      }).fail(function (args) {\n        if (that.option(\"acceptCustomValue\")) {\n          deferred.resolve(value);\n        } else {\n          deferred.reject();\n        }\n      });\n    }\n\n    return deferred.promise();\n  },\n  _popupElementTabHandler: function (e) {\n    if (\"tab\" !== (0, _index.normalizeKeyName)(e)) {\n      return;\n    }\n\n    var $firstTabbable = this._getTabbableElements().first().get(0);\n\n    var $lastTabbable = this._getTabbableElements().last().get(0);\n\n    var $target = e.originalEvent.target;\n    var moveBackward = !!($target === $firstTabbable && e.shift);\n    var moveForward = !!($target === $lastTabbable && !e.shift);\n\n    if (moveBackward || moveForward) {\n      this.close();\n\n      _events_engine.default.trigger(this._input(), \"focus\");\n\n      if (moveBackward) {\n        e.originalEvent.preventDefault();\n      }\n    }\n  },\n  _renderPopup: function (e) {\n    var _this = this;\n\n    this.callBase();\n\n    if (this.option(\"focusStateEnabled\")) {\n      _short.keyboard.on(this.content(), null, function (e) {\n        return _this._popupElementTabHandler(e);\n      });\n    }\n  },\n  _renderPopupContent: function () {\n    if (this.option(\"contentTemplate\") === ANONYMOUS_TEMPLATE_NAME) {\n      return;\n    }\n\n    var contentTemplate = this._getTemplateByOption(\"contentTemplate\");\n\n    if (!(contentTemplate && this.option(\"contentTemplate\"))) {\n      return;\n    }\n\n    var $popupContent = this._popup.$content();\n\n    var templateData = {\n      value: this._fieldRenderData(),\n      component: this\n    };\n    $popupContent.empty();\n    contentTemplate.render({\n      container: (0, _element.getPublicElement)($popupContent),\n      model: templateData\n    });\n  },\n  _canShowVirtualKeyboard: function () {\n    return realDevice.mac;\n  },\n  _isNestedElementActive: function () {\n    var activeElement = getActiveElement();\n    return activeElement && this._popup.$content().get(0).contains(activeElement);\n  },\n  _shouldCloseOnTargetScroll: function () {\n    return \"desktop\" === realDevice.deviceType && this._canShowVirtualKeyboard() && this._isNestedElementActive();\n  },\n  _popupHiddenHandler: function () {\n    this.callBase();\n    this._popupPosition = void 0;\n  },\n  _popupPositionedHandler: function (e) {\n    this.callBase(e);\n    this._popupPosition = e.position;\n  },\n  _getDefaultPopupPosition: function (isRtlEnabled) {\n    var _this$callBase = this.callBase(isRtlEnabled),\n        my = _this$callBase.my,\n        at = _this$callBase.at;\n\n    return {\n      my: my,\n      at: at,\n      offset: {\n        v: -1\n      },\n      collision: \"flipfit\"\n    };\n  },\n  _popupConfig: function () {\n    var _this2 = this;\n\n    var _this$option = this.option(),\n        focusStateEnabled = _this$option.focusStateEnabled;\n\n    return (0, _extend.extend)(this.callBase(), {\n      tabIndex: -1,\n      dragEnabled: false,\n      focusStateEnabled: focusStateEnabled,\n      contentTemplate: ANONYMOUS_TEMPLATE_NAME,\n      closeOnTargetScroll: this._shouldCloseOnTargetScroll.bind(this),\n      position: (0, _extend.extend)(this.option(\"popupPosition\"), {\n        of: this.$element()\n      }),\n      onKeyboardHandled: function (opts) {\n        return _this2.option(\"focusStateEnabled\") && _this2._popupElementTabHandler(opts);\n      },\n      maxHeight: function () {\n        var _this$_popupPosition;\n\n        var popupLocation = null === (_this$_popupPosition = this._popupPosition) || void 0 === _this$_popupPosition ? void 0 : _this$_popupPosition.v.location;\n        return (0, _utils.getElementMaxHeightByWindow)(this.$element(), popupLocation);\n      }.bind(this)\n    });\n  },\n  _popupShownHandler: function () {\n    this.callBase();\n\n    var $firstElement = this._getTabbableElements().first();\n\n    _events_engine.default.trigger($firstElement, \"focus\");\n  },\n  _setCollectionWidgetOption: _common.noop,\n  _optionChanged: function (args) {\n    this._dataExpressionOptionChanged(args);\n\n    switch (args.name) {\n      case \"dataSource\":\n        this._renderInputValue();\n\n        break;\n\n      case \"displayValue\":\n        this.option(\"text\", args.value);\n        break;\n\n      case \"displayExpr\":\n        this._renderValue();\n\n        break;\n\n      case \"contentTemplate\":\n        this._invalidate();\n\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  }\n}).include(_ui2.default);\n\n(0, _component_registrator.default)(\"dxDropDownBox\", DropDownBox);\nvar _default = DropDownBox;\nexports.default = _default;\nmodule.exports = exports.default;\nmodule.exports.default = module.exports;","map":{"version":3,"sources":["E:/newfrontend/webfe/node_modules/devextreme/ui/drop_down_box.js"],"names":["exports","default","_ui","_interopRequireDefault","require","_ui2","_common","_type","_iterator","_selectors","_deferred","_renderer","_events_engine","_extend","_utils","_component_registrator","_index","_short","_devices","_dom_adapter","_element","obj","__esModule","getActiveElement","DROP_DOWN_BOX_CLASS","ANONYMOUS_TEMPLATE_NAME","realDevice","real","DropDownBox","inherit","_supportedKeys","extend","callBase","tab","e","option","$tabbableElements","_getTabbableElements","$focusableElement","shiftKey","last","first","trigger","preventDefault","_getElements","filter","tabbable","content","find","_getDefaultOptions","acceptCustomValue","contentTemplate","openOnFieldClick","displayValueFormatter","value","Array","isArray","join","useHiddenSubmitElement","_getAnonymousTemplateName","_initTemplates","_initMarkup","_initDataExpressions","$element","addClass","_setSubmitValue","submitValue","_shouldUseDisplayValue","_displayGetter","_getSubmitElement","val","isObject","_renderInputValue","bind","values","_dataSource","Deferred","resolve","currentValue","_getCurrentValue","keys","ensureDefined","itemLoadDeferreds","map","key","_loadItem","always","item","displayValue","push","when","apply","length","deferred","that","selectedItem","grep","_isValueEquals","_valueGetter","_loadValue","done","fail","args","reject","promise","_popupElementTabHandler","normalizeKeyName","$firstTabbable","get","$lastTabbable","$target","originalEvent","target","moveBackward","shift","moveForward","close","_input","_renderPopup","_this","keyboard","on","_renderPopupContent","_getTemplateByOption","$popupContent","_popup","$content","templateData","_fieldRenderData","component","empty","render","container","getPublicElement","model","_canShowVirtualKeyboard","mac","_isNestedElementActive","activeElement","contains","_shouldCloseOnTargetScroll","deviceType","_popupHiddenHandler","_popupPosition","_popupPositionedHandler","position","_getDefaultPopupPosition","isRtlEnabled","_this$callBase","my","at","offset","v","collision","_popupConfig","_this2","_this$option","focusStateEnabled","tabIndex","dragEnabled","closeOnTargetScroll","of","onKeyboardHandled","opts","maxHeight","_this$_popupPosition","popupLocation","location","getElementMaxHeightByWindow","_popupShownHandler","$firstElement","_setCollectionWidgetOption","noop","_optionChanged","_dataExpressionOptionChanged","name","_renderValue","_invalidate","include","_default","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/drop_down_box.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _ui = _interopRequireDefault(require(\"./drop_down_editor/ui.drop_down_editor\"));\r\nvar _ui2 = _interopRequireDefault(require(\"./editor/ui.data_expression\"));\r\nvar _common = require(\"../core/utils/common\");\r\nvar _type = require(\"../core/utils/type\");\r\nvar _iterator = require(\"../core/utils/iterator\");\r\nvar _selectors = require(\"./widget/selectors\");\r\nvar _deferred = require(\"../core/utils/deferred\");\r\nvar _renderer = _interopRequireDefault(require(\"../core/renderer\"));\r\nvar _events_engine = _interopRequireDefault(require(\"../events/core/events_engine\"));\r\nvar _extend = require(\"../core/utils/extend\");\r\nvar _utils = require(\"../ui/overlay/utils\");\r\nvar _component_registrator = _interopRequireDefault(require(\"../core/component_registrator\"));\r\nvar _index = require(\"../events/utils/index\");\r\nvar _short = require(\"../events/short\");\r\nvar _devices = _interopRequireDefault(require(\"../core/devices\"));\r\nvar _dom_adapter = _interopRequireDefault(require(\"../core/dom_adapter\"));\r\nvar _element = require(\"../core/element\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar getActiveElement = _dom_adapter.default.getActiveElement;\r\nvar DROP_DOWN_BOX_CLASS = \"dx-dropdownbox\";\r\nvar ANONYMOUS_TEMPLATE_NAME = \"content\";\r\nvar realDevice = _devices.default.real();\r\nvar DropDownBox = _ui.default.inherit({\r\n    _supportedKeys: function() {\r\n        return (0, _extend.extend)({}, this.callBase(), {\r\n            tab: function(e) {\r\n                if (!this.option(\"opened\")) {\r\n                    return\r\n                }\r\n                var $tabbableElements = this._getTabbableElements();\r\n                var $focusableElement = e.shiftKey ? $tabbableElements.last() : $tabbableElements.first();\r\n                $focusableElement && _events_engine.default.trigger($focusableElement, \"focus\");\r\n                e.preventDefault()\r\n            }\r\n        })\r\n    },\r\n    _getTabbableElements: function() {\r\n        return this._getElements().filter(_selectors.tabbable)\r\n    },\r\n    _getElements: function() {\r\n        return (0, _renderer.default)(this.content()).find(\"*\")\r\n    },\r\n    _getDefaultOptions: function() {\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            acceptCustomValue: false,\r\n            contentTemplate: ANONYMOUS_TEMPLATE_NAME,\r\n            openOnFieldClick: true,\r\n            displayValueFormatter: function(value) {\r\n                return Array.isArray(value) ? value.join(\", \") : value\r\n            },\r\n            useHiddenSubmitElement: true\r\n        })\r\n    },\r\n    _getAnonymousTemplateName: function() {\r\n        return ANONYMOUS_TEMPLATE_NAME\r\n    },\r\n    _initTemplates: function() {\r\n        this.callBase()\r\n    },\r\n    _initMarkup: function() {\r\n        this._initDataExpressions();\r\n        this.$element().addClass(DROP_DOWN_BOX_CLASS);\r\n        this.callBase()\r\n    },\r\n    _setSubmitValue: function() {\r\n        var value = this.option(\"value\");\r\n        var submitValue = this._shouldUseDisplayValue(value) ? this._displayGetter(value) : value;\r\n        this._getSubmitElement().val(submitValue)\r\n    },\r\n    _shouldUseDisplayValue: function(value) {\r\n        return \"this\" === this.option(\"valueExpr\") && (0, _type.isObject)(value)\r\n    },\r\n    _renderInputValue: function() {\r\n        var callBase = this.callBase.bind(this);\r\n        var values = [];\r\n        if (!this._dataSource) {\r\n            callBase(values);\r\n            return (new _deferred.Deferred).resolve()\r\n        }\r\n        var currentValue = this._getCurrentValue();\r\n        var keys = (0, _common.ensureDefined)(currentValue, []);\r\n        keys = Array.isArray(keys) ? keys : [keys];\r\n        var itemLoadDeferreds = (0, _iterator.map)(keys, function(key) {\r\n            return this._loadItem(key).always(function(item) {\r\n                var displayValue = this._displayGetter(item);\r\n                values.push((0, _common.ensureDefined)(displayValue, key))\r\n            }.bind(this))\r\n        }.bind(this));\r\n        return _deferred.when.apply(this, itemLoadDeferreds).always(function() {\r\n            this.option(\"displayValue\", values);\r\n            callBase(values.length && values)\r\n        }.bind(this))\r\n    },\r\n    _loadItem: function(value) {\r\n        var deferred = new _deferred.Deferred;\r\n        var that = this;\r\n        var selectedItem = (0, _common.grep)(this.option(\"items\") || [], function(item) {\r\n            return this._isValueEquals(this._valueGetter(item), value)\r\n        }.bind(this))[0];\r\n        if (void 0 !== selectedItem) {\r\n            deferred.resolve(selectedItem)\r\n        } else {\r\n            this._loadValue(value).done(function(item) {\r\n                deferred.resolve(item)\r\n            }).fail(function(args) {\r\n                if (that.option(\"acceptCustomValue\")) {\r\n                    deferred.resolve(value)\r\n                } else {\r\n                    deferred.reject()\r\n                }\r\n            })\r\n        }\r\n        return deferred.promise()\r\n    },\r\n    _popupElementTabHandler: function(e) {\r\n        if (\"tab\" !== (0, _index.normalizeKeyName)(e)) {\r\n            return\r\n        }\r\n        var $firstTabbable = this._getTabbableElements().first().get(0);\r\n        var $lastTabbable = this._getTabbableElements().last().get(0);\r\n        var $target = e.originalEvent.target;\r\n        var moveBackward = !!($target === $firstTabbable && e.shift);\r\n        var moveForward = !!($target === $lastTabbable && !e.shift);\r\n        if (moveBackward || moveForward) {\r\n            this.close();\r\n            _events_engine.default.trigger(this._input(), \"focus\");\r\n            if (moveBackward) {\r\n                e.originalEvent.preventDefault()\r\n            }\r\n        }\r\n    },\r\n    _renderPopup: function(e) {\r\n        var _this = this;\r\n        this.callBase();\r\n        if (this.option(\"focusStateEnabled\")) {\r\n            _short.keyboard.on(this.content(), null, function(e) {\r\n                return _this._popupElementTabHandler(e)\r\n            })\r\n        }\r\n    },\r\n    _renderPopupContent: function() {\r\n        if (this.option(\"contentTemplate\") === ANONYMOUS_TEMPLATE_NAME) {\r\n            return\r\n        }\r\n        var contentTemplate = this._getTemplateByOption(\"contentTemplate\");\r\n        if (!(contentTemplate && this.option(\"contentTemplate\"))) {\r\n            return\r\n        }\r\n        var $popupContent = this._popup.$content();\r\n        var templateData = {\r\n            value: this._fieldRenderData(),\r\n            component: this\r\n        };\r\n        $popupContent.empty();\r\n        contentTemplate.render({\r\n            container: (0, _element.getPublicElement)($popupContent),\r\n            model: templateData\r\n        })\r\n    },\r\n    _canShowVirtualKeyboard: function() {\r\n        return realDevice.mac\r\n    },\r\n    _isNestedElementActive: function() {\r\n        var activeElement = getActiveElement();\r\n        return activeElement && this._popup.$content().get(0).contains(activeElement)\r\n    },\r\n    _shouldCloseOnTargetScroll: function() {\r\n        return \"desktop\" === realDevice.deviceType && this._canShowVirtualKeyboard() && this._isNestedElementActive()\r\n    },\r\n    _popupHiddenHandler: function() {\r\n        this.callBase();\r\n        this._popupPosition = void 0\r\n    },\r\n    _popupPositionedHandler: function(e) {\r\n        this.callBase(e);\r\n        this._popupPosition = e.position\r\n    },\r\n    _getDefaultPopupPosition: function(isRtlEnabled) {\r\n        var _this$callBase = this.callBase(isRtlEnabled),\r\n            my = _this$callBase.my,\r\n            at = _this$callBase.at;\r\n        return {\r\n            my: my,\r\n            at: at,\r\n            offset: {\r\n                v: -1\r\n            },\r\n            collision: \"flipfit\"\r\n        }\r\n    },\r\n    _popupConfig: function() {\r\n        var _this2 = this;\r\n        var _this$option = this.option(),\r\n            focusStateEnabled = _this$option.focusStateEnabled;\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            tabIndex: -1,\r\n            dragEnabled: false,\r\n            focusStateEnabled: focusStateEnabled,\r\n            contentTemplate: ANONYMOUS_TEMPLATE_NAME,\r\n            closeOnTargetScroll: this._shouldCloseOnTargetScroll.bind(this),\r\n            position: (0, _extend.extend)(this.option(\"popupPosition\"), {\r\n                of: this.$element()\r\n            }),\r\n            onKeyboardHandled: function(opts) {\r\n                return _this2.option(\"focusStateEnabled\") && _this2._popupElementTabHandler(opts)\r\n            },\r\n            maxHeight: function() {\r\n                var _this$_popupPosition;\r\n                var popupLocation = null === (_this$_popupPosition = this._popupPosition) || void 0 === _this$_popupPosition ? void 0 : _this$_popupPosition.v.location;\r\n                return (0, _utils.getElementMaxHeightByWindow)(this.$element(), popupLocation)\r\n            }.bind(this)\r\n        })\r\n    },\r\n    _popupShownHandler: function() {\r\n        this.callBase();\r\n        var $firstElement = this._getTabbableElements().first();\r\n        _events_engine.default.trigger($firstElement, \"focus\")\r\n    },\r\n    _setCollectionWidgetOption: _common.noop,\r\n    _optionChanged: function(args) {\r\n        this._dataExpressionOptionChanged(args);\r\n        switch (args.name) {\r\n            case \"dataSource\":\r\n                this._renderInputValue();\r\n                break;\r\n            case \"displayValue\":\r\n                this.option(\"text\", args.value);\r\n                break;\r\n            case \"displayExpr\":\r\n                this._renderValue();\r\n                break;\r\n            case \"contentTemplate\":\r\n                this._invalidate();\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    }\r\n}).include(_ui2.default);\r\n(0, _component_registrator.default)(\"dxDropDownBox\", DropDownBox);\r\nvar _default = DropDownBox;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\nmodule.exports.default = module.exports;\r\n"]},"metadata":{},"sourceType":"script"}