{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/appointmentPopup.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _devices = _interopRequireDefault(require(\"../../core/devices\"));\n\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\n\nvar _date = _interopRequireDefault(require(\"../../core/utils/date\"));\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _visibility_change = require(\"../../events/visibility_change\");\n\nvar _message = _interopRequireDefault(require(\"../../localization/message\"));\n\nvar _popup = _interopRequireDefault(require(\"../popup\"));\n\nvar _uiScheduler = require(\"./ui.scheduler.appointment_form\");\n\nvar _ui = require(\"./ui.loading\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar toMs = _date.default.dateToMilliseconds;\nvar WIDGET_CLASS = \"dx-scheduler\";\nvar APPOINTMENT_POPUP_CLASS = \"\".concat(WIDGET_CLASS, \"-appointment-popup\");\nvar APPOINTMENT_POPUP_WIDTH = 485;\nvar APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE = 970;\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH = 1e3;\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE = 500;\nvar APPOINTMENT_POPUP_WIDTH_MOBILE = 350;\nvar TOOLBAR_ITEM_AFTER_LOCATION = \"after\";\nvar TOOLBAR_ITEM_BEFORE_LOCATION = \"before\";\nvar DAY_IN_MS = toMs(\"day\");\n\nvar AppointmentPopup = function () {\n  function AppointmentPopup(scheduler) {\n    _classCallCheck(this, AppointmentPopup);\n\n    this.scheduler = scheduler;\n    this._popup = null;\n    this._appointmentForm = null;\n    this.state = {\n      lastEditData: null,\n      saveChangesLocker: false,\n      appointment: {\n        data: null,\n        isEmptyText: false,\n        isEmptyDescription: false\n      }\n    };\n  }\n\n  _createClass(AppointmentPopup, [{\n    key: \"show\",\n    value: function value() {\n      var data = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};\n      var isDoneButtonVisible = arguments.length > 1 ? arguments[1] : void 0;\n\n      if ((0, _type.isEmptyObject)(data)) {\n        var startDate = this.scheduler.option(\"currentDate\");\n        var endDate = new Date(startDate.getTime() + this.scheduler.option(\"cellDuration\") * toMs(\"minute\"));\n        this.scheduler.fire(\"setField\", \"startDate\", data, startDate);\n        this.scheduler.fire(\"setField\", \"endDate\", data, endDate);\n      }\n\n      this.state.appointment.data = data;\n\n      if (!this._popup) {\n        var popupConfig = this._createPopupConfig();\n\n        this._popup = this._createPopup(popupConfig);\n      }\n\n      this._popup.option(\"toolbarItems\", this._createPopupToolbarItems(isDoneButtonVisible));\n\n      this._popup.show();\n    }\n  }, {\n    key: \"hide\",\n    value: function value() {\n      this._popup.hide();\n    }\n  }, {\n    key: \"isVisible\",\n    value: function value() {\n      return this._popup ? this._popup.option(\"visible\") : false;\n    }\n  }, {\n    key: \"dispose\",\n    value: function value() {\n      if (this._$popup) {\n        this._popup.$element().remove();\n\n        this._$popup = null;\n      }\n    }\n  }, {\n    key: \"_createPopup\",\n    value: function value(options) {\n      var popupElement = (0, _renderer.default)(\"<div>\").addClass(APPOINTMENT_POPUP_CLASS).appendTo(this.scheduler.$element());\n      return this.scheduler._createComponent(popupElement, _popup.default, options);\n    }\n  }, {\n    key: \"_createPopupConfig\",\n    value: function value() {\n      var _this = this;\n\n      return {\n        height: \"auto\",\n        maxHeight: \"100%\",\n        showCloseButton: false,\n        showTitle: false,\n        onHiding: function onHiding() {\n          _this.scheduler.focus();\n        },\n        contentTemplate: function contentTemplate() {\n          return _this._createPopupContent();\n        },\n        onShowing: function onShowing(e) {\n          return _this._onShowing(e);\n        },\n        defaultOptionsRules: [{\n          device: function device() {\n            return _devices.default.current().android;\n          },\n          options: {\n            showTitle: false\n          }\n        }]\n      };\n    }\n  }, {\n    key: \"_onShowing\",\n    value: function value(e) {\n      var _this2 = this;\n\n      this._updateForm();\n\n      var arg = {\n        form: this._appointmentForm,\n        popup: this._popup,\n        appointmentData: this.state.appointment.data,\n        cancel: false\n      };\n\n      this.scheduler._actions.onAppointmentFormOpening(arg);\n\n      this.scheduler._processActionResult(arg, function (canceled) {\n        if (canceled) {\n          e.cancel = true;\n        } else {\n          _this2.updatePopupFullScreenMode();\n        }\n      });\n    }\n  }, {\n    key: \"_createPopupContent\",\n    value: function value() {\n      var formElement = (0, _renderer.default)(\"<div>\");\n      this._appointmentForm = this._createForm(formElement);\n      return formElement;\n    }\n  }, {\n    key: \"_createAppointmentFormData\",\n    value: function value(rawAppointment) {\n      var appointment = this._createAppointmentAdapter(rawAppointment);\n\n      var result = (0, _extend.extend)(true, {\n        repeat: !!appointment.recurrenceRule\n      }, rawAppointment);\n      (0, _iterator.each)(this.scheduler._resourcesManager.getResourcesFromItem(result, true) || {}, function (name, value) {\n        return result[name] = value;\n      });\n      return result;\n    }\n  }, {\n    key: \"_createForm\",\n    value: function value(element) {\n      var expr = this.scheduler._dataAccessors.expr;\n      var resources = this.scheduler.option(\"resources\");\n\n      var allowTimeZoneEditing = this._getAllowTimeZoneEditing();\n\n      var rawAppointment = this.state.appointment.data;\n\n      var formData = this._createAppointmentFormData(rawAppointment);\n\n      var readOnly = this._isReadOnly(rawAppointment);\n\n      _uiScheduler.AppointmentForm.prepareAppointmentFormEditors(expr, this.scheduler, this.triggerResize.bind(this), this.changeSize.bind(this), formData, allowTimeZoneEditing, readOnly);\n\n      if (resources && resources.length) {\n        _uiScheduler.AppointmentForm.concatResources(this.scheduler._resourcesManager.getEditors());\n      }\n\n      return _uiScheduler.AppointmentForm.create(this.scheduler._createComponent.bind(this.scheduler), element, readOnly, formData);\n    }\n  }, {\n    key: \"_getAllowTimeZoneEditing\",\n    value: function value() {\n      var scheduler = this.scheduler;\n      return scheduler.option(\"editing.allowTimeZoneEditing\") || scheduler.option(\"editing.allowEditingTimeZones\");\n    }\n  }, {\n    key: \"_isReadOnly\",\n    value: function value(rawAppointment) {\n      var adapter = this.scheduler.createAppointmentAdapter(rawAppointment);\n\n      if (rawAppointment && adapter.disabled) {\n        return true;\n      }\n\n      return this.scheduler._editAppointmentData ? !this.scheduler._editing.allowUpdating : false;\n    }\n  }, {\n    key: \"_createAppointmentAdapter\",\n    value: function value(rawAppointment) {\n      return this.scheduler.createAppointmentAdapter(rawAppointment);\n    }\n  }, {\n    key: \"_updateForm\",\n    value: function value() {\n      var data = this.state.appointment.data;\n\n      var adapter = this._createAppointmentAdapter(data);\n\n      var allDay = adapter.allDay;\n      var startDate = adapter.startDate && adapter.calculateStartDate(\"toAppointment\");\n      var endDate = adapter.endDate && adapter.calculateEndDate(\"toAppointment\");\n      this.state.appointment.isEmptyText = void 0 === data || void 0 === adapter.text;\n      this.state.appointment.isEmptyDescription = void 0 === data || void 0 === adapter.description;\n\n      var appointment = this._createAppointmentAdapter(this._createAppointmentFormData(data));\n\n      if (void 0 === appointment.text) {\n        appointment.text = \"\";\n      }\n\n      if (void 0 === appointment.description) {\n        appointment.description = \"\";\n      }\n\n      if (void 0 === appointment.recurrenceRule) {\n        appointment.recurrenceRule = \"\";\n      }\n\n      var formData = appointment.source();\n\n      if (startDate) {\n        this.scheduler.fire(\"setField\", \"startDate\", formData, startDate);\n      }\n\n      if (endDate) {\n        this.scheduler.fire(\"setField\", \"endDate\", formData, endDate);\n      }\n\n      var _this$scheduler$_data = this.scheduler._dataAccessors.expr,\n          startDateExpr = _this$scheduler$_data.startDateExpr,\n          endDateExpr = _this$scheduler$_data.endDateExpr;\n\n      this._appointmentForm.option(\"readOnly\", this._isReadOnly(data));\n\n      _uiScheduler.AppointmentForm.updateFormData(this._appointmentForm, formData, this.scheduler._dataAccessors.expr);\n\n      _uiScheduler.AppointmentForm.setEditorsType(this._appointmentForm, startDateExpr, endDateExpr, allDay);\n    }\n  }, {\n    key: \"_isDeviceMobile\",\n    value: function value() {\n      return \"desktop\" !== _devices.default.current().deviceType;\n    }\n  }, {\n    key: \"_isPopupFullScreenNeeded\",\n    value: function value() {\n      var width = this._tryGetWindowWidth();\n\n      if (width) {\n        return this._isDeviceMobile() ? width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE : width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"_tryGetWindowWidth\",\n    value: function value() {\n      if ((0, _window.hasWindow)()) {\n        var window = (0, _window.getWindow)();\n        return (0, _renderer.default)(window).width();\n      }\n    }\n  }, {\n    key: \"triggerResize\",\n    value: function value() {\n      this._popup && (0, _visibility_change.triggerResizeEvent)(this._popup.$element());\n    }\n  }, {\n    key: \"_getMaxWidth\",\n    value: function value(isRecurrence) {\n      if (this._isDeviceMobile()) {\n        return APPOINTMENT_POPUP_WIDTH_MOBILE;\n      }\n\n      return isRecurrence ? APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE : APPOINTMENT_POPUP_WIDTH;\n    }\n  }, {\n    key: \"changeSize\",\n    value: function value(isRecurrence) {\n      var isFullScreen = this._isPopupFullScreenNeeded();\n\n      this._popup.option({\n        maxWidth: isFullScreen ? \"100%\" : this._getMaxWidth(isRecurrence),\n        fullScreen: isFullScreen\n      });\n    }\n  }, {\n    key: \"updatePopupFullScreenMode\",\n    value: function value() {\n      if (!this._appointmentForm) {\n        return;\n      }\n\n      var isRecurrence = _uiScheduler.AppointmentForm.getRecurrenceRule(this._appointmentForm.option(\"formData\"), this.scheduler._dataAccessors.expr);\n\n      if (this.isVisible()) {\n        this.changeSize(isRecurrence);\n      }\n    }\n  }, {\n    key: \"_createPopupToolbarItems\",\n    value: function value(isDoneButtonVisible) {\n      var _this3 = this;\n\n      var result = [];\n\n      var isIOs = \"ios\" === _devices.default.current().platform;\n\n      if (isDoneButtonVisible) {\n        result.push({\n          shortcut: \"done\",\n          options: {\n            text: _message.default.format(\"Done\")\n          },\n          location: TOOLBAR_ITEM_AFTER_LOCATION,\n          onClick: function onClick(e) {\n            return _this3._doneButtonClickHandler(e);\n          }\n        });\n      }\n\n      result.push({\n        shortcut: \"cancel\",\n        location: isIOs ? TOOLBAR_ITEM_BEFORE_LOCATION : TOOLBAR_ITEM_AFTER_LOCATION\n      });\n      return result;\n    }\n  }, {\n    key: \"saveChanges\",\n    value: function value(showLoadPanel) {\n      var _this4 = this;\n\n      var deferred = new _deferred.Deferred();\n\n      var validation = this._appointmentForm.validate();\n\n      var state = this.state.appointment;\n      showLoadPanel && this._showLoadPanel();\n      (0, _deferred.when)(validation && validation.complete || validation).done(function (validation) {\n        if (validation && !validation.isValid) {\n          _this4._hideLoadPanel();\n\n          deferred.resolve(false);\n          return;\n        }\n\n        var formData = _this4._appointmentForm.option(\"formData\");\n\n        var adapter = _this4.scheduler.createAppointmentAdapter(formData);\n\n        var appointment = adapter.clone({\n          pathTimeZone: \"fromAppointment\"\n        }).source();\n        var oldData = _this4.scheduler._editAppointmentData;\n        var recData = _this4.scheduler._updatedRecAppointment;\n\n        if (state.isEmptyText && \"\" === adapter.text) {\n          delete appointment.text;\n        }\n\n        if (state.isEmptyDescription && \"\" === adapter.description) {\n          delete appointment.description;\n        }\n\n        if (void 0 === state.data.recurrenceRule && \"\" === adapter.recurrenceRule) {\n          delete appointment.recurrenceRule;\n        }\n\n        if ((0, _type.isDefined)(appointment.repeat)) {\n          delete appointment.repeat;\n        }\n\n        if (oldData && !recData) {\n          _this4.scheduler.updateAppointment(oldData, appointment).done(deferred.resolve);\n        } else {\n          if (recData) {\n            _this4.scheduler.updateAppointment(oldData, recData);\n\n            delete _this4.scheduler._updatedRecAppointment;\n          }\n\n          _this4.scheduler.addAppointment(appointment).done(deferred.resolve);\n        }\n\n        deferred.done(function () {\n          _this4._hideLoadPanel();\n\n          _this4.state.lastEditData = appointment;\n        });\n      });\n      return deferred.promise();\n    }\n  }, {\n    key: \"_doneButtonClickHandler\",\n    value: function value(e) {\n      e.cancel = true;\n      this.saveEditData();\n    }\n  }, {\n    key: \"saveEditData\",\n    value: function value() {\n      var _this5 = this;\n\n      var deferred = new _deferred.Deferred();\n\n      if (this._tryLockSaveChanges()) {\n        (0, _deferred.when)(this.saveChanges(true)).done(function () {\n          if (_this5.state.lastEditData) {\n            var adapter = _this5.scheduler.createAppointmentAdapter(_this5.state.lastEditData);\n\n            var startDate = adapter.startDate,\n                endDate = adapter.endDate,\n                allDay = adapter.allDay;\n            var startTime = startDate.getTime();\n            var endTime = endDate.getTime();\n            var inAllDayRow = allDay || endTime - startTime >= DAY_IN_MS;\n\n            _this5.scheduler._workSpace.updateScrollPosition(startDate, _this5.scheduler._resourcesManager.getResourcesFromItem(_this5.state.lastEditData, true), inAllDayRow);\n\n            _this5.state.lastEditData = null;\n          }\n\n          _this5._unlockSaveChanges();\n\n          deferred.resolve();\n        });\n      }\n\n      return deferred.promise();\n    }\n  }, {\n    key: \"_hideLoadPanel\",\n    value: function value() {\n      (0, _ui.hide)();\n    }\n  }, {\n    key: \"_showLoadPanel\",\n    value: function value() {\n      var $overlayContent = this._popup.overlayContent();\n\n      (0, _ui.show)({\n        container: $overlayContent,\n        position: {\n          of: $overlayContent\n        }\n      });\n    }\n  }, {\n    key: \"_tryLockSaveChanges\",\n    value: function value() {\n      if (false === this.state.saveChangesLocker) {\n        this.state.saveChangesLocker = true;\n        return true;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"_unlockSaveChanges\",\n    value: function value() {\n      this.state.saveChangesLocker = false;\n    }\n  }]);\n\n  return AppointmentPopup;\n}();\n\nexports.default = AppointmentPopup;\nmodule.exports = exports.default;","map":{"version":3,"sources":["E:/newfrontend/webfe/node_modules/devextreme/ui/scheduler/appointmentPopup.js"],"names":["exports","default","_devices","_interopRequireDefault","require","_renderer","_date","_deferred","_extend","_iterator","_type","_window","_visibility_change","_message","_popup","_uiScheduler","_ui","obj","__esModule","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","toMs","dateToMilliseconds","WIDGET_CLASS","APPOINTMENT_POPUP_CLASS","concat","APPOINTMENT_POPUP_WIDTH","APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE","APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH","APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE","APPOINTMENT_POPUP_WIDTH_MOBILE","TOOLBAR_ITEM_AFTER_LOCATION","TOOLBAR_ITEM_BEFORE_LOCATION","DAY_IN_MS","AppointmentPopup","scheduler","_appointmentForm","state","lastEditData","saveChangesLocker","appointment","data","isEmptyText","isEmptyDescription","value","arguments","isDoneButtonVisible","isEmptyObject","startDate","option","endDate","Date","getTime","fire","popupConfig","_createPopupConfig","_createPopup","_createPopupToolbarItems","show","hide","_$popup","$element","remove","options","popupElement","addClass","appendTo","_createComponent","_this","height","maxHeight","showCloseButton","showTitle","onHiding","focus","contentTemplate","_createPopupContent","onShowing","e","_onShowing","defaultOptionsRules","device","current","android","_this2","_updateForm","arg","form","popup","appointmentData","cancel","_actions","onAppointmentFormOpening","_processActionResult","canceled","updatePopupFullScreenMode","formElement","_createForm","rawAppointment","_createAppointmentAdapter","result","extend","repeat","recurrenceRule","each","_resourcesManager","getResourcesFromItem","name","element","expr","_dataAccessors","resources","allowTimeZoneEditing","_getAllowTimeZoneEditing","formData","_createAppointmentFormData","readOnly","_isReadOnly","AppointmentForm","prepareAppointmentFormEditors","triggerResize","bind","changeSize","concatResources","getEditors","create","adapter","createAppointmentAdapter","disabled","_editAppointmentData","_editing","allowUpdating","allDay","calculateStartDate","calculateEndDate","text","description","source","_this$scheduler$_data","startDateExpr","endDateExpr","updateFormData","setEditorsType","deviceType","width","_tryGetWindowWidth","_isDeviceMobile","hasWindow","window","getWindow","triggerResizeEvent","isRecurrence","isFullScreen","_isPopupFullScreenNeeded","maxWidth","_getMaxWidth","fullScreen","getRecurrenceRule","isVisible","_this3","isIOs","platform","push","shortcut","format","location","onClick","_doneButtonClickHandler","showLoadPanel","_this4","deferred","Deferred","validation","validate","_showLoadPanel","when","complete","done","isValid","_hideLoadPanel","resolve","clone","pathTimeZone","oldData","recData","_updatedRecAppointment","isDefined","updateAppointment","addAppointment","promise","saveEditData","_this5","_tryLockSaveChanges","saveChanges","startTime","endTime","inAllDayRow","_workSpace","updateScrollPosition","_unlockSaveChanges","$overlayContent","overlayContent","container","position","of","module"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAA,OAAO,CAACC,OAAR,GAAkB,KAAK,CAAvB;;AACA,IAAIC,QAAQ,GAAGC,sBAAsB,CAACC,OAAO,CAAC,oBAAD,CAAR,CAArC;;AACA,IAAIC,SAAS,GAAGF,sBAAsB,CAACC,OAAO,CAAC,qBAAD,CAAR,CAAtC;;AACA,IAAIE,KAAK,GAAGH,sBAAsB,CAACC,OAAO,CAAC,uBAAD,CAAR,CAAlC;;AACA,IAAIG,SAAS,GAAGH,OAAO,CAAC,2BAAD,CAAvB;;AACA,IAAII,OAAO,GAAGJ,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAIK,SAAS,GAAGL,OAAO,CAAC,2BAAD,CAAvB;;AACA,IAAIM,KAAK,GAAGN,OAAO,CAAC,uBAAD,CAAnB;;AACA,IAAIO,OAAO,GAAGP,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAIQ,kBAAkB,GAAGR,OAAO,CAAC,gCAAD,CAAhC;;AACA,IAAIS,QAAQ,GAAGV,sBAAsB,CAACC,OAAO,CAAC,4BAAD,CAAR,CAArC;;AACA,IAAIU,MAAM,GAAGX,sBAAsB,CAACC,OAAO,CAAC,UAAD,CAAR,CAAnC;;AACA,IAAIW,YAAY,GAAGX,OAAO,CAAC,iCAAD,CAA1B;;AACA,IAAIY,GAAG,GAAGZ,OAAO,CAAC,cAAD,CAAjB;;AAEA,SAASD,sBAAT,CAAgCc,GAAhC,EAAqC;AACjC,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AAED,SAASE,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;AAC5C,MAAI,EAAED,QAAQ,YAAYC,WAAtB,CAAJ,EAAwC;AACpC,UAAM,IAAIC,SAAJ,CAAc,mCAAd,CAAN;AACH;AACJ;;AAED,SAASC,iBAAT,CAA2BC,MAA3B,EAAmCC,KAAnC,EAA0C;AACtC,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAACE,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnC,QAAIE,UAAU,GAAGH,KAAK,CAACC,CAAD,CAAtB;AACAE,IAAAA,UAAU,CAACC,UAAX,GAAwBD,UAAU,CAACC,UAAX,IAAyB,KAAjD;AACAD,IAAAA,UAAU,CAACE,YAAX,GAA0B,IAA1B;;AACA,QAAI,WAAWF,UAAf,EAA2B;AACvBA,MAAAA,UAAU,CAACG,QAAX,GAAsB,IAAtB;AACH;;AACDC,IAAAA,MAAM,CAACC,cAAP,CAAsBT,MAAtB,EAA8BI,UAAU,CAACM,GAAzC,EAA8CN,UAA9C;AACH;AACJ;;AAED,SAASO,YAAT,CAAsBd,WAAtB,EAAmCe,UAAnC,EAA+CC,WAA/C,EAA4D;AACxD,MAAID,UAAJ,EAAgB;AACZb,IAAAA,iBAAiB,CAACF,WAAW,CAACiB,SAAb,EAAwBF,UAAxB,CAAjB;AACH;;AACD,MAAIC,WAAJ,EAAiB;AACbd,IAAAA,iBAAiB,CAACF,WAAD,EAAcgB,WAAd,CAAjB;AACH;;AACD,SAAOhB,WAAP;AACH;;AACD,IAAIkB,IAAI,GAAGjC,KAAK,CAACL,OAAN,CAAcuC,kBAAzB;AACA,IAAIC,YAAY,GAAG,cAAnB;AACA,IAAIC,uBAAuB,GAAG,GAAGC,MAAH,CAAUF,YAAV,EAAwB,oBAAxB,CAA9B;AACA,IAAIG,uBAAuB,GAAG,GAA9B;AACA,IAAIC,uCAAuC,GAAG,GAA9C;AACA,IAAIC,yCAAyC,GAAG,GAAhD;AACA,IAAIC,gDAAgD,GAAG,GAAvD;AACA,IAAIC,8BAA8B,GAAG,GAArC;AACA,IAAIC,2BAA2B,GAAG,OAAlC;AACA,IAAIC,4BAA4B,GAAG,QAAnC;AACA,IAAIC,SAAS,GAAGZ,IAAI,CAAC,KAAD,CAApB;;AACA,IAAIa,gBAAgB,GAAG,YAAW;AAC9B,WAASA,gBAAT,CAA0BC,SAA1B,EAAqC;AACjClC,IAAAA,eAAe,CAAC,IAAD,EAAOiC,gBAAP,CAAf;;AACA,SAAKC,SAAL,GAAiBA,SAAjB;AACA,SAAKvC,MAAL,GAAc,IAAd;AACA,SAAKwC,gBAAL,GAAwB,IAAxB;AACA,SAAKC,KAAL,GAAa;AACTC,MAAAA,YAAY,EAAE,IADL;AAETC,MAAAA,iBAAiB,EAAE,KAFV;AAGTC,MAAAA,WAAW,EAAE;AACTC,QAAAA,IAAI,EAAE,IADG;AAETC,QAAAA,WAAW,EAAE,KAFJ;AAGTC,QAAAA,kBAAkB,EAAE;AAHX;AAHJ,KAAb;AASH;;AACD1B,EAAAA,YAAY,CAACiB,gBAAD,EAAmB,CAAC;AAC5BlB,IAAAA,GAAG,EAAE,MADuB;AAE5B4B,IAAAA,KAAK,EAAE,iBAAW;AACd,UAAIH,IAAI,GAAGI,SAAS,CAACpC,MAAV,GAAmB,CAAnB,IAAwB,KAAK,CAAL,KAAWoC,SAAS,CAAC,CAAD,CAA5C,GAAkDA,SAAS,CAAC,CAAD,CAA3D,GAAiE,EAA5E;AACA,UAAIC,mBAAmB,GAAGD,SAAS,CAACpC,MAAV,GAAmB,CAAnB,GAAuBoC,SAAS,CAAC,CAAD,CAAhC,GAAsC,KAAK,CAArE;;AACA,UAAI,CAAC,GAAGrD,KAAK,CAACuD,aAAV,EAAyBN,IAAzB,CAAJ,EAAoC;AAChC,YAAIO,SAAS,GAAG,KAAKb,SAAL,CAAec,MAAf,CAAsB,aAAtB,CAAhB;AACA,YAAIC,OAAO,GAAG,IAAIC,IAAJ,CAASH,SAAS,CAACI,OAAV,KAAsB,KAAKjB,SAAL,CAAec,MAAf,CAAsB,cAAtB,IAAwC5B,IAAI,CAAC,QAAD,CAA3E,CAAd;AACA,aAAKc,SAAL,CAAekB,IAAf,CAAoB,UAApB,EAAgC,WAAhC,EAA6CZ,IAA7C,EAAmDO,SAAnD;AACA,aAAKb,SAAL,CAAekB,IAAf,CAAoB,UAApB,EAAgC,SAAhC,EAA2CZ,IAA3C,EAAiDS,OAAjD;AACH;;AACD,WAAKb,KAAL,CAAWG,WAAX,CAAuBC,IAAvB,GAA8BA,IAA9B;;AACA,UAAI,CAAC,KAAK7C,MAAV,EAAkB;AACd,YAAI0D,WAAW,GAAG,KAAKC,kBAAL,EAAlB;;AACA,aAAK3D,MAAL,GAAc,KAAK4D,YAAL,CAAkBF,WAAlB,CAAd;AACH;;AACD,WAAK1D,MAAL,CAAYqD,MAAZ,CAAmB,cAAnB,EAAmC,KAAKQ,wBAAL,CAA8BX,mBAA9B,CAAnC;;AACA,WAAKlD,MAAL,CAAY8D,IAAZ;AACH;AAlB2B,GAAD,EAmB5B;AACC1C,IAAAA,GAAG,EAAE,MADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,WAAKhD,MAAL,CAAY+D,IAAZ;AACH;AAJF,GAnB4B,EAwB5B;AACC3C,IAAAA,GAAG,EAAE,WADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,aAAO,KAAKhD,MAAL,GAAc,KAAKA,MAAL,CAAYqD,MAAZ,CAAmB,SAAnB,CAAd,GAA8C,KAArD;AACH;AAJF,GAxB4B,EA6B5B;AACCjC,IAAAA,GAAG,EAAE,SADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,UAAI,KAAKgB,OAAT,EAAkB;AACd,aAAKhE,MAAL,CAAYiE,QAAZ,GAAuBC,MAAvB;;AACA,aAAKF,OAAL,GAAe,IAAf;AACH;AACJ;AAPF,GA7B4B,EAqC5B;AACC5C,IAAAA,GAAG,EAAE,cADN;AAEC4B,IAAAA,KAAK,EAAE,eAASmB,OAAT,EAAkB;AACrB,UAAIC,YAAY,GAAG,CAAC,GAAG7E,SAAS,CAACJ,OAAd,EAAuB,OAAvB,EAAgCkF,QAAhC,CAAyCzC,uBAAzC,EAAkE0C,QAAlE,CAA2E,KAAK/B,SAAL,CAAe0B,QAAf,EAA3E,CAAnB;AACA,aAAO,KAAK1B,SAAL,CAAegC,gBAAf,CAAgCH,YAAhC,EAA8CpE,MAAM,CAACb,OAArD,EAA8DgF,OAA9D,CAAP;AACH;AALF,GArC4B,EA2C5B;AACC/C,IAAAA,GAAG,EAAE,oBADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,UAAIwB,KAAK,GAAG,IAAZ;;AACA,aAAO;AACHC,QAAAA,MAAM,EAAE,MADL;AAEHC,QAAAA,SAAS,EAAE,MAFR;AAGHC,QAAAA,eAAe,EAAE,KAHd;AAIHC,QAAAA,SAAS,EAAE,KAJR;AAKHC,QAAAA,QAAQ,EAAE,oBAAW;AACjBL,UAAAA,KAAK,CAACjC,SAAN,CAAgBuC,KAAhB;AACH,SAPE;AAQHC,QAAAA,eAAe,EAAE,2BAAW;AACxB,iBAAOP,KAAK,CAACQ,mBAAN,EAAP;AACH,SAVE;AAWHC,QAAAA,SAAS,EAAE,mBAASC,CAAT,EAAY;AACnB,iBAAOV,KAAK,CAACW,UAAN,CAAiBD,CAAjB,CAAP;AACH,SAbE;AAcHE,QAAAA,mBAAmB,EAAE,CAAC;AAClBC,UAAAA,MAAM,EAAE,kBAAW;AACf,mBAAOjG,QAAQ,CAACD,OAAT,CAAiBmG,OAAjB,GAA2BC,OAAlC;AACH,WAHiB;AAIlBpB,UAAAA,OAAO,EAAE;AACLS,YAAAA,SAAS,EAAE;AADN;AAJS,SAAD;AAdlB,OAAP;AAuBH;AA3BF,GA3C4B,EAuE5B;AACCxD,IAAAA,GAAG,EAAE,YADN;AAEC4B,IAAAA,KAAK,EAAE,eAASkC,CAAT,EAAY;AACf,UAAIM,MAAM,GAAG,IAAb;;AACA,WAAKC,WAAL;;AACA,UAAIC,GAAG,GAAG;AACNC,QAAAA,IAAI,EAAE,KAAKnD,gBADL;AAENoD,QAAAA,KAAK,EAAE,KAAK5F,MAFN;AAGN6F,QAAAA,eAAe,EAAE,KAAKpD,KAAL,CAAWG,WAAX,CAAuBC,IAHlC;AAINiD,QAAAA,MAAM,EAAE;AAJF,OAAV;;AAMA,WAAKvD,SAAL,CAAewD,QAAf,CAAwBC,wBAAxB,CAAiDN,GAAjD;;AACA,WAAKnD,SAAL,CAAe0D,oBAAf,CAAoCP,GAApC,EAAyC,UAASQ,QAAT,EAAmB;AACxD,YAAIA,QAAJ,EAAc;AACVhB,UAAAA,CAAC,CAACY,MAAF,GAAW,IAAX;AACH,SAFD,MAEO;AACHN,UAAAA,MAAM,CAACW,yBAAP;AACH;AACJ,OAND;AAOH;AAnBF,GAvE4B,EA2F5B;AACC/E,IAAAA,GAAG,EAAE,qBADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,UAAIoD,WAAW,GAAG,CAAC,GAAG7G,SAAS,CAACJ,OAAd,EAAuB,OAAvB,CAAlB;AACA,WAAKqD,gBAAL,GAAwB,KAAK6D,WAAL,CAAiBD,WAAjB,CAAxB;AACA,aAAOA,WAAP;AACH;AANF,GA3F4B,EAkG5B;AACChF,IAAAA,GAAG,EAAE,4BADN;AAEC4B,IAAAA,KAAK,EAAE,eAASsD,cAAT,EAAyB;AAC5B,UAAI1D,WAAW,GAAG,KAAK2D,yBAAL,CAA+BD,cAA/B,CAAlB;;AACA,UAAIE,MAAM,GAAG,CAAC,GAAG9G,OAAO,CAAC+G,MAAZ,EAAoB,IAApB,EAA0B;AACnCC,QAAAA,MAAM,EAAE,CAAC,CAAC9D,WAAW,CAAC+D;AADa,OAA1B,EAEVL,cAFU,CAAb;AAGA,OAAC,GAAG3G,SAAS,CAACiH,IAAd,EAAoB,KAAKrE,SAAL,CAAesE,iBAAf,CAAiCC,oBAAjC,CAAsDN,MAAtD,EAA8D,IAA9D,KAAuE,EAA3F,EAA+F,UAASO,IAAT,EAAe/D,KAAf,EAAsB;AACjH,eAAOwD,MAAM,CAACO,IAAD,CAAN,GAAe/D,KAAtB;AACH,OAFD;AAGA,aAAOwD,MAAP;AACH;AAXF,GAlG4B,EA8G5B;AACCpF,IAAAA,GAAG,EAAE,aADN;AAEC4B,IAAAA,KAAK,EAAE,eAASgE,OAAT,EAAkB;AACrB,UAAIC,IAAI,GAAG,KAAK1E,SAAL,CAAe2E,cAAf,CAA8BD,IAAzC;AACA,UAAIE,SAAS,GAAG,KAAK5E,SAAL,CAAec,MAAf,CAAsB,WAAtB,CAAhB;;AACA,UAAI+D,oBAAoB,GAAG,KAAKC,wBAAL,EAA3B;;AACA,UAAIf,cAAc,GAAG,KAAK7D,KAAL,CAAWG,WAAX,CAAuBC,IAA5C;;AACA,UAAIyE,QAAQ,GAAG,KAAKC,0BAAL,CAAgCjB,cAAhC,CAAf;;AACA,UAAIkB,QAAQ,GAAG,KAAKC,WAAL,CAAiBnB,cAAjB,CAAf;;AACArG,MAAAA,YAAY,CAACyH,eAAb,CAA6BC,6BAA7B,CAA2DV,IAA3D,EAAiE,KAAK1E,SAAtE,EAAiF,KAAKqF,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAAjF,EAAgH,KAAKC,UAAL,CAAgBD,IAAhB,CAAqB,IAArB,CAAhH,EAA4IP,QAA5I,EAAsJF,oBAAtJ,EAA4KI,QAA5K;;AACA,UAAIL,SAAS,IAAIA,SAAS,CAACtG,MAA3B,EAAmC;AAC/BZ,QAAAA,YAAY,CAACyH,eAAb,CAA6BK,eAA7B,CAA6C,KAAKxF,SAAL,CAAesE,iBAAf,CAAiCmB,UAAjC,EAA7C;AACH;;AACD,aAAO/H,YAAY,CAACyH,eAAb,CAA6BO,MAA7B,CAAoC,KAAK1F,SAAL,CAAegC,gBAAf,CAAgCsD,IAAhC,CAAqC,KAAKtF,SAA1C,CAApC,EAA0FyE,OAA1F,EAAmGQ,QAAnG,EAA6GF,QAA7G,CAAP;AACH;AAdF,GA9G4B,EA6H5B;AACClG,IAAAA,GAAG,EAAE,0BADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,UAAIT,SAAS,GAAG,KAAKA,SAArB;AACA,aAAOA,SAAS,CAACc,MAAV,CAAiB,8BAAjB,KAAoDd,SAAS,CAACc,MAAV,CAAiB,+BAAjB,CAA3D;AACH;AALF,GA7H4B,EAmI5B;AACCjC,IAAAA,GAAG,EAAE,aADN;AAEC4B,IAAAA,KAAK,EAAE,eAASsD,cAAT,EAAyB;AAC5B,UAAI4B,OAAO,GAAG,KAAK3F,SAAL,CAAe4F,wBAAf,CAAwC7B,cAAxC,CAAd;;AACA,UAAIA,cAAc,IAAI4B,OAAO,CAACE,QAA9B,EAAwC;AACpC,eAAO,IAAP;AACH;;AACD,aAAO,KAAK7F,SAAL,CAAe8F,oBAAf,GAAsC,CAAC,KAAK9F,SAAL,CAAe+F,QAAf,CAAwBC,aAA/D,GAA+E,KAAtF;AACH;AARF,GAnI4B,EA4I5B;AACCnH,IAAAA,GAAG,EAAE,2BADN;AAEC4B,IAAAA,KAAK,EAAE,eAASsD,cAAT,EAAyB;AAC5B,aAAO,KAAK/D,SAAL,CAAe4F,wBAAf,CAAwC7B,cAAxC,CAAP;AACH;AAJF,GA5I4B,EAiJ5B;AACClF,IAAAA,GAAG,EAAE,aADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,UAAIH,IAAI,GAAG,KAAKJ,KAAL,CAAWG,WAAX,CAAuBC,IAAlC;;AACA,UAAIqF,OAAO,GAAG,KAAK3B,yBAAL,CAA+B1D,IAA/B,CAAd;;AACA,UAAI2F,MAAM,GAAGN,OAAO,CAACM,MAArB;AACA,UAAIpF,SAAS,GAAG8E,OAAO,CAAC9E,SAAR,IAAqB8E,OAAO,CAACO,kBAAR,CAA2B,eAA3B,CAArC;AACA,UAAInF,OAAO,GAAG4E,OAAO,CAAC5E,OAAR,IAAmB4E,OAAO,CAACQ,gBAAR,CAAyB,eAAzB,CAAjC;AACA,WAAKjG,KAAL,CAAWG,WAAX,CAAuBE,WAAvB,GAAqC,KAAK,CAAL,KAAWD,IAAX,IAAmB,KAAK,CAAL,KAAWqF,OAAO,CAACS,IAA3E;AACA,WAAKlG,KAAL,CAAWG,WAAX,CAAuBG,kBAAvB,GAA4C,KAAK,CAAL,KAAWF,IAAX,IAAmB,KAAK,CAAL,KAAWqF,OAAO,CAACU,WAAlF;;AACA,UAAIhG,WAAW,GAAG,KAAK2D,yBAAL,CAA+B,KAAKgB,0BAAL,CAAgC1E,IAAhC,CAA/B,CAAlB;;AACA,UAAI,KAAK,CAAL,KAAWD,WAAW,CAAC+F,IAA3B,EAAiC;AAC7B/F,QAAAA,WAAW,CAAC+F,IAAZ,GAAmB,EAAnB;AACH;;AACD,UAAI,KAAK,CAAL,KAAW/F,WAAW,CAACgG,WAA3B,EAAwC;AACpChG,QAAAA,WAAW,CAACgG,WAAZ,GAA0B,EAA1B;AACH;;AACD,UAAI,KAAK,CAAL,KAAWhG,WAAW,CAAC+D,cAA3B,EAA2C;AACvC/D,QAAAA,WAAW,CAAC+D,cAAZ,GAA6B,EAA7B;AACH;;AACD,UAAIW,QAAQ,GAAG1E,WAAW,CAACiG,MAAZ,EAAf;;AACA,UAAIzF,SAAJ,EAAe;AACX,aAAKb,SAAL,CAAekB,IAAf,CAAoB,UAApB,EAAgC,WAAhC,EAA6C6D,QAA7C,EAAuDlE,SAAvD;AACH;;AACD,UAAIE,OAAJ,EAAa;AACT,aAAKf,SAAL,CAAekB,IAAf,CAAoB,UAApB,EAAgC,SAAhC,EAA2C6D,QAA3C,EAAqDhE,OAArD;AACH;;AACD,UAAIwF,qBAAqB,GAAG,KAAKvG,SAAL,CAAe2E,cAAf,CAA8BD,IAA1D;AAAA,UACI8B,aAAa,GAAGD,qBAAqB,CAACC,aAD1C;AAAA,UAEIC,WAAW,GAAGF,qBAAqB,CAACE,WAFxC;;AAGA,WAAKxG,gBAAL,CAAsBa,MAAtB,CAA6B,UAA7B,EAAyC,KAAKoE,WAAL,CAAiB5E,IAAjB,CAAzC;;AACA5C,MAAAA,YAAY,CAACyH,eAAb,CAA6BuB,cAA7B,CAA4C,KAAKzG,gBAAjD,EAAmE8E,QAAnE,EAA6E,KAAK/E,SAAL,CAAe2E,cAAf,CAA8BD,IAA3G;;AACAhH,MAAAA,YAAY,CAACyH,eAAb,CAA6BwB,cAA7B,CAA4C,KAAK1G,gBAAjD,EAAmEuG,aAAnE,EAAkFC,WAAlF,EAA+FR,MAA/F;AACH;AAjCF,GAjJ4B,EAmL5B;AACCpH,IAAAA,GAAG,EAAE,iBADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,aAAO,cAAc5D,QAAQ,CAACD,OAAT,CAAiBmG,OAAjB,GAA2B6D,UAAhD;AACH;AAJF,GAnL4B,EAwL5B;AACC/H,IAAAA,GAAG,EAAE,0BADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,UAAIoG,KAAK,GAAG,KAAKC,kBAAL,EAAZ;;AACA,UAAID,KAAJ,EAAW;AACP,eAAO,KAAKE,eAAL,KAAyBF,KAAK,GAAGnH,gDAAjC,GAAoFmH,KAAK,GAAGpH,yCAAnG;AACH;;AACD,aAAO,KAAP;AACH;AARF,GAxL4B,EAiM5B;AACCZ,IAAAA,GAAG,EAAE,oBADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,UAAI,CAAC,GAAGnD,OAAO,CAAC0J,SAAZ,GAAJ,EAA8B;AAC1B,YAAIC,MAAM,GAAG,CAAC,GAAG3J,OAAO,CAAC4J,SAAZ,GAAb;AACA,eAAO,CAAC,GAAGlK,SAAS,CAACJ,OAAd,EAAuBqK,MAAvB,EAA+BJ,KAA/B,EAAP;AACH;AACJ;AAPF,GAjM4B,EAyM5B;AACChI,IAAAA,GAAG,EAAE,eADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,WAAKhD,MAAL,IAAe,CAAC,GAAGF,kBAAkB,CAAC4J,kBAAvB,EAA2C,KAAK1J,MAAL,CAAYiE,QAAZ,EAA3C,CAAf;AACH;AAJF,GAzM4B,EA8M5B;AACC7C,IAAAA,GAAG,EAAE,cADN;AAEC4B,IAAAA,KAAK,EAAE,eAAS2G,YAAT,EAAuB;AAC1B,UAAI,KAAKL,eAAL,EAAJ,EAA4B;AACxB,eAAOpH,8BAAP;AACH;;AACD,aAAOyH,YAAY,GAAG5H,uCAAH,GAA6CD,uBAAhE;AACH;AAPF,GA9M4B,EAsN5B;AACCV,IAAAA,GAAG,EAAE,YADN;AAEC4B,IAAAA,KAAK,EAAE,eAAS2G,YAAT,EAAuB;AAC1B,UAAIC,YAAY,GAAG,KAAKC,wBAAL,EAAnB;;AACA,WAAK7J,MAAL,CAAYqD,MAAZ,CAAmB;AACfyG,QAAAA,QAAQ,EAAEF,YAAY,GAAG,MAAH,GAAY,KAAKG,YAAL,CAAkBJ,YAAlB,CADnB;AAEfK,QAAAA,UAAU,EAAEJ;AAFG,OAAnB;AAIH;AARF,GAtN4B,EA+N5B;AACCxI,IAAAA,GAAG,EAAE,2BADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,UAAI,CAAC,KAAKR,gBAAV,EAA4B;AACxB;AACH;;AACD,UAAImH,YAAY,GAAG1J,YAAY,CAACyH,eAAb,CAA6BuC,iBAA7B,CAA+C,KAAKzH,gBAAL,CAAsBa,MAAtB,CAA6B,UAA7B,CAA/C,EAAyF,KAAKd,SAAL,CAAe2E,cAAf,CAA8BD,IAAvH,CAAnB;;AACA,UAAI,KAAKiD,SAAL,EAAJ,EAAsB;AAClB,aAAKpC,UAAL,CAAgB6B,YAAhB;AACH;AACJ;AAVF,GA/N4B,EA0O5B;AACCvI,IAAAA,GAAG,EAAE,0BADN;AAEC4B,IAAAA,KAAK,EAAE,eAASE,mBAAT,EAA8B;AACjC,UAAIiH,MAAM,GAAG,IAAb;;AACA,UAAI3D,MAAM,GAAG,EAAb;;AACA,UAAI4D,KAAK,GAAG,UAAUhL,QAAQ,CAACD,OAAT,CAAiBmG,OAAjB,GAA2B+E,QAAjD;;AACA,UAAInH,mBAAJ,EAAyB;AACrBsD,QAAAA,MAAM,CAAC8D,IAAP,CAAY;AACRC,UAAAA,QAAQ,EAAE,MADF;AAERpG,UAAAA,OAAO,EAAE;AACLwE,YAAAA,IAAI,EAAE5I,QAAQ,CAACZ,OAAT,CAAiBqL,MAAjB,CAAwB,MAAxB;AADD,WAFD;AAKRC,UAAAA,QAAQ,EAAEtI,2BALF;AAMRuI,UAAAA,OAAO,EAAE,iBAASxF,CAAT,EAAY;AACjB,mBAAOiF,MAAM,CAACQ,uBAAP,CAA+BzF,CAA/B,CAAP;AACH;AARO,SAAZ;AAUH;;AACDsB,MAAAA,MAAM,CAAC8D,IAAP,CAAY;AACRC,QAAAA,QAAQ,EAAE,QADF;AAERE,QAAAA,QAAQ,EAAEL,KAAK,GAAGhI,4BAAH,GAAkCD;AAFzC,OAAZ;AAIA,aAAOqE,MAAP;AACH;AAvBF,GA1O4B,EAkQ5B;AACCpF,IAAAA,GAAG,EAAE,aADN;AAEC4B,IAAAA,KAAK,EAAE,eAAS4H,aAAT,EAAwB;AAC3B,UAAIC,MAAM,GAAG,IAAb;;AACA,UAAIC,QAAQ,GAAG,IAAIrL,SAAS,CAACsL,QAAd,EAAf;;AACA,UAAIC,UAAU,GAAG,KAAKxI,gBAAL,CAAsByI,QAAtB,EAAjB;;AACA,UAAIxI,KAAK,GAAG,KAAKA,KAAL,CAAWG,WAAvB;AACAgI,MAAAA,aAAa,IAAI,KAAKM,cAAL,EAAjB;AACA,OAAC,GAAGzL,SAAS,CAAC0L,IAAd,EAAoBH,UAAU,IAAIA,UAAU,CAACI,QAAzB,IAAqCJ,UAAzD,EAAqEK,IAArE,CAA0E,UAASL,UAAT,EAAqB;AAC3F,YAAIA,UAAU,IAAI,CAACA,UAAU,CAACM,OAA9B,EAAuC;AACnCT,UAAAA,MAAM,CAACU,cAAP;;AACAT,UAAAA,QAAQ,CAACU,OAAT,CAAiB,KAAjB;AACA;AACH;;AACD,YAAIlE,QAAQ,GAAGuD,MAAM,CAACrI,gBAAP,CAAwBa,MAAxB,CAA+B,UAA/B,CAAf;;AACA,YAAI6E,OAAO,GAAG2C,MAAM,CAACtI,SAAP,CAAiB4F,wBAAjB,CAA0Cb,QAA1C,CAAd;;AACA,YAAI1E,WAAW,GAAGsF,OAAO,CAACuD,KAAR,CAAc;AAC5BC,UAAAA,YAAY,EAAE;AADc,SAAd,EAEf7C,MAFe,EAAlB;AAGA,YAAI8C,OAAO,GAAGd,MAAM,CAACtI,SAAP,CAAiB8F,oBAA/B;AACA,YAAIuD,OAAO,GAAGf,MAAM,CAACtI,SAAP,CAAiBsJ,sBAA/B;;AACA,YAAIpJ,KAAK,CAACK,WAAN,IAAqB,OAAOoF,OAAO,CAACS,IAAxC,EAA8C;AAC1C,iBAAO/F,WAAW,CAAC+F,IAAnB;AACH;;AACD,YAAIlG,KAAK,CAACM,kBAAN,IAA4B,OAAOmF,OAAO,CAACU,WAA/C,EAA4D;AACxD,iBAAOhG,WAAW,CAACgG,WAAnB;AACH;;AACD,YAAI,KAAK,CAAL,KAAWnG,KAAK,CAACI,IAAN,CAAW8D,cAAtB,IAAwC,OAAOuB,OAAO,CAACvB,cAA3D,EAA2E;AACvE,iBAAO/D,WAAW,CAAC+D,cAAnB;AACH;;AACD,YAAI,CAAC,GAAG/G,KAAK,CAACkM,SAAV,EAAqBlJ,WAAW,CAAC8D,MAAjC,CAAJ,EAA8C;AAC1C,iBAAO9D,WAAW,CAAC8D,MAAnB;AACH;;AACD,YAAIiF,OAAO,IAAI,CAACC,OAAhB,EAAyB;AACrBf,UAAAA,MAAM,CAACtI,SAAP,CAAiBwJ,iBAAjB,CAAmCJ,OAAnC,EAA4C/I,WAA5C,EAAyDyI,IAAzD,CAA8DP,QAAQ,CAACU,OAAvE;AACH,SAFD,MAEO;AACH,cAAII,OAAJ,EAAa;AACTf,YAAAA,MAAM,CAACtI,SAAP,CAAiBwJ,iBAAjB,CAAmCJ,OAAnC,EAA4CC,OAA5C;;AACA,mBAAOf,MAAM,CAACtI,SAAP,CAAiBsJ,sBAAxB;AACH;;AACDhB,UAAAA,MAAM,CAACtI,SAAP,CAAiByJ,cAAjB,CAAgCpJ,WAAhC,EAA6CyI,IAA7C,CAAkDP,QAAQ,CAACU,OAA3D;AACH;;AACDV,QAAAA,QAAQ,CAACO,IAAT,CAAc,YAAW;AACrBR,UAAAA,MAAM,CAACU,cAAP;;AACAV,UAAAA,MAAM,CAACpI,KAAP,CAAaC,YAAb,GAA4BE,WAA5B;AACH,SAHD;AAIH,OAtCD;AAuCA,aAAOkI,QAAQ,CAACmB,OAAT,EAAP;AACH;AAhDF,GAlQ4B,EAmT5B;AACC7K,IAAAA,GAAG,EAAE,yBADN;AAEC4B,IAAAA,KAAK,EAAE,eAASkC,CAAT,EAAY;AACfA,MAAAA,CAAC,CAACY,MAAF,GAAW,IAAX;AACA,WAAKoG,YAAL;AACH;AALF,GAnT4B,EAyT5B;AACC9K,IAAAA,GAAG,EAAE,cADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,UAAImJ,MAAM,GAAG,IAAb;;AACA,UAAIrB,QAAQ,GAAG,IAAIrL,SAAS,CAACsL,QAAd,EAAf;;AACA,UAAI,KAAKqB,mBAAL,EAAJ,EAAgC;AAC5B,SAAC,GAAG3M,SAAS,CAAC0L,IAAd,EAAoB,KAAKkB,WAAL,CAAiB,IAAjB,CAApB,EAA4ChB,IAA5C,CAAiD,YAAW;AACxD,cAAIc,MAAM,CAAC1J,KAAP,CAAaC,YAAjB,EAA+B;AAC3B,gBAAIwF,OAAO,GAAGiE,MAAM,CAAC5J,SAAP,CAAiB4F,wBAAjB,CAA0CgE,MAAM,CAAC1J,KAAP,CAAaC,YAAvD,CAAd;;AACA,gBAAIU,SAAS,GAAG8E,OAAO,CAAC9E,SAAxB;AAAA,gBACIE,OAAO,GAAG4E,OAAO,CAAC5E,OADtB;AAAA,gBAEIkF,MAAM,GAAGN,OAAO,CAACM,MAFrB;AAGA,gBAAI8D,SAAS,GAAGlJ,SAAS,CAACI,OAAV,EAAhB;AACA,gBAAI+I,OAAO,GAAGjJ,OAAO,CAACE,OAAR,EAAd;AACA,gBAAIgJ,WAAW,GAAGhE,MAAM,IAAI+D,OAAO,GAAGD,SAAV,IAAuBjK,SAAnD;;AACA8J,YAAAA,MAAM,CAAC5J,SAAP,CAAiBkK,UAAjB,CAA4BC,oBAA5B,CAAiDtJ,SAAjD,EAA4D+I,MAAM,CAAC5J,SAAP,CAAiBsE,iBAAjB,CAAmCC,oBAAnC,CAAwDqF,MAAM,CAAC1J,KAAP,CAAaC,YAArE,EAAmF,IAAnF,CAA5D,EAAsJ8J,WAAtJ;;AACAL,YAAAA,MAAM,CAAC1J,KAAP,CAAaC,YAAb,GAA4B,IAA5B;AACH;;AACDyJ,UAAAA,MAAM,CAACQ,kBAAP;;AACA7B,UAAAA,QAAQ,CAACU,OAAT;AACH,SAdD;AAeH;;AACD,aAAOV,QAAQ,CAACmB,OAAT,EAAP;AACH;AAvBF,GAzT4B,EAiV5B;AACC7K,IAAAA,GAAG,EAAE,gBADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,OAAC,GAAG9C,GAAG,CAAC6D,IAAR;AACH;AAJF,GAjV4B,EAsV5B;AACC3C,IAAAA,GAAG,EAAE,gBADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,UAAI4J,eAAe,GAAG,KAAK5M,MAAL,CAAY6M,cAAZ,EAAtB;;AACA,OAAC,GAAG3M,GAAG,CAAC4D,IAAR,EAAc;AACVgJ,QAAAA,SAAS,EAAEF,eADD;AAEVG,QAAAA,QAAQ,EAAE;AACNC,UAAAA,EAAE,EAAEJ;AADE;AAFA,OAAd;AAMH;AAVF,GAtV4B,EAiW5B;AACCxL,IAAAA,GAAG,EAAE,qBADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,UAAI,UAAU,KAAKP,KAAL,CAAWE,iBAAzB,EAA4C;AACxC,aAAKF,KAAL,CAAWE,iBAAX,GAA+B,IAA/B;AACA,eAAO,IAAP;AACH;;AACD,aAAO,KAAP;AACH;AARF,GAjW4B,EA0W5B;AACCvB,IAAAA,GAAG,EAAE,oBADN;AAEC4B,IAAAA,KAAK,EAAE,iBAAW;AACd,WAAKP,KAAL,CAAWE,iBAAX,GAA+B,KAA/B;AACH;AAJF,GA1W4B,CAAnB,CAAZ;;AAgXA,SAAOL,gBAAP;AACH,CAjYsB,EAAvB;;AAkYApD,OAAO,CAACC,OAAR,GAAkBmD,gBAAlB;AACA2K,MAAM,CAAC/N,OAAP,GAAiBA,OAAO,CAACC,OAAzB","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/appointmentPopup.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _devices = _interopRequireDefault(require(\"../../core/devices\"));\r\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\r\nvar _date = _interopRequireDefault(require(\"../../core/utils/date\"));\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _window = require(\"../../core/utils/window\");\r\nvar _visibility_change = require(\"../../events/visibility_change\");\r\nvar _message = _interopRequireDefault(require(\"../../localization/message\"));\r\nvar _popup = _interopRequireDefault(require(\"../popup\"));\r\nvar _uiScheduler = require(\"./ui.scheduler.appointment_form\");\r\nvar _ui = require(\"./ui.loading\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n        throw new TypeError(\"Cannot call a class as a function\")\r\n    }\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n    for (var i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if (\"value\" in descriptor) {\r\n            descriptor.writable = true\r\n        }\r\n        Object.defineProperty(target, descriptor.key, descriptor)\r\n    }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n    if (protoProps) {\r\n        _defineProperties(Constructor.prototype, protoProps)\r\n    }\r\n    if (staticProps) {\r\n        _defineProperties(Constructor, staticProps)\r\n    }\r\n    return Constructor\r\n}\r\nvar toMs = _date.default.dateToMilliseconds;\r\nvar WIDGET_CLASS = \"dx-scheduler\";\r\nvar APPOINTMENT_POPUP_CLASS = \"\".concat(WIDGET_CLASS, \"-appointment-popup\");\r\nvar APPOINTMENT_POPUP_WIDTH = 485;\r\nvar APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE = 970;\r\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH = 1e3;\r\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE = 500;\r\nvar APPOINTMENT_POPUP_WIDTH_MOBILE = 350;\r\nvar TOOLBAR_ITEM_AFTER_LOCATION = \"after\";\r\nvar TOOLBAR_ITEM_BEFORE_LOCATION = \"before\";\r\nvar DAY_IN_MS = toMs(\"day\");\r\nvar AppointmentPopup = function() {\r\n    function AppointmentPopup(scheduler) {\r\n        _classCallCheck(this, AppointmentPopup);\r\n        this.scheduler = scheduler;\r\n        this._popup = null;\r\n        this._appointmentForm = null;\r\n        this.state = {\r\n            lastEditData: null,\r\n            saveChangesLocker: false,\r\n            appointment: {\r\n                data: null,\r\n                isEmptyText: false,\r\n                isEmptyDescription: false\r\n            }\r\n        }\r\n    }\r\n    _createClass(AppointmentPopup, [{\r\n        key: \"show\",\r\n        value: function() {\r\n            var data = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};\r\n            var isDoneButtonVisible = arguments.length > 1 ? arguments[1] : void 0;\r\n            if ((0, _type.isEmptyObject)(data)) {\r\n                var startDate = this.scheduler.option(\"currentDate\");\r\n                var endDate = new Date(startDate.getTime() + this.scheduler.option(\"cellDuration\") * toMs(\"minute\"));\r\n                this.scheduler.fire(\"setField\", \"startDate\", data, startDate);\r\n                this.scheduler.fire(\"setField\", \"endDate\", data, endDate)\r\n            }\r\n            this.state.appointment.data = data;\r\n            if (!this._popup) {\r\n                var popupConfig = this._createPopupConfig();\r\n                this._popup = this._createPopup(popupConfig)\r\n            }\r\n            this._popup.option(\"toolbarItems\", this._createPopupToolbarItems(isDoneButtonVisible));\r\n            this._popup.show()\r\n        }\r\n    }, {\r\n        key: \"hide\",\r\n        value: function() {\r\n            this._popup.hide()\r\n        }\r\n    }, {\r\n        key: \"isVisible\",\r\n        value: function() {\r\n            return this._popup ? this._popup.option(\"visible\") : false\r\n        }\r\n    }, {\r\n        key: \"dispose\",\r\n        value: function() {\r\n            if (this._$popup) {\r\n                this._popup.$element().remove();\r\n                this._$popup = null\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_createPopup\",\r\n        value: function(options) {\r\n            var popupElement = (0, _renderer.default)(\"<div>\").addClass(APPOINTMENT_POPUP_CLASS).appendTo(this.scheduler.$element());\r\n            return this.scheduler._createComponent(popupElement, _popup.default, options)\r\n        }\r\n    }, {\r\n        key: \"_createPopupConfig\",\r\n        value: function() {\r\n            var _this = this;\r\n            return {\r\n                height: \"auto\",\r\n                maxHeight: \"100%\",\r\n                showCloseButton: false,\r\n                showTitle: false,\r\n                onHiding: function() {\r\n                    _this.scheduler.focus()\r\n                },\r\n                contentTemplate: function() {\r\n                    return _this._createPopupContent()\r\n                },\r\n                onShowing: function(e) {\r\n                    return _this._onShowing(e)\r\n                },\r\n                defaultOptionsRules: [{\r\n                    device: function() {\r\n                        return _devices.default.current().android\r\n                    },\r\n                    options: {\r\n                        showTitle: false\r\n                    }\r\n                }]\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_onShowing\",\r\n        value: function(e) {\r\n            var _this2 = this;\r\n            this._updateForm();\r\n            var arg = {\r\n                form: this._appointmentForm,\r\n                popup: this._popup,\r\n                appointmentData: this.state.appointment.data,\r\n                cancel: false\r\n            };\r\n            this.scheduler._actions.onAppointmentFormOpening(arg);\r\n            this.scheduler._processActionResult(arg, function(canceled) {\r\n                if (canceled) {\r\n                    e.cancel = true\r\n                } else {\r\n                    _this2.updatePopupFullScreenMode()\r\n                }\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_createPopupContent\",\r\n        value: function() {\r\n            var formElement = (0, _renderer.default)(\"<div>\");\r\n            this._appointmentForm = this._createForm(formElement);\r\n            return formElement\r\n        }\r\n    }, {\r\n        key: \"_createAppointmentFormData\",\r\n        value: function(rawAppointment) {\r\n            var appointment = this._createAppointmentAdapter(rawAppointment);\r\n            var result = (0, _extend.extend)(true, {\r\n                repeat: !!appointment.recurrenceRule\r\n            }, rawAppointment);\r\n            (0, _iterator.each)(this.scheduler._resourcesManager.getResourcesFromItem(result, true) || {}, function(name, value) {\r\n                return result[name] = value\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_createForm\",\r\n        value: function(element) {\r\n            var expr = this.scheduler._dataAccessors.expr;\r\n            var resources = this.scheduler.option(\"resources\");\r\n            var allowTimeZoneEditing = this._getAllowTimeZoneEditing();\r\n            var rawAppointment = this.state.appointment.data;\r\n            var formData = this._createAppointmentFormData(rawAppointment);\r\n            var readOnly = this._isReadOnly(rawAppointment);\r\n            _uiScheduler.AppointmentForm.prepareAppointmentFormEditors(expr, this.scheduler, this.triggerResize.bind(this), this.changeSize.bind(this), formData, allowTimeZoneEditing, readOnly);\r\n            if (resources && resources.length) {\r\n                _uiScheduler.AppointmentForm.concatResources(this.scheduler._resourcesManager.getEditors())\r\n            }\r\n            return _uiScheduler.AppointmentForm.create(this.scheduler._createComponent.bind(this.scheduler), element, readOnly, formData)\r\n        }\r\n    }, {\r\n        key: \"_getAllowTimeZoneEditing\",\r\n        value: function() {\r\n            var scheduler = this.scheduler;\r\n            return scheduler.option(\"editing.allowTimeZoneEditing\") || scheduler.option(\"editing.allowEditingTimeZones\")\r\n        }\r\n    }, {\r\n        key: \"_isReadOnly\",\r\n        value: function(rawAppointment) {\r\n            var adapter = this.scheduler.createAppointmentAdapter(rawAppointment);\r\n            if (rawAppointment && adapter.disabled) {\r\n                return true\r\n            }\r\n            return this.scheduler._editAppointmentData ? !this.scheduler._editing.allowUpdating : false\r\n        }\r\n    }, {\r\n        key: \"_createAppointmentAdapter\",\r\n        value: function(rawAppointment) {\r\n            return this.scheduler.createAppointmentAdapter(rawAppointment)\r\n        }\r\n    }, {\r\n        key: \"_updateForm\",\r\n        value: function() {\r\n            var data = this.state.appointment.data;\r\n            var adapter = this._createAppointmentAdapter(data);\r\n            var allDay = adapter.allDay;\r\n            var startDate = adapter.startDate && adapter.calculateStartDate(\"toAppointment\");\r\n            var endDate = adapter.endDate && adapter.calculateEndDate(\"toAppointment\");\r\n            this.state.appointment.isEmptyText = void 0 === data || void 0 === adapter.text;\r\n            this.state.appointment.isEmptyDescription = void 0 === data || void 0 === adapter.description;\r\n            var appointment = this._createAppointmentAdapter(this._createAppointmentFormData(data));\r\n            if (void 0 === appointment.text) {\r\n                appointment.text = \"\"\r\n            }\r\n            if (void 0 === appointment.description) {\r\n                appointment.description = \"\"\r\n            }\r\n            if (void 0 === appointment.recurrenceRule) {\r\n                appointment.recurrenceRule = \"\"\r\n            }\r\n            var formData = appointment.source();\r\n            if (startDate) {\r\n                this.scheduler.fire(\"setField\", \"startDate\", formData, startDate)\r\n            }\r\n            if (endDate) {\r\n                this.scheduler.fire(\"setField\", \"endDate\", formData, endDate)\r\n            }\r\n            var _this$scheduler$_data = this.scheduler._dataAccessors.expr,\r\n                startDateExpr = _this$scheduler$_data.startDateExpr,\r\n                endDateExpr = _this$scheduler$_data.endDateExpr;\r\n            this._appointmentForm.option(\"readOnly\", this._isReadOnly(data));\r\n            _uiScheduler.AppointmentForm.updateFormData(this._appointmentForm, formData, this.scheduler._dataAccessors.expr);\r\n            _uiScheduler.AppointmentForm.setEditorsType(this._appointmentForm, startDateExpr, endDateExpr, allDay)\r\n        }\r\n    }, {\r\n        key: \"_isDeviceMobile\",\r\n        value: function() {\r\n            return \"desktop\" !== _devices.default.current().deviceType\r\n        }\r\n    }, {\r\n        key: \"_isPopupFullScreenNeeded\",\r\n        value: function() {\r\n            var width = this._tryGetWindowWidth();\r\n            if (width) {\r\n                return this._isDeviceMobile() ? width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE : width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH\r\n            }\r\n            return false\r\n        }\r\n    }, {\r\n        key: \"_tryGetWindowWidth\",\r\n        value: function() {\r\n            if ((0, _window.hasWindow)()) {\r\n                var window = (0, _window.getWindow)();\r\n                return (0, _renderer.default)(window).width()\r\n            }\r\n        }\r\n    }, {\r\n        key: \"triggerResize\",\r\n        value: function() {\r\n            this._popup && (0, _visibility_change.triggerResizeEvent)(this._popup.$element())\r\n        }\r\n    }, {\r\n        key: \"_getMaxWidth\",\r\n        value: function(isRecurrence) {\r\n            if (this._isDeviceMobile()) {\r\n                return APPOINTMENT_POPUP_WIDTH_MOBILE\r\n            }\r\n            return isRecurrence ? APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE : APPOINTMENT_POPUP_WIDTH\r\n        }\r\n    }, {\r\n        key: \"changeSize\",\r\n        value: function(isRecurrence) {\r\n            var isFullScreen = this._isPopupFullScreenNeeded();\r\n            this._popup.option({\r\n                maxWidth: isFullScreen ? \"100%\" : this._getMaxWidth(isRecurrence),\r\n                fullScreen: isFullScreen\r\n            })\r\n        }\r\n    }, {\r\n        key: \"updatePopupFullScreenMode\",\r\n        value: function() {\r\n            if (!this._appointmentForm) {\r\n                return\r\n            }\r\n            var isRecurrence = _uiScheduler.AppointmentForm.getRecurrenceRule(this._appointmentForm.option(\"formData\"), this.scheduler._dataAccessors.expr);\r\n            if (this.isVisible()) {\r\n                this.changeSize(isRecurrence)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_createPopupToolbarItems\",\r\n        value: function(isDoneButtonVisible) {\r\n            var _this3 = this;\r\n            var result = [];\r\n            var isIOs = \"ios\" === _devices.default.current().platform;\r\n            if (isDoneButtonVisible) {\r\n                result.push({\r\n                    shortcut: \"done\",\r\n                    options: {\r\n                        text: _message.default.format(\"Done\")\r\n                    },\r\n                    location: TOOLBAR_ITEM_AFTER_LOCATION,\r\n                    onClick: function(e) {\r\n                        return _this3._doneButtonClickHandler(e)\r\n                    }\r\n                })\r\n            }\r\n            result.push({\r\n                shortcut: \"cancel\",\r\n                location: isIOs ? TOOLBAR_ITEM_BEFORE_LOCATION : TOOLBAR_ITEM_AFTER_LOCATION\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"saveChanges\",\r\n        value: function(showLoadPanel) {\r\n            var _this4 = this;\r\n            var deferred = new _deferred.Deferred;\r\n            var validation = this._appointmentForm.validate();\r\n            var state = this.state.appointment;\r\n            showLoadPanel && this._showLoadPanel();\r\n            (0, _deferred.when)(validation && validation.complete || validation).done(function(validation) {\r\n                if (validation && !validation.isValid) {\r\n                    _this4._hideLoadPanel();\r\n                    deferred.resolve(false);\r\n                    return\r\n                }\r\n                var formData = _this4._appointmentForm.option(\"formData\");\r\n                var adapter = _this4.scheduler.createAppointmentAdapter(formData);\r\n                var appointment = adapter.clone({\r\n                    pathTimeZone: \"fromAppointment\"\r\n                }).source();\r\n                var oldData = _this4.scheduler._editAppointmentData;\r\n                var recData = _this4.scheduler._updatedRecAppointment;\r\n                if (state.isEmptyText && \"\" === adapter.text) {\r\n                    delete appointment.text\r\n                }\r\n                if (state.isEmptyDescription && \"\" === adapter.description) {\r\n                    delete appointment.description\r\n                }\r\n                if (void 0 === state.data.recurrenceRule && \"\" === adapter.recurrenceRule) {\r\n                    delete appointment.recurrenceRule\r\n                }\r\n                if ((0, _type.isDefined)(appointment.repeat)) {\r\n                    delete appointment.repeat\r\n                }\r\n                if (oldData && !recData) {\r\n                    _this4.scheduler.updateAppointment(oldData, appointment).done(deferred.resolve)\r\n                } else {\r\n                    if (recData) {\r\n                        _this4.scheduler.updateAppointment(oldData, recData);\r\n                        delete _this4.scheduler._updatedRecAppointment\r\n                    }\r\n                    _this4.scheduler.addAppointment(appointment).done(deferred.resolve)\r\n                }\r\n                deferred.done(function() {\r\n                    _this4._hideLoadPanel();\r\n                    _this4.state.lastEditData = appointment\r\n                })\r\n            });\r\n            return deferred.promise()\r\n        }\r\n    }, {\r\n        key: \"_doneButtonClickHandler\",\r\n        value: function(e) {\r\n            e.cancel = true;\r\n            this.saveEditData()\r\n        }\r\n    }, {\r\n        key: \"saveEditData\",\r\n        value: function() {\r\n            var _this5 = this;\r\n            var deferred = new _deferred.Deferred;\r\n            if (this._tryLockSaveChanges()) {\r\n                (0, _deferred.when)(this.saveChanges(true)).done(function() {\r\n                    if (_this5.state.lastEditData) {\r\n                        var adapter = _this5.scheduler.createAppointmentAdapter(_this5.state.lastEditData);\r\n                        var startDate = adapter.startDate,\r\n                            endDate = adapter.endDate,\r\n                            allDay = adapter.allDay;\r\n                        var startTime = startDate.getTime();\r\n                        var endTime = endDate.getTime();\r\n                        var inAllDayRow = allDay || endTime - startTime >= DAY_IN_MS;\r\n                        _this5.scheduler._workSpace.updateScrollPosition(startDate, _this5.scheduler._resourcesManager.getResourcesFromItem(_this5.state.lastEditData, true), inAllDayRow);\r\n                        _this5.state.lastEditData = null\r\n                    }\r\n                    _this5._unlockSaveChanges();\r\n                    deferred.resolve()\r\n                })\r\n            }\r\n            return deferred.promise()\r\n        }\r\n    }, {\r\n        key: \"_hideLoadPanel\",\r\n        value: function() {\r\n            (0, _ui.hide)()\r\n        }\r\n    }, {\r\n        key: \"_showLoadPanel\",\r\n        value: function() {\r\n            var $overlayContent = this._popup.overlayContent();\r\n            (0, _ui.show)({\r\n                container: $overlayContent,\r\n                position: {\r\n                    of: $overlayContent\r\n                }\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_tryLockSaveChanges\",\r\n        value: function() {\r\n            if (false === this.state.saveChangesLocker) {\r\n                this.state.saveChangesLocker = true;\r\n                return true\r\n            }\r\n            return false\r\n        }\r\n    }, {\r\n        key: \"_unlockSaveChanges\",\r\n        value: function() {\r\n            this.state.saveChangesLocker = false\r\n        }\r\n    }]);\r\n    return AppointmentPopup\r\n}();\r\nexports.default = AppointmentPopup;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}