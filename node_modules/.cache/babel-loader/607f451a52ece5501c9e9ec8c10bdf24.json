{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/ui.scheduler.resource_manager.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _object = require(\"../../core/utils/object\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _query = _interopRequireDefault(require(\"../../data/query\"));\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _data_source = require(\"../../data/data_source/data_source\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _utils = require(\"../../data/data_source/utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar getValueExpr = function (resource) {\n  return resource.valueExpr || \"id\";\n};\n\nvar getDisplayExpr = function (resource) {\n  return resource.displayExpr || \"text\";\n};\n\nvar ResourceManager = function () {\n  function ResourceManager(resources) {\n    _classCallCheck(this, ResourceManager);\n\n    this._resourceLoader = {};\n    this.setResources(resources);\n  }\n\n  _createClass(ResourceManager, [{\n    key: \"_createWrappedDataSource\",\n    value: function (dataSource) {\n      if (dataSource instanceof _data_source.DataSource) {\n        return dataSource;\n      }\n\n      var result = {\n        store: (0, _utils.normalizeDataSourceOptions)(dataSource).store,\n        pageSize: 0\n      };\n\n      if (!Array.isArray(dataSource)) {\n        result.filter = dataSource.filter;\n      }\n\n      return new _data_source.DataSource(result);\n    }\n  }, {\n    key: \"_mapResourceData\",\n    value: function (resource, data) {\n      var valueGetter = (0, _data.compileGetter)(getValueExpr(resource));\n      var displayGetter = (0, _data.compileGetter)(getDisplayExpr(resource));\n      return (0, _iterator.map)(data, function (item) {\n        var result = {\n          id: valueGetter(item),\n          text: displayGetter(item)\n        };\n\n        if (item.color) {\n          result.color = item.color;\n        }\n\n        return result;\n      });\n    }\n  }, {\n    key: \"_isMultipleResource\",\n    value: function (resourceField) {\n      var result = false;\n      (0, _iterator.each)(this.getResources(), function (_, resource) {\n        var field = this.getField(resource);\n\n        if (field === resourceField) {\n          result = resource.allowMultiple;\n          return false;\n        }\n      }.bind(this));\n      return result;\n    }\n  }, {\n    key: \"getDataAccessors\",\n    value: function (field, type) {\n      var result = null;\n      (0, _iterator.each)(this._dataAccessors[type], function (accessorName, accessors) {\n        if (field === accessorName) {\n          result = accessors;\n          return false;\n        }\n      });\n      return result;\n    }\n  }, {\n    key: \"getField\",\n    value: function (resource) {\n      return resource.fieldExpr || resource.field;\n    }\n  }, {\n    key: \"setResources\",\n    value: function (resources) {\n      this._resources = resources;\n      this._dataAccessors = {\n        getter: {},\n        setter: {}\n      };\n      this._resourceFields = (0, _iterator.map)(resources || [], function (resource) {\n        var field = this.getField(resource);\n        this._dataAccessors.getter[field] = (0, _data.compileGetter)(field);\n        this._dataAccessors.setter[field] = (0, _data.compileSetter)(field);\n        return field;\n      }.bind(this));\n    }\n  }, {\n    key: \"getResources\",\n    value: function () {\n      return this._resources || [];\n    }\n  }, {\n    key: \"getResourcesData\",\n    value: function () {\n      return this._resourcesData || [];\n    }\n  }, {\n    key: \"getEditors\",\n    value: function () {\n      var result = [];\n      var that = this;\n      (0, _iterator.each)(this.getResources(), function (i, resource) {\n        var field = that.getField(resource);\n\n        var currentResourceItems = that._getResourceDataByField(field);\n\n        result.push({\n          editorOptions: {\n            dataSource: currentResourceItems.length ? currentResourceItems : that._createWrappedDataSource(resource.dataSource),\n            displayExpr: getDisplayExpr(resource),\n            valueExpr: getValueExpr(resource)\n          },\n          dataField: field,\n          editorType: resource.allowMultiple ? \"dxTagBox\" : \"dxSelectBox\",\n          label: {\n            text: resource.label || field\n          }\n        });\n      });\n      return result;\n    }\n  }, {\n    key: \"getResourceDataByValue\",\n    value: function (field, value) {\n      var that = this;\n      var result = new _deferred.Deferred();\n      (0, _iterator.each)(this.getResources(), function (_, resource) {\n        var resourceField = that.getField(resource);\n\n        if (resourceField === field) {\n          var dataSource = that._createWrappedDataSource(resource.dataSource);\n\n          var valueExpr = getValueExpr(resource);\n\n          if (!that._resourceLoader[field]) {\n            that._resourceLoader[field] = dataSource.load();\n          }\n\n          that._resourceLoader[field].done(function (data) {\n            var filteredData = (0, _query.default)(data).filter(valueExpr, value).toArray();\n            delete that._resourceLoader[field];\n            result.resolve(filteredData[0]);\n          }).fail(function () {\n            delete that._resourceLoader[field];\n            result.reject();\n          });\n\n          return false;\n        }\n      });\n      return result.promise();\n    }\n  }, {\n    key: \"setResourcesToItem\",\n    value: function (itemData, resources) {\n      var resourcesSetter = this._dataAccessors.setter;\n\n      for (var name in resources) {\n        if (Object.prototype.hasOwnProperty.call(resources, name)) {\n          var resourceData = resources[name];\n          resourcesSetter[name](itemData, this._isMultipleResource(name) ? (0, _array.wrapToArray)(resourceData) : resourceData);\n        }\n      }\n    }\n  }, {\n    key: \"getResourcesFromItem\",\n    value: function (itemData, wrapOnlyMultipleResources) {\n      var _this = this;\n\n      var result = null;\n\n      if (!(0, _type.isDefined)(wrapOnlyMultipleResources)) {\n        wrapOnlyMultipleResources = false;\n      }\n\n      this._resourceFields.forEach(function (field) {\n        (0, _iterator.each)(itemData, function (fieldName, fieldValue) {\n          var tempObject = {};\n          tempObject[fieldName] = fieldValue;\n\n          var resourceData = _this.getDataAccessors(field, \"getter\")(tempObject);\n\n          if ((0, _type.isDefined)(resourceData)) {\n            if (!result) {\n              result = {};\n            }\n\n            if (1 === resourceData.length) {\n              resourceData = resourceData[0];\n            }\n\n            if (!wrapOnlyMultipleResources || wrapOnlyMultipleResources && _this._isMultipleResource(field)) {\n              _this.getDataAccessors(field, \"setter\")(tempObject, (0, _array.wrapToArray)(resourceData));\n            } else {\n              _this.getDataAccessors(field, \"setter\")(tempObject, resourceData);\n            }\n\n            (0, _extend.extend)(result, tempObject);\n            return true;\n          }\n        });\n      });\n\n      return result;\n    }\n  }, {\n    key: \"loadResources\",\n    value: function (groups) {\n      var result = new _deferred.Deferred();\n      var that = this;\n      var deferreds = [];\n      (0, _iterator.each)(this.getResourcesByFields(groups), function (i, resource) {\n        var deferred = new _deferred.Deferred();\n        var field = that.getField(resource);\n        deferreds.push(deferred);\n\n        that._createWrappedDataSource(resource.dataSource).load().done(function (data) {\n          deferred.resolve({\n            name: field,\n            items: that._mapResourceData(resource, data),\n            data: data\n          });\n        }).fail(function () {\n          deferred.reject();\n        });\n      });\n\n      if (!deferreds.length) {\n        that._resourcesData = [];\n        return result.resolve([]);\n      }\n\n      _deferred.when.apply(null, deferreds).done(function () {\n        var data = Array.prototype.slice.call(arguments);\n\n        var mapFunction = function (obj) {\n          return {\n            name: obj.name,\n            items: obj.items,\n            data: obj.data\n          };\n        };\n\n        that._resourcesData = data;\n        result.resolve(data.map(mapFunction));\n      }).fail(function () {\n        result.reject();\n      });\n\n      return result.promise();\n    }\n  }, {\n    key: \"getResourcesByFields\",\n    value: function (fields) {\n      return (0, _common.grep)(this.getResources(), function (resource) {\n        var field = this.getField(resource);\n        return (0, _array.inArray)(field, fields) > -1;\n      }.bind(this));\n    }\n  }, {\n    key: \"getResourceByField\",\n    value: function (field) {\n      return this.getResourcesByFields([field])[0] || {};\n    }\n  }, {\n    key: \"getResourceColor\",\n    value: function (field, value) {\n      var valueExpr = this.getResourceByField(field).valueExpr || \"id\";\n      var valueGetter = (0, _data.compileGetter)(valueExpr);\n      var colorExpr = this.getResourceByField(field).colorExpr || \"color\";\n      var colorGetter = (0, _data.compileGetter)(colorExpr);\n      var result = new _deferred.Deferred();\n\n      var resourceData = this._getResourceDataByField(field);\n\n      var resourceDataLength = resourceData.length;\n      var color;\n\n      if (resourceDataLength) {\n        for (var i = 0; i < resourceDataLength; i++) {\n          if (valueGetter(resourceData[i]) === value) {\n            color = colorGetter(resourceData[i]);\n            break;\n          }\n        }\n\n        result.resolve(color);\n      } else {\n        this.getResourceDataByValue(field, value).done(function (resourceData) {\n          if (resourceData) {\n            color = colorGetter(resourceData);\n          }\n\n          result.resolve(color);\n        }).fail(function () {\n          result.reject();\n        });\n      }\n\n      return result.promise();\n    }\n  }, {\n    key: \"getResourceForPainting\",\n    value: function (groups) {\n      var resources = this.getResources();\n      var result;\n      (0, _iterator.each)(resources, function (index, resource) {\n        if (resource.useColorAsDefault) {\n          result = resource;\n          return false;\n        }\n      });\n\n      if (!result) {\n        if (Array.isArray(groups) && groups.length) {\n          resources = this.getResourcesByFields(groups);\n        }\n\n        result = resources[resources.length - 1];\n      }\n\n      return result;\n    }\n  }, {\n    key: \"createResourcesTree\",\n    value: function (groups) {\n      var leafIndex = 0;\n      var groupIndex = groupIndex || 0;\n\n      function make(group, groupIndex, result, parent) {\n        result = result || [];\n\n        for (var i = 0; i < group.items.length; i++) {\n          var currentGroupItem = group.items[i];\n          var resultItem = {\n            name: group.name,\n            value: currentGroupItem.id,\n            title: currentGroupItem.text,\n            data: group.data && group.data[i],\n            children: [],\n            parent: parent ? parent : null\n          };\n          result.push(resultItem);\n          var nextGroupIndex = groupIndex + 1;\n\n          if (groups[nextGroupIndex]) {\n            make.call(this, groups[nextGroupIndex], nextGroupIndex, resultItem.children, resultItem);\n          }\n\n          if (!resultItem.children.length) {\n            resultItem.leafIndex = leafIndex;\n            leafIndex++;\n          }\n        }\n\n        return result;\n      }\n\n      return make.call(this, groups[0], 0);\n    }\n  }, {\n    key: \"_hasGroupItem\",\n    value: function (appointmentResources, groupName, itemValue) {\n      var group = this.getDataAccessors(groupName, \"getter\")(appointmentResources);\n\n      if (group) {\n        if ((0, _array.inArray)(itemValue, group) > -1) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n  }, {\n    key: \"_getResourceDataByField\",\n    value: function (fieldName) {\n      var loadedResources = this.getResourcesData();\n      var currentResourceData = [];\n\n      for (var i = 0, resourceCount = loadedResources.length; i < resourceCount; i++) {\n        if (loadedResources[i].name === fieldName) {\n          currentResourceData = loadedResources[i].data;\n          break;\n        }\n      }\n\n      return currentResourceData;\n    }\n  }, {\n    key: \"getResourceTreeLeaves\",\n    value: function (tree, appointmentResources, result) {\n      result = result || [];\n\n      for (var i = 0; i < tree.length; i++) {\n        if (!this._hasGroupItem(appointmentResources, tree[i].name, tree[i].value)) {\n          continue;\n        }\n\n        if ((0, _type.isDefined)(tree[i].leafIndex)) {\n          result.push(tree[i].leafIndex);\n        }\n\n        if (tree[i].children) {\n          this.getResourceTreeLeaves(tree[i].children, appointmentResources, result);\n        }\n      }\n\n      return result;\n    }\n  }, {\n    key: \"groupAppointmentsByResources\",\n    value: function (appointments, resources) {\n      var tree = this.createResourcesTree(resources);\n      var result = {};\n      (0, _iterator.each)(appointments, function (_, appointment) {\n        var appointmentResources = this.getResourcesFromItem(appointment);\n        var treeLeaves = this.getResourceTreeLeaves(tree, appointmentResources);\n\n        for (var i = 0; i < treeLeaves.length; i++) {\n          if (!result[treeLeaves[i]]) {\n            result[treeLeaves[i]] = [];\n          }\n\n          result[treeLeaves[i]].push((0, _object.deepExtendArraySafe)({}, appointment, true));\n        }\n      }.bind(this));\n      return result;\n    }\n  }, {\n    key: \"reduceResourcesTree\",\n    value: function (tree, existingAppointments, _result) {\n      _result = _result ? _result.children : [];\n      var that = this;\n      tree.forEach(function (node, index) {\n        var ok = false;\n        var resourceName = node.name;\n        var resourceValue = node.value;\n        var resourceTitle = node.title;\n        var resourceData = node.data;\n        var resourceGetter = that.getDataAccessors(resourceName, \"getter\");\n        existingAppointments.forEach(function (appointment) {\n          if (!ok) {\n            var resourceFromAppointment = resourceGetter(appointment);\n\n            if (Array.isArray(resourceFromAppointment)) {\n              if (resourceFromAppointment.indexOf(resourceValue) > -1) {\n                _result.push({\n                  name: resourceName,\n                  value: resourceValue,\n                  title: resourceTitle,\n                  data: resourceData,\n                  children: []\n                });\n\n                ok = true;\n              }\n            } else {\n              if (resourceFromAppointment === resourceValue) {\n                _result.push({\n                  name: resourceName,\n                  value: resourceValue,\n                  title: resourceTitle,\n                  data: resourceData,\n                  children: []\n                });\n\n                ok = true;\n              }\n            }\n          }\n        });\n\n        if (ok && node.children && node.children.length) {\n          that.reduceResourcesTree(node.children, existingAppointments, _result[index]);\n        }\n      });\n      return _result;\n    }\n  }, {\n    key: \"getResourcesDataByGroups\",\n    value: function (groups) {\n      var _this2 = this;\n\n      var resourcesData = this.getResourcesData();\n\n      if (!groups) {\n        return resourcesData;\n      }\n\n      var fieldNames = Object.getOwnPropertyNames(groups);\n      var resourceData = resourcesData.filter(function (item) {\n        return fieldNames.indexOf(item.name) !== -1;\n      });\n      var currentResourcesData = [];\n      resourceData.forEach(function (data) {\n        return currentResourcesData.push((0, _extend.extend)({}, data));\n      });\n      (0, _iterator.each)(groups, function (_, value) {\n        currentResourcesData.forEach(function (resourceData) {\n          var items = resourceData.items,\n              data = resourceData.data,\n              name = resourceData.name;\n\n          var resource = _this2.getResourceByField(name);\n\n          var valueExpr = getValueExpr(resource);\n          var currentItems = items.filter(function (item) {\n            return item.id === value;\n          });\n          var currentData = data.filter(function (item) {\n            return item[valueExpr] === value;\n          });\n          resourceData.items = currentItems;\n          resourceData.data = currentData;\n        });\n      });\n      return currentResourcesData;\n    }\n  }]);\n\n  return ResourceManager;\n}();\n\nexports.default = ResourceManager;\nmodule.exports = exports.default;","map":{"version":3,"sources":["F:/webfe/node_modules/devextreme/ui/scheduler/ui.scheduler.resource_manager.js"],"names":["exports","default","_array","require","_common","_type","_object","_iterator","_extend","_query","_interopRequireDefault","_data","_data_source","_deferred","_utils","obj","__esModule","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","getValueExpr","resource","valueExpr","getDisplayExpr","displayExpr","ResourceManager","resources","_resourceLoader","setResources","value","dataSource","DataSource","result","store","normalizeDataSourceOptions","pageSize","Array","isArray","filter","data","valueGetter","compileGetter","displayGetter","map","item","id","text","color","resourceField","each","getResources","_","field","getField","allowMultiple","bind","type","_dataAccessors","accessorName","accessors","fieldExpr","_resources","getter","setter","_resourceFields","compileSetter","_resourcesData","that","currentResourceItems","_getResourceDataByField","push","editorOptions","_createWrappedDataSource","dataField","editorType","label","Deferred","load","done","filteredData","toArray","resolve","fail","reject","promise","itemData","resourcesSetter","name","hasOwnProperty","call","resourceData","_isMultipleResource","wrapToArray","wrapOnlyMultipleResources","_this","isDefined","forEach","fieldName","fieldValue","tempObject","getDataAccessors","extend","groups","deferreds","getResourcesByFields","deferred","items","_mapResourceData","when","apply","slice","arguments","mapFunction","fields","grep","inArray","getResourceByField","colorExpr","colorGetter","resourceDataLength","getResourceDataByValue","index","useColorAsDefault","leafIndex","groupIndex","make","group","parent","currentGroupItem","resultItem","title","children","nextGroupIndex","appointmentResources","groupName","itemValue","loadedResources","getResourcesData","currentResourceData","resourceCount","tree","_hasGroupItem","getResourceTreeLeaves","appointments","createResourcesTree","appointment","getResourcesFromItem","treeLeaves","deepExtendArraySafe","existingAppointments","_result","node","ok","resourceName","resourceValue","resourceTitle","resourceGetter","resourceFromAppointment","indexOf","reduceResourcesTree","_this2","resourcesData","fieldNames","getOwnPropertyNames","currentResourcesData","currentItems","currentData","module"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAA,OAAO,CAACC,OAAR,GAAkB,KAAK,CAAvB;;AACA,IAAIC,MAAM,GAAGC,OAAO,CAAC,wBAAD,CAApB;;AACA,IAAIC,OAAO,GAAGD,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAIE,KAAK,GAAGF,OAAO,CAAC,uBAAD,CAAnB;;AACA,IAAIG,OAAO,GAAGH,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAII,SAAS,GAAGJ,OAAO,CAAC,2BAAD,CAAvB;;AACA,IAAIK,OAAO,GAAGL,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAIM,MAAM,GAAGC,sBAAsB,CAACP,OAAO,CAAC,kBAAD,CAAR,CAAnC;;AACA,IAAIQ,KAAK,GAAGR,OAAO,CAAC,uBAAD,CAAnB;;AACA,IAAIS,YAAY,GAAGT,OAAO,CAAC,oCAAD,CAA1B;;AACA,IAAIU,SAAS,GAAGV,OAAO,CAAC,2BAAD,CAAvB;;AACA,IAAIW,MAAM,GAAGX,OAAO,CAAC,8BAAD,CAApB;;AAEA,SAASO,sBAAT,CAAgCK,GAAhC,EAAqC;AACjC,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AAED,SAASE,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;AAC5C,MAAI,EAAED,QAAQ,YAAYC,WAAtB,CAAJ,EAAwC;AACpC,UAAM,IAAIC,SAAJ,CAAc,mCAAd,CAAN;AACH;AACJ;;AAED,SAASC,iBAAT,CAA2BC,MAA3B,EAAmCC,KAAnC,EAA0C;AACtC,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAACE,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnC,QAAIE,UAAU,GAAGH,KAAK,CAACC,CAAD,CAAtB;AACAE,IAAAA,UAAU,CAACC,UAAX,GAAwBD,UAAU,CAACC,UAAX,IAAyB,KAAjD;AACAD,IAAAA,UAAU,CAACE,YAAX,GAA0B,IAA1B;;AACA,QAAI,WAAWF,UAAf,EAA2B;AACvBA,MAAAA,UAAU,CAACG,QAAX,GAAsB,IAAtB;AACH;;AACDC,IAAAA,MAAM,CAACC,cAAP,CAAsBT,MAAtB,EAA8BI,UAAU,CAACM,GAAzC,EAA8CN,UAA9C;AACH;AACJ;;AAED,SAASO,YAAT,CAAsBd,WAAtB,EAAmCe,UAAnC,EAA+CC,WAA/C,EAA4D;AACxD,MAAID,UAAJ,EAAgB;AACZb,IAAAA,iBAAiB,CAACF,WAAW,CAACiB,SAAb,EAAwBF,UAAxB,CAAjB;AACH;;AACD,MAAIC,WAAJ,EAAiB;AACbd,IAAAA,iBAAiB,CAACF,WAAD,EAAcgB,WAAd,CAAjB;AACH;;AACD,SAAOhB,WAAP;AACH;;AACD,IAAIkB,YAAY,GAAG,UAASC,QAAT,EAAmB;AAClC,SAAOA,QAAQ,CAACC,SAAT,IAAsB,IAA7B;AACH,CAFD;;AAGA,IAAIC,cAAc,GAAG,UAASF,QAAT,EAAmB;AACpC,SAAOA,QAAQ,CAACG,WAAT,IAAwB,MAA/B;AACH,CAFD;;AAGA,IAAIC,eAAe,GAAG,YAAW;AAC7B,WAASA,eAAT,CAAyBC,SAAzB,EAAoC;AAChC1B,IAAAA,eAAe,CAAC,IAAD,EAAOyB,eAAP,CAAf;;AACA,SAAKE,eAAL,GAAuB,EAAvB;AACA,SAAKC,YAAL,CAAkBF,SAAlB;AACH;;AACDV,EAAAA,YAAY,CAACS,eAAD,EAAkB,CAAC;AAC3BV,IAAAA,GAAG,EAAE,0BADsB;AAE3Bc,IAAAA,KAAK,EAAE,UAASC,UAAT,EAAqB;AACxB,UAAIA,UAAU,YAAYnC,YAAY,CAACoC,UAAvC,EAAmD;AAC/C,eAAOD,UAAP;AACH;;AACD,UAAIE,MAAM,GAAG;AACTC,QAAAA,KAAK,EAAE,CAAC,GAAGpC,MAAM,CAACqC,0BAAX,EAAuCJ,UAAvC,EAAmDG,KADjD;AAETE,QAAAA,QAAQ,EAAE;AAFD,OAAb;;AAIA,UAAI,CAACC,KAAK,CAACC,OAAN,CAAcP,UAAd,CAAL,EAAgC;AAC5BE,QAAAA,MAAM,CAACM,MAAP,GAAgBR,UAAU,CAACQ,MAA3B;AACH;;AACD,aAAO,IAAI3C,YAAY,CAACoC,UAAjB,CAA4BC,MAA5B,CAAP;AACH;AAd0B,GAAD,EAe3B;AACCjB,IAAAA,GAAG,EAAE,kBADN;AAECc,IAAAA,KAAK,EAAE,UAASR,QAAT,EAAmBkB,IAAnB,EAAyB;AAC5B,UAAIC,WAAW,GAAG,CAAC,GAAG9C,KAAK,CAAC+C,aAAV,EAAyBrB,YAAY,CAACC,QAAD,CAArC,CAAlB;AACA,UAAIqB,aAAa,GAAG,CAAC,GAAGhD,KAAK,CAAC+C,aAAV,EAAyBlB,cAAc,CAACF,QAAD,CAAvC,CAApB;AACA,aAAO,CAAC,GAAG/B,SAAS,CAACqD,GAAd,EAAmBJ,IAAnB,EAAyB,UAASK,IAAT,EAAe;AAC3C,YAAIZ,MAAM,GAAG;AACTa,UAAAA,EAAE,EAAEL,WAAW,CAACI,IAAD,CADN;AAETE,UAAAA,IAAI,EAAEJ,aAAa,CAACE,IAAD;AAFV,SAAb;;AAIA,YAAIA,IAAI,CAACG,KAAT,EAAgB;AACZf,UAAAA,MAAM,CAACe,KAAP,GAAeH,IAAI,CAACG,KAApB;AACH;;AACD,eAAOf,MAAP;AACH,OATM,CAAP;AAUH;AAfF,GAf2B,EA+B3B;AACCjB,IAAAA,GAAG,EAAE,qBADN;AAECc,IAAAA,KAAK,EAAE,UAASmB,aAAT,EAAwB;AAC3B,UAAIhB,MAAM,GAAG,KAAb;AACA,OAAC,GAAG1C,SAAS,CAAC2D,IAAd,EAAoB,KAAKC,YAAL,EAApB,EAAyC,UAASC,CAAT,EAAY9B,QAAZ,EAAsB;AAC3D,YAAI+B,KAAK,GAAG,KAAKC,QAAL,CAAchC,QAAd,CAAZ;;AACA,YAAI+B,KAAK,KAAKJ,aAAd,EAA6B;AACzBhB,UAAAA,MAAM,GAAGX,QAAQ,CAACiC,aAAlB;AACA,iBAAO,KAAP;AACH;AACJ,OANwC,CAMvCC,IANuC,CAMlC,IANkC,CAAzC;AAOA,aAAOvB,MAAP;AACH;AAZF,GA/B2B,EA4C3B;AACCjB,IAAAA,GAAG,EAAE,kBADN;AAECc,IAAAA,KAAK,EAAE,UAASuB,KAAT,EAAgBI,IAAhB,EAAsB;AACzB,UAAIxB,MAAM,GAAG,IAAb;AACA,OAAC,GAAG1C,SAAS,CAAC2D,IAAd,EAAoB,KAAKQ,cAAL,CAAoBD,IAApB,CAApB,EAA+C,UAASE,YAAT,EAAuBC,SAAvB,EAAkC;AAC7E,YAAIP,KAAK,KAAKM,YAAd,EAA4B;AACxB1B,UAAAA,MAAM,GAAG2B,SAAT;AACA,iBAAO,KAAP;AACH;AACJ,OALD;AAMA,aAAO3B,MAAP;AACH;AAXF,GA5C2B,EAwD3B;AACCjB,IAAAA,GAAG,EAAE,UADN;AAECc,IAAAA,KAAK,EAAE,UAASR,QAAT,EAAmB;AACtB,aAAOA,QAAQ,CAACuC,SAAT,IAAsBvC,QAAQ,CAAC+B,KAAtC;AACH;AAJF,GAxD2B,EA6D3B;AACCrC,IAAAA,GAAG,EAAE,cADN;AAECc,IAAAA,KAAK,EAAE,UAASH,SAAT,EAAoB;AACvB,WAAKmC,UAAL,GAAkBnC,SAAlB;AACA,WAAK+B,cAAL,GAAsB;AAClBK,QAAAA,MAAM,EAAE,EADU;AAElBC,QAAAA,MAAM,EAAE;AAFU,OAAtB;AAIA,WAAKC,eAAL,GAAuB,CAAC,GAAG1E,SAAS,CAACqD,GAAd,EAAmBjB,SAAS,IAAI,EAAhC,EAAoC,UAASL,QAAT,EAAmB;AAC1E,YAAI+B,KAAK,GAAG,KAAKC,QAAL,CAAchC,QAAd,CAAZ;AACA,aAAKoC,cAAL,CAAoBK,MAApB,CAA2BV,KAA3B,IAAoC,CAAC,GAAG1D,KAAK,CAAC+C,aAAV,EAAyBW,KAAzB,CAApC;AACA,aAAKK,cAAL,CAAoBM,MAApB,CAA2BX,KAA3B,IAAoC,CAAC,GAAG1D,KAAK,CAACuE,aAAV,EAAyBb,KAAzB,CAApC;AACA,eAAOA,KAAP;AACH,OAL0D,CAKzDG,IALyD,CAKpD,IALoD,CAApC,CAAvB;AAMH;AAdF,GA7D2B,EA4E3B;AACCxC,IAAAA,GAAG,EAAE,cADN;AAECc,IAAAA,KAAK,EAAE,YAAW;AACd,aAAO,KAAKgC,UAAL,IAAmB,EAA1B;AACH;AAJF,GA5E2B,EAiF3B;AACC9C,IAAAA,GAAG,EAAE,kBADN;AAECc,IAAAA,KAAK,EAAE,YAAW;AACd,aAAO,KAAKqC,cAAL,IAAuB,EAA9B;AACH;AAJF,GAjF2B,EAsF3B;AACCnD,IAAAA,GAAG,EAAE,YADN;AAECc,IAAAA,KAAK,EAAE,YAAW;AACd,UAAIG,MAAM,GAAG,EAAb;AACA,UAAImC,IAAI,GAAG,IAAX;AACA,OAAC,GAAG7E,SAAS,CAAC2D,IAAd,EAAoB,KAAKC,YAAL,EAApB,EAAyC,UAAS3C,CAAT,EAAYc,QAAZ,EAAsB;AAC3D,YAAI+B,KAAK,GAAGe,IAAI,CAACd,QAAL,CAAchC,QAAd,CAAZ;;AACA,YAAI+C,oBAAoB,GAAGD,IAAI,CAACE,uBAAL,CAA6BjB,KAA7B,CAA3B;;AACApB,QAAAA,MAAM,CAACsC,IAAP,CAAY;AACRC,UAAAA,aAAa,EAAE;AACXzC,YAAAA,UAAU,EAAEsC,oBAAoB,CAAC5D,MAArB,GAA8B4D,oBAA9B,GAAqDD,IAAI,CAACK,wBAAL,CAA8BnD,QAAQ,CAACS,UAAvC,CADtD;AAEXN,YAAAA,WAAW,EAAED,cAAc,CAACF,QAAD,CAFhB;AAGXC,YAAAA,SAAS,EAAEF,YAAY,CAACC,QAAD;AAHZ,WADP;AAMRoD,UAAAA,SAAS,EAAErB,KANH;AAORsB,UAAAA,UAAU,EAAErD,QAAQ,CAACiC,aAAT,GAAyB,UAAzB,GAAsC,aAP1C;AAQRqB,UAAAA,KAAK,EAAE;AACH7B,YAAAA,IAAI,EAAEzB,QAAQ,CAACsD,KAAT,IAAkBvB;AADrB;AARC,SAAZ;AAYH,OAfD;AAgBA,aAAOpB,MAAP;AACH;AAtBF,GAtF2B,EA6G3B;AACCjB,IAAAA,GAAG,EAAE,wBADN;AAECc,IAAAA,KAAK,EAAE,UAASuB,KAAT,EAAgBvB,KAAhB,EAAuB;AAC1B,UAAIsC,IAAI,GAAG,IAAX;AACA,UAAInC,MAAM,GAAG,IAAIpC,SAAS,CAACgF,QAAd,EAAb;AACA,OAAC,GAAGtF,SAAS,CAAC2D,IAAd,EAAoB,KAAKC,YAAL,EAApB,EAAyC,UAASC,CAAT,EAAY9B,QAAZ,EAAsB;AAC3D,YAAI2B,aAAa,GAAGmB,IAAI,CAACd,QAAL,CAAchC,QAAd,CAApB;;AACA,YAAI2B,aAAa,KAAKI,KAAtB,EAA6B;AACzB,cAAItB,UAAU,GAAGqC,IAAI,CAACK,wBAAL,CAA8BnD,QAAQ,CAACS,UAAvC,CAAjB;;AACA,cAAIR,SAAS,GAAGF,YAAY,CAACC,QAAD,CAA5B;;AACA,cAAI,CAAC8C,IAAI,CAACxC,eAAL,CAAqByB,KAArB,CAAL,EAAkC;AAC9Be,YAAAA,IAAI,CAACxC,eAAL,CAAqByB,KAArB,IAA8BtB,UAAU,CAAC+C,IAAX,EAA9B;AACH;;AACDV,UAAAA,IAAI,CAACxC,eAAL,CAAqByB,KAArB,EAA4B0B,IAA5B,CAAiC,UAASvC,IAAT,EAAe;AAC5C,gBAAIwC,YAAY,GAAG,CAAC,GAAGvF,MAAM,CAACR,OAAX,EAAoBuD,IAApB,EAA0BD,MAA1B,CAAiChB,SAAjC,EAA4CO,KAA5C,EAAmDmD,OAAnD,EAAnB;AACA,mBAAOb,IAAI,CAACxC,eAAL,CAAqByB,KAArB,CAAP;AACApB,YAAAA,MAAM,CAACiD,OAAP,CAAeF,YAAY,CAAC,CAAD,CAA3B;AACH,WAJD,EAIGG,IAJH,CAIQ,YAAW;AACf,mBAAOf,IAAI,CAACxC,eAAL,CAAqByB,KAArB,CAAP;AACApB,YAAAA,MAAM,CAACmD,MAAP;AACH,WAPD;;AAQA,iBAAO,KAAP;AACH;AACJ,OAlBD;AAmBA,aAAOnD,MAAM,CAACoD,OAAP,EAAP;AACH;AAzBF,GA7G2B,EAuI3B;AACCrE,IAAAA,GAAG,EAAE,oBADN;AAECc,IAAAA,KAAK,EAAE,UAASwD,QAAT,EAAmB3D,SAAnB,EAA8B;AACjC,UAAI4D,eAAe,GAAG,KAAK7B,cAAL,CAAoBM,MAA1C;;AACA,WAAK,IAAIwB,IAAT,IAAiB7D,SAAjB,EAA4B;AACxB,YAAIb,MAAM,CAACM,SAAP,CAAiBqE,cAAjB,CAAgCC,IAAhC,CAAqC/D,SAArC,EAAgD6D,IAAhD,CAAJ,EAA2D;AACvD,cAAIG,YAAY,GAAGhE,SAAS,CAAC6D,IAAD,CAA5B;AACAD,UAAAA,eAAe,CAACC,IAAD,CAAf,CAAsBF,QAAtB,EAAgC,KAAKM,mBAAL,CAAyBJ,IAAzB,IAAiC,CAAC,GAAGtG,MAAM,CAAC2G,WAAX,EAAwBF,YAAxB,CAAjC,GAAyEA,YAAzG;AACH;AACJ;AACJ;AAVF,GAvI2B,EAkJ3B;AACC3E,IAAAA,GAAG,EAAE,sBADN;AAECc,IAAAA,KAAK,EAAE,UAASwD,QAAT,EAAmBQ,yBAAnB,EAA8C;AACjD,UAAIC,KAAK,GAAG,IAAZ;;AACA,UAAI9D,MAAM,GAAG,IAAb;;AACA,UAAI,CAAC,CAAC,GAAG5C,KAAK,CAAC2G,SAAV,EAAqBF,yBAArB,CAAL,EAAsD;AAClDA,QAAAA,yBAAyB,GAAG,KAA5B;AACH;;AACD,WAAK7B,eAAL,CAAqBgC,OAArB,CAA6B,UAAS5C,KAAT,EAAgB;AACzC,SAAC,GAAG9D,SAAS,CAAC2D,IAAd,EAAoBoC,QAApB,EAA8B,UAASY,SAAT,EAAoBC,UAApB,EAAgC;AAC1D,cAAIC,UAAU,GAAG,EAAjB;AACAA,UAAAA,UAAU,CAACF,SAAD,CAAV,GAAwBC,UAAxB;;AACA,cAAIR,YAAY,GAAGI,KAAK,CAACM,gBAAN,CAAuBhD,KAAvB,EAA8B,QAA9B,EAAwC+C,UAAxC,CAAnB;;AACA,cAAI,CAAC,GAAG/G,KAAK,CAAC2G,SAAV,EAAqBL,YAArB,CAAJ,EAAwC;AACpC,gBAAI,CAAC1D,MAAL,EAAa;AACTA,cAAAA,MAAM,GAAG,EAAT;AACH;;AACD,gBAAI,MAAM0D,YAAY,CAAClF,MAAvB,EAA+B;AAC3BkF,cAAAA,YAAY,GAAGA,YAAY,CAAC,CAAD,CAA3B;AACH;;AACD,gBAAI,CAACG,yBAAD,IAA8BA,yBAAyB,IAAIC,KAAK,CAACH,mBAAN,CAA0BvC,KAA1B,CAA/D,EAAiG;AAC7F0C,cAAAA,KAAK,CAACM,gBAAN,CAAuBhD,KAAvB,EAA8B,QAA9B,EAAwC+C,UAAxC,EAAoD,CAAC,GAAGlH,MAAM,CAAC2G,WAAX,EAAwBF,YAAxB,CAApD;AACH,aAFD,MAEO;AACHI,cAAAA,KAAK,CAACM,gBAAN,CAAuBhD,KAAvB,EAA8B,QAA9B,EAAwC+C,UAAxC,EAAoDT,YAApD;AACH;;AAAA,aAAC,GAAGnG,OAAO,CAAC8G,MAAZ,EAAoBrE,MAApB,EAA4BmE,UAA5B;AACD,mBAAO,IAAP;AACH;AACJ,SAlBD;AAmBH,OApBD;;AAqBA,aAAOnE,MAAP;AACH;AA9BF,GAlJ2B,EAiL3B;AACCjB,IAAAA,GAAG,EAAE,eADN;AAECc,IAAAA,KAAK,EAAE,UAASyE,MAAT,EAAiB;AACpB,UAAItE,MAAM,GAAG,IAAIpC,SAAS,CAACgF,QAAd,EAAb;AACA,UAAIT,IAAI,GAAG,IAAX;AACA,UAAIoC,SAAS,GAAG,EAAhB;AACA,OAAC,GAAGjH,SAAS,CAAC2D,IAAd,EAAoB,KAAKuD,oBAAL,CAA0BF,MAA1B,CAApB,EAAuD,UAAS/F,CAAT,EAAYc,QAAZ,EAAsB;AACzE,YAAIoF,QAAQ,GAAG,IAAI7G,SAAS,CAACgF,QAAd,EAAf;AACA,YAAIxB,KAAK,GAAGe,IAAI,CAACd,QAAL,CAAchC,QAAd,CAAZ;AACAkF,QAAAA,SAAS,CAACjC,IAAV,CAAemC,QAAf;;AACAtC,QAAAA,IAAI,CAACK,wBAAL,CAA8BnD,QAAQ,CAACS,UAAvC,EAAmD+C,IAAnD,GAA0DC,IAA1D,CAA+D,UAASvC,IAAT,EAAe;AAC1EkE,UAAAA,QAAQ,CAACxB,OAAT,CAAiB;AACbM,YAAAA,IAAI,EAAEnC,KADO;AAEbsD,YAAAA,KAAK,EAAEvC,IAAI,CAACwC,gBAAL,CAAsBtF,QAAtB,EAAgCkB,IAAhC,CAFM;AAGbA,YAAAA,IAAI,EAAEA;AAHO,WAAjB;AAKH,SAND,EAMG2C,IANH,CAMQ,YAAW;AACfuB,UAAAA,QAAQ,CAACtB,MAAT;AACH,SARD;AASH,OAbD;;AAcA,UAAI,CAACoB,SAAS,CAAC/F,MAAf,EAAuB;AACnB2D,QAAAA,IAAI,CAACD,cAAL,GAAsB,EAAtB;AACA,eAAOlC,MAAM,CAACiD,OAAP,CAAe,EAAf,CAAP;AACH;;AACDrF,MAAAA,SAAS,CAACgH,IAAV,CAAeC,KAAf,CAAqB,IAArB,EAA2BN,SAA3B,EAAsCzB,IAAtC,CAA2C,YAAW;AAClD,YAAIvC,IAAI,GAAGH,KAAK,CAACjB,SAAN,CAAgB2F,KAAhB,CAAsBrB,IAAtB,CAA2BsB,SAA3B,CAAX;;AACA,YAAIC,WAAW,GAAG,UAASlH,GAAT,EAAc;AAC5B,iBAAO;AACHyF,YAAAA,IAAI,EAAEzF,GAAG,CAACyF,IADP;AAEHmB,YAAAA,KAAK,EAAE5G,GAAG,CAAC4G,KAFR;AAGHnE,YAAAA,IAAI,EAAEzC,GAAG,CAACyC;AAHP,WAAP;AAKH,SAND;;AAOA4B,QAAAA,IAAI,CAACD,cAAL,GAAsB3B,IAAtB;AACAP,QAAAA,MAAM,CAACiD,OAAP,CAAe1C,IAAI,CAACI,GAAL,CAASqE,WAAT,CAAf;AACH,OAXD,EAWG9B,IAXH,CAWQ,YAAW;AACflD,QAAAA,MAAM,CAACmD,MAAP;AACH,OAbD;;AAcA,aAAOnD,MAAM,CAACoD,OAAP,EAAP;AACH;AAvCF,GAjL2B,EAyN3B;AACCrE,IAAAA,GAAG,EAAE,sBADN;AAECc,IAAAA,KAAK,EAAE,UAASoF,MAAT,EAAiB;AACpB,aAAO,CAAC,GAAG9H,OAAO,CAAC+H,IAAZ,EAAkB,KAAKhE,YAAL,EAAlB,EAAuC,UAAS7B,QAAT,EAAmB;AAC7D,YAAI+B,KAAK,GAAG,KAAKC,QAAL,CAAchC,QAAd,CAAZ;AACA,eAAO,CAAC,GAAGpC,MAAM,CAACkI,OAAX,EAAoB/D,KAApB,EAA2B6D,MAA3B,IAAqC,CAAC,CAA7C;AACH,OAH6C,CAG5C1D,IAH4C,CAGvC,IAHuC,CAAvC,CAAP;AAIH;AAPF,GAzN2B,EAiO3B;AACCxC,IAAAA,GAAG,EAAE,oBADN;AAECc,IAAAA,KAAK,EAAE,UAASuB,KAAT,EAAgB;AACnB,aAAO,KAAKoD,oBAAL,CAA0B,CAACpD,KAAD,CAA1B,EAAmC,CAAnC,KAAyC,EAAhD;AACH;AAJF,GAjO2B,EAsO3B;AACCrC,IAAAA,GAAG,EAAE,kBADN;AAECc,IAAAA,KAAK,EAAE,UAASuB,KAAT,EAAgBvB,KAAhB,EAAuB;AAC1B,UAAIP,SAAS,GAAG,KAAK8F,kBAAL,CAAwBhE,KAAxB,EAA+B9B,SAA/B,IAA4C,IAA5D;AACA,UAAIkB,WAAW,GAAG,CAAC,GAAG9C,KAAK,CAAC+C,aAAV,EAAyBnB,SAAzB,CAAlB;AACA,UAAI+F,SAAS,GAAG,KAAKD,kBAAL,CAAwBhE,KAAxB,EAA+BiE,SAA/B,IAA4C,OAA5D;AACA,UAAIC,WAAW,GAAG,CAAC,GAAG5H,KAAK,CAAC+C,aAAV,EAAyB4E,SAAzB,CAAlB;AACA,UAAIrF,MAAM,GAAG,IAAIpC,SAAS,CAACgF,QAAd,EAAb;;AACA,UAAIc,YAAY,GAAG,KAAKrB,uBAAL,CAA6BjB,KAA7B,CAAnB;;AACA,UAAImE,kBAAkB,GAAG7B,YAAY,CAAClF,MAAtC;AACA,UAAIuC,KAAJ;;AACA,UAAIwE,kBAAJ,EAAwB;AACpB,aAAK,IAAIhH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgH,kBAApB,EAAwChH,CAAC,EAAzC,EAA6C;AACzC,cAAIiC,WAAW,CAACkD,YAAY,CAACnF,CAAD,CAAb,CAAX,KAAiCsB,KAArC,EAA4C;AACxCkB,YAAAA,KAAK,GAAGuE,WAAW,CAAC5B,YAAY,CAACnF,CAAD,CAAb,CAAnB;AACA;AACH;AACJ;;AACDyB,QAAAA,MAAM,CAACiD,OAAP,CAAelC,KAAf;AACH,OARD,MAQO;AACH,aAAKyE,sBAAL,CAA4BpE,KAA5B,EAAmCvB,KAAnC,EAA0CiD,IAA1C,CAA+C,UAASY,YAAT,EAAuB;AAClE,cAAIA,YAAJ,EAAkB;AACd3C,YAAAA,KAAK,GAAGuE,WAAW,CAAC5B,YAAD,CAAnB;AACH;;AACD1D,UAAAA,MAAM,CAACiD,OAAP,CAAelC,KAAf;AACH,SALD,EAKGmC,IALH,CAKQ,YAAW;AACflD,UAAAA,MAAM,CAACmD,MAAP;AACH,SAPD;AAQH;;AACD,aAAOnD,MAAM,CAACoD,OAAP,EAAP;AACH;AA9BF,GAtO2B,EAqQ3B;AACCrE,IAAAA,GAAG,EAAE,wBADN;AAECc,IAAAA,KAAK,EAAE,UAASyE,MAAT,EAAiB;AACpB,UAAI5E,SAAS,GAAG,KAAKwB,YAAL,EAAhB;AACA,UAAIlB,MAAJ;AACA,OAAC,GAAG1C,SAAS,CAAC2D,IAAd,EAAoBvB,SAApB,EAA+B,UAAS+F,KAAT,EAAgBpG,QAAhB,EAA0B;AACrD,YAAIA,QAAQ,CAACqG,iBAAb,EAAgC;AAC5B1F,UAAAA,MAAM,GAAGX,QAAT;AACA,iBAAO,KAAP;AACH;AACJ,OALD;;AAMA,UAAI,CAACW,MAAL,EAAa;AACT,YAAII,KAAK,CAACC,OAAN,CAAciE,MAAd,KAAyBA,MAAM,CAAC9F,MAApC,EAA4C;AACxCkB,UAAAA,SAAS,GAAG,KAAK8E,oBAAL,CAA0BF,MAA1B,CAAZ;AACH;;AACDtE,QAAAA,MAAM,GAAGN,SAAS,CAACA,SAAS,CAAClB,MAAV,GAAmB,CAApB,CAAlB;AACH;;AACD,aAAOwB,MAAP;AACH;AAlBF,GArQ2B,EAwR3B;AACCjB,IAAAA,GAAG,EAAE,qBADN;AAECc,IAAAA,KAAK,EAAE,UAASyE,MAAT,EAAiB;AACpB,UAAIqB,SAAS,GAAG,CAAhB;AACA,UAAIC,UAAU,GAAGA,UAAU,IAAI,CAA/B;;AAEA,eAASC,IAAT,CAAcC,KAAd,EAAqBF,UAArB,EAAiC5F,MAAjC,EAAyC+F,MAAzC,EAAiD;AAC7C/F,QAAAA,MAAM,GAAGA,MAAM,IAAI,EAAnB;;AACA,aAAK,IAAIzB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuH,KAAK,CAACpB,KAAN,CAAYlG,MAAhC,EAAwCD,CAAC,EAAzC,EAA6C;AACzC,cAAIyH,gBAAgB,GAAGF,KAAK,CAACpB,KAAN,CAAYnG,CAAZ,CAAvB;AACA,cAAI0H,UAAU,GAAG;AACb1C,YAAAA,IAAI,EAAEuC,KAAK,CAACvC,IADC;AAEb1D,YAAAA,KAAK,EAAEmG,gBAAgB,CAACnF,EAFX;AAGbqF,YAAAA,KAAK,EAAEF,gBAAgB,CAAClF,IAHX;AAIbP,YAAAA,IAAI,EAAEuF,KAAK,CAACvF,IAAN,IAAcuF,KAAK,CAACvF,IAAN,CAAWhC,CAAX,CAJP;AAKb4H,YAAAA,QAAQ,EAAE,EALG;AAMbJ,YAAAA,MAAM,EAAEA,MAAM,GAAGA,MAAH,GAAY;AANb,WAAjB;AAQA/F,UAAAA,MAAM,CAACsC,IAAP,CAAY2D,UAAZ;AACA,cAAIG,cAAc,GAAGR,UAAU,GAAG,CAAlC;;AACA,cAAItB,MAAM,CAAC8B,cAAD,CAAV,EAA4B;AACxBP,YAAAA,IAAI,CAACpC,IAAL,CAAU,IAAV,EAAgBa,MAAM,CAAC8B,cAAD,CAAtB,EAAwCA,cAAxC,EAAwDH,UAAU,CAACE,QAAnE,EAA6EF,UAA7E;AACH;;AACD,cAAI,CAACA,UAAU,CAACE,QAAX,CAAoB3H,MAAzB,EAAiC;AAC7ByH,YAAAA,UAAU,CAACN,SAAX,GAAuBA,SAAvB;AACAA,YAAAA,SAAS;AACZ;AACJ;;AACD,eAAO3F,MAAP;AACH;;AACD,aAAO6F,IAAI,CAACpC,IAAL,CAAU,IAAV,EAAgBa,MAAM,CAAC,CAAD,CAAtB,EAA2B,CAA3B,CAAP;AACH;AA/BF,GAxR2B,EAwT3B;AACCvF,IAAAA,GAAG,EAAE,eADN;AAECc,IAAAA,KAAK,EAAE,UAASwG,oBAAT,EAA+BC,SAA/B,EAA0CC,SAA1C,EAAqD;AACxD,UAAIT,KAAK,GAAG,KAAK1B,gBAAL,CAAsBkC,SAAtB,EAAiC,QAAjC,EAA2CD,oBAA3C,CAAZ;;AACA,UAAIP,KAAJ,EAAW;AACP,YAAI,CAAC,GAAG7I,MAAM,CAACkI,OAAX,EAAoBoB,SAApB,EAA+BT,KAA/B,IAAwC,CAAC,CAA7C,EAAgD;AAC5C,iBAAO,IAAP;AACH;AACJ;;AACD,aAAO,KAAP;AACH;AAVF,GAxT2B,EAmU3B;AACC/G,IAAAA,GAAG,EAAE,yBADN;AAECc,IAAAA,KAAK,EAAE,UAASoE,SAAT,EAAoB;AACvB,UAAIuC,eAAe,GAAG,KAAKC,gBAAL,EAAtB;AACA,UAAIC,mBAAmB,GAAG,EAA1B;;AACA,WAAK,IAAInI,CAAC,GAAG,CAAR,EAAWoI,aAAa,GAAGH,eAAe,CAAChI,MAAhD,EAAwDD,CAAC,GAAGoI,aAA5D,EAA2EpI,CAAC,EAA5E,EAAgF;AAC5E,YAAIiI,eAAe,CAACjI,CAAD,CAAf,CAAmBgF,IAAnB,KAA4BU,SAAhC,EAA2C;AACvCyC,UAAAA,mBAAmB,GAAGF,eAAe,CAACjI,CAAD,CAAf,CAAmBgC,IAAzC;AACA;AACH;AACJ;;AACD,aAAOmG,mBAAP;AACH;AAZF,GAnU2B,EAgV3B;AACC3H,IAAAA,GAAG,EAAE,uBADN;AAECc,IAAAA,KAAK,EAAE,UAAS+G,IAAT,EAAeP,oBAAf,EAAqCrG,MAArC,EAA6C;AAChDA,MAAAA,MAAM,GAAGA,MAAM,IAAI,EAAnB;;AACA,WAAK,IAAIzB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqI,IAAI,CAACpI,MAAzB,EAAiCD,CAAC,EAAlC,EAAsC;AAClC,YAAI,CAAC,KAAKsI,aAAL,CAAmBR,oBAAnB,EAAyCO,IAAI,CAACrI,CAAD,CAAJ,CAAQgF,IAAjD,EAAuDqD,IAAI,CAACrI,CAAD,CAAJ,CAAQsB,KAA/D,CAAL,EAA4E;AACxE;AACH;;AACD,YAAI,CAAC,GAAGzC,KAAK,CAAC2G,SAAV,EAAqB6C,IAAI,CAACrI,CAAD,CAAJ,CAAQoH,SAA7B,CAAJ,EAA6C;AACzC3F,UAAAA,MAAM,CAACsC,IAAP,CAAYsE,IAAI,CAACrI,CAAD,CAAJ,CAAQoH,SAApB;AACH;;AACD,YAAIiB,IAAI,CAACrI,CAAD,CAAJ,CAAQ4H,QAAZ,EAAsB;AAClB,eAAKW,qBAAL,CAA2BF,IAAI,CAACrI,CAAD,CAAJ,CAAQ4H,QAAnC,EAA6CE,oBAA7C,EAAmErG,MAAnE;AACH;AACJ;;AACD,aAAOA,MAAP;AACH;AAhBF,GAhV2B,EAiW3B;AACCjB,IAAAA,GAAG,EAAE,8BADN;AAECc,IAAAA,KAAK,EAAE,UAASkH,YAAT,EAAuBrH,SAAvB,EAAkC;AACrC,UAAIkH,IAAI,GAAG,KAAKI,mBAAL,CAAyBtH,SAAzB,CAAX;AACA,UAAIM,MAAM,GAAG,EAAb;AACA,OAAC,GAAG1C,SAAS,CAAC2D,IAAd,EAAoB8F,YAApB,EAAkC,UAAS5F,CAAT,EAAY8F,WAAZ,EAAyB;AACvD,YAAIZ,oBAAoB,GAAG,KAAKa,oBAAL,CAA0BD,WAA1B,CAA3B;AACA,YAAIE,UAAU,GAAG,KAAKL,qBAAL,CAA2BF,IAA3B,EAAiCP,oBAAjC,CAAjB;;AACA,aAAK,IAAI9H,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG4I,UAAU,CAAC3I,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,cAAI,CAACyB,MAAM,CAACmH,UAAU,CAAC5I,CAAD,CAAX,CAAX,EAA4B;AACxByB,YAAAA,MAAM,CAACmH,UAAU,CAAC5I,CAAD,CAAX,CAAN,GAAwB,EAAxB;AACH;;AACDyB,UAAAA,MAAM,CAACmH,UAAU,CAAC5I,CAAD,CAAX,CAAN,CAAsB+D,IAAtB,CAA2B,CAAC,GAAGjF,OAAO,CAAC+J,mBAAZ,EAAiC,EAAjC,EAAqCH,WAArC,EAAkD,IAAlD,CAA3B;AACH;AACJ,OATiC,CAShC1F,IATgC,CAS3B,IAT2B,CAAlC;AAUA,aAAOvB,MAAP;AACH;AAhBF,GAjW2B,EAkX3B;AACCjB,IAAAA,GAAG,EAAE,qBADN;AAECc,IAAAA,KAAK,EAAE,UAAS+G,IAAT,EAAeS,oBAAf,EAAqCC,OAArC,EAA8C;AACjDA,MAAAA,OAAO,GAAGA,OAAO,GAAGA,OAAO,CAACnB,QAAX,GAAsB,EAAvC;AACA,UAAIhE,IAAI,GAAG,IAAX;AACAyE,MAAAA,IAAI,CAAC5C,OAAL,CAAa,UAASuD,IAAT,EAAe9B,KAAf,EAAsB;AAC/B,YAAI+B,EAAE,GAAG,KAAT;AACA,YAAIC,YAAY,GAAGF,IAAI,CAAChE,IAAxB;AACA,YAAImE,aAAa,GAAGH,IAAI,CAAC1H,KAAzB;AACA,YAAI8H,aAAa,GAAGJ,IAAI,CAACrB,KAAzB;AACA,YAAIxC,YAAY,GAAG6D,IAAI,CAAChH,IAAxB;AACA,YAAIqH,cAAc,GAAGzF,IAAI,CAACiC,gBAAL,CAAsBqD,YAAtB,EAAoC,QAApC,CAArB;AACAJ,QAAAA,oBAAoB,CAACrD,OAArB,CAA6B,UAASiD,WAAT,EAAsB;AAC/C,cAAI,CAACO,EAAL,EAAS;AACL,gBAAIK,uBAAuB,GAAGD,cAAc,CAACX,WAAD,CAA5C;;AACA,gBAAI7G,KAAK,CAACC,OAAN,CAAcwH,uBAAd,CAAJ,EAA4C;AACxC,kBAAIA,uBAAuB,CAACC,OAAxB,CAAgCJ,aAAhC,IAAiD,CAAC,CAAtD,EAAyD;AACrDJ,gBAAAA,OAAO,CAAChF,IAAR,CAAa;AACTiB,kBAAAA,IAAI,EAAEkE,YADG;AAET5H,kBAAAA,KAAK,EAAE6H,aAFE;AAGTxB,kBAAAA,KAAK,EAAEyB,aAHE;AAITpH,kBAAAA,IAAI,EAAEmD,YAJG;AAKTyC,kBAAAA,QAAQ,EAAE;AALD,iBAAb;;AAOAqB,gBAAAA,EAAE,GAAG,IAAL;AACH;AACJ,aAXD,MAWO;AACH,kBAAIK,uBAAuB,KAAKH,aAAhC,EAA+C;AAC3CJ,gBAAAA,OAAO,CAAChF,IAAR,CAAa;AACTiB,kBAAAA,IAAI,EAAEkE,YADG;AAET5H,kBAAAA,KAAK,EAAE6H,aAFE;AAGTxB,kBAAAA,KAAK,EAAEyB,aAHE;AAITpH,kBAAAA,IAAI,EAAEmD,YAJG;AAKTyC,kBAAAA,QAAQ,EAAE;AALD,iBAAb;;AAOAqB,gBAAAA,EAAE,GAAG,IAAL;AACH;AACJ;AACJ;AACJ,SA3BD;;AA4BA,YAAIA,EAAE,IAAID,IAAI,CAACpB,QAAX,IAAuBoB,IAAI,CAACpB,QAAL,CAAc3H,MAAzC,EAAiD;AAC7C2D,UAAAA,IAAI,CAAC4F,mBAAL,CAAyBR,IAAI,CAACpB,QAA9B,EAAwCkB,oBAAxC,EAA8DC,OAAO,CAAC7B,KAAD,CAArE;AACH;AACJ,OAtCD;AAuCA,aAAO6B,OAAP;AACH;AA7CF,GAlX2B,EAga3B;AACCvI,IAAAA,GAAG,EAAE,0BADN;AAECc,IAAAA,KAAK,EAAE,UAASyE,MAAT,EAAiB;AACpB,UAAI0D,MAAM,GAAG,IAAb;;AACA,UAAIC,aAAa,GAAG,KAAKxB,gBAAL,EAApB;;AACA,UAAI,CAACnC,MAAL,EAAa;AACT,eAAO2D,aAAP;AACH;;AACD,UAAIC,UAAU,GAAGrJ,MAAM,CAACsJ,mBAAP,CAA2B7D,MAA3B,CAAjB;AACA,UAAIZ,YAAY,GAAGuE,aAAa,CAAC3H,MAAd,CAAqB,UAASM,IAAT,EAAe;AACnD,eAAOsH,UAAU,CAACJ,OAAX,CAAmBlH,IAAI,CAAC2C,IAAxB,MAAkC,CAAC,CAA1C;AACH,OAFkB,CAAnB;AAGA,UAAI6E,oBAAoB,GAAG,EAA3B;AACA1E,MAAAA,YAAY,CAACM,OAAb,CAAqB,UAASzD,IAAT,EAAe;AAChC,eAAO6H,oBAAoB,CAAC9F,IAArB,CAA0B,CAAC,GAAG/E,OAAO,CAAC8G,MAAZ,EAAoB,EAApB,EAAwB9D,IAAxB,CAA1B,CAAP;AACH,OAFD;AAGA,OAAC,GAAGjD,SAAS,CAAC2D,IAAd,EAAoBqD,MAApB,EAA4B,UAASnD,CAAT,EAAYtB,KAAZ,EAAmB;AAC3CuI,QAAAA,oBAAoB,CAACpE,OAArB,CAA6B,UAASN,YAAT,EAAuB;AAChD,cAAIgB,KAAK,GAAGhB,YAAY,CAACgB,KAAzB;AAAA,cACInE,IAAI,GAAGmD,YAAY,CAACnD,IADxB;AAAA,cAEIgD,IAAI,GAAGG,YAAY,CAACH,IAFxB;;AAGA,cAAIlE,QAAQ,GAAG2I,MAAM,CAAC5C,kBAAP,CAA0B7B,IAA1B,CAAf;;AACA,cAAIjE,SAAS,GAAGF,YAAY,CAACC,QAAD,CAA5B;AACA,cAAIgJ,YAAY,GAAG3D,KAAK,CAACpE,MAAN,CAAa,UAASM,IAAT,EAAe;AAC3C,mBAAOA,IAAI,CAACC,EAAL,KAAYhB,KAAnB;AACH,WAFkB,CAAnB;AAGA,cAAIyI,WAAW,GAAG/H,IAAI,CAACD,MAAL,CAAY,UAASM,IAAT,EAAe;AACzC,mBAAOA,IAAI,CAACtB,SAAD,CAAJ,KAAoBO,KAA3B;AACH,WAFiB,CAAlB;AAGA6D,UAAAA,YAAY,CAACgB,KAAb,GAAqB2D,YAArB;AACA3E,UAAAA,YAAY,CAACnD,IAAb,GAAoB+H,WAApB;AACH,SAdD;AAeH,OAhBD;AAiBA,aAAOF,oBAAP;AACH;AAlCF,GAha2B,CAAlB,CAAZ;;AAocA,SAAO3I,eAAP;AACH,CA3cqB,EAAtB;;AA4cA1C,OAAO,CAACC,OAAR,GAAkByC,eAAlB;AACA8I,MAAM,CAACxL,OAAP,GAAiBA,OAAO,CAACC,OAAzB","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/ui.scheduler.resource_manager.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _object = require(\"../../core/utils/object\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _query = _interopRequireDefault(require(\"../../data/query\"));\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _data_source = require(\"../../data/data_source/data_source\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _utils = require(\"../../data/data_source/utils\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n        throw new TypeError(\"Cannot call a class as a function\")\r\n    }\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n    for (var i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if (\"value\" in descriptor) {\r\n            descriptor.writable = true\r\n        }\r\n        Object.defineProperty(target, descriptor.key, descriptor)\r\n    }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n    if (protoProps) {\r\n        _defineProperties(Constructor.prototype, protoProps)\r\n    }\r\n    if (staticProps) {\r\n        _defineProperties(Constructor, staticProps)\r\n    }\r\n    return Constructor\r\n}\r\nvar getValueExpr = function(resource) {\r\n    return resource.valueExpr || \"id\"\r\n};\r\nvar getDisplayExpr = function(resource) {\r\n    return resource.displayExpr || \"text\"\r\n};\r\nvar ResourceManager = function() {\r\n    function ResourceManager(resources) {\r\n        _classCallCheck(this, ResourceManager);\r\n        this._resourceLoader = {};\r\n        this.setResources(resources)\r\n    }\r\n    _createClass(ResourceManager, [{\r\n        key: \"_createWrappedDataSource\",\r\n        value: function(dataSource) {\r\n            if (dataSource instanceof _data_source.DataSource) {\r\n                return dataSource\r\n            }\r\n            var result = {\r\n                store: (0, _utils.normalizeDataSourceOptions)(dataSource).store,\r\n                pageSize: 0\r\n            };\r\n            if (!Array.isArray(dataSource)) {\r\n                result.filter = dataSource.filter\r\n            }\r\n            return new _data_source.DataSource(result)\r\n        }\r\n    }, {\r\n        key: \"_mapResourceData\",\r\n        value: function(resource, data) {\r\n            var valueGetter = (0, _data.compileGetter)(getValueExpr(resource));\r\n            var displayGetter = (0, _data.compileGetter)(getDisplayExpr(resource));\r\n            return (0, _iterator.map)(data, function(item) {\r\n                var result = {\r\n                    id: valueGetter(item),\r\n                    text: displayGetter(item)\r\n                };\r\n                if (item.color) {\r\n                    result.color = item.color\r\n                }\r\n                return result\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_isMultipleResource\",\r\n        value: function(resourceField) {\r\n            var result = false;\r\n            (0, _iterator.each)(this.getResources(), function(_, resource) {\r\n                var field = this.getField(resource);\r\n                if (field === resourceField) {\r\n                    result = resource.allowMultiple;\r\n                    return false\r\n                }\r\n            }.bind(this));\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"getDataAccessors\",\r\n        value: function(field, type) {\r\n            var result = null;\r\n            (0, _iterator.each)(this._dataAccessors[type], function(accessorName, accessors) {\r\n                if (field === accessorName) {\r\n                    result = accessors;\r\n                    return false\r\n                }\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"getField\",\r\n        value: function(resource) {\r\n            return resource.fieldExpr || resource.field\r\n        }\r\n    }, {\r\n        key: \"setResources\",\r\n        value: function(resources) {\r\n            this._resources = resources;\r\n            this._dataAccessors = {\r\n                getter: {},\r\n                setter: {}\r\n            };\r\n            this._resourceFields = (0, _iterator.map)(resources || [], function(resource) {\r\n                var field = this.getField(resource);\r\n                this._dataAccessors.getter[field] = (0, _data.compileGetter)(field);\r\n                this._dataAccessors.setter[field] = (0, _data.compileSetter)(field);\r\n                return field\r\n            }.bind(this))\r\n        }\r\n    }, {\r\n        key: \"getResources\",\r\n        value: function() {\r\n            return this._resources || []\r\n        }\r\n    }, {\r\n        key: \"getResourcesData\",\r\n        value: function() {\r\n            return this._resourcesData || []\r\n        }\r\n    }, {\r\n        key: \"getEditors\",\r\n        value: function() {\r\n            var result = [];\r\n            var that = this;\r\n            (0, _iterator.each)(this.getResources(), function(i, resource) {\r\n                var field = that.getField(resource);\r\n                var currentResourceItems = that._getResourceDataByField(field);\r\n                result.push({\r\n                    editorOptions: {\r\n                        dataSource: currentResourceItems.length ? currentResourceItems : that._createWrappedDataSource(resource.dataSource),\r\n                        displayExpr: getDisplayExpr(resource),\r\n                        valueExpr: getValueExpr(resource)\r\n                    },\r\n                    dataField: field,\r\n                    editorType: resource.allowMultiple ? \"dxTagBox\" : \"dxSelectBox\",\r\n                    label: {\r\n                        text: resource.label || field\r\n                    }\r\n                })\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"getResourceDataByValue\",\r\n        value: function(field, value) {\r\n            var that = this;\r\n            var result = new _deferred.Deferred;\r\n            (0, _iterator.each)(this.getResources(), function(_, resource) {\r\n                var resourceField = that.getField(resource);\r\n                if (resourceField === field) {\r\n                    var dataSource = that._createWrappedDataSource(resource.dataSource);\r\n                    var valueExpr = getValueExpr(resource);\r\n                    if (!that._resourceLoader[field]) {\r\n                        that._resourceLoader[field] = dataSource.load()\r\n                    }\r\n                    that._resourceLoader[field].done(function(data) {\r\n                        var filteredData = (0, _query.default)(data).filter(valueExpr, value).toArray();\r\n                        delete that._resourceLoader[field];\r\n                        result.resolve(filteredData[0])\r\n                    }).fail(function() {\r\n                        delete that._resourceLoader[field];\r\n                        result.reject()\r\n                    });\r\n                    return false\r\n                }\r\n            });\r\n            return result.promise()\r\n        }\r\n    }, {\r\n        key: \"setResourcesToItem\",\r\n        value: function(itemData, resources) {\r\n            var resourcesSetter = this._dataAccessors.setter;\r\n            for (var name in resources) {\r\n                if (Object.prototype.hasOwnProperty.call(resources, name)) {\r\n                    var resourceData = resources[name];\r\n                    resourcesSetter[name](itemData, this._isMultipleResource(name) ? (0, _array.wrapToArray)(resourceData) : resourceData)\r\n                }\r\n            }\r\n        }\r\n    }, {\r\n        key: \"getResourcesFromItem\",\r\n        value: function(itemData, wrapOnlyMultipleResources) {\r\n            var _this = this;\r\n            var result = null;\r\n            if (!(0, _type.isDefined)(wrapOnlyMultipleResources)) {\r\n                wrapOnlyMultipleResources = false\r\n            }\r\n            this._resourceFields.forEach(function(field) {\r\n                (0, _iterator.each)(itemData, function(fieldName, fieldValue) {\r\n                    var tempObject = {};\r\n                    tempObject[fieldName] = fieldValue;\r\n                    var resourceData = _this.getDataAccessors(field, \"getter\")(tempObject);\r\n                    if ((0, _type.isDefined)(resourceData)) {\r\n                        if (!result) {\r\n                            result = {}\r\n                        }\r\n                        if (1 === resourceData.length) {\r\n                            resourceData = resourceData[0]\r\n                        }\r\n                        if (!wrapOnlyMultipleResources || wrapOnlyMultipleResources && _this._isMultipleResource(field)) {\r\n                            _this.getDataAccessors(field, \"setter\")(tempObject, (0, _array.wrapToArray)(resourceData))\r\n                        } else {\r\n                            _this.getDataAccessors(field, \"setter\")(tempObject, resourceData)\r\n                        }(0, _extend.extend)(result, tempObject);\r\n                        return true\r\n                    }\r\n                })\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"loadResources\",\r\n        value: function(groups) {\r\n            var result = new _deferred.Deferred;\r\n            var that = this;\r\n            var deferreds = [];\r\n            (0, _iterator.each)(this.getResourcesByFields(groups), function(i, resource) {\r\n                var deferred = new _deferred.Deferred;\r\n                var field = that.getField(resource);\r\n                deferreds.push(deferred);\r\n                that._createWrappedDataSource(resource.dataSource).load().done(function(data) {\r\n                    deferred.resolve({\r\n                        name: field,\r\n                        items: that._mapResourceData(resource, data),\r\n                        data: data\r\n                    })\r\n                }).fail(function() {\r\n                    deferred.reject()\r\n                })\r\n            });\r\n            if (!deferreds.length) {\r\n                that._resourcesData = [];\r\n                return result.resolve([])\r\n            }\r\n            _deferred.when.apply(null, deferreds).done(function() {\r\n                var data = Array.prototype.slice.call(arguments);\r\n                var mapFunction = function(obj) {\r\n                    return {\r\n                        name: obj.name,\r\n                        items: obj.items,\r\n                        data: obj.data\r\n                    }\r\n                };\r\n                that._resourcesData = data;\r\n                result.resolve(data.map(mapFunction))\r\n            }).fail(function() {\r\n                result.reject()\r\n            });\r\n            return result.promise()\r\n        }\r\n    }, {\r\n        key: \"getResourcesByFields\",\r\n        value: function(fields) {\r\n            return (0, _common.grep)(this.getResources(), function(resource) {\r\n                var field = this.getField(resource);\r\n                return (0, _array.inArray)(field, fields) > -1\r\n            }.bind(this))\r\n        }\r\n    }, {\r\n        key: \"getResourceByField\",\r\n        value: function(field) {\r\n            return this.getResourcesByFields([field])[0] || {}\r\n        }\r\n    }, {\r\n        key: \"getResourceColor\",\r\n        value: function(field, value) {\r\n            var valueExpr = this.getResourceByField(field).valueExpr || \"id\";\r\n            var valueGetter = (0, _data.compileGetter)(valueExpr);\r\n            var colorExpr = this.getResourceByField(field).colorExpr || \"color\";\r\n            var colorGetter = (0, _data.compileGetter)(colorExpr);\r\n            var result = new _deferred.Deferred;\r\n            var resourceData = this._getResourceDataByField(field);\r\n            var resourceDataLength = resourceData.length;\r\n            var color;\r\n            if (resourceDataLength) {\r\n                for (var i = 0; i < resourceDataLength; i++) {\r\n                    if (valueGetter(resourceData[i]) === value) {\r\n                        color = colorGetter(resourceData[i]);\r\n                        break\r\n                    }\r\n                }\r\n                result.resolve(color)\r\n            } else {\r\n                this.getResourceDataByValue(field, value).done(function(resourceData) {\r\n                    if (resourceData) {\r\n                        color = colorGetter(resourceData)\r\n                    }\r\n                    result.resolve(color)\r\n                }).fail(function() {\r\n                    result.reject()\r\n                })\r\n            }\r\n            return result.promise()\r\n        }\r\n    }, {\r\n        key: \"getResourceForPainting\",\r\n        value: function(groups) {\r\n            var resources = this.getResources();\r\n            var result;\r\n            (0, _iterator.each)(resources, function(index, resource) {\r\n                if (resource.useColorAsDefault) {\r\n                    result = resource;\r\n                    return false\r\n                }\r\n            });\r\n            if (!result) {\r\n                if (Array.isArray(groups) && groups.length) {\r\n                    resources = this.getResourcesByFields(groups)\r\n                }\r\n                result = resources[resources.length - 1]\r\n            }\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"createResourcesTree\",\r\n        value: function(groups) {\r\n            var leafIndex = 0;\r\n            var groupIndex = groupIndex || 0;\r\n\r\n            function make(group, groupIndex, result, parent) {\r\n                result = result || [];\r\n                for (var i = 0; i < group.items.length; i++) {\r\n                    var currentGroupItem = group.items[i];\r\n                    var resultItem = {\r\n                        name: group.name,\r\n                        value: currentGroupItem.id,\r\n                        title: currentGroupItem.text,\r\n                        data: group.data && group.data[i],\r\n                        children: [],\r\n                        parent: parent ? parent : null\r\n                    };\r\n                    result.push(resultItem);\r\n                    var nextGroupIndex = groupIndex + 1;\r\n                    if (groups[nextGroupIndex]) {\r\n                        make.call(this, groups[nextGroupIndex], nextGroupIndex, resultItem.children, resultItem)\r\n                    }\r\n                    if (!resultItem.children.length) {\r\n                        resultItem.leafIndex = leafIndex;\r\n                        leafIndex++\r\n                    }\r\n                }\r\n                return result\r\n            }\r\n            return make.call(this, groups[0], 0)\r\n        }\r\n    }, {\r\n        key: \"_hasGroupItem\",\r\n        value: function(appointmentResources, groupName, itemValue) {\r\n            var group = this.getDataAccessors(groupName, \"getter\")(appointmentResources);\r\n            if (group) {\r\n                if ((0, _array.inArray)(itemValue, group) > -1) {\r\n                    return true\r\n                }\r\n            }\r\n            return false\r\n        }\r\n    }, {\r\n        key: \"_getResourceDataByField\",\r\n        value: function(fieldName) {\r\n            var loadedResources = this.getResourcesData();\r\n            var currentResourceData = [];\r\n            for (var i = 0, resourceCount = loadedResources.length; i < resourceCount; i++) {\r\n                if (loadedResources[i].name === fieldName) {\r\n                    currentResourceData = loadedResources[i].data;\r\n                    break\r\n                }\r\n            }\r\n            return currentResourceData\r\n        }\r\n    }, {\r\n        key: \"getResourceTreeLeaves\",\r\n        value: function(tree, appointmentResources, result) {\r\n            result = result || [];\r\n            for (var i = 0; i < tree.length; i++) {\r\n                if (!this._hasGroupItem(appointmentResources, tree[i].name, tree[i].value)) {\r\n                    continue\r\n                }\r\n                if ((0, _type.isDefined)(tree[i].leafIndex)) {\r\n                    result.push(tree[i].leafIndex)\r\n                }\r\n                if (tree[i].children) {\r\n                    this.getResourceTreeLeaves(tree[i].children, appointmentResources, result)\r\n                }\r\n            }\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"groupAppointmentsByResources\",\r\n        value: function(appointments, resources) {\r\n            var tree = this.createResourcesTree(resources);\r\n            var result = {};\r\n            (0, _iterator.each)(appointments, function(_, appointment) {\r\n                var appointmentResources = this.getResourcesFromItem(appointment);\r\n                var treeLeaves = this.getResourceTreeLeaves(tree, appointmentResources);\r\n                for (var i = 0; i < treeLeaves.length; i++) {\r\n                    if (!result[treeLeaves[i]]) {\r\n                        result[treeLeaves[i]] = []\r\n                    }\r\n                    result[treeLeaves[i]].push((0, _object.deepExtendArraySafe)({}, appointment, true))\r\n                }\r\n            }.bind(this));\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"reduceResourcesTree\",\r\n        value: function(tree, existingAppointments, _result) {\r\n            _result = _result ? _result.children : [];\r\n            var that = this;\r\n            tree.forEach(function(node, index) {\r\n                var ok = false;\r\n                var resourceName = node.name;\r\n                var resourceValue = node.value;\r\n                var resourceTitle = node.title;\r\n                var resourceData = node.data;\r\n                var resourceGetter = that.getDataAccessors(resourceName, \"getter\");\r\n                existingAppointments.forEach(function(appointment) {\r\n                    if (!ok) {\r\n                        var resourceFromAppointment = resourceGetter(appointment);\r\n                        if (Array.isArray(resourceFromAppointment)) {\r\n                            if (resourceFromAppointment.indexOf(resourceValue) > -1) {\r\n                                _result.push({\r\n                                    name: resourceName,\r\n                                    value: resourceValue,\r\n                                    title: resourceTitle,\r\n                                    data: resourceData,\r\n                                    children: []\r\n                                });\r\n                                ok = true\r\n                            }\r\n                        } else {\r\n                            if (resourceFromAppointment === resourceValue) {\r\n                                _result.push({\r\n                                    name: resourceName,\r\n                                    value: resourceValue,\r\n                                    title: resourceTitle,\r\n                                    data: resourceData,\r\n                                    children: []\r\n                                });\r\n                                ok = true\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n                if (ok && node.children && node.children.length) {\r\n                    that.reduceResourcesTree(node.children, existingAppointments, _result[index])\r\n                }\r\n            });\r\n            return _result\r\n        }\r\n    }, {\r\n        key: \"getResourcesDataByGroups\",\r\n        value: function(groups) {\r\n            var _this2 = this;\r\n            var resourcesData = this.getResourcesData();\r\n            if (!groups) {\r\n                return resourcesData\r\n            }\r\n            var fieldNames = Object.getOwnPropertyNames(groups);\r\n            var resourceData = resourcesData.filter(function(item) {\r\n                return fieldNames.indexOf(item.name) !== -1\r\n            });\r\n            var currentResourcesData = [];\r\n            resourceData.forEach(function(data) {\r\n                return currentResourcesData.push((0, _extend.extend)({}, data))\r\n            });\r\n            (0, _iterator.each)(groups, function(_, value) {\r\n                currentResourcesData.forEach(function(resourceData) {\r\n                    var items = resourceData.items,\r\n                        data = resourceData.data,\r\n                        name = resourceData.name;\r\n                    var resource = _this2.getResourceByField(name);\r\n                    var valueExpr = getValueExpr(resource);\r\n                    var currentItems = items.filter(function(item) {\r\n                        return item.id === value\r\n                    });\r\n                    var currentData = data.filter(function(item) {\r\n                        return item[valueExpr] === value\r\n                    });\r\n                    resourceData.items = currentItems;\r\n                    resourceData.data = currentData\r\n                })\r\n            });\r\n            return currentResourcesData\r\n        }\r\n    }]);\r\n    return ResourceManager\r\n}();\r\nexports.default = ResourceManager;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}