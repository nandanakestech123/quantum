{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/appointmentSettingsGenerator.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nexports.AppointmentSettingsGeneratorVirtualStrategy = exports.AppointmentSettingsGeneratorBaseStrategy = exports.AppointmentSettingsGenerator = void 0;\n\nvar _date = _interopRequireDefault(require(\"../../core/utils/date\"));\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _recurrence = require(\"./recurrence\");\n\nvar _utilsTimeZone = _interopRequireDefault(require(\"./utils.timeZone.js\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _iterableToArray(iter) {\n  if (\"undefined\" !== typeof Symbol && Symbol.iterator in Object(iter)) {\n    return Array.from(iter);\n  }\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    return _arrayLikeToArray(arr);\n  }\n}\n\nfunction _get(target, property, receiver) {\n  if (\"undefined\" !== typeof Reflect && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function (target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) {\n        return;\n      }\n\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n\n    if (null === object) {\n      break;\n    }\n  }\n\n  return object;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (\"function\" !== typeof superClass && null !== superClass) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n\n  if (superClass) {\n    _setPrototypeOf(subClass, superClass);\n  }\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function (o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function () {\n    var result,\n        Super = _getPrototypeOf(Derived);\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (void 0 === self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (\"undefined\" === typeof Reflect || !Reflect.construct) {\n    return false;\n  }\n\n  if (Reflect.construct.sham) {\n    return false;\n  }\n\n  if (\"function\" === typeof Proxy) {\n    return true;\n  }\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function (o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) {\n    return;\n  }\n\n  if (\"string\" === typeof o) {\n    return _arrayLikeToArray(o, minLen);\n  }\n\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n\n  if (\"Object\" === n && o.constructor) {\n    n = o.constructor.name;\n  }\n\n  if (\"Map\" === n || \"Set\" === n) {\n    return Array.from(o);\n  }\n\n  if (\"Arguments\" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) {\n    return _arrayLikeToArray(o, minLen);\n  }\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (null == len || len > arr.length) {\n    len = arr.length;\n  }\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (\"undefined\" === typeof Symbol || !(Symbol.iterator in Object(arr))) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _e = void 0;\n\n  try {\n    for (var _s, _i = arr[Symbol.iterator](); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) {\n        break;\n      }\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && null != _i.return) {\n        _i.return();\n      }\n    } finally {\n      if (_d) {\n        throw _e;\n      }\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) {\n    return arr;\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar toMs = _date.default.dateToMilliseconds;\n\nvar AppointmentSettingsGenerator = function () {\n  function AppointmentSettingsGenerator(scheduler) {\n    _classCallCheck(this, AppointmentSettingsGenerator);\n\n    this.scheduler = scheduler;\n    this.settingsStrategy = this.scheduler.isVirtualScrolling() ? new AppointmentSettingsGeneratorVirtualStrategy(this.scheduler) : new AppointmentSettingsGeneratorBaseStrategy(this.scheduler);\n  }\n\n  _createClass(AppointmentSettingsGenerator, [{\n    key: \"create\",\n    value: function (rawAppointment) {\n      return this.settingsStrategy.create(rawAppointment);\n    }\n  }]);\n\n  return AppointmentSettingsGenerator;\n}();\n\nexports.AppointmentSettingsGenerator = AppointmentSettingsGenerator;\n\nvar AppointmentSettingsGeneratorBaseStrategy = function () {\n  function AppointmentSettingsGeneratorBaseStrategy(scheduler) {\n    _classCallCheck(this, AppointmentSettingsGeneratorBaseStrategy);\n\n    this.scheduler = scheduler;\n  }\n\n  _createClass(AppointmentSettingsGeneratorBaseStrategy, [{\n    key: \"create\",\n    value: function (rawAppointment) {\n      var scheduler = this.scheduler;\n      var appointment = scheduler.createAppointmentAdapter(rawAppointment);\n\n      var itemResources = scheduler._resourcesManager.getResourcesFromItem(rawAppointment);\n\n      var isAllDay = this._isAllDayAppointment(rawAppointment);\n\n      var appointmentList = this._createAppointments(appointment, itemResources);\n\n      if (this._canProcessNotNativeTimezoneDates(appointmentList, appointment)) {\n        appointmentList = this._getProcessedNotNativeTimezoneDates(appointmentList, appointment);\n      }\n\n      var gridAppointmentList = this._createGridAppointmentList(appointmentList);\n\n      gridAppointmentList = this._cropAppointmentsByStartDayHour(gridAppointmentList, rawAppointment, isAllDay);\n      gridAppointmentList = this._getProcessedLongAppointmentsIfRequired(gridAppointmentList, appointment);\n\n      var appointmentInfos = this._createAppointmentInfos(gridAppointmentList, itemResources, isAllDay, appointment.isRecurrent);\n\n      return appointmentInfos;\n    }\n  }, {\n    key: \"_isAllDayAppointment\",\n    value: function (rawAppointment) {\n      return this.scheduler.appointmentTakesAllDay(rawAppointment) && this.workspace.supportAllDayRow();\n    }\n  }, {\n    key: \"_createAppointments\",\n    value: function (appointment, resources) {\n      var appointments = this._createRecurrenceAppointments(appointment, resources);\n\n      if (!appointment.isRecurrent && 0 === appointments.length) {\n        appointments.push({\n          startDate: appointment.startDate,\n          endDate: appointment.endDate\n        });\n      }\n\n      appointments = appointments.map(function (item) {\n        var startDate = item.startDate,\n            endDate = item.endDate;\n        var endTime = null === endDate || void 0 === endDate ? void 0 : endDate.getTime();\n\n        if (startDate.getTime() === endTime) {\n          endDate.setTime(endTime + toMs(\"minute\"));\n        }\n\n        return item;\n      });\n      return appointments;\n    }\n  }, {\n    key: \"_canProcessNotNativeTimezoneDates\",\n    value: function (appointmentList, appointment) {\n      var timeZoneName = this.scheduler.option(\"timeZone\");\n      var isEqualLocalTimeZone = _utilsTimeZone.default.isEqualLocalTimeZone,\n          hasDSTInLocalTimeZone = _utilsTimeZone.default.hasDSTInLocalTimeZone;\n      var isRecurrence = appointmentList.length > 1;\n      var isTimeZoneSet = !(0, _type.isEmptyObject)(timeZoneName);\n\n      if (!isRecurrence) {\n        return false;\n      }\n\n      if (!isTimeZoneSet && hasDSTInLocalTimeZone()) {\n        return false;\n      }\n\n      return isTimeZoneSet && !isEqualLocalTimeZone(timeZoneName);\n    }\n  }, {\n    key: \"_getProcessedNotNativeDateIfCrossDST\",\n    value: function (date, offset) {\n      if (offset < 0) {\n        var newDate = new Date(date);\n        var newDateMinusOneHour = new Date(newDate);\n        newDateMinusOneHour.setHours(newDateMinusOneHour.getHours() - 1);\n        var newDateOffset = this.timeZoneCalculator.getOffsets(newDate).common;\n        var newDateMinusOneHourOffset = this.timeZoneCalculator.getOffsets(newDateMinusOneHour).common;\n\n        if (newDateOffset !== newDateMinusOneHourOffset) {\n          return 0;\n        }\n      }\n\n      return offset;\n    }\n  }, {\n    key: \"_getProcessedNotNativeTimezoneDates\",\n    value: function (appointmentList, appointment) {\n      var _this = this;\n\n      var startDateRange = appointment.startDate;\n      var endDateRange = appointmentList[appointmentList.length - 1].endDate;\n      var startDateRangeOffset = this.timeZoneCalculator.getOffsets(startDateRange).common;\n      var endDateRangeOffset = this.timeZoneCalculator.getOffsets(endDateRange).common;\n      var isChangeOffsetInRange = startDateRangeOffset !== endDateRangeOffset;\n\n      if (isChangeOffsetInRange) {\n        return appointmentList.map(function (a) {\n          var diffStartDateOffset = _this.timeZoneCalculator.getOffsets(appointment.startDate).common - _this.timeZoneCalculator.getOffsets(a.startDate).common;\n\n          var diffEndDateOffset = _this.timeZoneCalculator.getOffsets(appointment.endDate).common - _this.timeZoneCalculator.getOffsets(a.endDate).common;\n\n          diffStartDateOffset = _this._getProcessedNotNativeDateIfCrossDST(a.startDate, diffStartDateOffset);\n          diffEndDateOffset = _this._getProcessedNotNativeDateIfCrossDST(a.endDate, diffEndDateOffset);\n          var newStartDate = new Date(a.startDate.getTime() + diffStartDateOffset * toMs(\"hour\"));\n          var newEndDate = new Date(a.endDate.getTime() + diffEndDateOffset * toMs(\"hour\"));\n\n          var testNewStartDate = _this.timeZoneCalculator.createDate(newStartDate, {\n            path: \"toGrid\"\n          });\n\n          var testNewEndDate = _this.timeZoneCalculator.createDate(newEndDate, {\n            path: \"toGrid\"\n          });\n\n          if (appointment.duration > testNewEndDate.getTime() - testNewStartDate.getTime()) {\n            newEndDate = new Date(newStartDate.getTime() + appointment.duration);\n          }\n\n          return {\n            startDate: newStartDate,\n            endDate: newEndDate\n          };\n        });\n      }\n\n      return appointmentList;\n    }\n  }, {\n    key: \"_getProcessedLongAppointmentsIfRequired\",\n    value: function (gridAppointmentList, appointment) {\n      var _this2 = this;\n\n      var rawAppointment = appointment.source();\n      var allDay = this.scheduler.appointmentTakesAllDay(rawAppointment);\n      var dateRange = this.workspace.getDateRange();\n      var renderingStrategy = this.scheduler.getLayoutManager().getRenderingStrategyInstance();\n\n      if (renderingStrategy.needSeparateAppointment(allDay)) {\n        var longStartDateParts = [];\n        var resultDates = [];\n        gridAppointmentList.forEach(function (gridAppointment) {\n          var maxDate = new Date(dateRange[1]);\n          var endDateOfPart = renderingStrategy.normalizeEndDateByViewEnd(rawAppointment, gridAppointment.endDate);\n          longStartDateParts = _date.default.getDatesOfInterval(gridAppointment.startDate, endDateOfPart, {\n            milliseconds: _this2.scheduler.getWorkSpace().getIntervalDuration(allDay)\n          });\n          var list = longStartDateParts.filter(function (startDatePart) {\n            return new Date(startDatePart) < maxDate;\n          }).map(function (date) {\n            return {\n              startDate: date,\n              endDate: new Date(new Date(date).setMilliseconds(appointment.duration)),\n              source: gridAppointment.source\n            };\n          });\n          resultDates = resultDates.concat(list);\n        });\n        gridAppointmentList = resultDates;\n      }\n\n      return gridAppointmentList;\n    }\n  }, {\n    key: \"_createGridAppointmentList\",\n    value: function (appointmentList) {\n      var _this3 = this;\n\n      return appointmentList.map(function (source) {\n        var startDate = _this3.timeZoneCalculator.createDate(source.startDate, {\n          path: \"toGrid\"\n        });\n\n        var endDate = _this3.timeZoneCalculator.createDate(source.endDate, {\n          path: \"toGrid\"\n        });\n\n        return {\n          startDate: startDate,\n          endDate: endDate,\n          source: source\n        };\n      });\n    }\n  }, {\n    key: \"_createExtremeRecurrenceDates\",\n    value: function (rawAppointment) {\n      var dateRange = this.workspace.getDateRange();\n      var startViewDate = this.scheduler.appointmentTakesAllDay(rawAppointment) ? _date.default.trimTime(dateRange[0]) : dateRange[0];\n      var commonTimeZone = this.scheduler.option(\"timeZone\");\n      var minRecurrenceDate = commonTimeZone ? this.timeZoneCalculator.createDate(startViewDate, {\n        path: \"fromGrid\"\n      }) : startViewDate;\n      var maxRecurrenceDate = commonTimeZone ? this.timeZoneCalculator.createDate(dateRange[1], {\n        path: \"fromGrid\"\n      }) : dateRange[1];\n      return [minRecurrenceDate, maxRecurrenceDate];\n    }\n  }, {\n    key: \"_createRecurrenceOptions\",\n    value: function (appointment, groupIndex) {\n      var _this4 = this;\n\n      var _this$_createExtremeR = this._createExtremeRecurrenceDates(appointment.source(), groupIndex),\n          _this$_createExtremeR2 = _slicedToArray(_this$_createExtremeR, 2),\n          minRecurrenceDate = _this$_createExtremeR2[0],\n          maxRecurrenceDate = _this$_createExtremeR2[1];\n\n      return {\n        rule: appointment.recurrenceRule,\n        exception: appointment.recurrenceException,\n        min: minRecurrenceDate,\n        max: maxRecurrenceDate,\n        firstDayOfWeek: this.scheduler.getFirstDayOfWeek(),\n        start: appointment.startDate,\n        end: appointment.endDate,\n        getPostProcessedException: function (date) {\n          var timeZoneName = _this4.scheduler.option(\"timeZone\");\n\n          if ((0, _type.isEmptyObject)(timeZoneName) || _utilsTimeZone.default.isEqualLocalTimeZone(timeZoneName)) {\n            return date;\n          }\n\n          var appointmentOffset = _this4.timeZoneCalculator.getOffsets(appointment.startDate).common;\n\n          var exceptionAppointmentOffset = _this4.timeZoneCalculator.getOffsets(date).common;\n\n          var diff = appointmentOffset - exceptionAppointmentOffset;\n          diff = _this4._getProcessedNotNativeDateIfCrossDST(date, diff);\n          return new Date(date.getTime() - diff * _date.default.dateToMilliseconds(\"hour\"));\n        }\n      };\n    }\n  }, {\n    key: \"_createRecurrenceAppointments\",\n    value: function (appointment, resources) {\n      var duration = appointment.duration;\n\n      var option = this._createRecurrenceOptions(appointment);\n\n      var generatedStartDates = (0, _recurrence.getRecurrenceProcessor)().generateDates(option);\n      return generatedStartDates.map(function (date) {\n        var utcDate = _utilsTimeZone.default.createUTCDateWithLocalOffset(date);\n\n        utcDate.setTime(utcDate.getTime() + duration);\n\n        var endDate = _utilsTimeZone.default.createDateFromUTCWithLocalOffset(utcDate);\n\n        return {\n          startDate: new Date(date),\n          endDate: endDate\n        };\n      });\n    }\n  }, {\n    key: \"_getGroupIndices\",\n    value: function (resources) {\n      var workspace = this.scheduler._workSpace;\n      return workspace._getGroupIndexes(resources);\n    }\n  }, {\n    key: \"_cropAppointmentsByStartDayHour\",\n    value: function (appointments, rawAppointment, isAllDay) {\n      var _this5 = this;\n\n      return appointments.map(function (appointment) {\n        var startDate = new Date(appointment.startDate);\n\n        var firstViewDate = _this5._getAppointmentFirstViewDate(appointment, rawAppointment);\n\n        var startDayHour = _this5._getViewStartDayHour(firstViewDate);\n\n        appointment.startDate = _this5._getAppointmentResultDate({\n          appointment: appointment,\n          rawAppointment: rawAppointment,\n          startDate: startDate,\n          startDayHour: startDayHour,\n          firstViewDate: firstViewDate\n        });\n        return appointment;\n      });\n    }\n  }, {\n    key: \"_getAppointmentFirstViewDate\",\n    value: function () {\n      return this.scheduler.getStartViewDate();\n    }\n  }, {\n    key: \"_getViewStartDayHour\",\n    value: function () {\n      return this.scheduler._getCurrentViewOption(\"startDayHour\");\n    }\n  }, {\n    key: \"_getAppointmentResultDate\",\n    value: function (options) {\n      var appointment = options.appointment,\n          rawAppointment = options.rawAppointment,\n          startDayHour = options.startDayHour,\n          firstViewDate = options.firstViewDate;\n      var startDate = options.startDate;\n      var resultDate = new Date(appointment.startDate);\n\n      if (this.scheduler.appointmentTakesAllDay(rawAppointment)) {\n        resultDate = _date.default.normalizeDate(startDate, firstViewDate);\n      } else {\n        if (startDate < firstViewDate) {\n          startDate = firstViewDate;\n        }\n\n        resultDate = _date.default.normalizeDate(appointment.startDate, startDate);\n      }\n\n      return _date.default.roundDateByStartDayHour(resultDate, startDayHour);\n    }\n  }, {\n    key: \"_createAppointmentInfos\",\n    value: function (gridAppointments, resources, allDay, recurrent) {\n      var _this6 = this;\n\n      var result = [];\n\n      var _loop = function (i) {\n        var coordinates = _this6.scheduler._workSpace.getCoordinatesByDateInGroup(gridAppointments[i].startDate, resources, allDay);\n\n        coordinates.forEach(function (coordinate) {\n          (0, _extend.extend)(coordinate, {\n            info: {\n              appointment: gridAppointments[i],\n              sourceAppointment: gridAppointments[i].source\n            }\n          });\n        });\n        result = result.concat(coordinates);\n      };\n\n      for (var i = 0; i < gridAppointments.length; i++) {\n        _loop(i);\n      }\n\n      return result;\n    }\n  }, {\n    key: \"timeZoneCalculator\",\n    get: function () {\n      return this.scheduler.timeZoneCalculator;\n    }\n  }, {\n    key: \"workspace\",\n    get: function () {\n      return this.scheduler.getWorkSpace();\n    }\n  }, {\n    key: \"viewDataProvider\",\n    get: function () {\n      return this.workspace.viewDataProvider;\n    }\n  }]);\n\n  return AppointmentSettingsGeneratorBaseStrategy;\n}();\n\nexports.AppointmentSettingsGeneratorBaseStrategy = AppointmentSettingsGeneratorBaseStrategy;\n\nvar AppointmentSettingsGeneratorVirtualStrategy = function (_AppointmentSettingsG) {\n  _inherits(AppointmentSettingsGeneratorVirtualStrategy, _AppointmentSettingsG);\n\n  var _super = _createSuper(AppointmentSettingsGeneratorVirtualStrategy);\n\n  function AppointmentSettingsGeneratorVirtualStrategy() {\n    _classCallCheck(this, AppointmentSettingsGeneratorVirtualStrategy);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(AppointmentSettingsGeneratorVirtualStrategy, [{\n    key: \"_createAppointmentInfos\",\n    value: function (gridAppointments, resources, allDay, recurrent) {\n      var _this7 = this;\n\n      var appointments = allDay ? gridAppointments : gridAppointments.filter(function (item) {\n        var source = item.source,\n            startDate = item.startDate,\n            endDate = item.endDate;\n        var groupIndex = source.groupIndex;\n        return _this7.viewDataProvider.isGroupIntersectDateInterval(groupIndex, startDate, endDate);\n      });\n\n      if (recurrent && this.isVerticalGrouping) {\n        return this._createRecurrentAppointmentInfos(appointments, resources, allDay);\n      }\n\n      return _get(_getPrototypeOf(AppointmentSettingsGeneratorVirtualStrategy.prototype), \"_createAppointmentInfos\", this).call(this, appointments, resources, allDay, recurrent);\n    }\n  }, {\n    key: \"_createRecurrentAppointmentInfos\",\n    value: function (gridAppointments, resources, allDay) {\n      var _this8 = this;\n\n      var result = [];\n      gridAppointments.forEach(function (appointment) {\n        var source = appointment.source;\n        var groupIndex = source.groupIndex;\n\n        var coordinate = _this8.workspace.getCoordinatesByDate(appointment.startDate, groupIndex, allDay);\n\n        if (coordinate) {\n          (0, _extend.extend)(coordinate, {\n            info: {\n              appointment: appointment,\n              sourceAppointment: source\n            }\n          });\n          result.push(coordinate);\n        }\n      });\n      return result;\n    }\n  }, {\n    key: \"_cropAppointmentsByStartDayHour\",\n    value: function (appointments, rawAppointment, isAllDay) {\n      var _this9 = this;\n\n      return appointments.filter(function (appointment) {\n        var firstViewDate = _this9._getAppointmentFirstViewDate(appointment, rawAppointment);\n\n        if (!firstViewDate) {\n          return false;\n        }\n\n        var startDayHour = _this9._getViewStartDayHour(firstViewDate);\n\n        var startDate = new Date(appointment.startDate);\n        appointment.startDate = _this9._getAppointmentResultDate({\n          appointment: appointment,\n          rawAppointment: rawAppointment,\n          startDate: startDate,\n          startDayHour: startDayHour,\n          firstViewDate: firstViewDate\n        });\n        return !isAllDay ? appointment.endDate > appointment.startDate : true;\n      });\n    }\n  }, {\n    key: \"_createRecurrenceAppointments\",\n    value: function (appointment, resources) {\n      var _this10 = this;\n\n      var duration = appointment.duration;\n      var result = [];\n      var groupIndices = this.isVerticalGrouping && this.workspace._getGroupCount() ? this._getGroupIndices(resources) : [0];\n      groupIndices.forEach(function (groupIndex) {\n        var option = _this10._createRecurrenceOptions(appointment, groupIndex);\n\n        var generatedStartDates = (0, _recurrence.getRecurrenceProcessor)().generateDates(option);\n        var recurrentInfo = generatedStartDates.map(function (date) {\n          var startDate = new Date(date);\n\n          var utcDate = _utilsTimeZone.default.createUTCDateWithLocalOffset(date);\n\n          utcDate.setTime(utcDate.getTime() + duration);\n\n          var endDate = _utilsTimeZone.default.createDateFromUTCWithLocalOffset(utcDate);\n\n          return {\n            startDate: startDate,\n            endDate: endDate,\n            groupIndex: groupIndex\n          };\n        });\n        result.push.apply(result, _toConsumableArray(recurrentInfo));\n      });\n      return result;\n    }\n  }, {\n    key: \"_getViewStartDayHour\",\n    value: function (firstViewDate) {\n      return firstViewDate.getHours();\n    }\n  }, {\n    key: \"_getAppointmentFirstViewDate\",\n    value: function (appointment, rawAppointment) {\n      var _this$scheduler$getWo = this.scheduler.getWorkSpace(),\n          viewDataProvider = _this$scheduler$getWo.viewDataProvider;\n\n      var groupIndex = appointment.source.groupIndex;\n      var startDate = appointment.startDate,\n          endDate = appointment.endDate;\n\n      var isAllDay = this._isAllDayAppointment(rawAppointment);\n\n      return viewDataProvider.findGroupCellStartDate(groupIndex, startDate, endDate, isAllDay);\n    }\n  }, {\n    key: \"_updateGroupIndices\",\n    value: function (appointments, itemResources) {\n      var _this11 = this;\n\n      var groupIndices = this.isVerticalGrouping ? this._getGroupIndices(itemResources) : [0];\n      var result = [];\n      groupIndices.forEach(function (groupIndex) {\n        var groupStartDate = _this11.viewDataProvider.getGroupStartDate(groupIndex);\n\n        if (groupStartDate) {\n          appointments.forEach(function (appointment) {\n            var appointmentCopy = (0, _extend.extend)({}, appointment);\n            appointmentCopy.groupIndex = groupIndex;\n            result.push(appointmentCopy);\n          });\n        }\n      });\n      return result;\n    }\n  }, {\n    key: \"_getGroupIndices\",\n    value: function (resources) {\n      var groupIndices = _get(_getPrototypeOf(AppointmentSettingsGeneratorVirtualStrategy.prototype), \"_getGroupIndices\", this).call(this, resources);\n\n      var _this$scheduler$getWo2 = this.scheduler.getWorkSpace(),\n          viewDataProvider = _this$scheduler$getWo2.viewDataProvider;\n\n      var viewDataGroupIndices = viewDataProvider.getGroupIndices();\n      var result = groupIndices.filter(function (groupIndex) {\n        return viewDataGroupIndices.indexOf(groupIndex) !== -1;\n      });\n      return result;\n    }\n  }, {\n    key: \"_createAppointments\",\n    value: function (appointment, resources) {\n      var appointments = _get(_getPrototypeOf(AppointmentSettingsGeneratorVirtualStrategy.prototype), \"_createAppointments\", this).call(this, appointment, resources);\n\n      return !appointment.isRecurrent ? this._updateGroupIndices(appointments, resources) : appointments;\n    }\n  }, {\n    key: \"viewDataProvider\",\n    get: function () {\n      return this.workspace.viewDataProvider;\n    }\n  }, {\n    key: \"isVerticalGrouping\",\n    get: function () {\n      return this.workspace._isVerticalGroupedWorkSpace();\n    }\n  }]);\n\n  return AppointmentSettingsGeneratorVirtualStrategy;\n}(AppointmentSettingsGeneratorBaseStrategy);\n\nexports.AppointmentSettingsGeneratorVirtualStrategy = AppointmentSettingsGeneratorVirtualStrategy;","map":{"version":3,"sources":["C:/Users/hp/Downloads/quantumCode20082022/node_modules/devextreme/ui/scheduler/appointmentSettingsGenerator.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","exports","AppointmentSettingsGeneratorVirtualStrategy","AppointmentSettingsGeneratorBaseStrategy","AppointmentSettingsGenerator","_date","_interopRequireDefault","require","_type","_extend","_recurrence","_utilsTimeZone","__esModule","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","iter","Object","Array","from","isArray","_arrayLikeToArray","_get","target","property","receiver","Reflect","get","base","_superPropBase","desc","getOwnPropertyDescriptor","call","value","object","hasOwnProperty","_getPrototypeOf","_inherits","subClass","superClass","create","writable","configurable","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","result","Super","NewTarget","construct","arguments","apply","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Date","toString","e","getPrototypeOf","_slicedToArray","i","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","minLen","n","slice","name","test","len","length","arr2","_arr","_n","_d","_e","_s","_i","next","done","push","err","return","_classCallCheck","instance","Constructor","_defineProperties","props","descriptor","enumerable","defineProperty","key","_createClass","protoProps","staticProps","toMs","default","dateToMilliseconds","scheduler","settingsStrategy","isVirtualScrolling","rawAppointment","appointment","createAppointmentAdapter","itemResources","_resourcesManager","getResourcesFromItem","isAllDay","_isAllDayAppointment","appointmentList","_createAppointments","_canProcessNotNativeTimezoneDates","_getProcessedNotNativeTimezoneDates","gridAppointmentList","_createGridAppointmentList","_cropAppointmentsByStartDayHour","_getProcessedLongAppointmentsIfRequired","appointmentInfos","_createAppointmentInfos","isRecurrent","appointmentTakesAllDay","workspace","supportAllDayRow","resources","appointments","_createRecurrenceAppointments","startDate","endDate","map","item","endTime","getTime","setTime","timeZoneName","option","isEqualLocalTimeZone","hasDSTInLocalTimeZone","isRecurrence","isTimeZoneSet","isEmptyObject","date","offset","newDate","newDateMinusOneHour","setHours","getHours","newDateOffset","timeZoneCalculator","getOffsets","common","newDateMinusOneHourOffset","_this","startDateRange","endDateRange","startDateRangeOffset","endDateRangeOffset","isChangeOffsetInRange","a","diffStartDateOffset","diffEndDateOffset","_getProcessedNotNativeDateIfCrossDST","newStartDate","newEndDate","testNewStartDate","createDate","path","testNewEndDate","duration","_this2","source","allDay","dateRange","getDateRange","renderingStrategy","getLayoutManager","getRenderingStrategyInstance","needSeparateAppointment","longStartDateParts","resultDates","forEach","gridAppointment","maxDate","endDateOfPart","normalizeEndDateByViewEnd","getDatesOfInterval","milliseconds","getWorkSpace","getIntervalDuration","list","filter","startDatePart","setMilliseconds","concat","_this3","startViewDate","trimTime","commonTimeZone","minRecurrenceDate","maxRecurrenceDate","groupIndex","_this4","_this$_createExtremeR","_createExtremeRecurrenceDates","_this$_createExtremeR2","rule","recurrenceRule","exception","recurrenceException","min","max","firstDayOfWeek","getFirstDayOfWeek","start","end","getPostProcessedException","appointmentOffset","exceptionAppointmentOffset","diff","_createRecurrenceOptions","generatedStartDates","getRecurrenceProcessor","generateDates","utcDate","createUTCDateWithLocalOffset","createDateFromUTCWithLocalOffset","_workSpace","_getGroupIndexes","_this5","firstViewDate","_getAppointmentFirstViewDate","startDayHour","_getViewStartDayHour","_getAppointmentResultDate","getStartViewDate","_getCurrentViewOption","options","resultDate","normalizeDate","roundDateByStartDayHour","gridAppointments","recurrent","_this6","_loop","coordinates","getCoordinatesByDateInGroup","coordinate","extend","info","sourceAppointment","viewDataProvider","_AppointmentSettingsG","_super","_this7","isGroupIntersectDateInterval","isVerticalGrouping","_createRecurrentAppointmentInfos","_this8","getCoordinatesByDate","_this9","_this10","groupIndices","_getGroupCount","_getGroupIndices","recurrentInfo","_this$scheduler$getWo","findGroupCellStartDate","_this11","groupStartDate","getGroupStartDate","appointmentCopy","_this$scheduler$getWo2","viewDataGroupIndices","getGroupIndices","indexOf","_updateGroupIndices","_isVerticalGroupedWorkSpace"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/appointmentSettingsGenerator.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\n\r\nfunction _typeof(obj) {\r\n    \"@babel/helpers - typeof\";\r\n    if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\r\n        _typeof = function(obj) {\r\n            return typeof obj\r\n        }\r\n    } else {\r\n        _typeof = function(obj) {\r\n            return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj\r\n        }\r\n    }\r\n    return _typeof(obj)\r\n}\r\nexports.AppointmentSettingsGeneratorVirtualStrategy = exports.AppointmentSettingsGeneratorBaseStrategy = exports.AppointmentSettingsGenerator = void 0;\r\nvar _date = _interopRequireDefault(require(\"../../core/utils/date\"));\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _recurrence = require(\"./recurrence\");\r\nvar _utilsTimeZone = _interopRequireDefault(require(\"./utils.timeZone.js\"));\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _toConsumableArray(arr) {\r\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread()\r\n}\r\n\r\nfunction _nonIterableSpread() {\r\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")\r\n}\r\n\r\nfunction _iterableToArray(iter) {\r\n    if (\"undefined\" !== typeof Symbol && Symbol.iterator in Object(iter)) {\r\n        return Array.from(iter)\r\n    }\r\n}\r\n\r\nfunction _arrayWithoutHoles(arr) {\r\n    if (Array.isArray(arr)) {\r\n        return _arrayLikeToArray(arr)\r\n    }\r\n}\r\n\r\nfunction _get(target, property, receiver) {\r\n    if (\"undefined\" !== typeof Reflect && Reflect.get) {\r\n        _get = Reflect.get\r\n    } else {\r\n        _get = function(target, property, receiver) {\r\n            var base = _superPropBase(target, property);\r\n            if (!base) {\r\n                return\r\n            }\r\n            var desc = Object.getOwnPropertyDescriptor(base, property);\r\n            if (desc.get) {\r\n                return desc.get.call(receiver)\r\n            }\r\n            return desc.value\r\n        }\r\n    }\r\n    return _get(target, property, receiver || target)\r\n}\r\n\r\nfunction _superPropBase(object, property) {\r\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\r\n        object = _getPrototypeOf(object);\r\n        if (null === object) {\r\n            break\r\n        }\r\n    }\r\n    return object\r\n}\r\n\r\nfunction _inherits(subClass, superClass) {\r\n    if (\"function\" !== typeof superClass && null !== superClass) {\r\n        throw new TypeError(\"Super expression must either be null or a function\")\r\n    }\r\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\r\n        constructor: {\r\n            value: subClass,\r\n            writable: true,\r\n            configurable: true\r\n        }\r\n    });\r\n    if (superClass) {\r\n        _setPrototypeOf(subClass, superClass)\r\n    }\r\n}\r\n\r\nfunction _setPrototypeOf(o, p) {\r\n    _setPrototypeOf = Object.setPrototypeOf || function(o, p) {\r\n        o.__proto__ = p;\r\n        return o\r\n    };\r\n    return _setPrototypeOf(o, p)\r\n}\r\n\r\nfunction _createSuper(Derived) {\r\n    var hasNativeReflectConstruct = _isNativeReflectConstruct();\r\n    return function() {\r\n        var result, Super = _getPrototypeOf(Derived);\r\n        if (hasNativeReflectConstruct) {\r\n            var NewTarget = _getPrototypeOf(this).constructor;\r\n            result = Reflect.construct(Super, arguments, NewTarget)\r\n        } else {\r\n            result = Super.apply(this, arguments)\r\n        }\r\n        return _possibleConstructorReturn(this, result)\r\n    }\r\n}\r\n\r\nfunction _possibleConstructorReturn(self, call) {\r\n    if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\r\n        return call\r\n    }\r\n    return _assertThisInitialized(self)\r\n}\r\n\r\nfunction _assertThisInitialized(self) {\r\n    if (void 0 === self) {\r\n        throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\")\r\n    }\r\n    return self\r\n}\r\n\r\nfunction _isNativeReflectConstruct() {\r\n    if (\"undefined\" === typeof Reflect || !Reflect.construct) {\r\n        return false\r\n    }\r\n    if (Reflect.construct.sham) {\r\n        return false\r\n    }\r\n    if (\"function\" === typeof Proxy) {\r\n        return true\r\n    }\r\n    try {\r\n        Date.prototype.toString.call(Reflect.construct(Date, [], function() {}));\r\n        return true\r\n    } catch (e) {\r\n        return false\r\n    }\r\n}\r\n\r\nfunction _getPrototypeOf(o) {\r\n    _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function(o) {\r\n        return o.__proto__ || Object.getPrototypeOf(o)\r\n    };\r\n    return _getPrototypeOf(o)\r\n}\r\n\r\nfunction _slicedToArray(arr, i) {\r\n    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest()\r\n}\r\n\r\nfunction _nonIterableRest() {\r\n    throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")\r\n}\r\n\r\nfunction _unsupportedIterableToArray(o, minLen) {\r\n    if (!o) {\r\n        return\r\n    }\r\n    if (\"string\" === typeof o) {\r\n        return _arrayLikeToArray(o, minLen)\r\n    }\r\n    var n = Object.prototype.toString.call(o).slice(8, -1);\r\n    if (\"Object\" === n && o.constructor) {\r\n        n = o.constructor.name\r\n    }\r\n    if (\"Map\" === n || \"Set\" === n) {\r\n        return Array.from(o)\r\n    }\r\n    if (\"Arguments\" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) {\r\n        return _arrayLikeToArray(o, minLen)\r\n    }\r\n}\r\n\r\nfunction _arrayLikeToArray(arr, len) {\r\n    if (null == len || len > arr.length) {\r\n        len = arr.length\r\n    }\r\n    for (var i = 0, arr2 = new Array(len); i < len; i++) {\r\n        arr2[i] = arr[i]\r\n    }\r\n    return arr2\r\n}\r\n\r\nfunction _iterableToArrayLimit(arr, i) {\r\n    if (\"undefined\" === typeof Symbol || !(Symbol.iterator in Object(arr))) {\r\n        return\r\n    }\r\n    var _arr = [];\r\n    var _n = true;\r\n    var _d = false;\r\n    var _e = void 0;\r\n    try {\r\n        for (var _s, _i = arr[Symbol.iterator](); !(_n = (_s = _i.next()).done); _n = true) {\r\n            _arr.push(_s.value);\r\n            if (i && _arr.length === i) {\r\n                break\r\n            }\r\n        }\r\n    } catch (err) {\r\n        _d = true;\r\n        _e = err\r\n    } finally {\r\n        try {\r\n            if (!_n && null != _i.return) {\r\n                _i.return()\r\n            }\r\n        } finally {\r\n            if (_d) {\r\n                throw _e\r\n            }\r\n        }\r\n    }\r\n    return _arr\r\n}\r\n\r\nfunction _arrayWithHoles(arr) {\r\n    if (Array.isArray(arr)) {\r\n        return arr\r\n    }\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n        throw new TypeError(\"Cannot call a class as a function\")\r\n    }\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n    for (var i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if (\"value\" in descriptor) {\r\n            descriptor.writable = true\r\n        }\r\n        Object.defineProperty(target, descriptor.key, descriptor)\r\n    }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n    if (protoProps) {\r\n        _defineProperties(Constructor.prototype, protoProps)\r\n    }\r\n    if (staticProps) {\r\n        _defineProperties(Constructor, staticProps)\r\n    }\r\n    return Constructor\r\n}\r\nvar toMs = _date.default.dateToMilliseconds;\r\nvar AppointmentSettingsGenerator = function() {\r\n    function AppointmentSettingsGenerator(scheduler) {\r\n        _classCallCheck(this, AppointmentSettingsGenerator);\r\n        this.scheduler = scheduler;\r\n        this.settingsStrategy = this.scheduler.isVirtualScrolling() ? new AppointmentSettingsGeneratorVirtualStrategy(this.scheduler) : new AppointmentSettingsGeneratorBaseStrategy(this.scheduler)\r\n    }\r\n    _createClass(AppointmentSettingsGenerator, [{\r\n        key: \"create\",\r\n        value: function(rawAppointment) {\r\n            return this.settingsStrategy.create(rawAppointment)\r\n        }\r\n    }]);\r\n    return AppointmentSettingsGenerator\r\n}();\r\nexports.AppointmentSettingsGenerator = AppointmentSettingsGenerator;\r\nvar AppointmentSettingsGeneratorBaseStrategy = function() {\r\n    function AppointmentSettingsGeneratorBaseStrategy(scheduler) {\r\n        _classCallCheck(this, AppointmentSettingsGeneratorBaseStrategy);\r\n        this.scheduler = scheduler\r\n    }\r\n    _createClass(AppointmentSettingsGeneratorBaseStrategy, [{\r\n        key: \"create\",\r\n        value: function(rawAppointment) {\r\n            var scheduler = this.scheduler;\r\n            var appointment = scheduler.createAppointmentAdapter(rawAppointment);\r\n            var itemResources = scheduler._resourcesManager.getResourcesFromItem(rawAppointment);\r\n            var isAllDay = this._isAllDayAppointment(rawAppointment);\r\n            var appointmentList = this._createAppointments(appointment, itemResources);\r\n            if (this._canProcessNotNativeTimezoneDates(appointmentList, appointment)) {\r\n                appointmentList = this._getProcessedNotNativeTimezoneDates(appointmentList, appointment)\r\n            }\r\n            var gridAppointmentList = this._createGridAppointmentList(appointmentList);\r\n            gridAppointmentList = this._cropAppointmentsByStartDayHour(gridAppointmentList, rawAppointment, isAllDay);\r\n            gridAppointmentList = this._getProcessedLongAppointmentsIfRequired(gridAppointmentList, appointment);\r\n            var appointmentInfos = this._createAppointmentInfos(gridAppointmentList, itemResources, isAllDay, appointment.isRecurrent);\r\n            return appointmentInfos\r\n        }\r\n    }, {\r\n        key: \"_isAllDayAppointment\",\r\n        value: function(rawAppointment) {\r\n            return this.scheduler.appointmentTakesAllDay(rawAppointment) && this.workspace.supportAllDayRow()\r\n        }\r\n    }, {\r\n        key: \"_createAppointments\",\r\n        value: function(appointment, resources) {\r\n            var appointments = this._createRecurrenceAppointments(appointment, resources);\r\n            if (!appointment.isRecurrent && 0 === appointments.length) {\r\n                appointments.push({\r\n                    startDate: appointment.startDate,\r\n                    endDate: appointment.endDate\r\n                })\r\n            }\r\n            appointments = appointments.map(function(item) {\r\n                var startDate = item.startDate,\r\n                    endDate = item.endDate;\r\n                var endTime = null === endDate || void 0 === endDate ? void 0 : endDate.getTime();\r\n                if (startDate.getTime() === endTime) {\r\n                    endDate.setTime(endTime + toMs(\"minute\"))\r\n                }\r\n                return item\r\n            });\r\n            return appointments\r\n        }\r\n    }, {\r\n        key: \"_canProcessNotNativeTimezoneDates\",\r\n        value: function(appointmentList, appointment) {\r\n            var timeZoneName = this.scheduler.option(\"timeZone\");\r\n            var isEqualLocalTimeZone = _utilsTimeZone.default.isEqualLocalTimeZone,\r\n                hasDSTInLocalTimeZone = _utilsTimeZone.default.hasDSTInLocalTimeZone;\r\n            var isRecurrence = appointmentList.length > 1;\r\n            var isTimeZoneSet = !(0, _type.isEmptyObject)(timeZoneName);\r\n            if (!isRecurrence) {\r\n                return false\r\n            }\r\n            if (!isTimeZoneSet && hasDSTInLocalTimeZone()) {\r\n                return false\r\n            }\r\n            return isTimeZoneSet && !isEqualLocalTimeZone(timeZoneName)\r\n        }\r\n    }, {\r\n        key: \"_getProcessedNotNativeDateIfCrossDST\",\r\n        value: function(date, offset) {\r\n            if (offset < 0) {\r\n                var newDate = new Date(date);\r\n                var newDateMinusOneHour = new Date(newDate);\r\n                newDateMinusOneHour.setHours(newDateMinusOneHour.getHours() - 1);\r\n                var newDateOffset = this.timeZoneCalculator.getOffsets(newDate).common;\r\n                var newDateMinusOneHourOffset = this.timeZoneCalculator.getOffsets(newDateMinusOneHour).common;\r\n                if (newDateOffset !== newDateMinusOneHourOffset) {\r\n                    return 0\r\n                }\r\n            }\r\n            return offset\r\n        }\r\n    }, {\r\n        key: \"_getProcessedNotNativeTimezoneDates\",\r\n        value: function(appointmentList, appointment) {\r\n            var _this = this;\r\n            var startDateRange = appointment.startDate;\r\n            var endDateRange = appointmentList[appointmentList.length - 1].endDate;\r\n            var startDateRangeOffset = this.timeZoneCalculator.getOffsets(startDateRange).common;\r\n            var endDateRangeOffset = this.timeZoneCalculator.getOffsets(endDateRange).common;\r\n            var isChangeOffsetInRange = startDateRangeOffset !== endDateRangeOffset;\r\n            if (isChangeOffsetInRange) {\r\n                return appointmentList.map(function(a) {\r\n                    var diffStartDateOffset = _this.timeZoneCalculator.getOffsets(appointment.startDate).common - _this.timeZoneCalculator.getOffsets(a.startDate).common;\r\n                    var diffEndDateOffset = _this.timeZoneCalculator.getOffsets(appointment.endDate).common - _this.timeZoneCalculator.getOffsets(a.endDate).common;\r\n                    diffStartDateOffset = _this._getProcessedNotNativeDateIfCrossDST(a.startDate, diffStartDateOffset);\r\n                    diffEndDateOffset = _this._getProcessedNotNativeDateIfCrossDST(a.endDate, diffEndDateOffset);\r\n                    var newStartDate = new Date(a.startDate.getTime() + diffStartDateOffset * toMs(\"hour\"));\r\n                    var newEndDate = new Date(a.endDate.getTime() + diffEndDateOffset * toMs(\"hour\"));\r\n                    var testNewStartDate = _this.timeZoneCalculator.createDate(newStartDate, {\r\n                        path: \"toGrid\"\r\n                    });\r\n                    var testNewEndDate = _this.timeZoneCalculator.createDate(newEndDate, {\r\n                        path: \"toGrid\"\r\n                    });\r\n                    if (appointment.duration > testNewEndDate.getTime() - testNewStartDate.getTime()) {\r\n                        newEndDate = new Date(newStartDate.getTime() + appointment.duration)\r\n                    }\r\n                    return {\r\n                        startDate: newStartDate,\r\n                        endDate: newEndDate\r\n                    }\r\n                })\r\n            }\r\n            return appointmentList\r\n        }\r\n    }, {\r\n        key: \"_getProcessedLongAppointmentsIfRequired\",\r\n        value: function(gridAppointmentList, appointment) {\r\n            var _this2 = this;\r\n            var rawAppointment = appointment.source();\r\n            var allDay = this.scheduler.appointmentTakesAllDay(rawAppointment);\r\n            var dateRange = this.workspace.getDateRange();\r\n            var renderingStrategy = this.scheduler.getLayoutManager().getRenderingStrategyInstance();\r\n            if (renderingStrategy.needSeparateAppointment(allDay)) {\r\n                var longStartDateParts = [];\r\n                var resultDates = [];\r\n                gridAppointmentList.forEach(function(gridAppointment) {\r\n                    var maxDate = new Date(dateRange[1]);\r\n                    var endDateOfPart = renderingStrategy.normalizeEndDateByViewEnd(rawAppointment, gridAppointment.endDate);\r\n                    longStartDateParts = _date.default.getDatesOfInterval(gridAppointment.startDate, endDateOfPart, {\r\n                        milliseconds: _this2.scheduler.getWorkSpace().getIntervalDuration(allDay)\r\n                    });\r\n                    var list = longStartDateParts.filter(function(startDatePart) {\r\n                        return new Date(startDatePart) < maxDate\r\n                    }).map(function(date) {\r\n                        return {\r\n                            startDate: date,\r\n                            endDate: new Date(new Date(date).setMilliseconds(appointment.duration)),\r\n                            source: gridAppointment.source\r\n                        }\r\n                    });\r\n                    resultDates = resultDates.concat(list)\r\n                });\r\n                gridAppointmentList = resultDates\r\n            }\r\n            return gridAppointmentList\r\n        }\r\n    }, {\r\n        key: \"_createGridAppointmentList\",\r\n        value: function(appointmentList) {\r\n            var _this3 = this;\r\n            return appointmentList.map(function(source) {\r\n                var startDate = _this3.timeZoneCalculator.createDate(source.startDate, {\r\n                    path: \"toGrid\"\r\n                });\r\n                var endDate = _this3.timeZoneCalculator.createDate(source.endDate, {\r\n                    path: \"toGrid\"\r\n                });\r\n                return {\r\n                    startDate: startDate,\r\n                    endDate: endDate,\r\n                    source: source\r\n                }\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_createExtremeRecurrenceDates\",\r\n        value: function(rawAppointment) {\r\n            var dateRange = this.workspace.getDateRange();\r\n            var startViewDate = this.scheduler.appointmentTakesAllDay(rawAppointment) ? _date.default.trimTime(dateRange[0]) : dateRange[0];\r\n            var commonTimeZone = this.scheduler.option(\"timeZone\");\r\n            var minRecurrenceDate = commonTimeZone ? this.timeZoneCalculator.createDate(startViewDate, {\r\n                path: \"fromGrid\"\r\n            }) : startViewDate;\r\n            var maxRecurrenceDate = commonTimeZone ? this.timeZoneCalculator.createDate(dateRange[1], {\r\n                path: \"fromGrid\"\r\n            }) : dateRange[1];\r\n            return [minRecurrenceDate, maxRecurrenceDate]\r\n        }\r\n    }, {\r\n        key: \"_createRecurrenceOptions\",\r\n        value: function(appointment, groupIndex) {\r\n            var _this4 = this;\r\n            var _this$_createExtremeR = this._createExtremeRecurrenceDates(appointment.source(), groupIndex),\r\n                _this$_createExtremeR2 = _slicedToArray(_this$_createExtremeR, 2),\r\n                minRecurrenceDate = _this$_createExtremeR2[0],\r\n                maxRecurrenceDate = _this$_createExtremeR2[1];\r\n            return {\r\n                rule: appointment.recurrenceRule,\r\n                exception: appointment.recurrenceException,\r\n                min: minRecurrenceDate,\r\n                max: maxRecurrenceDate,\r\n                firstDayOfWeek: this.scheduler.getFirstDayOfWeek(),\r\n                start: appointment.startDate,\r\n                end: appointment.endDate,\r\n                getPostProcessedException: function(date) {\r\n                    var timeZoneName = _this4.scheduler.option(\"timeZone\");\r\n                    if ((0, _type.isEmptyObject)(timeZoneName) || _utilsTimeZone.default.isEqualLocalTimeZone(timeZoneName)) {\r\n                        return date\r\n                    }\r\n                    var appointmentOffset = _this4.timeZoneCalculator.getOffsets(appointment.startDate).common;\r\n                    var exceptionAppointmentOffset = _this4.timeZoneCalculator.getOffsets(date).common;\r\n                    var diff = appointmentOffset - exceptionAppointmentOffset;\r\n                    diff = _this4._getProcessedNotNativeDateIfCrossDST(date, diff);\r\n                    return new Date(date.getTime() - diff * _date.default.dateToMilliseconds(\"hour\"))\r\n                }\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_createRecurrenceAppointments\",\r\n        value: function(appointment, resources) {\r\n            var duration = appointment.duration;\r\n            var option = this._createRecurrenceOptions(appointment);\r\n            var generatedStartDates = (0, _recurrence.getRecurrenceProcessor)().generateDates(option);\r\n            return generatedStartDates.map(function(date) {\r\n                var utcDate = _utilsTimeZone.default.createUTCDateWithLocalOffset(date);\r\n                utcDate.setTime(utcDate.getTime() + duration);\r\n                var endDate = _utilsTimeZone.default.createDateFromUTCWithLocalOffset(utcDate);\r\n                return {\r\n                    startDate: new Date(date),\r\n                    endDate: endDate\r\n                }\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_getGroupIndices\",\r\n        value: function(resources) {\r\n            var workspace = this.scheduler._workSpace;\r\n            return workspace._getGroupIndexes(resources)\r\n        }\r\n    }, {\r\n        key: \"_cropAppointmentsByStartDayHour\",\r\n        value: function(appointments, rawAppointment, isAllDay) {\r\n            var _this5 = this;\r\n            return appointments.map(function(appointment) {\r\n                var startDate = new Date(appointment.startDate);\r\n                var firstViewDate = _this5._getAppointmentFirstViewDate(appointment, rawAppointment);\r\n                var startDayHour = _this5._getViewStartDayHour(firstViewDate);\r\n                appointment.startDate = _this5._getAppointmentResultDate({\r\n                    appointment: appointment,\r\n                    rawAppointment: rawAppointment,\r\n                    startDate: startDate,\r\n                    startDayHour: startDayHour,\r\n                    firstViewDate: firstViewDate\r\n                });\r\n                return appointment\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_getAppointmentFirstViewDate\",\r\n        value: function() {\r\n            return this.scheduler.getStartViewDate()\r\n        }\r\n    }, {\r\n        key: \"_getViewStartDayHour\",\r\n        value: function() {\r\n            return this.scheduler._getCurrentViewOption(\"startDayHour\")\r\n        }\r\n    }, {\r\n        key: \"_getAppointmentResultDate\",\r\n        value: function(options) {\r\n            var appointment = options.appointment,\r\n                rawAppointment = options.rawAppointment,\r\n                startDayHour = options.startDayHour,\r\n                firstViewDate = options.firstViewDate;\r\n            var startDate = options.startDate;\r\n            var resultDate = new Date(appointment.startDate);\r\n            if (this.scheduler.appointmentTakesAllDay(rawAppointment)) {\r\n                resultDate = _date.default.normalizeDate(startDate, firstViewDate)\r\n            } else {\r\n                if (startDate < firstViewDate) {\r\n                    startDate = firstViewDate\r\n                }\r\n                resultDate = _date.default.normalizeDate(appointment.startDate, startDate)\r\n            }\r\n            return _date.default.roundDateByStartDayHour(resultDate, startDayHour)\r\n        }\r\n    }, {\r\n        key: \"_createAppointmentInfos\",\r\n        value: function(gridAppointments, resources, allDay, recurrent) {\r\n            var _this6 = this;\r\n            var result = [];\r\n            var _loop = function(i) {\r\n                var coordinates = _this6.scheduler._workSpace.getCoordinatesByDateInGroup(gridAppointments[i].startDate, resources, allDay);\r\n                coordinates.forEach(function(coordinate) {\r\n                    (0, _extend.extend)(coordinate, {\r\n                        info: {\r\n                            appointment: gridAppointments[i],\r\n                            sourceAppointment: gridAppointments[i].source\r\n                        }\r\n                    })\r\n                });\r\n                result = result.concat(coordinates)\r\n            };\r\n            for (var i = 0; i < gridAppointments.length; i++) {\r\n                _loop(i)\r\n            }\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"timeZoneCalculator\",\r\n        get: function() {\r\n            return this.scheduler.timeZoneCalculator\r\n        }\r\n    }, {\r\n        key: \"workspace\",\r\n        get: function() {\r\n            return this.scheduler.getWorkSpace()\r\n        }\r\n    }, {\r\n        key: \"viewDataProvider\",\r\n        get: function() {\r\n            return this.workspace.viewDataProvider\r\n        }\r\n    }]);\r\n    return AppointmentSettingsGeneratorBaseStrategy\r\n}();\r\nexports.AppointmentSettingsGeneratorBaseStrategy = AppointmentSettingsGeneratorBaseStrategy;\r\nvar AppointmentSettingsGeneratorVirtualStrategy = function(_AppointmentSettingsG) {\r\n    _inherits(AppointmentSettingsGeneratorVirtualStrategy, _AppointmentSettingsG);\r\n    var _super = _createSuper(AppointmentSettingsGeneratorVirtualStrategy);\r\n\r\n    function AppointmentSettingsGeneratorVirtualStrategy() {\r\n        _classCallCheck(this, AppointmentSettingsGeneratorVirtualStrategy);\r\n        return _super.apply(this, arguments)\r\n    }\r\n    _createClass(AppointmentSettingsGeneratorVirtualStrategy, [{\r\n        key: \"_createAppointmentInfos\",\r\n        value: function(gridAppointments, resources, allDay, recurrent) {\r\n            var _this7 = this;\r\n            var appointments = allDay ? gridAppointments : gridAppointments.filter(function(item) {\r\n                var source = item.source,\r\n                    startDate = item.startDate,\r\n                    endDate = item.endDate;\r\n                var groupIndex = source.groupIndex;\r\n                return _this7.viewDataProvider.isGroupIntersectDateInterval(groupIndex, startDate, endDate)\r\n            });\r\n            if (recurrent && this.isVerticalGrouping) {\r\n                return this._createRecurrentAppointmentInfos(appointments, resources, allDay)\r\n            }\r\n            return _get(_getPrototypeOf(AppointmentSettingsGeneratorVirtualStrategy.prototype), \"_createAppointmentInfos\", this).call(this, appointments, resources, allDay, recurrent)\r\n        }\r\n    }, {\r\n        key: \"_createRecurrentAppointmentInfos\",\r\n        value: function(gridAppointments, resources, allDay) {\r\n            var _this8 = this;\r\n            var result = [];\r\n            gridAppointments.forEach(function(appointment) {\r\n                var source = appointment.source;\r\n                var groupIndex = source.groupIndex;\r\n                var coordinate = _this8.workspace.getCoordinatesByDate(appointment.startDate, groupIndex, allDay);\r\n                if (coordinate) {\r\n                    (0, _extend.extend)(coordinate, {\r\n                        info: {\r\n                            appointment: appointment,\r\n                            sourceAppointment: source\r\n                        }\r\n                    });\r\n                    result.push(coordinate)\r\n                }\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_cropAppointmentsByStartDayHour\",\r\n        value: function(appointments, rawAppointment, isAllDay) {\r\n            var _this9 = this;\r\n            return appointments.filter(function(appointment) {\r\n                var firstViewDate = _this9._getAppointmentFirstViewDate(appointment, rawAppointment);\r\n                if (!firstViewDate) {\r\n                    return false\r\n                }\r\n                var startDayHour = _this9._getViewStartDayHour(firstViewDate);\r\n                var startDate = new Date(appointment.startDate);\r\n                appointment.startDate = _this9._getAppointmentResultDate({\r\n                    appointment: appointment,\r\n                    rawAppointment: rawAppointment,\r\n                    startDate: startDate,\r\n                    startDayHour: startDayHour,\r\n                    firstViewDate: firstViewDate\r\n                });\r\n                return !isAllDay ? appointment.endDate > appointment.startDate : true\r\n            })\r\n        }\r\n    }, {\r\n        key: \"_createRecurrenceAppointments\",\r\n        value: function(appointment, resources) {\r\n            var _this10 = this;\r\n            var duration = appointment.duration;\r\n            var result = [];\r\n            var groupIndices = this.isVerticalGrouping && this.workspace._getGroupCount() ? this._getGroupIndices(resources) : [0];\r\n            groupIndices.forEach(function(groupIndex) {\r\n                var option = _this10._createRecurrenceOptions(appointment, groupIndex);\r\n                var generatedStartDates = (0, _recurrence.getRecurrenceProcessor)().generateDates(option);\r\n                var recurrentInfo = generatedStartDates.map(function(date) {\r\n                    var startDate = new Date(date);\r\n                    var utcDate = _utilsTimeZone.default.createUTCDateWithLocalOffset(date);\r\n                    utcDate.setTime(utcDate.getTime() + duration);\r\n                    var endDate = _utilsTimeZone.default.createDateFromUTCWithLocalOffset(utcDate);\r\n                    return {\r\n                        startDate: startDate,\r\n                        endDate: endDate,\r\n                        groupIndex: groupIndex\r\n                    }\r\n                });\r\n                result.push.apply(result, _toConsumableArray(recurrentInfo))\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_getViewStartDayHour\",\r\n        value: function(firstViewDate) {\r\n            return firstViewDate.getHours()\r\n        }\r\n    }, {\r\n        key: \"_getAppointmentFirstViewDate\",\r\n        value: function(appointment, rawAppointment) {\r\n            var _this$scheduler$getWo = this.scheduler.getWorkSpace(),\r\n                viewDataProvider = _this$scheduler$getWo.viewDataProvider;\r\n            var groupIndex = appointment.source.groupIndex;\r\n            var startDate = appointment.startDate,\r\n                endDate = appointment.endDate;\r\n            var isAllDay = this._isAllDayAppointment(rawAppointment);\r\n            return viewDataProvider.findGroupCellStartDate(groupIndex, startDate, endDate, isAllDay)\r\n        }\r\n    }, {\r\n        key: \"_updateGroupIndices\",\r\n        value: function(appointments, itemResources) {\r\n            var _this11 = this;\r\n            var groupIndices = this.isVerticalGrouping ? this._getGroupIndices(itemResources) : [0];\r\n            var result = [];\r\n            groupIndices.forEach(function(groupIndex) {\r\n                var groupStartDate = _this11.viewDataProvider.getGroupStartDate(groupIndex);\r\n                if (groupStartDate) {\r\n                    appointments.forEach(function(appointment) {\r\n                        var appointmentCopy = (0, _extend.extend)({}, appointment);\r\n                        appointmentCopy.groupIndex = groupIndex;\r\n                        result.push(appointmentCopy)\r\n                    })\r\n                }\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_getGroupIndices\",\r\n        value: function(resources) {\r\n            var groupIndices = _get(_getPrototypeOf(AppointmentSettingsGeneratorVirtualStrategy.prototype), \"_getGroupIndices\", this).call(this, resources);\r\n            var _this$scheduler$getWo2 = this.scheduler.getWorkSpace(),\r\n                viewDataProvider = _this$scheduler$getWo2.viewDataProvider;\r\n            var viewDataGroupIndices = viewDataProvider.getGroupIndices();\r\n            var result = groupIndices.filter(function(groupIndex) {\r\n                return viewDataGroupIndices.indexOf(groupIndex) !== -1\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_createAppointments\",\r\n        value: function(appointment, resources) {\r\n            var appointments = _get(_getPrototypeOf(AppointmentSettingsGeneratorVirtualStrategy.prototype), \"_createAppointments\", this).call(this, appointment, resources);\r\n            return !appointment.isRecurrent ? this._updateGroupIndices(appointments, resources) : appointments\r\n        }\r\n    }, {\r\n        key: \"viewDataProvider\",\r\n        get: function() {\r\n            return this.workspace.viewDataProvider\r\n        }\r\n    }, {\r\n        key: \"isVerticalGrouping\",\r\n        get: function() {\r\n            return this.workspace._isVerticalGroupedWorkSpace()\r\n        }\r\n    }]);\r\n    return AppointmentSettingsGeneratorVirtualStrategy\r\n}(AppointmentSettingsGeneratorBaseStrategy);\r\nexports.AppointmentSettingsGeneratorVirtualStrategy = AppointmentSettingsGeneratorVirtualStrategy;\r\n"]},"metadata":{},"sourceType":"script"}