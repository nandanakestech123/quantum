{"ast":null,"code":"var _jsxFileName = \"E:\\\\newfrontend\\\\webfe\\\\src\\\\component\\\\Admin\\\\Reports\\\\Types\\\\DailyCollectionReport.js\";\nimport { NormalButton, NormalDateTime, NormalMultiSelect, NormalSelect } from \"component/common\";\nimport React, { Component } from \"react\";\nimport { withTranslation } from \"react-i18next\";\nimport { connect } from \"react-redux\";\nimport { bindActionCreators } from \"redux\";\nimport { getCommonApi } from \"redux/actions/common\";\nimport { getReport, updateReport } from \"redux/actions/reports\";\nimport { Viewer, Designer } from \"@grapecity/activereports-react\";\nimport \"../style.scss\";\nimport { Fragment } from \"react\";\n\nclass DailyCollectionReportClass extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      payGroupOptions: [],\n      selectedPayGroup: \"\",\n      selectedSites: \"\",\n      siteOptions: [],\n      selectedSiteGroup: \"\",\n      siteGroupOptions: [],\n      isEdit: false,\n      isMounted: true,\n      isLoading: true,\n      start: Date.now(),\n      end: Date.now(),\n      data: null\n    };\n\n    this.updateState = state => {\n      if (this.state.isMounted) this.setState(state);\n    };\n\n    this.getData = async () => {\n      let {\n        siteOptions,\n        siteGroupOptions,\n        payGroupOptions\n      } = this.state;\n      await this.props.getReport(\"SalesDailyReporting\");\n      let payGroup = await this.props.getCommonApi(\"pay_group_list\");\n      let branchRes = await this.props.getCommonApi(\"branchlist/\");\n      let siteGroupRes = await this.props.getCommonApi(\"site_group_list/\");\n\n      for (let key of payGroup.data) {\n        payGroupOptions.push({\n          value: key,\n          label: key\n        });\n      }\n\n      for (let key of branchRes.data) {\n        siteOptions.push({\n          value: key.itemsite_code,\n          label: key.itemsite_desc\n        });\n      }\n\n      for (let key of siteGroupRes.data.groups) {\n        siteGroupOptions.push({\n          value: key.code,\n          label: key.description\n        });\n      }\n\n      this.updateState({\n        siteOptions,\n        siteGroupOptions,\n        payGroupOptions,\n        isLoading: false\n      });\n    };\n\n    this.getFormatedDate = input => {\n      let date = new Date(input);\n      let d = date.getDate();\n      let day = d < 10 ? \"0\" + d : d;\n      let a = date.getMonth() + 1;\n      let month = a < 10 ? \"0\" + a : a;\n      let year = date.getFullYear();\n      return `${year}-${month}-${day}`;\n    };\n\n    this.handleChanges = e => {\n      this.state[e.target.name] = e.target.value;\n      this.updateState({});\n    };\n\n    this.handleMultiSelect = (data = []) => {\n      if (data.length == 0) return this.updateState({\n        selectedSites: \"\"\n      });\n      let {\n        selectedSites\n      } = this.state;\n      selectedSites = [];\n      data.forEach(element => {\n        selectedSites.push(element.value);\n      });\n      selectedSites = selectedSites.reduce((a, e) => a + \",\" + e);\n      this.updateState({\n        selectedSites\n      });\n    };\n\n    this.handleDatePick = (name, value) => {\n      this.state[name] = value;\n\n      if (name === \"start\") {\n        let start = new Date(value);\n        let end = new Date(this.state.end);\n        if (end < start) this.state.end = this.state.start;\n      }\n\n      this.updateState({});\n    };\n\n    this.onRun = async () => {\n      this.updateState({\n        isLoading: true\n      });\n      let {\n        data,\n        selectedSites,\n        selectedSiteGroup,\n        selectedPayGroup,\n        start,\n        end\n      } = this.state;\n      let additionalParams = \"\";\n      if (selectedSiteGroup) additionalParams = `&siteGroup=${selectedSiteGroup}`;else additionalParams = `&siteCodes=${selectedSites}`;\n      if (selectedPayGroup) additionalParams += `&payGroup=${selectedPayGroup}`;\n\n      try {\n        let res = await this.props.getCommonApi(`SalesDailyReporting?start=${this.getFormatedDate(start)}&end=${this.getFormatedDate(end)}${additionalParams}`);\n        console.log(res);\n        data = res.data;\n        this.updateState({\n          data,\n          isLoading: false\n        });\n      } catch (e) {\n        console.log(e);\n      }\n\n      this.updateState({\n        isLoading: false\n      });\n    };\n\n    this.onSaveReport = async info => {\n      this.updateReport({\n        isLoading: true\n      });\n      await this.props.updateReport(\"\", info.definition);\n      this.updateReport({\n        isLoading: false\n      });\n    };\n  }\n\n  componentWillUnmount() {\n    this.state.isMounted = false;\n  }\n\n  componentDidMount() {\n    this.getData();\n  }\n\n  render() {\n    let {\n      t,\n      report\n    } = this.props;\n    if (report.DataSources) report.DataSources[0].ConnectionProperties.ConnectString = `jsondata=${JSON.stringify({\n      data: this.state.data\n    })}`;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid report-types\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 13\n      }\n    }, t(\"Daily Collection Report\")))), this.state.isLoading ? /*#__PURE__*/React.createElement(\"div\", {\n      class: \"d-flex mt-5 align-items-center justify-content-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"spinner-border\",\n      role: \"status\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      class: \"sr-only\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 15\n      }\n    }, \"Loading...\"))) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-3 col-lg-2 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(NormalButton, {\n      label: t(\"Run\"),\n      mainbg: \"true\",\n      onClick: this.onRun,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-4 col-lg-3 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(NormalButton, {\n      label: this.state.isEdit ? t(\"Switch to View Mode\") : t(\"Switch to Edit Mode\"),\n      mainbg: \"true\",\n      onClick: () => this.updateState({\n        isEdit: !this.state.isEdit\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 17\n      }\n    }))), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-4 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-left text-black common-label-text fs-17 pb-1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 17\n      }\n    }, t(\"From Date\")), /*#__PURE__*/React.createElement(NormalDateTime, {\n      onChange: this.handleDatePick,\n      value: this.state.start,\n      name: \"start\",\n      showYearDropdown: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-4 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-left text-black common-label-text fs-17 pb-1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 17\n      }\n    }, t(\"To Date\")), /*#__PURE__*/React.createElement(NormalDateTime, {\n      onChange: this.handleDatePick,\n      value: this.state.end,\n      minDate: this.state.start,\n      name: \"end\",\n      showYearDropdown: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-4 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-left text-black common-label-text fs-17 pb-1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 17\n      }\n    }, t(\"Site Group\")), /*#__PURE__*/React.createElement(NormalSelect, {\n      onChange: this.handleChanges,\n      options: this.state.siteGroupOptions,\n      value: this.state.selectedSiteGroup,\n      name: \"selectedSiteGroup\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-4 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-left text-black common-label-text fs-17 pb-1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 17\n      }\n    }, t(\"Sites\")), /*#__PURE__*/React.createElement(NormalMultiSelect, {\n      handleMultiSelect: this.handleMultiSelect,\n      options: this.state.siteOptions,\n      value: this.state.selectedSites,\n      name: \"selectedSites\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-4 mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: \"text-left text-black common-label-text fs-17 pb-1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 17\n      }\n    }, t(\"Pay Group\")), /*#__PURE__*/React.createElement(NormalSelect, {\n      onChange: this.handleChanges,\n      options: this.state.payGroupOptions,\n      value: this.state.selectedPayGroup,\n      name: \"selectedPayGroup\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 17\n      }\n    }))), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 13\n      }\n    }, this.state.data ? /*#__PURE__*/React.createElement(Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 17\n      }\n    }, this.state.isEdit ? /*#__PURE__*/React.createElement(\"div\", {\n      id: \"designer-host\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Designer, {\n      report: {\n        displayName: t(\"report\"),\n        definition: report\n      },\n      language: localStorage.getItem(\"lang\"),\n      onSave: this.onSaveReport,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 23\n      }\n    })) : /*#__PURE__*/React.createElement(\"div\", {\n      id: \"viewer-host\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Viewer, {\n      report: {\n        Uri: report\n      },\n      availableExports: [],\n      sidebarVisible: true,\n      language: localStorage.getItem(\"lang\"),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 23\n      }\n    }))) : null)));\n  }\n\n}\n\nconst mapStateToProps = state => ({\n  report: state.reporting.reportLayout\n});\n\nconst mapDispatchToProps = dispatch => {\n  return bindActionCreators({\n    getCommonApi,\n    getReport,\n    updateReport\n  }, dispatch);\n};\n\nexport const DailyCollectionReport = withTranslation()(connect(mapStateToProps, mapDispatchToProps)(DailyCollectionReportClass));","map":{"version":3,"sources":["E:/newfrontend/webfe/src/component/Admin/Reports/Types/DailyCollectionReport.js"],"names":["NormalButton","NormalDateTime","NormalMultiSelect","NormalSelect","React","Component","withTranslation","connect","bindActionCreators","getCommonApi","getReport","updateReport","Viewer","Designer","Fragment","DailyCollectionReportClass","state","payGroupOptions","selectedPayGroup","selectedSites","siteOptions","selectedSiteGroup","siteGroupOptions","isEdit","isMounted","isLoading","start","Date","now","end","data","updateState","setState","getData","props","payGroup","branchRes","siteGroupRes","key","push","value","label","itemsite_code","itemsite_desc","groups","code","description","getFormatedDate","input","date","d","getDate","day","a","getMonth","month","year","getFullYear","handleChanges","e","target","name","handleMultiSelect","length","forEach","element","reduce","handleDatePick","onRun","additionalParams","res","console","log","onSaveReport","info","definition","componentWillUnmount","componentDidMount","render","t","report","DataSources","ConnectionProperties","ConnectString","JSON","stringify","displayName","localStorage","getItem","Uri","mapStateToProps","reporting","reportLayout","mapDispatchToProps","dispatch","DailyCollectionReport"],"mappings":"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","sourcesContent":["import {\n  NormalButton,\n  NormalDateTime,\n  NormalMultiSelect,\n  NormalSelect,\n} from \"component/common\";\nimport React, { Component } from \"react\";\nimport { withTranslation } from \"react-i18next\";\nimport { connect } from \"react-redux\";\nimport { bindActionCreators } from \"redux\";\nimport { getCommonApi } from \"redux/actions/common\";\nimport { getReport, updateReport } from \"redux/actions/reports\";\nimport { Viewer, Designer } from \"@grapecity/activereports-react\";\nimport \"../style.scss\";\nimport { Fragment } from \"react\";\n\nclass DailyCollectionReportClass extends Component {\n  state = {\n    payGroupOptions: [],\n    selectedPayGroup: \"\",\n    selectedSites: \"\",\n    siteOptions: [],\n    selectedSiteGroup: \"\",\n    siteGroupOptions: [],\n    isEdit: false,\n    isMounted: true,\n    isLoading: true,\n    start: Date.now(),\n    end: Date.now(),\n    data: null,\n  };\n\n  updateState = (state) => {\n    if (this.state.isMounted) this.setState(state);\n  };\n\n  componentWillUnmount() {\n    this.state.isMounted = false;\n  }\n\n  componentDidMount() {\n    this.getData();\n  }\n\n  getData = async () => {\n    let { siteOptions, siteGroupOptions, payGroupOptions } = this.state;\n    await this.props.getReport(\"SalesDailyReporting\");\n    let payGroup = await this.props.getCommonApi(\"pay_group_list\");\n    let branchRes = await this.props.getCommonApi(\"branchlist/\");\n    let siteGroupRes = await this.props.getCommonApi(\"site_group_list/\");\n    for (let key of payGroup.data) {\n      payGroupOptions.push({\n        value: key,\n        label: key,\n      });\n    }\n    for (let key of branchRes.data) {\n      siteOptions.push({\n        value: key.itemsite_code,\n        label: key.itemsite_desc,\n      });\n    }\n    for (let key of siteGroupRes.data.groups) {\n      siteGroupOptions.push({ value: key.code, label: key.description });\n    }\n    this.updateState({\n      siteOptions,\n      siteGroupOptions,\n      payGroupOptions,\n      isLoading: false,\n    });\n  };\n\n  getFormatedDate = (input) => {\n    let date = new Date(input);\n    let d = date.getDate();\n    let day = d < 10 ? \"0\" + d : d;\n    let a = date.getMonth() + 1;\n    let month = a < 10 ? \"0\" + a : a;\n    let year = date.getFullYear();\n    return `${year}-${month}-${day}`;\n  };\n\n  handleChanges = (e) => {\n    this.state[e.target.name] = e.target.value;\n    this.updateState({});\n  };\n\n  handleMultiSelect = (data = []) => {\n    if (data.length == 0) return this.updateState({ selectedSites: \"\" });\n    let { selectedSites } = this.state;\n    selectedSites = [];\n    data.forEach((element) => {\n      selectedSites.push(element.value);\n    });\n    selectedSites = selectedSites.reduce((a, e) => a + \",\" + e);\n    this.updateState({ selectedSites });\n  };\n\n  handleDatePick = (name, value) => {\n    this.state[name] = value;\n    if (name === \"start\") {\n      let start = new Date(value);\n      let end = new Date(this.state.end);\n      if (end < start) this.state.end = this.state.start;\n    }\n    this.updateState({});\n  };\n\n  onRun = async () => {\n    this.updateState({ isLoading: true });\n    let {\n      data,\n      selectedSites,\n      selectedSiteGroup,\n      selectedPayGroup,\n      start,\n      end,\n    } = this.state;\n    let additionalParams = \"\";\n    if (selectedSiteGroup) additionalParams = `&siteGroup=${selectedSiteGroup}`;\n    else additionalParams = `&siteCodes=${selectedSites}`;\n    if (selectedPayGroup) additionalParams += `&payGroup=${selectedPayGroup}`;\n    try {\n      let res = await this.props.getCommonApi(\n        `SalesDailyReporting?start=${this.getFormatedDate(\n          start\n        )}&end=${this.getFormatedDate(end)}${additionalParams}`\n      );\n      console.log(res);\n      data = res.data;\n      this.updateState({ data, isLoading: false });\n    } catch (e) {\n      console.log(e);\n    }\n    this.updateState({ isLoading: false });\n  };\n\n  onSaveReport = async (info) => {\n    this.updateReport({ isLoading: true });\n    await this.props.updateReport(\"\", info.definition);\n    this.updateReport({ isLoading: false });\n  };\n\n  render() {\n    let { t, report } = this.props;\n    if (report.DataSources)\n      report.DataSources[0].ConnectionProperties.ConnectString = `jsondata=${JSON.stringify(\n        { data: this.state.data }\n      )}`;\n    return (\n      <div className=\"container-fluid report-types\">\n        <div className=\"row mb-4\">\n          <div className=\"col\">\n            <h3>{t(\"Daily Collection Report\")}</h3>\n          </div>\n        </div>\n        {this.state.isLoading ? (\n          <div class=\"d-flex mt-5 align-items-center justify-content-center\">\n            <div class=\"spinner-border\" role=\"status\">\n              <span class=\"sr-only\">Loading...</span>\n            </div>\n          </div>\n        ) : (\n          <>\n            <div className=\"row\">\n              <div className=\"col-md-3 col-lg-2 mb-4\">\n                <NormalButton\n                  label={t(\"Run\")}\n                  mainbg=\"true\"\n                  onClick={this.onRun}\n                />\n              </div>\n              <div className=\"col-md-4 col-lg-3 mb-4\">\n                <NormalButton\n                  label={\n                    this.state.isEdit\n                      ? t(\"Switch to View Mode\")\n                      : t(\"Switch to Edit Mode\")\n                  }\n                  mainbg=\"true\"\n                  onClick={() =>\n                    this.updateState({ isEdit: !this.state.isEdit })\n                  }\n                />\n              </div>\n            </div>\n            <hr />\n            <div className=\"row\">\n              <div className=\"col-md-4 mb-4\">\n                <label className=\"text-left text-black common-label-text fs-17 pb-1\">\n                  {t(\"From Date\")}\n                </label>\n                <NormalDateTime\n                  onChange={this.handleDatePick}\n                  value={this.state.start}\n                  name=\"start\"\n                  showYearDropdown={true}\n                />\n              </div>\n              <div className=\"col-md-4 mb-4\">\n                <label className=\"text-left text-black common-label-text fs-17 pb-1\">\n                  {t(\"To Date\")}\n                </label>\n                <NormalDateTime\n                  onChange={this.handleDatePick}\n                  value={this.state.end}\n                  minDate={this.state.start}\n                  name=\"end\"\n                  showYearDropdown={true}\n                />\n              </div>\n              <div className=\"col-md-4 mb-4\">\n                <label className=\"text-left text-black common-label-text fs-17 pb-1\">\n                  {t(\"Site Group\")}\n                </label>\n                <NormalSelect\n                  onChange={this.handleChanges}\n                  options={this.state.siteGroupOptions}\n                  value={this.state.selectedSiteGroup}\n                  name=\"selectedSiteGroup\"\n                />\n              </div>\n              <div className=\"col-md-4 mb-4\">\n                <label className=\"text-left text-black common-label-text fs-17 pb-1\">\n                  {t(\"Sites\")}\n                </label>\n                <NormalMultiSelect\n                  handleMultiSelect={this.handleMultiSelect}\n                  options={this.state.siteOptions}\n                  value={this.state.selectedSites}\n                  name=\"selectedSites\"\n                />\n              </div>\n              <div className=\"col-md-4 mb-4\">\n                <label className=\"text-left text-black common-label-text fs-17 pb-1\">\n                  {t(\"Pay Group\")}\n                </label>\n                <NormalSelect\n                  onChange={this.handleChanges}\n                  options={this.state.payGroupOptions}\n                  value={this.state.selectedPayGroup}\n                  name=\"selectedPayGroup\"\n                />\n              </div>\n            </div>\n            <hr />\n            <div className=\"row mb-4\">\n              {this.state.data ? (\n                <Fragment>\n                  {this.state.isEdit ? (\n                    <div id=\"designer-host\">\n                      <Designer\n                        report={{\n                          displayName: t(\"report\"),\n                          definition: report,\n                        }}\n                        language={localStorage.getItem(\"lang\")}\n                        onSave={this.onSaveReport}\n                      />\n                    </div>\n                  ) : (\n                    <div id=\"viewer-host\">\n                      <Viewer\n                        report={{ Uri: report }}\n                        availableExports={[]}\n                        sidebarVisible={true}\n                        language={localStorage.getItem(\"lang\")}\n                      />\n                    </div>\n                  )}\n                </Fragment>\n              ) : null}\n            </div>\n          </>\n        )}\n      </div>\n    );\n  }\n}\nconst mapStateToProps = (state) => ({\n  report: state.reporting.reportLayout,\n});\n\nconst mapDispatchToProps = (dispatch) => {\n  return bindActionCreators(\n    {\n      getCommonApi,\n      getReport,\n      updateReport,\n    },\n    dispatch\n  );\n};\n\nexport const DailyCollectionReport = withTranslation()(\n  connect(mapStateToProps, mapDispatchToProps)(DailyCollectionReportClass)\n);\n"]},"metadata":{},"sourceType":"module"}