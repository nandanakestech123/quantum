{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.chart_integration.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar FORMAT_DICTIONARY = {\n  number: \"numeric\",\n  date: \"datetime\"\n};\nvar UNBIND_KEY = \"dxPivotGridUnbinding\";\n\nfunction getFormattedValue(path, fields) {\n  var value = [];\n  var lastFieldIndex = fields.length - 1;\n  (0, _iterator.each)(path, function (i, item) {\n    value.push(item.text || (0, _uiPivot_grid.formatValue)(item.value, fields[lastFieldIndex - i]));\n  });\n  return value.reverse();\n}\n\nfunction getExpandedLevel(node) {\n  var level = 0;\n  (0, _uiPivot_grid.foreachTree)(node, function (members) {\n    level = Math.max(level, members.length - 1);\n  });\n  return level;\n}\n\nfunction processDataCell(processCellArgs, processCell) {\n  var chartDataItem = processCellArgs.chartDataItem;\n  var processedCell = processCell && processCell(processCellArgs);\n\n  if (processedCell) {\n    chartDataItem = (0, _extend.extend)({}, chartDataItem, processedCell.chartDataItem);\n    processedCell = (0, _extend.extend)({}, processCellArgs, processedCell, {\n      chartDataItem: chartDataItem\n    });\n    return processedCell;\n  }\n\n  return processCellArgs;\n}\n\nfunction createChartDataSource(pivotGridDataSource, mapOptions, axisDictionary) {\n  var data = pivotGridDataSource.getData();\n  var dataSource = [];\n  var dataFields = pivotGridDataSource.getAreaFields(\"data\");\n  var rowFields = pivotGridDataSource.getAreaFields(\"row\");\n  var columnFields = pivotGridDataSource.getAreaFields(\"column\");\n  var columnElements = [{\n    index: data.grandTotalColumnIndex,\n    children: data.columns\n  }];\n  var rowElements = [{\n    index: data.grandTotalRowIndex,\n    children: data.rows\n  }];\n  var rowLevel = getExpandedLevel(rowElements);\n  var columnLevel = getExpandedLevel(columnElements);\n  var measureIndex;\n  var dataField;\n  var rowMemberIndex;\n  var rowVisibility;\n  var rowPathFormatted;\n  var rowPath;\n  var columnMemberIndex;\n  var columnVisibility;\n  var columnPath;\n  var columnPathFormatted;\n\n  function createDataItem() {\n    var dataCell = (data.values[rowMemberIndex] || [])[columnMemberIndex] || [];\n    var value = dataCell[measureIndex];\n    var axis;\n    var processCellArgs = {\n      rowPath: rowPath,\n      maxRowLevel: rowLevel,\n      rowPathFormatted: rowPathFormatted,\n      rowFields: rowFields,\n      columnPathFormatted: columnPathFormatted,\n      maxColumnLevel: columnLevel,\n      columnPath: columnPath,\n      columnFields: columnFields,\n      dataFields: dataFields,\n      dataIndex: measureIndex,\n      dataValues: dataCell,\n      visible: columnVisibility && rowVisibility\n    };\n    var seriesName = (mapOptions.inverted ? columnPathFormatted : rowPathFormatted).join(\" - \");\n    var argument = (mapOptions.inverted ? rowPathFormatted : columnPathFormatted).join(\"/\");\n\n    if (dataFields.length > 1) {\n      if (\"args\" === mapOptions.putDataFieldsInto || \"both\" === mapOptions.putDataFieldsInto) {\n        argument += \" | \" + dataField.caption;\n      }\n\n      if (\"args\" !== mapOptions.putDataFieldsInto) {\n        seriesName += \" | \" + dataField.caption;\n\n        if (\"singleAxis\" !== mapOptions.dataFieldsDisplayMode) {\n          axis = dataField.caption;\n        }\n      }\n    }\n\n    processCellArgs.chartDataItem = {\n      val: void 0 === value ? null : value,\n      series: seriesName,\n      arg: argument\n    };\n    processCellArgs = processDataCell(processCellArgs, mapOptions.processCell);\n\n    if (processCellArgs.visible) {\n      axisDictionary[processCellArgs.chartDataItem.series] = axisDictionary[processCellArgs.chartDataItem.series] || axis;\n      dataSource.push(processCellArgs.chartDataItem);\n    }\n  }\n\n  function foreachRowColumn(callBack) {\n    (0, _uiPivot_grid.foreachTree)(rowElements, function (rowMembers) {\n      rowMemberIndex = rowMembers[0].index;\n      rowMembers = rowMembers.slice(0, rowMembers.length - 1);\n      rowVisibility = rowLevel === rowMembers.length;\n      rowPath = (0, _uiPivot_grid.createPath)(rowMembers);\n      rowPathFormatted = getFormattedValue(rowMembers, rowFields);\n\n      if (0 === rowPath.length) {\n        rowPathFormatted = [mapOptions.grandTotalText];\n      }\n\n      (0, _uiPivot_grid.foreachTree)(columnElements, function (columnMembers) {\n        columnMemberIndex = columnMembers[0].index;\n        columnMembers = columnMembers.slice(0, columnMembers.length - 1);\n        columnVisibility = columnLevel === columnMembers.length;\n        columnPath = (0, _uiPivot_grid.createPath)(columnMembers);\n        columnPathFormatted = getFormattedValue(columnMembers, columnFields);\n\n        if (0 === columnPath.length) {\n          columnPathFormatted = [mapOptions.grandTotalText];\n        }\n\n        callBack();\n      });\n    });\n  }\n\n  function foreachDataField(callback) {\n    (0, _iterator.each)(dataFields, function (index, field) {\n      dataField = field;\n      measureIndex = index;\n      callback();\n    });\n  }\n\n  if (false === mapOptions.alternateDataFields) {\n    foreachDataField(function () {\n      foreachRowColumn(createDataItem);\n    });\n  } else {\n    foreachRowColumn(function () {\n      foreachDataField(createDataItem);\n    });\n  }\n\n  return dataSource;\n}\n\nfunction createValueAxisOptions(dataSource, options) {\n  var dataFields = dataSource.getAreaFields(\"data\");\n\n  if (\"args\" !== options.putDataFieldsInto && \"singleAxis\" !== options.dataFieldsDisplayMode || 1 === dataFields.length) {\n    var valueAxisSettings = [];\n    (0, _iterator.each)(dataFields, function (_, dataField) {\n      var valueAxisOptions = {\n        name: dataField.caption,\n        title: dataField.caption,\n        valueType: FORMAT_DICTIONARY[dataField.dataType] || dataField.dataType,\n        label: {\n          format: dataField.format\n        }\n      };\n\n      if (dataField.customizeText) {\n        valueAxisOptions.label.customizeText = function (formatObject) {\n          return dataField.customizeText.call(dataField, formatObject);\n        };\n      }\n\n      if (\"splitPanes\" === options.dataFieldsDisplayMode) {\n        valueAxisOptions.pane = dataField.caption;\n      }\n\n      valueAxisSettings.push(valueAxisOptions);\n    });\n    return valueAxisSettings;\n  }\n\n  return [{}];\n}\n\nfunction createPanesOptions(dataSource, options) {\n  var panes = [];\n  var dataFields = dataSource.getAreaFields(\"data\");\n\n  if (dataFields.length > 1 && \"splitPanes\" === options.dataFieldsDisplayMode && \"args\" !== options.putDataFieldsInto) {\n    (0, _iterator.each)(dataFields, function (_, dataField) {\n      panes.push({\n        name: dataField.caption\n      });\n    });\n  }\n\n  if (!panes.length) {\n    panes.push({});\n  }\n\n  return panes;\n}\n\nfunction createChartOptions(dataSource, options) {\n  var _customizeSeries = options.customizeSeries;\n  var customizeChart = options.customizeChart;\n  var chartOptions = {\n    valueAxis: createValueAxisOptions(dataSource, options),\n    panes: createPanesOptions(dataSource, options)\n  };\n  var axisDictionary = {};\n\n  if (customizeChart) {\n    chartOptions = (0, _extend.extend)(true, {}, chartOptions, customizeChart(chartOptions));\n  }\n\n  chartOptions.dataSource = createChartDataSource(dataSource, options, axisDictionary);\n  chartOptions.seriesTemplate = {\n    nameField: \"series\",\n    customizeSeries: function (seriesName) {\n      var seriesOptions = {};\n\n      if (\"splitPanes\" === options.dataFieldsDisplayMode) {\n        seriesOptions.pane = axisDictionary[seriesName];\n      } else {\n        if (\"singleAxis\" !== options.dataFieldsDisplayMode) {\n          seriesOptions.axis = axisDictionary[seriesName];\n        }\n      }\n\n      if (_customizeSeries) {\n        seriesOptions = (0, _extend.extend)(seriesOptions, _customizeSeries(seriesName, seriesOptions));\n      }\n\n      return seriesOptions;\n    }\n  };\n  return chartOptions;\n}\n\nfunction getChartInstance(chartElement) {\n  if (!chartElement) {\n    return false;\n  }\n\n  if (chartElement.NAME) {\n    return \"dxChart\" === chartElement.NAME && chartElement;\n  }\n\n  var element = (0, _renderer.default)(chartElement);\n  return element.data(\"dxChart\") && element.dxChart(\"instance\");\n}\n\nfunction removeBinding(chart) {\n  var unbind = chart.$element().data(UNBIND_KEY);\n  unbind && unbind();\n}\n\nvar _default = {\n  bindChart: function (chart, integrationOptions) {\n    integrationOptions = (0, _extend.extend)({}, integrationOptions);\n    var that = this;\n\n    var updateChart = function () {\n      integrationOptions.grandTotalText = that.option(\"texts.grandTotal\");\n      var chartOptions = createChartOptions(that.getDataSource(), integrationOptions);\n      chart.option(chartOptions);\n    };\n\n    chart = getChartInstance(chart);\n\n    if (!chart) {\n      return null;\n    }\n\n    removeBinding(chart);\n    that.on(\"changed\", updateChart);\n    updateChart();\n\n    var disposeBinding = function () {\n      chart.$element().removeData(UNBIND_KEY);\n      that.off(\"changed\", updateChart);\n    };\n\n    chart.on(\"disposing\", disposeBinding);\n    this.on(\"disposing\", disposeBinding);\n    chart.$element().data(UNBIND_KEY, disposeBinding);\n    return disposeBinding;\n  }\n};\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["E:/newfrontend/webfe/node_modules/devextreme/ui/pivot_grid/ui.pivot_grid.chart_integration.js"],"names":["exports","default","_renderer","_interopRequireDefault","require","_extend","_uiPivot_grid","_iterator","obj","__esModule","FORMAT_DICTIONARY","number","date","UNBIND_KEY","getFormattedValue","path","fields","value","lastFieldIndex","length","each","i","item","push","text","formatValue","reverse","getExpandedLevel","node","level","foreachTree","members","Math","max","processDataCell","processCellArgs","processCell","chartDataItem","processedCell","extend","createChartDataSource","pivotGridDataSource","mapOptions","axisDictionary","data","getData","dataSource","dataFields","getAreaFields","rowFields","columnFields","columnElements","index","grandTotalColumnIndex","children","columns","rowElements","grandTotalRowIndex","rows","rowLevel","columnLevel","measureIndex","dataField","rowMemberIndex","rowVisibility","rowPathFormatted","rowPath","columnMemberIndex","columnVisibility","columnPath","columnPathFormatted","createDataItem","dataCell","values","axis","maxRowLevel","maxColumnLevel","dataIndex","dataValues","visible","seriesName","inverted","join","argument","putDataFieldsInto","caption","dataFieldsDisplayMode","val","series","arg","foreachRowColumn","callBack","rowMembers","slice","createPath","grandTotalText","columnMembers","foreachDataField","callback","field","alternateDataFields","createValueAxisOptions","options","valueAxisSettings","_","valueAxisOptions","name","title","valueType","dataType","label","format","customizeText","formatObject","call","pane","createPanesOptions","panes","createChartOptions","_customizeSeries","customizeSeries","customizeChart","chartOptions","valueAxis","seriesTemplate","nameField","seriesOptions","getChartInstance","chartElement","NAME","element","dxChart","removeBinding","chart","unbind","$element","_default","bindChart","integrationOptions","that","updateChart","option","getDataSource","on","disposeBinding","removeData","off","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/pivot_grid/ui.pivot_grid.chart_integration.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar FORMAT_DICTIONARY = {\r\n    number: \"numeric\",\r\n    date: \"datetime\"\r\n};\r\nvar UNBIND_KEY = \"dxPivotGridUnbinding\";\r\n\r\nfunction getFormattedValue(path, fields) {\r\n    var value = [];\r\n    var lastFieldIndex = fields.length - 1;\r\n    (0, _iterator.each)(path, function(i, item) {\r\n        value.push(item.text || (0, _uiPivot_grid.formatValue)(item.value, fields[lastFieldIndex - i]))\r\n    });\r\n    return value.reverse()\r\n}\r\n\r\nfunction getExpandedLevel(node) {\r\n    var level = 0;\r\n    (0, _uiPivot_grid.foreachTree)(node, function(members) {\r\n        level = Math.max(level, members.length - 1)\r\n    });\r\n    return level\r\n}\r\n\r\nfunction processDataCell(processCellArgs, processCell) {\r\n    var chartDataItem = processCellArgs.chartDataItem;\r\n    var processedCell = processCell && processCell(processCellArgs);\r\n    if (processedCell) {\r\n        chartDataItem = (0, _extend.extend)({}, chartDataItem, processedCell.chartDataItem);\r\n        processedCell = (0, _extend.extend)({}, processCellArgs, processedCell, {\r\n            chartDataItem: chartDataItem\r\n        });\r\n        return processedCell\r\n    }\r\n    return processCellArgs\r\n}\r\n\r\nfunction createChartDataSource(pivotGridDataSource, mapOptions, axisDictionary) {\r\n    var data = pivotGridDataSource.getData();\r\n    var dataSource = [];\r\n    var dataFields = pivotGridDataSource.getAreaFields(\"data\");\r\n    var rowFields = pivotGridDataSource.getAreaFields(\"row\");\r\n    var columnFields = pivotGridDataSource.getAreaFields(\"column\");\r\n    var columnElements = [{\r\n        index: data.grandTotalColumnIndex,\r\n        children: data.columns\r\n    }];\r\n    var rowElements = [{\r\n        index: data.grandTotalRowIndex,\r\n        children: data.rows\r\n    }];\r\n    var rowLevel = getExpandedLevel(rowElements);\r\n    var columnLevel = getExpandedLevel(columnElements);\r\n    var measureIndex;\r\n    var dataField;\r\n    var rowMemberIndex;\r\n    var rowVisibility;\r\n    var rowPathFormatted;\r\n    var rowPath;\r\n    var columnMemberIndex;\r\n    var columnVisibility;\r\n    var columnPath;\r\n    var columnPathFormatted;\r\n\r\n    function createDataItem() {\r\n        var dataCell = (data.values[rowMemberIndex] || [])[columnMemberIndex] || [];\r\n        var value = dataCell[measureIndex];\r\n        var axis;\r\n        var processCellArgs = {\r\n            rowPath: rowPath,\r\n            maxRowLevel: rowLevel,\r\n            rowPathFormatted: rowPathFormatted,\r\n            rowFields: rowFields,\r\n            columnPathFormatted: columnPathFormatted,\r\n            maxColumnLevel: columnLevel,\r\n            columnPath: columnPath,\r\n            columnFields: columnFields,\r\n            dataFields: dataFields,\r\n            dataIndex: measureIndex,\r\n            dataValues: dataCell,\r\n            visible: columnVisibility && rowVisibility\r\n        };\r\n        var seriesName = (mapOptions.inverted ? columnPathFormatted : rowPathFormatted).join(\" - \");\r\n        var argument = (mapOptions.inverted ? rowPathFormatted : columnPathFormatted).join(\"/\");\r\n        if (dataFields.length > 1) {\r\n            if (\"args\" === mapOptions.putDataFieldsInto || \"both\" === mapOptions.putDataFieldsInto) {\r\n                argument += \" | \" + dataField.caption\r\n            }\r\n            if (\"args\" !== mapOptions.putDataFieldsInto) {\r\n                seriesName += \" | \" + dataField.caption;\r\n                if (\"singleAxis\" !== mapOptions.dataFieldsDisplayMode) {\r\n                    axis = dataField.caption\r\n                }\r\n            }\r\n        }\r\n        processCellArgs.chartDataItem = {\r\n            val: void 0 === value ? null : value,\r\n            series: seriesName,\r\n            arg: argument\r\n        };\r\n        processCellArgs = processDataCell(processCellArgs, mapOptions.processCell);\r\n        if (processCellArgs.visible) {\r\n            axisDictionary[processCellArgs.chartDataItem.series] = axisDictionary[processCellArgs.chartDataItem.series] || axis;\r\n            dataSource.push(processCellArgs.chartDataItem)\r\n        }\r\n    }\r\n\r\n    function foreachRowColumn(callBack) {\r\n        (0, _uiPivot_grid.foreachTree)(rowElements, function(rowMembers) {\r\n            rowMemberIndex = rowMembers[0].index;\r\n            rowMembers = rowMembers.slice(0, rowMembers.length - 1);\r\n            rowVisibility = rowLevel === rowMembers.length;\r\n            rowPath = (0, _uiPivot_grid.createPath)(rowMembers);\r\n            rowPathFormatted = getFormattedValue(rowMembers, rowFields);\r\n            if (0 === rowPath.length) {\r\n                rowPathFormatted = [mapOptions.grandTotalText]\r\n            }(0, _uiPivot_grid.foreachTree)(columnElements, function(columnMembers) {\r\n                columnMemberIndex = columnMembers[0].index;\r\n                columnMembers = columnMembers.slice(0, columnMembers.length - 1);\r\n                columnVisibility = columnLevel === columnMembers.length;\r\n                columnPath = (0, _uiPivot_grid.createPath)(columnMembers);\r\n                columnPathFormatted = getFormattedValue(columnMembers, columnFields);\r\n                if (0 === columnPath.length) {\r\n                    columnPathFormatted = [mapOptions.grandTotalText]\r\n                }\r\n                callBack()\r\n            })\r\n        })\r\n    }\r\n\r\n    function foreachDataField(callback) {\r\n        (0, _iterator.each)(dataFields, function(index, field) {\r\n            dataField = field;\r\n            measureIndex = index;\r\n            callback()\r\n        })\r\n    }\r\n    if (false === mapOptions.alternateDataFields) {\r\n        foreachDataField(function() {\r\n            foreachRowColumn(createDataItem)\r\n        })\r\n    } else {\r\n        foreachRowColumn(function() {\r\n            foreachDataField(createDataItem)\r\n        })\r\n    }\r\n    return dataSource\r\n}\r\n\r\nfunction createValueAxisOptions(dataSource, options) {\r\n    var dataFields = dataSource.getAreaFields(\"data\");\r\n    if (\"args\" !== options.putDataFieldsInto && \"singleAxis\" !== options.dataFieldsDisplayMode || 1 === dataFields.length) {\r\n        var valueAxisSettings = [];\r\n        (0, _iterator.each)(dataFields, function(_, dataField) {\r\n            var valueAxisOptions = {\r\n                name: dataField.caption,\r\n                title: dataField.caption,\r\n                valueType: FORMAT_DICTIONARY[dataField.dataType] || dataField.dataType,\r\n                label: {\r\n                    format: dataField.format\r\n                }\r\n            };\r\n            if (dataField.customizeText) {\r\n                valueAxisOptions.label.customizeText = function(formatObject) {\r\n                    return dataField.customizeText.call(dataField, formatObject)\r\n                }\r\n            }\r\n            if (\"splitPanes\" === options.dataFieldsDisplayMode) {\r\n                valueAxisOptions.pane = dataField.caption\r\n            }\r\n            valueAxisSettings.push(valueAxisOptions)\r\n        });\r\n        return valueAxisSettings\r\n    }\r\n    return [{}]\r\n}\r\n\r\nfunction createPanesOptions(dataSource, options) {\r\n    var panes = [];\r\n    var dataFields = dataSource.getAreaFields(\"data\");\r\n    if (dataFields.length > 1 && \"splitPanes\" === options.dataFieldsDisplayMode && \"args\" !== options.putDataFieldsInto) {\r\n        (0, _iterator.each)(dataFields, function(_, dataField) {\r\n            panes.push({\r\n                name: dataField.caption\r\n            })\r\n        })\r\n    }\r\n    if (!panes.length) {\r\n        panes.push({})\r\n    }\r\n    return panes\r\n}\r\n\r\nfunction createChartOptions(dataSource, options) {\r\n    var _customizeSeries = options.customizeSeries;\r\n    var customizeChart = options.customizeChart;\r\n    var chartOptions = {\r\n        valueAxis: createValueAxisOptions(dataSource, options),\r\n        panes: createPanesOptions(dataSource, options)\r\n    };\r\n    var axisDictionary = {};\r\n    if (customizeChart) {\r\n        chartOptions = (0, _extend.extend)(true, {}, chartOptions, customizeChart(chartOptions))\r\n    }\r\n    chartOptions.dataSource = createChartDataSource(dataSource, options, axisDictionary);\r\n    chartOptions.seriesTemplate = {\r\n        nameField: \"series\",\r\n        customizeSeries: function(seriesName) {\r\n            var seriesOptions = {};\r\n            if (\"splitPanes\" === options.dataFieldsDisplayMode) {\r\n                seriesOptions.pane = axisDictionary[seriesName]\r\n            } else {\r\n                if (\"singleAxis\" !== options.dataFieldsDisplayMode) {\r\n                    seriesOptions.axis = axisDictionary[seriesName]\r\n                }\r\n            }\r\n            if (_customizeSeries) {\r\n                seriesOptions = (0, _extend.extend)(seriesOptions, _customizeSeries(seriesName, seriesOptions))\r\n            }\r\n            return seriesOptions\r\n        }\r\n    };\r\n    return chartOptions\r\n}\r\n\r\nfunction getChartInstance(chartElement) {\r\n    if (!chartElement) {\r\n        return false\r\n    }\r\n    if (chartElement.NAME) {\r\n        return \"dxChart\" === chartElement.NAME && chartElement\r\n    }\r\n    var element = (0, _renderer.default)(chartElement);\r\n    return element.data(\"dxChart\") && element.dxChart(\"instance\")\r\n}\r\n\r\nfunction removeBinding(chart) {\r\n    var unbind = chart.$element().data(UNBIND_KEY);\r\n    unbind && unbind()\r\n}\r\nvar _default = {\r\n    bindChart: function(chart, integrationOptions) {\r\n        integrationOptions = (0, _extend.extend)({}, integrationOptions);\r\n        var that = this;\r\n        var updateChart = function() {\r\n            integrationOptions.grandTotalText = that.option(\"texts.grandTotal\");\r\n            var chartOptions = createChartOptions(that.getDataSource(), integrationOptions);\r\n            chart.option(chartOptions)\r\n        };\r\n        chart = getChartInstance(chart);\r\n        if (!chart) {\r\n            return null\r\n        }\r\n        removeBinding(chart);\r\n        that.on(\"changed\", updateChart);\r\n        updateChart();\r\n        var disposeBinding = function() {\r\n            chart.$element().removeData(UNBIND_KEY);\r\n            that.off(\"changed\", updateChart)\r\n        };\r\n        chart.on(\"disposing\", disposeBinding);\r\n        this.on(\"disposing\", disposeBinding);\r\n        chart.$element().data(UNBIND_KEY, disposeBinding);\r\n        return disposeBinding\r\n    }\r\n};\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}