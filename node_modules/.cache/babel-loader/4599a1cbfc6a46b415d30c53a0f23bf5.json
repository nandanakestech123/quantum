{"ast":null,"code":"/**\r\n * DevExtreme (viz/funnel/funnel.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _tiling = require(\"./tiling\");\n\nvar _tiling2 = _interopRequireDefault(require(\"./tiling.funnel\"));\n\nvar _tiling3 = _interopRequireDefault(require(\"./tiling.pyramid\"));\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _base_widget = _interopRequireDefault(require(\"../core/base_widget\"));\n\nvar _component_registrator = _interopRequireDefault(require(\"../../core/component_registrator\"));\n\nvar _item = _interopRequireDefault(require(\"./item\"));\n\nvar _data_source = require(\"../core/data_source\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar NODES_CREATE_CHANGE = \"NODES_CREATE\";\n(0, _tiling.addAlgorithm)(\"dynamicslope\", _tiling2.default, true);\n(0, _tiling.addAlgorithm)(\"dynamicheight\", _tiling3.default);\n\nfunction invertFigure(figure) {\n  return figure.map(function (coord, index) {\n    return index % 2 ? 1 - coord : coord;\n  });\n}\n\nfunction getLegendItemState(itemState) {\n  return {\n    fill: itemState.fill,\n    hatching: itemState.hatching\n  };\n}\n\nvar dxFunnel = _base_widget.default.inherit({\n  _rootClass: \"dxf-funnel\",\n  _rootClassPrefix: \"dxf\",\n  _proxyData: [],\n  _optionChangesMap: {\n    dataSource: \"DATA_SOURCE\",\n    neckWidth: NODES_CREATE_CHANGE,\n    neckHeight: NODES_CREATE_CHANGE,\n    inverted: NODES_CREATE_CHANGE,\n    algorithm: NODES_CREATE_CHANGE,\n    item: NODES_CREATE_CHANGE,\n    valueField: NODES_CREATE_CHANGE,\n    argumentField: NODES_CREATE_CHANGE,\n    colorField: NODES_CREATE_CHANGE,\n    palette: NODES_CREATE_CHANGE,\n    paletteExtensionMode: NODES_CREATE_CHANGE,\n    sortData: NODES_CREATE_CHANGE\n  },\n  _themeDependentChanges: [NODES_CREATE_CHANGE],\n  _getDefaultSize: function () {\n    return {\n      width: 400,\n      height: 400\n    };\n  },\n  _themeSection: \"funnel\",\n  _fontFields: [\"legend.title.font\", \"legend.title.subtitle.font\", \"legend.font\"],\n  _optionChangesOrder: [\"DATA_SOURCE\"],\n  _initialChanges: [\"DATA_SOURCE\"],\n  _initCore: function () {\n    this._group = this._renderer.g().append(this._renderer.root);\n    this._items = [];\n  },\n  _eventsMap: {\n    onHoverChanged: {\n      name: \"hoverChanged\"\n    },\n    onSelectionChanged: {\n      name: \"selectionChanged\"\n    }\n  },\n  _disposeCore: _common.noop,\n  _applySize: function (rect) {\n    this._rect = rect.slice();\n\n    this._change([\"TILING\"]);\n\n    return this._rect;\n  },\n  _getAlignmentRect: function () {\n    return this._rect;\n  },\n  _change_TILING: function () {\n    var that = this;\n    var items = that._items;\n    var rect = that._rect;\n\n    var convertCoord = function (coord, index) {\n      var offset = index % 2;\n      return rect[0 + offset] + (rect[2 + offset] - rect[0 + offset]) * coord;\n    };\n\n    this._group.clear();\n\n    items.forEach(function (item, index) {\n      var coords = item.figure.map(convertCoord);\n\n      var element = that._renderer.path([], \"area\").attr({\n        points: coords\n      }).append(that._group);\n\n      item.coords = coords;\n      item.element = element;\n    });\n\n    this._requestChange([\"TILES\"]);\n  },\n  _customChangesOrder: [NODES_CREATE_CHANGE, \"LAYOUT\", \"TILING\", \"TILES\", \"DRAWN\"],\n  _dataSourceChangedHandler: function () {\n    this._requestChange([NODES_CREATE_CHANGE]);\n  },\n  _change_DRAWN: function () {\n    this._drawn();\n  },\n  _change_DATA_SOURCE: function () {\n    this._change([\"DRAWN\"]);\n\n    this._updateDataSource();\n  },\n  _change_NODES_CREATE: function () {\n    this._buildNodes();\n  },\n  _change_TILES: function () {\n    this._applyTilesAppearance();\n  },\n  _suspend: function () {\n    if (!this._applyingChanges) {\n      this._suspendChanges();\n    }\n  },\n  _resume: function () {\n    if (!this._applyingChanges) {\n      this._resumeChanges();\n    }\n  },\n  _applyTilesAppearance: function () {\n    this._items.forEach(function (item) {\n      var state = item.getState();\n      item.element.smartAttr(item.states[state]);\n    });\n  },\n  _hitTestTargets: function (x, y) {\n    var that = this;\n    var data;\n\n    this._proxyData.some(function (callback) {\n      data = callback.call(that, x, y);\n\n      if (data) {\n        return true;\n      }\n    });\n\n    return data;\n  },\n  clearHover: function () {\n    this._suspend();\n\n    this._items.forEach(function (item) {\n      item.isHovered() && item.hover(false);\n    });\n\n    this._resume();\n  },\n  clearSelection: function () {\n    this._suspend();\n\n    this._items.forEach(function (item) {\n      item.isSelected() && item.select(false);\n    });\n\n    this._resume();\n  },\n  _getData: function () {\n    var that = this;\n    var data = that._dataSourceItems() || [];\n\n    var valueField = that._getOption(\"valueField\", true);\n\n    var argumentField = that._getOption(\"argumentField\", true);\n\n    var colorField = that._getOption(\"colorField\", true);\n\n    var processedData = data.reduce(function (d, item) {\n      var value = Number(item[valueField]);\n\n      if (value >= 0) {\n        d[0].push({\n          value: value,\n          color: item[colorField],\n          argument: item[argumentField],\n          dataItem: item\n        });\n        d[1] += value;\n      }\n\n      return d;\n    }, [[], 0]);\n    var items = processedData[0];\n\n    if (!processedData[1]) {\n      items = items.map(function (item) {\n        item.value += 1;\n        return item;\n      });\n    }\n\n    if (data.length > 0 && 0 === items.length) {\n      that._incidentOccurred(\"E2005\", valueField);\n    }\n\n    if (that._getOption(\"sortData\", true)) {\n      items.sort(function (a, b) {\n        return b.value - a.value;\n      });\n    }\n\n    return items;\n  },\n  _buildNodes: function () {\n    var that = this;\n\n    var data = that._getData();\n\n    var algorithm = (0, _tiling.getAlgorithm)(that._getOption(\"algorithm\", true));\n    var percents = algorithm.normalizeValues(data);\n\n    var itemOptions = that._getOption(\"item\");\n\n    var figures = algorithm.getFigures(percents, that._getOption(\"neckWidth\", true), that._getOption(\"neckHeight\", true));\n\n    var palette = that._themeManager.createPalette(that._getOption(\"palette\", true), {\n      useHighlight: true,\n      extensionMode: that._getOption(\"paletteExtensionMode\", true),\n      count: figures.length\n    });\n\n    that._items = figures.map(function (figure, index) {\n      var curData = data[index];\n      var node = new _item.default(that, {\n        figure: figure,\n        data: curData,\n        percent: percents[index],\n        id: index,\n        color: curData.color || palette.getNextColor(),\n        itemOptions: itemOptions\n      });\n      return node;\n    });\n\n    if (that._getOption(\"inverted\", true)) {\n      that._items.forEach(function (item) {\n        item.figure = invertFigure(item.figure);\n      });\n    }\n\n    that._renderer.initHatching();\n\n    that._change([\"TILING\", \"DRAWN\"]);\n  },\n  _showTooltip: _common.noop,\n  hideTooltip: _common.noop,\n  getAllItems: function () {\n    return this._items.slice();\n  },\n  _getLegendData: function () {\n    return this._items.map(function (item) {\n      var states = item.states;\n      return {\n        id: item.id,\n        visible: true,\n        text: item.argument,\n        item: item,\n        states: {\n          normal: getLegendItemState(states.normal),\n          hover: getLegendItemState(states.hover),\n          selection: getLegendItemState(states.selection)\n        }\n      };\n    });\n  },\n  _getMinSize: function () {\n    var adaptiveLayout = this._getOption(\"adaptiveLayout\");\n\n    return [adaptiveLayout.width, adaptiveLayout.height];\n  }\n});\n\n(0, _component_registrator.default)(\"dxFunnel\", dxFunnel);\nvar _default = dxFunnel;\nexports.default = _default;\ndxFunnel.addPlugin(_data_source.plugin);\nmodule.exports = exports.default;","map":{"version":3,"sources":["E:/newfrontend/webfe/node_modules/devextreme/viz/funnel/funnel.js"],"names":["exports","default","_tiling","require","_tiling2","_interopRequireDefault","_tiling3","_common","_base_widget","_component_registrator","_item","_data_source","obj","__esModule","NODES_CREATE_CHANGE","addAlgorithm","invertFigure","figure","map","coord","index","getLegendItemState","itemState","fill","hatching","dxFunnel","inherit","_rootClass","_rootClassPrefix","_proxyData","_optionChangesMap","dataSource","neckWidth","neckHeight","inverted","algorithm","item","valueField","argumentField","colorField","palette","paletteExtensionMode","sortData","_themeDependentChanges","_getDefaultSize","width","height","_themeSection","_fontFields","_optionChangesOrder","_initialChanges","_initCore","_group","_renderer","g","append","root","_items","_eventsMap","onHoverChanged","name","onSelectionChanged","_disposeCore","noop","_applySize","rect","_rect","slice","_change","_getAlignmentRect","_change_TILING","that","items","convertCoord","offset","clear","forEach","coords","element","path","attr","points","_requestChange","_customChangesOrder","_dataSourceChangedHandler","_change_DRAWN","_drawn","_change_DATA_SOURCE","_updateDataSource","_change_NODES_CREATE","_buildNodes","_change_TILES","_applyTilesAppearance","_suspend","_applyingChanges","_suspendChanges","_resume","_resumeChanges","state","getState","smartAttr","states","_hitTestTargets","x","y","data","some","callback","call","clearHover","isHovered","hover","clearSelection","isSelected","select","_getData","_dataSourceItems","_getOption","processedData","reduce","d","value","Number","push","color","argument","dataItem","length","_incidentOccurred","sort","a","b","getAlgorithm","percents","normalizeValues","itemOptions","figures","getFigures","_themeManager","createPalette","useHighlight","extensionMode","count","curData","node","percent","id","getNextColor","initHatching","_showTooltip","hideTooltip","getAllItems","_getLegendData","visible","text","normal","selection","_getMinSize","adaptiveLayout","_default","addPlugin","plugin","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/funnel/funnel.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _tiling = require(\"./tiling\");\r\nvar _tiling2 = _interopRequireDefault(require(\"./tiling.funnel\"));\r\nvar _tiling3 = _interopRequireDefault(require(\"./tiling.pyramid\"));\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _base_widget = _interopRequireDefault(require(\"../core/base_widget\"));\r\nvar _component_registrator = _interopRequireDefault(require(\"../../core/component_registrator\"));\r\nvar _item = _interopRequireDefault(require(\"./item\"));\r\nvar _data_source = require(\"../core/data_source\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar NODES_CREATE_CHANGE = \"NODES_CREATE\";\r\n(0, _tiling.addAlgorithm)(\"dynamicslope\", _tiling2.default, true);\r\n(0, _tiling.addAlgorithm)(\"dynamicheight\", _tiling3.default);\r\n\r\nfunction invertFigure(figure) {\r\n    return figure.map(function(coord, index) {\r\n        return index % 2 ? 1 - coord : coord\r\n    })\r\n}\r\n\r\nfunction getLegendItemState(itemState) {\r\n    return {\r\n        fill: itemState.fill,\r\n        hatching: itemState.hatching\r\n    }\r\n}\r\nvar dxFunnel = _base_widget.default.inherit({\r\n    _rootClass: \"dxf-funnel\",\r\n    _rootClassPrefix: \"dxf\",\r\n    _proxyData: [],\r\n    _optionChangesMap: {\r\n        dataSource: \"DATA_SOURCE\",\r\n        neckWidth: NODES_CREATE_CHANGE,\r\n        neckHeight: NODES_CREATE_CHANGE,\r\n        inverted: NODES_CREATE_CHANGE,\r\n        algorithm: NODES_CREATE_CHANGE,\r\n        item: NODES_CREATE_CHANGE,\r\n        valueField: NODES_CREATE_CHANGE,\r\n        argumentField: NODES_CREATE_CHANGE,\r\n        colorField: NODES_CREATE_CHANGE,\r\n        palette: NODES_CREATE_CHANGE,\r\n        paletteExtensionMode: NODES_CREATE_CHANGE,\r\n        sortData: NODES_CREATE_CHANGE\r\n    },\r\n    _themeDependentChanges: [NODES_CREATE_CHANGE],\r\n    _getDefaultSize: function() {\r\n        return {\r\n            width: 400,\r\n            height: 400\r\n        }\r\n    },\r\n    _themeSection: \"funnel\",\r\n    _fontFields: [\"legend.title.font\", \"legend.title.subtitle.font\", \"legend.font\"],\r\n    _optionChangesOrder: [\"DATA_SOURCE\"],\r\n    _initialChanges: [\"DATA_SOURCE\"],\r\n    _initCore: function() {\r\n        this._group = this._renderer.g().append(this._renderer.root);\r\n        this._items = []\r\n    },\r\n    _eventsMap: {\r\n        onHoverChanged: {\r\n            name: \"hoverChanged\"\r\n        },\r\n        onSelectionChanged: {\r\n            name: \"selectionChanged\"\r\n        }\r\n    },\r\n    _disposeCore: _common.noop,\r\n    _applySize: function(rect) {\r\n        this._rect = rect.slice();\r\n        this._change([\"TILING\"]);\r\n        return this._rect\r\n    },\r\n    _getAlignmentRect: function() {\r\n        return this._rect\r\n    },\r\n    _change_TILING: function() {\r\n        var that = this;\r\n        var items = that._items;\r\n        var rect = that._rect;\r\n        var convertCoord = function(coord, index) {\r\n            var offset = index % 2;\r\n            return rect[0 + offset] + (rect[2 + offset] - rect[0 + offset]) * coord\r\n        };\r\n        this._group.clear();\r\n        items.forEach(function(item, index) {\r\n            var coords = item.figure.map(convertCoord);\r\n            var element = that._renderer.path([], \"area\").attr({\r\n                points: coords\r\n            }).append(that._group);\r\n            item.coords = coords;\r\n            item.element = element\r\n        });\r\n        this._requestChange([\"TILES\"])\r\n    },\r\n    _customChangesOrder: [NODES_CREATE_CHANGE, \"LAYOUT\", \"TILING\", \"TILES\", \"DRAWN\"],\r\n    _dataSourceChangedHandler: function() {\r\n        this._requestChange([NODES_CREATE_CHANGE])\r\n    },\r\n    _change_DRAWN: function() {\r\n        this._drawn()\r\n    },\r\n    _change_DATA_SOURCE: function() {\r\n        this._change([\"DRAWN\"]);\r\n        this._updateDataSource()\r\n    },\r\n    _change_NODES_CREATE: function() {\r\n        this._buildNodes()\r\n    },\r\n    _change_TILES: function() {\r\n        this._applyTilesAppearance()\r\n    },\r\n    _suspend: function() {\r\n        if (!this._applyingChanges) {\r\n            this._suspendChanges()\r\n        }\r\n    },\r\n    _resume: function() {\r\n        if (!this._applyingChanges) {\r\n            this._resumeChanges()\r\n        }\r\n    },\r\n    _applyTilesAppearance: function() {\r\n        this._items.forEach(function(item) {\r\n            var state = item.getState();\r\n            item.element.smartAttr(item.states[state])\r\n        })\r\n    },\r\n    _hitTestTargets: function(x, y) {\r\n        var that = this;\r\n        var data;\r\n        this._proxyData.some(function(callback) {\r\n            data = callback.call(that, x, y);\r\n            if (data) {\r\n                return true\r\n            }\r\n        });\r\n        return data\r\n    },\r\n    clearHover: function() {\r\n        this._suspend();\r\n        this._items.forEach(function(item) {\r\n            item.isHovered() && item.hover(false)\r\n        });\r\n        this._resume()\r\n    },\r\n    clearSelection: function() {\r\n        this._suspend();\r\n        this._items.forEach(function(item) {\r\n            item.isSelected() && item.select(false)\r\n        });\r\n        this._resume()\r\n    },\r\n    _getData: function() {\r\n        var that = this;\r\n        var data = that._dataSourceItems() || [];\r\n        var valueField = that._getOption(\"valueField\", true);\r\n        var argumentField = that._getOption(\"argumentField\", true);\r\n        var colorField = that._getOption(\"colorField\", true);\r\n        var processedData = data.reduce(function(d, item) {\r\n            var value = Number(item[valueField]);\r\n            if (value >= 0) {\r\n                d[0].push({\r\n                    value: value,\r\n                    color: item[colorField],\r\n                    argument: item[argumentField],\r\n                    dataItem: item\r\n                });\r\n                d[1] += value\r\n            }\r\n            return d\r\n        }, [\r\n            [], 0\r\n        ]);\r\n        var items = processedData[0];\r\n        if (!processedData[1]) {\r\n            items = items.map(function(item) {\r\n                item.value += 1;\r\n                return item\r\n            })\r\n        }\r\n        if (data.length > 0 && 0 === items.length) {\r\n            that._incidentOccurred(\"E2005\", valueField)\r\n        }\r\n        if (that._getOption(\"sortData\", true)) {\r\n            items.sort(function(a, b) {\r\n                return b.value - a.value\r\n            })\r\n        }\r\n        return items\r\n    },\r\n    _buildNodes: function() {\r\n        var that = this;\r\n        var data = that._getData();\r\n        var algorithm = (0, _tiling.getAlgorithm)(that._getOption(\"algorithm\", true));\r\n        var percents = algorithm.normalizeValues(data);\r\n        var itemOptions = that._getOption(\"item\");\r\n        var figures = algorithm.getFigures(percents, that._getOption(\"neckWidth\", true), that._getOption(\"neckHeight\", true));\r\n        var palette = that._themeManager.createPalette(that._getOption(\"palette\", true), {\r\n            useHighlight: true,\r\n            extensionMode: that._getOption(\"paletteExtensionMode\", true),\r\n            count: figures.length\r\n        });\r\n        that._items = figures.map(function(figure, index) {\r\n            var curData = data[index];\r\n            var node = new _item.default(that, {\r\n                figure: figure,\r\n                data: curData,\r\n                percent: percents[index],\r\n                id: index,\r\n                color: curData.color || palette.getNextColor(),\r\n                itemOptions: itemOptions\r\n            });\r\n            return node\r\n        });\r\n        if (that._getOption(\"inverted\", true)) {\r\n            that._items.forEach(function(item) {\r\n                item.figure = invertFigure(item.figure)\r\n            })\r\n        }\r\n        that._renderer.initHatching();\r\n        that._change([\"TILING\", \"DRAWN\"])\r\n    },\r\n    _showTooltip: _common.noop,\r\n    hideTooltip: _common.noop,\r\n    getAllItems: function() {\r\n        return this._items.slice()\r\n    },\r\n    _getLegendData: function() {\r\n        return this._items.map(function(item) {\r\n            var states = item.states;\r\n            return {\r\n                id: item.id,\r\n                visible: true,\r\n                text: item.argument,\r\n                item: item,\r\n                states: {\r\n                    normal: getLegendItemState(states.normal),\r\n                    hover: getLegendItemState(states.hover),\r\n                    selection: getLegendItemState(states.selection)\r\n                }\r\n            }\r\n        })\r\n    },\r\n    _getMinSize: function() {\r\n        var adaptiveLayout = this._getOption(\"adaptiveLayout\");\r\n        return [adaptiveLayout.width, adaptiveLayout.height]\r\n    }\r\n});\r\n(0, _component_registrator.default)(\"dxFunnel\", dxFunnel);\r\nvar _default = dxFunnel;\r\nexports.default = _default;\r\ndxFunnel.addPlugin(_data_source.plugin);\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}