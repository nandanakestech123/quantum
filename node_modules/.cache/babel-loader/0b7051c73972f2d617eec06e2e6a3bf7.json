{"ast":null,"code":"/**\r\n * DevExtreme (viz/vector_map/layout.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.LayoutControl = LayoutControl;\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _round = Math.round;\nvar _min = Math.min;\nvar _max = Math.max;\nvar _each = _iterator.each;\nvar _inArray = _array.inArray;\nvar horizontalAlignmentMap = {\n  left: 0,\n  center: 1,\n  right: 2\n};\nvar verticalAlignmentMap = {\n  top: 0,\n  bottom: 1\n};\n\nfunction getCellIndex(options) {\n  return 3 * verticalAlignmentMap[options.verticalAlignment] + horizontalAlignmentMap[options.horizontalAlignment];\n}\n\nfunction createCells(canvas, items) {\n  var hStep = (canvas.right - canvas.left) / 3;\n  var vStep = (canvas.bottom - canvas.top) / 2;\n  var h1 = canvas.left;\n\n  var h2 = _round(h1 + hStep);\n\n  var h3 = _round(h1 + hStep + hStep);\n\n  var h4 = canvas.right;\n  var v1 = canvas.top;\n\n  var v2 = _round(v1 + vStep);\n\n  var v3 = canvas.bottom;\n  var cells = [{\n    rect: [h1, v1, h2, v2]\n  }, {\n    rect: [h2, v1, h3, v2],\n    center: true\n  }, {\n    rect: [h3, v1, h4, v2],\n    horInversion: true\n  }, {\n    rect: [h1, v2, h2, v3],\n    verInversion: true\n  }, {\n    rect: [h2, v2, h3, v3],\n    center: true,\n    verInversion: true\n  }, {\n    rect: [h3, v2, h4, v3],\n    horInversion: true,\n    verInversion: true\n  }];\n  var itemsList = [[], [], [], [], [], []];\n\n  _each(items, function (_, item) {\n    var options = item.getLayoutOptions();\n\n    if (options) {\n      itemsList[getCellIndex(options)].push({\n        item: item,\n        width: options.width,\n        height: options.height\n      });\n    }\n  });\n\n  _each(cells, function (i, cell) {\n    if (itemsList[i].length) {\n      cell.items = itemsList[i];\n    } else {\n      if (cell.center) {\n        cell.rect[0] = cell.rect[2] = (cell.rect[0] + cell.rect[2]) / 2;\n      } else {\n        cell.rect[cell.horInversion ? 0 : 2] = cell.rect[cell.horInversion ? 2 : 0];\n      }\n\n      cell.rect[cell.verInversion ? 1 : 3] = cell.rect[cell.verInversion ? 3 : 1];\n    }\n  });\n\n  return cells;\n}\n\nfunction adjustCellSizes(cells) {\n  _each([0, 1, 2, 3, 4, 5], function (_, index) {\n    var cell = cells[index];\n    var otherCell = cells[(index + 3) % 6];\n\n    if (cell.items) {\n      if (!otherCell.items) {\n        cell.rect[1] = _min(cell.rect[1], otherCell.rect[3]);\n        cell.rect[3] = _max(cell.rect[3], otherCell.rect[1]);\n      }\n    }\n  });\n\n  _each([1, 4], function (_, index) {\n    var cell = cells[index];\n    var otherCell1 = cells[index - 1];\n    var otherCell2 = cells[index + 1];\n    var size1;\n    var size2;\n\n    if (cell.items) {\n      if (!otherCell1.items && !otherCell2.items) {\n        size1 = cell.rect[0] - otherCell1.rect[2];\n        size2 = otherCell2.rect[0] - cell.rect[2];\n\n        if (size1 > size2) {\n          if (size1 / size2 >= 2) {\n            cell.rect[0] -= size1;\n            cell.right = true;\n          } else {\n            cell.rect[0] -= size2;\n            cell.rect[2] += size2;\n          }\n        } else {\n          if (size2 / size1 >= 2) {\n            cell.rect[2] += size2;\n            cell.center = null;\n          } else {\n            cell.rect[0] -= size1;\n            cell.rect[2] += size1;\n          }\n        }\n      }\n    } else {\n      if (otherCell1.items) {\n        otherCell1.rect[2] = (cell.rect[0] + cell.rect[2]) / 2;\n      }\n\n      if (otherCell2.items) {\n        otherCell2.rect[0] = (cell.rect[0] + cell.rect[2]) / 2;\n      }\n    }\n  });\n}\n\nfunction adjustCellsAndApplyLayout(cells, forceMode) {\n  var hasHiddenItems = false;\n  adjustCellSizes(cells);\n\n  _each(cells, function (_, cell) {\n    if (cell.items) {\n      hasHiddenItems = applyCellLayout(cell, forceMode) || hasHiddenItems;\n    }\n  });\n\n  return hasHiddenItems;\n}\n\nfunction applyCellLayout(cell, forceMode) {\n  var cellRect = cell.rect;\n  var cellWidth = cellRect[2] - cellRect[0];\n  var cellHeight = cellRect[3] - cellRect[1];\n  var xOffset = 0;\n  var yOffset = 0;\n  var currentHeight = 0;\n  var totalL = cellRect[2];\n  var totalT = cellRect[3];\n  var totalR = cellRect[0];\n  var totalB = cellRect[1];\n  var moves = [];\n  var hasHiddenItems = false;\n\n  _each(cell.items, function (_, item) {\n    if (item.width > cellWidth || item.height > cellHeight) {\n      moves.push(null);\n      hasHiddenItems = true;\n      return forceMode || false;\n    }\n\n    if (xOffset + item.width > cellWidth) {\n      yOffset += currentHeight;\n      xOffset = currentHeight = 0;\n    }\n\n    if (yOffset + item.height > cellHeight) {\n      moves.push(null);\n      hasHiddenItems = true;\n      return forceMode || false;\n    }\n\n    currentHeight = _max(currentHeight, item.height);\n    var dx = cell.horInversion ? cellRect[2] - item.width - xOffset : cellRect[0] + xOffset;\n    var dy = cell.verInversion ? cellRect[3] - item.height - yOffset : cellRect[1] + yOffset;\n    xOffset += item.width;\n    totalL = _min(totalL, dx);\n    totalT = _min(totalT, dy);\n    totalR = _max(totalR, dx + item.width);\n    totalB = _max(totalB, dy + item.height);\n    moves.push([dx, dy]);\n  });\n\n  if (forceMode || !hasHiddenItems) {\n    xOffset = 0;\n\n    if (cell.right) {\n      xOffset = cellRect[2] - cellRect[0] - totalR + totalL;\n    } else {\n      if (cell.center) {\n        xOffset = _round((cellRect[2] - cellRect[0] - totalR + totalL) / 2);\n      }\n    }\n\n    _each(cell.items, function (i, item) {\n      var move = moves[i];\n\n      if (move) {\n        item.item.locate(move[0] + xOffset, move[1]);\n      } else {\n        item.item.resize(null);\n      }\n    });\n\n    cell.rect = [totalL, totalT, totalR, totalB];\n    cell.items = null;\n  }\n\n  return hasHiddenItems;\n}\n\nfunction applyLayout(canvas, items) {\n  var cells = createCells(canvas, items);\n\n  if (adjustCellsAndApplyLayout(cells)) {\n    adjustCellsAndApplyLayout(cells, true);\n  }\n}\n\nfunction LayoutControl(widget) {\n  var that = this;\n  that._items = [];\n  that._suspended = 0;\n  that._widget = widget;\n\n  that._updateLayout = function () {\n    that._update();\n  };\n}\n\nLayoutControl.prototype = {\n  constructor: LayoutControl,\n  dispose: function () {\n    this._items = this._updateLayout = null;\n  },\n  setSize: function (canvas) {\n    this._canvas = canvas;\n\n    this._update();\n  },\n  suspend: function () {\n    ++this._suspended;\n  },\n  resume: function () {\n    if (0 === --this._suspended) {\n      this._update();\n    }\n  },\n  addItem: function (item) {\n    this._items.push(item);\n\n    item.updateLayout = this._updateLayout;\n  },\n  removeItem: function (item) {\n    this._items.splice(_inArray(item, this._items), 1);\n\n    item.updateLayout = null;\n  },\n  _update: function () {\n    var canvas;\n\n    if (0 === this._suspended) {\n      canvas = this._canvas;\n\n      _each(this._items, function (_, item) {\n        item.resize(canvas);\n      });\n\n      this._widget.resolveItemsDeferred(this._items.filter(function (el) {\n        return el.getTemplatesGroups && el.getTemplatesDef;\n      }));\n\n      applyLayout({\n        left: canvas.left,\n        top: canvas.top,\n        right: canvas.width + canvas.left,\n        bottom: canvas.height + canvas.top\n      }, this._items);\n    }\n  }\n};","map":{"version":3,"sources":["E:/newfrontend/webfe/node_modules/devextreme/viz/vector_map/layout.js"],"names":["exports","LayoutControl","_array","require","_iterator","_round","Math","round","_min","min","_max","max","_each","each","_inArray","inArray","horizontalAlignmentMap","left","center","right","verticalAlignmentMap","top","bottom","getCellIndex","options","verticalAlignment","horizontalAlignment","createCells","canvas","items","hStep","vStep","h1","h2","h3","h4","v1","v2","v3","cells","rect","horInversion","verInversion","itemsList","_","item","getLayoutOptions","push","width","height","i","cell","length","adjustCellSizes","index","otherCell","otherCell1","otherCell2","size1","size2","adjustCellsAndApplyLayout","forceMode","hasHiddenItems","applyCellLayout","cellRect","cellWidth","cellHeight","xOffset","yOffset","currentHeight","totalL","totalT","totalR","totalB","moves","dx","dy","move","locate","resize","applyLayout","widget","that","_items","_suspended","_widget","_updateLayout","_update","prototype","constructor","dispose","setSize","_canvas","suspend","resume","addItem","updateLayout","removeItem","splice","resolveItemsDeferred","filter","el","getTemplatesGroups","getTemplatesDef"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/vector_map/layout.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.LayoutControl = LayoutControl;\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _round = Math.round;\r\nvar _min = Math.min;\r\nvar _max = Math.max;\r\nvar _each = _iterator.each;\r\nvar _inArray = _array.inArray;\r\nvar horizontalAlignmentMap = {\r\n    left: 0,\r\n    center: 1,\r\n    right: 2\r\n};\r\nvar verticalAlignmentMap = {\r\n    top: 0,\r\n    bottom: 1\r\n};\r\n\r\nfunction getCellIndex(options) {\r\n    return 3 * verticalAlignmentMap[options.verticalAlignment] + horizontalAlignmentMap[options.horizontalAlignment]\r\n}\r\n\r\nfunction createCells(canvas, items) {\r\n    var hStep = (canvas.right - canvas.left) / 3;\r\n    var vStep = (canvas.bottom - canvas.top) / 2;\r\n    var h1 = canvas.left;\r\n    var h2 = _round(h1 + hStep);\r\n    var h3 = _round(h1 + hStep + hStep);\r\n    var h4 = canvas.right;\r\n    var v1 = canvas.top;\r\n    var v2 = _round(v1 + vStep);\r\n    var v3 = canvas.bottom;\r\n    var cells = [{\r\n        rect: [h1, v1, h2, v2]\r\n    }, {\r\n        rect: [h2, v1, h3, v2],\r\n        center: true\r\n    }, {\r\n        rect: [h3, v1, h4, v2],\r\n        horInversion: true\r\n    }, {\r\n        rect: [h1, v2, h2, v3],\r\n        verInversion: true\r\n    }, {\r\n        rect: [h2, v2, h3, v3],\r\n        center: true,\r\n        verInversion: true\r\n    }, {\r\n        rect: [h3, v2, h4, v3],\r\n        horInversion: true,\r\n        verInversion: true\r\n    }];\r\n    var itemsList = [\r\n        [],\r\n        [],\r\n        [],\r\n        [],\r\n        [],\r\n        []\r\n    ];\r\n    _each(items, function(_, item) {\r\n        var options = item.getLayoutOptions();\r\n        if (options) {\r\n            itemsList[getCellIndex(options)].push({\r\n                item: item,\r\n                width: options.width,\r\n                height: options.height\r\n            })\r\n        }\r\n    });\r\n    _each(cells, function(i, cell) {\r\n        if (itemsList[i].length) {\r\n            cell.items = itemsList[i]\r\n        } else {\r\n            if (cell.center) {\r\n                cell.rect[0] = cell.rect[2] = (cell.rect[0] + cell.rect[2]) / 2\r\n            } else {\r\n                cell.rect[cell.horInversion ? 0 : 2] = cell.rect[cell.horInversion ? 2 : 0]\r\n            }\r\n            cell.rect[cell.verInversion ? 1 : 3] = cell.rect[cell.verInversion ? 3 : 1]\r\n        }\r\n    });\r\n    return cells\r\n}\r\n\r\nfunction adjustCellSizes(cells) {\r\n    _each([0, 1, 2, 3, 4, 5], function(_, index) {\r\n        var cell = cells[index];\r\n        var otherCell = cells[(index + 3) % 6];\r\n        if (cell.items) {\r\n            if (!otherCell.items) {\r\n                cell.rect[1] = _min(cell.rect[1], otherCell.rect[3]);\r\n                cell.rect[3] = _max(cell.rect[3], otherCell.rect[1])\r\n            }\r\n        }\r\n    });\r\n    _each([1, 4], function(_, index) {\r\n        var cell = cells[index];\r\n        var otherCell1 = cells[index - 1];\r\n        var otherCell2 = cells[index + 1];\r\n        var size1;\r\n        var size2;\r\n        if (cell.items) {\r\n            if (!otherCell1.items && !otherCell2.items) {\r\n                size1 = cell.rect[0] - otherCell1.rect[2];\r\n                size2 = otherCell2.rect[0] - cell.rect[2];\r\n                if (size1 > size2) {\r\n                    if (size1 / size2 >= 2) {\r\n                        cell.rect[0] -= size1;\r\n                        cell.right = true\r\n                    } else {\r\n                        cell.rect[0] -= size2;\r\n                        cell.rect[2] += size2\r\n                    }\r\n                } else {\r\n                    if (size2 / size1 >= 2) {\r\n                        cell.rect[2] += size2;\r\n                        cell.center = null\r\n                    } else {\r\n                        cell.rect[0] -= size1;\r\n                        cell.rect[2] += size1\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            if (otherCell1.items) {\r\n                otherCell1.rect[2] = (cell.rect[0] + cell.rect[2]) / 2\r\n            }\r\n            if (otherCell2.items) {\r\n                otherCell2.rect[0] = (cell.rect[0] + cell.rect[2]) / 2\r\n            }\r\n        }\r\n    })\r\n}\r\n\r\nfunction adjustCellsAndApplyLayout(cells, forceMode) {\r\n    var hasHiddenItems = false;\r\n    adjustCellSizes(cells);\r\n    _each(cells, function(_, cell) {\r\n        if (cell.items) {\r\n            hasHiddenItems = applyCellLayout(cell, forceMode) || hasHiddenItems\r\n        }\r\n    });\r\n    return hasHiddenItems\r\n}\r\n\r\nfunction applyCellLayout(cell, forceMode) {\r\n    var cellRect = cell.rect;\r\n    var cellWidth = cellRect[2] - cellRect[0];\r\n    var cellHeight = cellRect[3] - cellRect[1];\r\n    var xOffset = 0;\r\n    var yOffset = 0;\r\n    var currentHeight = 0;\r\n    var totalL = cellRect[2];\r\n    var totalT = cellRect[3];\r\n    var totalR = cellRect[0];\r\n    var totalB = cellRect[1];\r\n    var moves = [];\r\n    var hasHiddenItems = false;\r\n    _each(cell.items, function(_, item) {\r\n        if (item.width > cellWidth || item.height > cellHeight) {\r\n            moves.push(null);\r\n            hasHiddenItems = true;\r\n            return forceMode || false\r\n        }\r\n        if (xOffset + item.width > cellWidth) {\r\n            yOffset += currentHeight;\r\n            xOffset = currentHeight = 0\r\n        }\r\n        if (yOffset + item.height > cellHeight) {\r\n            moves.push(null);\r\n            hasHiddenItems = true;\r\n            return forceMode || false\r\n        }\r\n        currentHeight = _max(currentHeight, item.height);\r\n        var dx = cell.horInversion ? cellRect[2] - item.width - xOffset : cellRect[0] + xOffset;\r\n        var dy = cell.verInversion ? cellRect[3] - item.height - yOffset : cellRect[1] + yOffset;\r\n        xOffset += item.width;\r\n        totalL = _min(totalL, dx);\r\n        totalT = _min(totalT, dy);\r\n        totalR = _max(totalR, dx + item.width);\r\n        totalB = _max(totalB, dy + item.height);\r\n        moves.push([dx, dy])\r\n    });\r\n    if (forceMode || !hasHiddenItems) {\r\n        xOffset = 0;\r\n        if (cell.right) {\r\n            xOffset = cellRect[2] - cellRect[0] - totalR + totalL\r\n        } else {\r\n            if (cell.center) {\r\n                xOffset = _round((cellRect[2] - cellRect[0] - totalR + totalL) / 2)\r\n            }\r\n        }\r\n        _each(cell.items, function(i, item) {\r\n            var move = moves[i];\r\n            if (move) {\r\n                item.item.locate(move[0] + xOffset, move[1])\r\n            } else {\r\n                item.item.resize(null)\r\n            }\r\n        });\r\n        cell.rect = [totalL, totalT, totalR, totalB];\r\n        cell.items = null\r\n    }\r\n    return hasHiddenItems\r\n}\r\n\r\nfunction applyLayout(canvas, items) {\r\n    var cells = createCells(canvas, items);\r\n    if (adjustCellsAndApplyLayout(cells)) {\r\n        adjustCellsAndApplyLayout(cells, true)\r\n    }\r\n}\r\n\r\nfunction LayoutControl(widget) {\r\n    var that = this;\r\n    that._items = [];\r\n    that._suspended = 0;\r\n    that._widget = widget;\r\n    that._updateLayout = function() {\r\n        that._update()\r\n    }\r\n}\r\nLayoutControl.prototype = {\r\n    constructor: LayoutControl,\r\n    dispose: function() {\r\n        this._items = this._updateLayout = null\r\n    },\r\n    setSize: function(canvas) {\r\n        this._canvas = canvas;\r\n        this._update()\r\n    },\r\n    suspend: function() {\r\n        ++this._suspended\r\n    },\r\n    resume: function() {\r\n        if (0 === --this._suspended) {\r\n            this._update()\r\n        }\r\n    },\r\n    addItem: function(item) {\r\n        this._items.push(item);\r\n        item.updateLayout = this._updateLayout\r\n    },\r\n    removeItem: function(item) {\r\n        this._items.splice(_inArray(item, this._items), 1);\r\n        item.updateLayout = null\r\n    },\r\n    _update: function() {\r\n        var canvas;\r\n        if (0 === this._suspended) {\r\n            canvas = this._canvas;\r\n            _each(this._items, function(_, item) {\r\n                item.resize(canvas)\r\n            });\r\n            this._widget.resolveItemsDeferred(this._items.filter(function(el) {\r\n                return el.getTemplatesGroups && el.getTemplatesDef\r\n            }));\r\n            applyLayout({\r\n                left: canvas.left,\r\n                top: canvas.top,\r\n                right: canvas.width + canvas.left,\r\n                bottom: canvas.height + canvas.top\r\n            }, this._items)\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"script"}