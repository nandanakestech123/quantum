{"ast":null,"code":"import _classCallCheck from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from\"react\";import{NormalButton,NormalSelect,TableWrapper}from\"component/common\";import{getTcmApi,tcmCreateApi}from\"redux/actions/TCM\";import{updateForm}from\"redux/actions/common\";import{connect}from\"react-redux\";import{bindActionCreators}from\"redux\";import _ from\"lodash\";import{history}from\"helpers\";import{withTranslation}from\"react-i18next\";import{dateFormat}from\"service/helperFunctions\";import{PDFViewer,PDFDownloadLink,BlobProvider}from\"@react-pdf/renderer\";import Prescription from\"../Report/Prescription\";import{Tcm}from\"service/apiVariables\";export var TCMPaymentListClass=/*#__PURE__*/function(_React$Component){_inherits(TCMPaymentListClass,_React$Component);var _super=_createSuper(TCMPaymentListClass);function TCMPaymentListClass(){var _this;_classCallCheck(this,TCMPaymentListClass);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={headerDetails:[{label:\"Customer Code\"},{label:\"Customer Name\"},{label:\"NRIC\"},{label:\"Gender\"},{label:\"Age\"},{label:\"Date\"},{label:\"Physician\"},{label:\"Status\"},{label:\"Total Amount\"},{label:\"\"},{label:\"\"},{label:\"\"}],tcmPaymentList:[],pageMeta:{},active:false,currentIndex:-1,isPrintPdfClick:false,accountHeader:{name:\"Prescription\",address:\"\",logo:\"\"},tcmPrescriptionMain:[],tcmPrescriptionList:[]};_this.queryHandler=function(data){var payload={siteCode:_this.props.tokenDetails.site_code,date:dateFormat(new Date(),\"yyyy-mm-dd\")};_this.props.tcmCreateApi(\"tcmCustomerListFronDesk/\",payload).then(function(res){console.log(res,\"dsfdfaafg\");var result=res.result,success=res.success;var tcmPaymentList=_this.state.tcmPaymentList;if(success==\"1\"&&result){tcmPaymentList=result;_this.setState({tcmPaymentList:tcmPaymentList});}});};_this.handleGotoCart=function(data){var formFields={custId:0,custName:\"\"};formFields[\"custId\"]=data.customerId;formFields[\"custName\"]=data.customerName;_this.props.updateForm(\"basicApptDetail\",formFields);history.push(\"/admin/cart\");};_this.handleSendBack=function(data){var payload={AppointmentCode:data.apptCode,status:\"Verify\",siteCode:_this.props.tokenDetails.site_code};_this.props.tcmCreateApi(\"tcmAppointmentStatus/\",payload).then(function(res){console.log(res,\"dsfdfaafgcustomerlist\");var result=res.result,success=res.success;if(success==\"1\"&&result){_this.queryHandler({});}});};_this.handlePrescription=function(data){_this.props.getTcmApi(\"tcmPrescriptionReceipt/?PrescriptionNo=\".concat(data.prescriptionNo)).then(function(res){var result=res.result,success=res.success;if(success==\"1\"&&result){console.log(result,\"dsfdfaafgprescriptionresponse\");_this.setState({tcmPrescriptionMain:result});_this.props.getTcmApi(\"tcmPrescription/?PrescriptionNo=\".concat(data.prescriptionNo)).then(function(res){var result=res.result,success=res.success;if(success==\"1\"&&result){console.log(result,\"dsfdfaafgprescriptionresponse\");_this.setState({tcmPrescriptionList:result});_this.setState({isPrintPdfClick:true});}});}});};_this.handlePrintPdfFormat=function(url){var tcmPrescriptionMain=_this.state.tcmPrescriptionMain;console.log(tcmPrescriptionMain,\"prescriptionmain\");_this.setState({isPrintPdfClick:false});var a=document.createElement(\"a\");a.setAttribute(\"download\",\"\".concat(tcmPrescriptionMain[0].prescriptionNo,\".pdf\"));a.setAttribute(\"href\",url);a.click();window.open(url);};return _this;}_createClass(TCMPaymentListClass,[{key:\"componentDidMount\",value:function componentDidMount(){this.queryHandler({});}// api call for list\n},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,headerDetails=_this$state.headerDetails,tcmPaymentList=_this$state.tcmPaymentList,pageMeta=_this$state.pageMeta,currentIndex=_this$state.currentIndex,tcmPrescriptionList=_this$state.tcmPrescriptionList,isPrintPdfClick=_this$state.isPrintPdfClick,accountHeader=_this$state.accountHeader,tcmPrescriptionMain=_this$state.tcmPrescriptionMain;var t=this.props.t;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"table-container mt-3\"},/*#__PURE__*/React.createElement(TableWrapper,{headerDetails:headerDetails// queryHandler={this.handlePagination}\n// pageMeta={pageMeta}\n},tcmPaymentList.length>0?tcmPaymentList.filter(function(acc){return String(acc.apptStatus).toUpperCase()===\"VERIFY\"||String(acc.apptStatus).toUpperCase()===\"AWAITING PAYMENT\";}).map(function(data,index){return/*#__PURE__*/React.createElement(\"tr\",{key:index},/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},data.customerCode)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},data.customerName)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},data.custNRIC)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},data.gender)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},data.customerAge)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},data.apptDate)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},data.physician)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},data.apptStatus)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center\"},data.paymentAmount)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex py-0\"},/*#__PURE__*/React.createElement(NormalButton,{className:\"fs-12\",label:\"Prescribe\",mainbgrev:true,onClick:function onClick(){return _this2.handlePrescription(data);}}))),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex py-0\"},/*#__PURE__*/React.createElement(NormalButton,{className:\"fs-12\",label:\"Payment\",styleFive:true,onClick:function onClick(){return _this2.handleGotoCart(data);}}))),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex py-0\"},/*#__PURE__*/React.createElement(NormalButton,{className:\"w-100 fs-12\",label:\"Send Back\",styleFour:true,onClick:function onClick(){return _this2.handleSendBack(data);}}))));}):null)),isPrintPdfClick?/*#__PURE__*/React.createElement(PDFDownloadLink,{document:/*#__PURE__*/React.createElement(Prescription,{TableDetail:tcmPrescriptionList,MainInfo:tcmPrescriptionMain,accountHeader:accountHeader,Flag:1,landscape:false})},function(_ref){var blob=_ref.blob,url=_ref.url,loading=_ref.loading,error=_ref.error;return!loading&&url?_this2.handlePrintPdfFormat(url):null;}):null);}}]);return TCMPaymentListClass;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{// filter: state.dashboard\ntokenDetails:state.authStore.tokenDetails};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return bindActionCreators({getTcmApi:getTcmApi,tcmCreateApi:tcmCreateApi,updateForm:updateForm},dispatch);};export var TCMPaymentList=withTranslation()(connect(mapStateToProps,mapDispatchToProps)(TCMPaymentListClass));","map":{"version":3,"sources":["E:/newfrontend/webfe/src/component/Admin/TCM/TCMPaymentList/index.js"],"names":["React","NormalButton","NormalSelect","TableWrapper","getTcmApi","tcmCreateApi","updateForm","connect","bindActionCreators","_","history","withTranslation","dateFormat","PDFViewer","PDFDownloadLink","BlobProvider","Prescription","Tcm","TCMPaymentListClass","state","headerDetails","label","tcmPaymentList","pageMeta","active","currentIndex","isPrintPdfClick","accountHeader","name","address","logo","tcmPrescriptionMain","tcmPrescriptionList","queryHandler","data","payload","siteCode","props","tokenDetails","site_code","date","Date","then","res","console","log","result","success","setState","handleGotoCart","formFields","custId","custName","customerId","customerName","push","handleSendBack","AppointmentCode","apptCode","status","handlePrescription","prescriptionNo","handlePrintPdfFormat","url","a","document","createElement","setAttribute","click","window","open","t","length","filter","acc","String","apptStatus","toUpperCase","map","index","customerCode","custNRIC","gender","customerAge","apptDate","physician","paymentAmount","blob","loading","error","Component","mapStateToProps","authStore","mapDispatchToProps","dispatch","TCMPaymentList"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { NormalButton, NormalSelect, TableWrapper } from \"component/common\";\r\nimport { getTcmApi, tcmCreateApi } from \"redux/actions/TCM\";\r\nimport { updateForm } from \"redux/actions/common\";\r\nimport { connect } from \"react-redux\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport _ from \"lodash\";\r\nimport { history } from \"helpers\";\r\nimport { withTranslation } from \"react-i18next\";\r\nimport { dateFormat } from \"service/helperFunctions\";\r\nimport { PDFViewer, PDFDownloadLink, BlobProvider } from \"@react-pdf/renderer\";\r\nimport Prescription from \"../Report/Prescription\";\r\nimport { Tcm } from \"service/apiVariables\";\r\n\r\nexport class TCMPaymentListClass extends React.Component {\r\n  state = {\r\n    headerDetails: [\r\n      { label: \"Customer Code\" },\r\n      { label: \"Customer Name\" },\r\n      { label: \"NRIC\" },\r\n      { label: \"Gender\" },\r\n      { label: \"Age\" },\r\n      { label: \"Date\" },\r\n      { label: \"Physician\" },\r\n      { label: \"Status\" },\r\n      { label: \"Total Amount\" },\r\n      { label: \"\" },\r\n      { label: \"\" },\r\n      { label: \"\" },\r\n    ],\r\n    tcmPaymentList: [],\r\n    pageMeta: {},\r\n    active: false,\r\n    currentIndex: -1,\r\n    isPrintPdfClick: false,\r\n    accountHeader: { name: \"Prescription\", address: \"\", logo: \"\" },\r\n    tcmPrescriptionMain: [],\r\n    tcmPrescriptionList: [],\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.queryHandler({});\r\n  }\r\n\r\n  // api call for list\r\n  queryHandler = data => {\r\n    let payload = {\r\n      siteCode: this.props.tokenDetails.site_code,\r\n      date: dateFormat(new Date(), \"yyyy-mm-dd\"),\r\n    };\r\n    this.props.tcmCreateApi(`tcmCustomerListFronDesk/`, payload).then(res => {\r\n      console.log(res, \"dsfdfaafg\");\r\n      let { result, success } = res;\r\n      let { tcmPaymentList } = this.state;\r\n      if (success == \"1\" && result) {\r\n        tcmPaymentList = result;\r\n        this.setState({\r\n          tcmPaymentList,\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  handleGotoCart = data => {\r\n    let formFields = { custId: 0, custName: \"\" };\r\n    formFields[\"custId\"] = data.customerId;\r\n    formFields[\"custName\"] = data.customerName;\r\n    this.props.updateForm(\"basicApptDetail\", formFields);\r\n\r\n    history.push(\"/admin/cart\");\r\n  };\r\n  handleSendBack = data => {\r\n    let payload = {\r\n      AppointmentCode: data.apptCode,\r\n      status: \"Verify\",\r\n      siteCode: this.props.tokenDetails.site_code,\r\n    };\r\n    this.props.tcmCreateApi(`tcmAppointmentStatus/`, payload).then(res => {\r\n      console.log(res, \"dsfdfaafgcustomerlist\");\r\n      let { result, success } = res;\r\n      if (success == \"1\" && result) {\r\n        this.queryHandler({});\r\n      }\r\n    });\r\n  };\r\n\r\n  handlePrescription = data => {\r\n    this.props\r\n      .getTcmApi(\r\n        `tcmPrescriptionReceipt/?PrescriptionNo=${data.prescriptionNo}`\r\n      )\r\n      .then(res => {\r\n        let { result, success } = res;\r\n        if (success == \"1\" && result) {\r\n          console.log(result, \"dsfdfaafgprescriptionresponse\");\r\n          this.setState({\r\n            tcmPrescriptionMain: result,\r\n          });\r\n          this.props\r\n            .getTcmApi(`tcmPrescription/?PrescriptionNo=${data.prescriptionNo}`)\r\n            .then(res => {\r\n              let { result, success } = res;\r\n              if (success == \"1\" && result) {\r\n                console.log(result, \"dsfdfaafgprescriptionresponse\");\r\n                this.setState({\r\n                  tcmPrescriptionList: result,\r\n                });\r\n                this.setState({ isPrintPdfClick: true });\r\n              }\r\n            });\r\n        }\r\n      });\r\n  };\r\n  handlePrintPdfFormat = url => {\r\n    let { tcmPrescriptionMain } = this.state;\r\n    console.log(tcmPrescriptionMain, \"prescriptionmain\");\r\n    this.setState({\r\n      isPrintPdfClick: false,\r\n    });\r\n    var a = document.createElement(\"a\");\r\n    a.setAttribute(\"download\", `${tcmPrescriptionMain[0].prescriptionNo}.pdf`);\r\n    a.setAttribute(\"href\", url);\r\n    a.click();\r\n    window.open(url);\r\n  };\r\n  render() {\r\n    let {\r\n      headerDetails,\r\n      tcmPaymentList,\r\n      pageMeta,\r\n      currentIndex,\r\n      tcmPrescriptionList,\r\n      isPrintPdfClick,\r\n      accountHeader,\r\n      tcmPrescriptionMain,\r\n    } = this.state;\r\n    let { t } = this.props;\r\n    return (\r\n      <>\r\n        <div className=\"table-container mt-3\">\r\n          <TableWrapper\r\n            headerDetails={headerDetails}\r\n            // queryHandler={this.handlePagination}\r\n            // pageMeta={pageMeta}\r\n          >\r\n            {tcmPaymentList.length > 0\r\n              ? tcmPaymentList\r\n                  .filter(\r\n                    acc =>\r\n                      String(acc.apptStatus).toUpperCase() === \"VERIFY\" ||\r\n                      String(acc.apptStatus).toUpperCase() ===\r\n                        \"AWAITING PAYMENT\"\r\n                  )\r\n                  .map((data, index) => {\r\n                    return (\r\n                      <tr key={index}>\r\n                        <td>\r\n                          <div className=\"d-flex align-items-center justify-content-center\">\r\n                            {data.customerCode}\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex align-items-center justify-content-center\">\r\n                            {data.customerName}\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex align-items-center justify-content-center\">\r\n                            {data.custNRIC}\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex align-items-center justify-content-center\">\r\n                            {data.gender}\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex align-items-center justify-content-center\">\r\n                            {data.customerAge}\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex align-items-center justify-content-center\">\r\n                            {data.apptDate}\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex align-items-center justify-content-center\">\r\n                            {data.physician}\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex align-items-center justify-content-center\">\r\n                            {data.apptStatus}\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex align-items-center justify-content-center\">\r\n                            {data.paymentAmount}\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex py-0\">\r\n                            <NormalButton\r\n                              className={`fs-12`}\r\n                              label=\"Prescribe\"\r\n                              mainbgrev={true}\r\n                              onClick={() => this.handlePrescription(data)}\r\n                            />\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex py-0\">\r\n                            <NormalButton\r\n                              className=\"fs-12\"\r\n                              label=\"Payment\"\r\n                              styleFive={true}\r\n                              onClick={() => this.handleGotoCart(data)}\r\n                            />\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex py-0\">\r\n                            <NormalButton\r\n                              className=\"w-100 fs-12\"\r\n                              label=\"Send Back\"\r\n                              styleFour={true}\r\n                              onClick={() => this.handleSendBack(data)}\r\n                            />\r\n                          </div>\r\n                        </td>\r\n                      </tr>\r\n                    );\r\n                  })\r\n              : null}\r\n          </TableWrapper>\r\n        </div>\r\n        {isPrintPdfClick ? (\r\n          <PDFDownloadLink\r\n            document={\r\n              <Prescription\r\n                TableDetail={tcmPrescriptionList}\r\n                MainInfo={tcmPrescriptionMain}\r\n                accountHeader={accountHeader}\r\n                Flag={1}\r\n                landscape={false}\r\n              />\r\n            }\r\n          >\r\n            {({ blob, url, loading, error }) =>\r\n              !loading && url ? this.handlePrintPdfFormat(url) : null\r\n            }\r\n          </PDFDownloadLink>\r\n        ) : null}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n  // filter: state.dashboard\r\n  tokenDetails: state.authStore.tokenDetails,\r\n});\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return bindActionCreators(\r\n    {\r\n      getTcmApi,\r\n      tcmCreateApi,\r\n      updateForm,\r\n    },\r\n    dispatch\r\n  );\r\n};\r\n\r\nexport const TCMPaymentList = withTranslation()(\r\n  connect(mapStateToProps, mapDispatchToProps)(TCMPaymentListClass)\r\n);\r\n"]},"metadata":{},"sourceType":"module"}