{"ast":null,"code":"/**\r\n * DevExtreme (ui/pivot_grid/data_source.utils.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.sort = sort;\n\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nfunction sort(loadOptions, dataSource, getAscOrder) {\n  sortDimension(dataSource, loadOptions, \"rows\", getAscOrder);\n  sortDimension(dataSource, loadOptions, \"columns\", getAscOrder);\n}\n\nfunction sortDimension(dataSource, loadOptions, dimensionName, getAscOrder) {\n  var fields = loadOptions[dimensionName] || [];\n  var baseIndex = loadOptions.headerName === dimensionName ? loadOptions.path.length : 0;\n  var sortingMethodByLevel = [];\n  (0, _uiPivot_grid.foreachDataLevel)(dataSource[dimensionName], function (item, index) {\n    var field = fields[index] || {};\n    var sortingMethod = sortingMethodByLevel[index] = sortingMethodByLevel[index] || getSortingMethod(field, dataSource, loadOptions, dimensionName, getAscOrder);\n    item.sort(sortingMethod);\n  }, baseIndex);\n}\n\nfunction getSortingMethod(field, dataSource, loadOptions, dimensionName, getAscOrder) {\n  var sortOrder = getAscOrder ? \"asc\" : field.sortOrder;\n  var sortBy = getMemberForSortBy(field.sortBy, getAscOrder);\n  var defaultCompare = field.sortingMethod ? function (a, b) {\n    return field.sortingMethod(a, b);\n  } : (0, _uiPivot_grid.getCompareFunction)(function (item) {\n    return item[sortBy];\n  });\n  var summaryValueSelector = !getAscOrder && getFieldSummaryValueSelector(field, dataSource, loadOptions, dimensionName);\n  var summaryCompare = summaryValueSelector && (0, _uiPivot_grid.getCompareFunction)(summaryValueSelector);\n\n  var sortingMethod = function (a, b) {\n    var result = summaryCompare && summaryCompare(a, b) || defaultCompare(a, b);\n    return \"desc\" === sortOrder ? -result : result;\n  };\n\n  return sortingMethod;\n}\n\nfunction getFieldSummaryValueSelector(field, dataSource, loadOptions, dimensionName) {\n  var values = dataSource.values;\n  var sortBySummaryFieldIndex = (0, _uiPivot_grid.findField)(loadOptions.values, field.sortBySummaryField);\n  var areRows = \"rows\" === dimensionName;\n  var sortByDimension = areRows ? dataSource.columns : dataSource.rows;\n  var grandTotalIndex = areRows ? dataSource.grandTotalRowIndex : dataSource.grandTotalColumnIndex;\n  var sortBySummaryPath = field.sortBySummaryPath || [];\n  var sliceIndex = sortBySummaryPath.length ? getSliceIndex(sortByDimension, sortBySummaryPath) : grandTotalIndex;\n\n  if (values && values.length && sortBySummaryFieldIndex >= 0 && (0, _type.isDefined)(sliceIndex)) {\n    return function (field) {\n      var rowIndex = areRows ? field.index : sliceIndex;\n      var columnIndex = areRows ? sliceIndex : field.index;\n      var value = ((values[rowIndex] || [[]])[columnIndex] || [])[sortBySummaryFieldIndex];\n      return (0, _type.isDefined)(value) ? value : null;\n    };\n  }\n}\n\nfunction getMemberForSortBy(sortBy, getAscOrder) {\n  var member = \"text\";\n\n  if (\"none\" === sortBy) {\n    member = \"index\";\n  } else {\n    if (getAscOrder || \"displayText\" !== sortBy) {\n      member = \"value\";\n    }\n  }\n\n  return member;\n}\n\nfunction getSliceIndex(items, path) {\n  var index = null;\n  var pathValue = (path || []).join(\".\");\n\n  if (pathValue.length) {\n    (0, _uiPivot_grid.foreachTree)(items, function (items) {\n      var item = items[0];\n      var itemPath = (0, _uiPivot_grid.createPath)(items).join(\".\");\n      var textPath = (0, _iterator.map)(items, function (item) {\n        return item.text;\n      }).reverse().join(\".\");\n\n      if (pathValue === itemPath || item.key && textPath === pathValue) {\n        index = items[0].index;\n        return false;\n      }\n    });\n  }\n\n  return index;\n}","map":{"version":3,"sources":["E:/newfrontend/webfe/node_modules/devextreme/ui/pivot_grid/data_source.utils.js"],"names":["exports","sort","_uiPivot_grid","require","_type","_iterator","loadOptions","dataSource","getAscOrder","sortDimension","dimensionName","fields","baseIndex","headerName","path","length","sortingMethodByLevel","foreachDataLevel","item","index","field","sortingMethod","getSortingMethod","sortOrder","sortBy","getMemberForSortBy","defaultCompare","a","b","getCompareFunction","summaryValueSelector","getFieldSummaryValueSelector","summaryCompare","result","values","sortBySummaryFieldIndex","findField","sortBySummaryField","areRows","sortByDimension","columns","rows","grandTotalIndex","grandTotalRowIndex","grandTotalColumnIndex","sortBySummaryPath","sliceIndex","getSliceIndex","isDefined","rowIndex","columnIndex","value","member","items","pathValue","join","foreachTree","itemPath","createPath","textPath","map","text","reverse","key"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/pivot_grid/data_source.utils.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.sort = sort;\r\nvar _uiPivot_grid = require(\"./ui.pivot_grid.utils\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\n\r\nfunction sort(loadOptions, dataSource, getAscOrder) {\r\n    sortDimension(dataSource, loadOptions, \"rows\", getAscOrder);\r\n    sortDimension(dataSource, loadOptions, \"columns\", getAscOrder)\r\n}\r\n\r\nfunction sortDimension(dataSource, loadOptions, dimensionName, getAscOrder) {\r\n    var fields = loadOptions[dimensionName] || [];\r\n    var baseIndex = loadOptions.headerName === dimensionName ? loadOptions.path.length : 0;\r\n    var sortingMethodByLevel = [];\r\n    (0, _uiPivot_grid.foreachDataLevel)(dataSource[dimensionName], function(item, index) {\r\n        var field = fields[index] || {};\r\n        var sortingMethod = sortingMethodByLevel[index] = sortingMethodByLevel[index] || getSortingMethod(field, dataSource, loadOptions, dimensionName, getAscOrder);\r\n        item.sort(sortingMethod)\r\n    }, baseIndex)\r\n}\r\n\r\nfunction getSortingMethod(field, dataSource, loadOptions, dimensionName, getAscOrder) {\r\n    var sortOrder = getAscOrder ? \"asc\" : field.sortOrder;\r\n    var sortBy = getMemberForSortBy(field.sortBy, getAscOrder);\r\n    var defaultCompare = field.sortingMethod ? function(a, b) {\r\n        return field.sortingMethod(a, b)\r\n    } : (0, _uiPivot_grid.getCompareFunction)(function(item) {\r\n        return item[sortBy]\r\n    });\r\n    var summaryValueSelector = !getAscOrder && getFieldSummaryValueSelector(field, dataSource, loadOptions, dimensionName);\r\n    var summaryCompare = summaryValueSelector && (0, _uiPivot_grid.getCompareFunction)(summaryValueSelector);\r\n    var sortingMethod = function(a, b) {\r\n        var result = summaryCompare && summaryCompare(a, b) || defaultCompare(a, b);\r\n        return \"desc\" === sortOrder ? -result : result\r\n    };\r\n    return sortingMethod\r\n}\r\n\r\nfunction getFieldSummaryValueSelector(field, dataSource, loadOptions, dimensionName) {\r\n    var values = dataSource.values;\r\n    var sortBySummaryFieldIndex = (0, _uiPivot_grid.findField)(loadOptions.values, field.sortBySummaryField);\r\n    var areRows = \"rows\" === dimensionName;\r\n    var sortByDimension = areRows ? dataSource.columns : dataSource.rows;\r\n    var grandTotalIndex = areRows ? dataSource.grandTotalRowIndex : dataSource.grandTotalColumnIndex;\r\n    var sortBySummaryPath = field.sortBySummaryPath || [];\r\n    var sliceIndex = sortBySummaryPath.length ? getSliceIndex(sortByDimension, sortBySummaryPath) : grandTotalIndex;\r\n    if (values && values.length && sortBySummaryFieldIndex >= 0 && (0, _type.isDefined)(sliceIndex)) {\r\n        return function(field) {\r\n            var rowIndex = areRows ? field.index : sliceIndex;\r\n            var columnIndex = areRows ? sliceIndex : field.index;\r\n            var value = ((values[rowIndex] || [\r\n                []\r\n            ])[columnIndex] || [])[sortBySummaryFieldIndex];\r\n            return (0, _type.isDefined)(value) ? value : null\r\n        }\r\n    }\r\n}\r\n\r\nfunction getMemberForSortBy(sortBy, getAscOrder) {\r\n    var member = \"text\";\r\n    if (\"none\" === sortBy) {\r\n        member = \"index\"\r\n    } else {\r\n        if (getAscOrder || \"displayText\" !== sortBy) {\r\n            member = \"value\"\r\n        }\r\n    }\r\n    return member\r\n}\r\n\r\nfunction getSliceIndex(items, path) {\r\n    var index = null;\r\n    var pathValue = (path || []).join(\".\");\r\n    if (pathValue.length) {\r\n        (0, _uiPivot_grid.foreachTree)(items, function(items) {\r\n            var item = items[0];\r\n            var itemPath = (0, _uiPivot_grid.createPath)(items).join(\".\");\r\n            var textPath = (0, _iterator.map)(items, function(item) {\r\n                return item.text\r\n            }).reverse().join(\".\");\r\n            if (pathValue === itemPath || item.key && textPath === pathValue) {\r\n                index = items[0].index;\r\n                return false\r\n            }\r\n        })\r\n    }\r\n    return index\r\n}\r\n"]},"metadata":{},"sourceType":"script"}