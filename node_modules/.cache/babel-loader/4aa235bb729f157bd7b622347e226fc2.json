{"ast":null,"code":"import _createForOfIteratorHelper from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createForOfIteratorHelper\";import _classCallCheck from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _assertThisInitialized from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"F:\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import\"./style.scss\";import{NormalButton,NormalInput,NormalSelect,InputSearch,NormalModal,TableWrapper}from\"component/common\";import{dateFormat}from\"service/helperFunctions\";import _ from\"lodash\";import{history}from\"helpers\";import{connect}from\"react-redux\";import{bindActionCreators}from\"redux\";import{getCommonApi,updateForm,commonCreateApi,commonDeleteApi,commonPatchApi}from\"redux/actions/common\";import SimpleReactValidator from\"simple-react-validator\";// import { Treatment, Payment, EditCart } from './cart/index';\nimport service from\"assets/images/make-up-brush.png\";// import Discount from './cart/discount';\nimport{FormGroup,Label,Input}from\"reactstrap\";import{withTranslation}from\"react-i18next\";export var TopupProductClass=/*#__PURE__*/function(_Component){_inherits(TopupProductClass,_Component);var _super=_createSuper(TopupProductClass);function TopupProductClass(){var _this;_classCallCheck(this,TopupProductClass);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={treatmentList:[],cartData:{},formFields:{customer_name:\"\",new_outstanding:\"\",old_outstanding:\"\",topup_amount:\"\"},headerDetails:[{label:\"Invoice No\",sortKey:false,width:\"120px\"},{label:\"Item\",sortKey:false,width:\"150px\"},{label:\"Qty\",sortKey:false,width:\"50px\",divClass:\"justify-content-end text-right\"},{label:\"Deposit\",width:\"100px\",divClass:\"justify-content-end text-right\"},{label:\"Outstanding\",sortKey:false,width:\"100px\",divClass:\"justify-content-end text-right\"},{label:\"Pay amount\",width:\"100px\",divClass:\"justify-content-center\"},{label:\"Staff\",width:\"100px\"}]};_this.componentWillMount=function(){_this.validator=new SimpleReactValidator({element:function element(message){return/*#__PURE__*/React.createElement(\"span\",{className:\"error-message text-danger validNo fs14\"},message);},autoForceUpdate:_assertThisInitialized(_this)});var _this$state=_this.state,roomList=_this$state.roomList,sourceList=_this$state.sourceList,staffList=_this$state.staffList,cartData=_this$state.cartData,duration=_this$state.duration,treatmentList=_this$state.treatmentList;_this.getCart();};_this.getCart=function(){var _this$state2=_this.state,roomList=_this$state2.roomList,sourceList=_this$state2.sourceList,staffList=_this$state2.staffList,cartData=_this$state2.cartData,duration=_this$state2.duration,treatmentList=_this$state2.treatmentList;_this.props.getCommonApi(\"topupproduct/?cust_id=\".concat(_this.props.id)).then(function(key){cartData=key;treatmentList=key.data;_this.setState({cartData:cartData,treatmentList:treatmentList});_this.getDataFromRes(key);// }\n});};_this.getDataFromRes=function(data){var header_data=data.header_data;var formFields=_this.state.formFields;formFields[\"customer_name\"]=header_data?header_data.customer_name:\"\";formFields[\"new_outstanding\"]=header_data?header_data.new_outstanding:\"\";formFields[\"old_outstanding\"]=header_data?header_data.old_outstanding:\"\";formFields[\"topup_amount\"]=header_data?header_data.topup_amount:\"\";_this.setState({formFields:formFields});};_this.handleCreateCart=function(){var basicApptDetail=_this.props.basicApptDetail;var treatmentList=_this.state.treatmentList;var payload=[];if(_this.validator.allValid()){var _iterator=_createForOfIteratorHelper(treatmentList),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var key=_step.value;if(key.pay_amount>0){var obj={cust_noid:basicApptDetail.custId,cart_date:dateFormat(new Date(),\"yyyy-mm-dd\"),itemcodeid:key.stock_id,price:key.pay_amount,item_uom:null,treatment_account:null,deposit_account:key.DepositAccountid,prepaid_account:null};payload.push(obj);}}}catch(err){_iterator.e(err);}finally{_iterator.f();}_this.props.getCommonApi(\"itemcart/Check/?cart_date=\".concat(dateFormat(new Date(),\"yyyy-mm-dd\"),\"&cust_noid=\").concat(basicApptDetail.custId)).then(function(res){if(res.data.length===0){_this.props.commonCreateApi(\"itemcart/TopUpCartCreate/\",payload).then(function(res){// this.props.handleCartCreated()\n_this.props.handleModal();});}else{_this.props.commonCreateApi(\"itemcart/TopUpCartCreate/?cart_id=\".concat(res.cart_id),payload).then(function(res){_this.props.handleModal();});}});}else{_this.validator.showMessages();}};_this.handleClearLine=function(){_this.props.commonDeleteApi(\"tmpitemhelper/delete/?clear_all=0&cartid=\".concat(_this.props.cartId)).then(function(){_this.getCart();});};_this.handleClearAll=function(){_this.props.commonDeleteApi(\"tmpitemhelper/delete/?clear_all=1&cartid=\".concat(_this.props.cartId)).then(function(){var _this$state3=_this.state,formFields=_this$state3.formFields,postFields=_this$state3.postFields;// formFields[\"work_point\"] = \"\";\n// postFields['times'] = \"\";\n_this.setState({formFields:formFields,postFields:postFields});_this.getCart();});};_this.handlePayAmount=function(event,data,index){var treatmentList=_this.state.treatmentList;treatmentList[index][event.target.name]=event.target.value;_this.setState({treatmentList:treatmentList});};return _this;}_createClass(TopupProductClass,[{key:\"render\",value:function render(){var _this2=this;var _this$state4=this.state,_this$state4$workpoin=_this$state4.workpoint,workpoint=_this$state4$workpoin===void 0?\"\":_this$state4$workpoin,_this$state4$treatmen=_this$state4.treatmentList,treatmentList=_this$state4$treatmen===void 0?[]:_this$state4$treatmen,headerDetails=_this$state4.headerDetails,formFields=_this$state4.formFields;var customer_name=formFields.customer_name,new_outstanding=formFields.new_outstanding,old_outstanding=formFields.old_outstanding,topup_amount=formFields.topup_amount;var t=this.props.t;return/*#__PURE__*/React.createElement(\"div\",{className:\"row new-cart treatment-done top-up\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-5\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-left w-100 text-black common-label-text mr-2\"},t(\"Customer\")),/*#__PURE__*/React.createElement(\"div\",{className:\"input-group\"},/*#__PURE__*/React.createElement(NormalInput,{value:customer_name,name:\"customer_name\",onChange:this.handlePostChange,className:\"customer-name\",disabled:true}))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-left w-100 text-black common-label-text mr-2\"},t(\"Outstanding\")),/*#__PURE__*/React.createElement(\"div\",{className:\"input-group\"},/*#__PURE__*/React.createElement(NormalInput,{value:old_outstanding,name:\"old_outstanding\",onChange:this.handlePostChange,className:\"customer-name\",disabled:true})))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-3\"},/*#__PURE__*/React.createElement(FormGroup,{check:true,className:\"m-0\"},/*#__PURE__*/React.createElement(Label,{check:true},/*#__PURE__*/React.createElement(Input,{type:\"checkbox\",onChange:this.props.handleChangeBox,name:\"cust_maillist\"}),t(\"Auto\")))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-left w-100 text-black common-label-text mr-2\"},t(\"Top Up Amount\")),/*#__PURE__*/React.createElement(\"div\",{className:\"input-group\"},/*#__PURE__*/React.createElement(NormalInput,{value:topup_amount,name:\"topup_amount\",onChange:this.handlePostChange,className:\"customer-name\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-left w-100 text-black common-label-text mr-2\"},t(\"New Outstanding\")),/*#__PURE__*/React.createElement(\"div\",{className:\"input-group\"},/*#__PURE__*/React.createElement(NormalInput,{value:new_outstanding,name:\"new_outstanding\",onChange:this.handlePostChange,className:\"customer-name\"})))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 cart-item mt-2\"},/*#__PURE__*/React.createElement(\"div\",{className:\"item-list\"},/*#__PURE__*/React.createElement(\"div\",{className:\"table\"},/*#__PURE__*/React.createElement(TableWrapper,{headerDetails:headerDetails,queryHandler:this.handlePagination},treatmentList.length>0?treatmentList.map(function(item,index){return/*#__PURE__*/React.createElement(\"tr\",{key:index},/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-left\"},item.transaction_code)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-left\"},item.item_description)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-right\"},item.qty)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-right\"},item.balance)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-right\"},item.outstanding)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center payment-input justify-content-center\"},/*#__PURE__*/React.createElement(NormalInput,{value:item.pay_amount,name:\"pay_amount\",onChange:function onChange(e){return _this2.handlePayAmount(e,item,index);},className:\"customer-name text-right\"}),item.pay_amount?_this2.validator.message(\"pay_amount\",item.pay_amount,\"required|max:\".concat(Number(item.outstanding),\",num\")):\"\")),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-left\"},item.sa_staffname)));}):null)))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 pt-4 action-bar\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-6 d-flex\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"col-4 text-right\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"col-2 text-right\"},/*#__PURE__*/React.createElement(NormalButton,{buttonClass:\"mx-2\",mainbg:true,className:\" fs-15 confirm\",label:\"Confirm\",outline:false,onClick:this.handleCreateCart})))));}}]);return TopupProductClass;}(Component);var mapStateToProps=function mapStateToProps(state){return{selected_cstomer:state.common.selected_cstomer,basicApptDetail:state.appointment.basicApptDetail};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return bindActionCreators({// getCustomer,\ngetCommonApi:getCommonApi,updateForm:updateForm,commonCreateApi:commonCreateApi,commonPatchApi:commonPatchApi,commonDeleteApi:commonDeleteApi},dispatch);};export var TopupProduct=withTranslation()(connect(mapStateToProps,mapDispatchToProps)(TopupProductClass));","map":{"version":3,"sources":["F:/webfe/src/component/Admin/Cart/topup/product.js"],"names":["React","Component","NormalButton","NormalInput","NormalSelect","InputSearch","NormalModal","TableWrapper","dateFormat","_","history","connect","bindActionCreators","getCommonApi","updateForm","commonCreateApi","commonDeleteApi","commonPatchApi","SimpleReactValidator","service","FormGroup","Label","Input","withTranslation","TopupProductClass","state","treatmentList","cartData","formFields","customer_name","new_outstanding","old_outstanding","topup_amount","headerDetails","label","sortKey","width","divClass","componentWillMount","validator","element","message","autoForceUpdate","roomList","sourceList","staffList","duration","getCart","props","id","then","key","data","setState","getDataFromRes","header_data","handleCreateCart","basicApptDetail","payload","allValid","pay_amount","obj","cust_noid","custId","cart_date","Date","itemcodeid","stock_id","price","item_uom","treatment_account","deposit_account","DepositAccountid","prepaid_account","push","res","length","handleModal","cart_id","showMessages","handleClearLine","cartId","handleClearAll","postFields","handlePayAmount","event","index","target","name","value","workpoint","t","handlePostChange","handleChangeBox","handlePagination","map","item","transaction_code","item_description","qty","balance","outstanding","e","Number","sa_staffname","mapStateToProps","selected_cstomer","common","appointment","mapDispatchToProps","dispatch","TopupProduct"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport \"./style.scss\";\r\nimport {\r\n  NormalButton,\r\n  NormalInput,\r\n  NormalSelect,\r\n  InputSearch,\r\n  NormalModal,\r\n  TableWrapper,\r\n} from \"component/common\";\r\nimport { dateFormat } from \"service/helperFunctions\";\r\nimport _ from \"lodash\";\r\nimport { history } from \"helpers\";\r\nimport { connect } from \"react-redux\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport {\r\n  getCommonApi,\r\n  updateForm,\r\n  commonCreateApi,\r\n  commonDeleteApi,\r\n  commonPatchApi,\r\n} from \"redux/actions/common\";\r\nimport SimpleReactValidator from \"simple-react-validator\";\r\n// import { Treatment, Payment, EditCart } from './cart/index';\r\nimport service from \"assets/images/make-up-brush.png\";\r\n// import Discount from './cart/discount';\r\nimport { FormGroup, Label, Input } from \"reactstrap\";\r\nimport { withTranslation } from \"react-i18next\";\r\n\r\nexport class TopupProductClass extends Component {\r\n  state = {\r\n    treatmentList: [],\r\n    cartData: {},\r\n    formFields: {\r\n      customer_name: \"\",\r\n      new_outstanding: \"\",\r\n      old_outstanding: \"\",\r\n      topup_amount: \"\",\r\n    },\r\n    headerDetails: [\r\n      { label: \"Invoice No\", sortKey: false, width: \"120px\" },\r\n      { label: \"Item\", sortKey: false, width: \"150px\" },\r\n      {\r\n        label: \"Qty\",\r\n        sortKey: false,\r\n        width: \"50px\",\r\n        divClass: \"justify-content-end text-right\",\r\n      },\r\n      {\r\n        label: \"Deposit\",\r\n        width: \"100px\",\r\n        divClass: \"justify-content-end text-right\",\r\n      },\r\n      {\r\n        label: \"Outstanding\",\r\n        sortKey: false,\r\n        width: \"100px\",\r\n        divClass: \"justify-content-end text-right\",\r\n      },\r\n      {\r\n        label: \"Pay amount\",\r\n        width: \"100px\",\r\n        divClass: \"justify-content-center\",\r\n      },\r\n      { label: \"Staff\", width: \"100px\" },\r\n    ],\r\n  };\r\n\r\n  componentWillMount = () => {\r\n    this.validator = new SimpleReactValidator({\r\n      element: message => (\r\n        <span className=\"error-message text-danger validNo fs14\">\r\n          {message}\r\n        </span>\r\n      ),\r\n      autoForceUpdate: this,\r\n    });\r\n    let { roomList, sourceList, staffList, cartData, duration, treatmentList } =\r\n      this.state;\r\n\r\n    this.getCart();\r\n  };\r\n\r\n  getCart = () => {\r\n    let { roomList, sourceList, staffList, cartData, duration, treatmentList } =\r\n      this.state;\r\n    this.props\r\n      .getCommonApi(`topupproduct/?cust_id=${this.props.id}`)\r\n      .then(key => {\r\n        cartData = key;\r\n        treatmentList = key.data;\r\n        this.setState({ cartData, treatmentList });\r\n        this.getDataFromRes(key);\r\n        // }\r\n      });\r\n  };\r\n\r\n  getDataFromRes = data => {\r\n    let { header_data } = data;\r\n    let { formFields } = this.state;\r\n    formFields[\"customer_name\"] = header_data ? header_data.customer_name : \"\";\r\n    formFields[\"new_outstanding\"] = header_data\r\n      ? header_data.new_outstanding\r\n      : \"\";\r\n    formFields[\"old_outstanding\"] = header_data\r\n      ? header_data.old_outstanding\r\n      : \"\";\r\n    formFields[\"topup_amount\"] = header_data ? header_data.topup_amount : \"\";\r\n    this.setState({\r\n      formFields,\r\n    });\r\n  };\r\n\r\n  handleCreateCart = () => {\r\n    let { basicApptDetail } = this.props;\r\n    let { treatmentList } = this.state;\r\n    let payload = [];\r\n    if (this.validator.allValid()) {\r\n      for (let key of treatmentList) {\r\n        if (key.pay_amount > 0) {\r\n          let obj = {\r\n            cust_noid: basicApptDetail.custId,\r\n            cart_date: dateFormat(new Date(), \"yyyy-mm-dd\"),\r\n            itemcodeid: key.stock_id,\r\n            price: key.pay_amount,\r\n            item_uom: null,\r\n            treatment_account: null,\r\n            deposit_account: key.DepositAccountid,\r\n            prepaid_account: null,\r\n          };\r\n          payload.push(obj);\r\n        }\r\n      }\r\n\r\n      this.props\r\n        .getCommonApi(\r\n          `itemcart/Check/?cart_date=${dateFormat(\r\n            new Date(),\r\n            \"yyyy-mm-dd\"\r\n          )}&cust_noid=${basicApptDetail.custId}`\r\n        )\r\n        .then(res => {\r\n          if (res.data.length === 0) {\r\n            this.props\r\n              .commonCreateApi(\"itemcart/TopUpCartCreate/\", payload)\r\n              .then(res => {\r\n                // this.props.handleCartCreated()\r\n                this.props.handleModal();\r\n              });\r\n          } else {\r\n            this.props\r\n              .commonCreateApi(\r\n                `itemcart/TopUpCartCreate/?cart_id=${res.cart_id}`,\r\n                payload\r\n              )\r\n              .then(res => {\r\n                this.props.handleModal();\r\n              });\r\n          }\r\n        });\r\n    } else {\r\n      this.validator.showMessages();\r\n    }\r\n  };\r\n\r\n  handleClearLine = () => {\r\n    this.props\r\n      .commonDeleteApi(\r\n        `tmpitemhelper/delete/?clear_all=0&cartid=${this.props.cartId}`\r\n      )\r\n      .then(() => {\r\n        this.getCart();\r\n      });\r\n  };\r\n\r\n  handleClearAll = () => {\r\n    this.props\r\n      .commonDeleteApi(\r\n        `tmpitemhelper/delete/?clear_all=1&cartid=${this.props.cartId}`\r\n      )\r\n      .then(() => {\r\n        let { formFields, postFields } = this.state;\r\n        // formFields[\"work_point\"] = \"\";\r\n        // postFields['times'] = \"\";\r\n        this.setState({\r\n          formFields,\r\n          postFields,\r\n        });\r\n        this.getCart();\r\n      });\r\n  };\r\n\r\n  handlePayAmount = (event, data, index) => {\r\n    let { treatmentList } = this.state;\r\n    treatmentList[index][event.target.name] = event.target.value;\r\n    this.setState({\r\n      treatmentList,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    let {\r\n      workpoint = \"\",\r\n      treatmentList = [],\r\n      headerDetails,\r\n      formFields,\r\n    } = this.state;\r\n    let { customer_name, new_outstanding, old_outstanding, topup_amount } =\r\n      formFields;\r\n    let { t } = this.props;\r\n    return (\r\n      <div className=\"row new-cart treatment-done top-up\">\r\n        <div className=\"col-5\">\r\n          <div className=\"d-flex\">\r\n            <label className=\"text-left w-100 text-black common-label-text mr-2\">\r\n              {t(\"Customer\")}\r\n            </label>\r\n            <div className=\"input-group\">\r\n              <NormalInput\r\n                value={customer_name}\r\n                name=\"customer_name\"\r\n                onChange={this.handlePostChange}\r\n                className={`customer-name`}\r\n                disabled\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className=\"d-flex\">\r\n            <label className=\"text-left w-100 text-black common-label-text mr-2\">\r\n              {t(\"Outstanding\")}\r\n            </label>\r\n            <div className=\"input-group\">\r\n              <NormalInput\r\n                value={old_outstanding}\r\n                name=\"old_outstanding\"\r\n                onChange={this.handlePostChange}\r\n                className={`customer-name`}\r\n                disabled\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"col-3\">\r\n          <FormGroup check className=\"m-0\">\r\n            <Label check>\r\n              <Input\r\n                type=\"checkbox\"\r\n                onChange={this.props.handleChangeBox}\r\n                name=\"cust_maillist\"\r\n              />\r\n              {t(\"Auto\")}\r\n            </Label>\r\n          </FormGroup>\r\n        </div>\r\n        <div className=\"col-4\">\r\n          <div className=\"d-flex\">\r\n            <label className=\"text-left w-100 text-black common-label-text mr-2\">\r\n              {t(\"Top Up Amount\")}\r\n            </label>\r\n            <div className=\"input-group\">\r\n              <NormalInput\r\n                value={topup_amount}\r\n                name=\"topup_amount\"\r\n                onChange={this.handlePostChange}\r\n                className={`customer-name`}\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className=\"d-flex\">\r\n            <label className=\"text-left w-100 text-black common-label-text mr-2\">\r\n              {t(\"New Outstanding\")}\r\n            </label>\r\n            <div className=\"input-group\">\r\n              <NormalInput\r\n                value={new_outstanding}\r\n                name=\"new_outstanding\"\r\n                onChange={this.handlePostChange}\r\n                className={`customer-name`}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className={`col-12 cart-item mt-2`}>\r\n          <div className={`item-list`}>\r\n            <div className=\"table\">\r\n              <TableWrapper\r\n                headerDetails={headerDetails}\r\n                queryHandler={this.handlePagination}\r\n              >\r\n                {treatmentList.length > 0\r\n                  ? treatmentList.map((item, index) => {\r\n                      return (\r\n                        <tr key={index}>\r\n                          <td>\r\n                            <div className=\"text-left\">\r\n                              {item.transaction_code}\r\n                            </div>\r\n                          </td>\r\n                          <td>\r\n                            <div className=\"text-left\">\r\n                              {item.item_description}\r\n                            </div>\r\n                          </td>\r\n                          <td>\r\n                            <div className=\"text-right\">{item.qty}</div>\r\n                          </td>\r\n                          <td>\r\n                            <div className=\"text-right\">{item.balance}</div>\r\n                          </td>\r\n                          <td>\r\n                            <div className=\"text-right\">{item.outstanding}</div>\r\n                          </td>\r\n                          <td>\r\n                            <div className=\"d-flex align-items-center payment-input justify-content-center\">\r\n                              <NormalInput\r\n                                value={item.pay_amount}\r\n                                name=\"pay_amount\"\r\n                                onChange={e =>\r\n                                  this.handlePayAmount(e, item, index)\r\n                                }\r\n                                className={`customer-name text-right`}\r\n                              />\r\n                              {item.pay_amount\r\n                                ? this.validator.message(\r\n                                    \"pay_amount\",\r\n                                    item.pay_amount,\r\n                                    `required|max:${Number(\r\n                                      item.outstanding\r\n                                    )},num`\r\n                                  )\r\n                                : \"\"}\r\n                            </div>\r\n                          </td>\r\n                          <td>\r\n                            <div className=\"text-left\">{item.sa_staffname}</div>\r\n                          </td>\r\n                        </tr>\r\n                      );\r\n                    })\r\n                  : null}\r\n              </TableWrapper>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"col-12 pt-4 action-bar\">\r\n          <div className=\"row\">\r\n            <div className=\"col-6 d-flex\">\r\n              {/* <NormalButton\r\n                                buttonClass={\"mx-2\"}\r\n                                mainbg={true}\r\n                                className=\"fs-15 clear-line\"\r\n                                label=\"Clear Line\"\r\n                                outline={false}\r\n                                onClick={this.handleClearLine}\r\n                            />\r\n                            <NormalButton\r\n                                buttonClass={\"mx-2\"}\r\n                                mainbg={true}\r\n                                className=\"fs-15 clear-all\"\r\n                                label=\"Clear All\"\r\n                                outline={false}\r\n                                onClick={this.handleClearAll}\r\n                            /> */}\r\n            </div>\r\n            <div className=\"col-4 text-right\"></div>\r\n            <div className=\"col-2 text-right\">\r\n              <NormalButton\r\n                buttonClass={\"mx-2\"}\r\n                mainbg={true}\r\n                className=\" fs-15 confirm\"\r\n                label=\"Confirm\"\r\n                outline={false}\r\n                onClick={this.handleCreateCart}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n  selected_cstomer: state.common.selected_cstomer,\r\n  basicApptDetail: state.appointment.basicApptDetail,\r\n});\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return bindActionCreators(\r\n    {\r\n      // getCustomer,\r\n      getCommonApi,\r\n      updateForm,\r\n      commonCreateApi,\r\n      commonPatchApi,\r\n      commonDeleteApi,\r\n    },\r\n    dispatch\r\n  );\r\n};\r\n\r\nexport const TopupProduct = withTranslation()(\r\n  connect(mapStateToProps, mapDispatchToProps)(TopupProductClass)\r\n);\r\n"]},"metadata":{},"sourceType":"module"}