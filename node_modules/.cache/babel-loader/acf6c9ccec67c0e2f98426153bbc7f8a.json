{"ast":null,"code":"import _classCallCheck from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from\"react\";import{NormalButton,NormalSelect,TableWrapper,NormalModal}from\"component/common\";import{getTcmApi,tcmCreateApi}from\"redux/actions/TCM\";import{updateForm}from\"redux/actions/common\";import{connect}from\"react-redux\";import{bindActionCreators}from\"redux\";import _ from\"lodash\";import{history}from\"helpers\";import{withTranslation}from\"react-i18next\";import{dateFormat}from\"service/helperFunctions\";import{PDFViewer,PDFDownloadLink,BlobProvider}from\"@react-pdf/renderer\";import Prescription from\"../Report/Prescription\";import closeIcon from\"assets/images/close.png\";export var TCMPaymentListClass=/*#__PURE__*/function(_React$Component){_inherits(TCMPaymentListClass,_React$Component);var _super=_createSuper(TCMPaymentListClass);function TCMPaymentListClass(){var _this;_classCallCheck(this,TCMPaymentListClass);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={headerDetails:[{label:\"Customer Code\"},{label:\"Customer Name\"},{label:\"NRIC\"},{label:\"Gender\"},{label:\"Age\"},{label:\"Date\",divClass:\"justify-content-end text-right\"},{label:\"Physician\"},{label:\"Status\"},{label:\"Total Amount\",divClass:\"justify-content-end text-right\"},{label:\"\"},{label:\"\"},{label:\"\"}],tcmPaymentList:[],pageMeta:{},active:false,currentIndex:-1,isPrintPdfClick:false,accountHeader:{name:\"Prescription\",address:\"\",logo:\"\"},tcmPrescriptionMain:[],tcmPrescriptionList:[],isConfirmOpen:false,AppointmentCode:\"\"};_this.queryHandler=function(data){var payload={siteCode:_this.props.tokenDetails.site_code,date:dateFormat(new Date(),\"yyyy-mm-dd\")};_this.props.tcmCreateApi(\"tcmCustomerListFronDesk/\",payload).then(function(res){console.log(res,\"dsfdfaafg\");var result=res.result,success=res.success;var tcmPaymentList=_this.state.tcmPaymentList;if(success==\"1\"&&result){tcmPaymentList=result;_this.setState({tcmPaymentList:tcmPaymentList});}});};_this.handleGotoCart=function(data){var formFields={custId:0,custName:\"\"};formFields[\"custId\"]=data.customerId;formFields[\"custName\"]=data.customerName;_this.props.updateForm(\"basicApptDetail\",formFields);history.push(\"/admin/cart\");};_this.handleSendBack=function(data){_this.setState({isConfirmOpen:true,AppointmentCode:data.apptCode});};_this.handlecloseDialog=function(){var isConfirmOpen=_this.state.isConfirmOpen;_this.setState({isConfirmOpen:!isConfirmOpen});};_this.handleSendBackConfirm=function(){var payload={AppointmentCode:_this.state.AppointmentCode,status:\"Verify\",siteCode:_this.props.tokenDetails.site_code};_this.props.tcmCreateApi(\"tcmAppointmentStatus/\",payload).then(function(res){console.log(res,\"dsfdfaafgcustomerlist\");var result=res.result,success=res.success;if(success==\"1\"&&result){_this.queryHandler({});}});_this.handlecloseDialog();};_this.handlePrescription=function(data){_this.props.getTcmApi(\"tcmPrescriptionReceipt/?PrescriptionNo=\".concat(data.prescriptionNo)).then(function(res){var result=res.result,success=res.success;if(success==\"1\"&&result){console.log(result,\"dsfdfaafgprescriptionresponse\");_this.setState({tcmPrescriptionMain:result});_this.props.getTcmApi(\"tcmPrescription/?PrescriptionNo=\".concat(data.prescriptionNo)).then(function(res){var result=res.result,success=res.success;if(success==\"1\"&&result){console.log(result,\"dsfdfaafgprescriptionresponse\");_this.setState({tcmPrescriptionList:result});_this.setState({isPrintPdfClick:true});}});}});};_this.handlePrintPdfFormat=function(url){var tcmPrescriptionMain=_this.state.tcmPrescriptionMain;console.log(tcmPrescriptionMain,\"prescriptionmain\");_this.setState({isPrintPdfClick:false});var a=document.createElement(\"a\");a.setAttribute(\"download\",\"\".concat(tcmPrescriptionMain[0].prescriptionNo,\".pdf\"));a.setAttribute(\"href\",url);a.click();window.open(url);};return _this;}_createClass(TCMPaymentListClass,[{key:\"componentDidMount\",value:function componentDidMount(){this.queryHandler({});}// api call for list\n},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,headerDetails=_this$state.headerDetails,tcmPaymentList=_this$state.tcmPaymentList,pageMeta=_this$state.pageMeta,currentIndex=_this$state.currentIndex,tcmPrescriptionList=_this$state.tcmPrescriptionList,isPrintPdfClick=_this$state.isPrintPdfClick,accountHeader=_this$state.accountHeader,tcmPrescriptionMain=_this$state.tcmPrescriptionMain,isConfirmOpen=_this$state.isConfirmOpen;var t=this.props.t;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"table-container mt-3\"},/*#__PURE__*/React.createElement(TableWrapper,{headerDetails:headerDetails// queryHandler={this.handlePagination}\n// pageMeta={pageMeta}\n},tcmPaymentList.length>0?tcmPaymentList.filter(function(acc){return String(acc.apptStatus).toUpperCase()===\"VERIFY\"||String(acc.apptStatus).toUpperCase()===\"AWAITING PAYMENT\";}).map(function(data,index){return/*#__PURE__*/React.createElement(\"tr\",{key:index},/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-left\"},data.customerCode)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-left\"},data.customerName)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-left\"},data.custNRIC)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-left\"},data.gender)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-left\"},data.customerAge)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-right\"},data.apptDate)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-left\"},data.physician)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-left\"},data.apptStatus)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"text-right\"},data.paymentAmount)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex py-0\"},/*#__PURE__*/React.createElement(NormalButton,{className:\"fs-12\",label:\"Prescribe\",mainbgrev:true,onClick:function onClick(){return _this2.handlePrescription(data);}}))),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex py-0\"},/*#__PURE__*/React.createElement(NormalButton,{className:\"fs-12\",label:\"Payment\",styleFive:true,onClick:function onClick(){return _this2.handleGotoCart(data);},disabled:String(data.apptStatus).toUpperCase()===\"DONE\"?true:false}))),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex py-0\"},/*#__PURE__*/React.createElement(NormalButton,{className:\"w-100 fs-12\",label:\"Send Back\",styleFour:true,onClick:function onClick(){return _this2.handleSendBack(data);},disabled:String(data.apptStatus).toUpperCase()===\"AWAITING PAYMENT\"?false:true}))));}):null),/*#__PURE__*/React.createElement(NormalModal,{className:\"multiple-appointment\",modal:isConfirmOpen//style={{ minWidth: \"30%\" }}\n,handleModal:function handleModal(){}},/*#__PURE__*/React.createElement(\"div\",{className:\"row m-2\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 h4 p-0\"},t(\"Confirm\")),/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 h6\"},t(\"Are you sure want to update\"),\"?\"),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex justify-content-start mt-4 w-100\"},/*#__PURE__*/React.createElement(NormalButton,{buttonClass:\"mx-2\",mainbg:true,className:\"col-12 multiple-customer\",label:\"Cancel\",onClick:this.handlecloseDialog}),/*#__PURE__*/React.createElement(NormalButton,{buttonClass:\"mx-2\",mainbgrev:true,className:\"col-12 fs-15 multiple-customer\",label:\"Confirm\",onClick:this.handleSendBackConfirm}))))),isPrintPdfClick?/*#__PURE__*/React.createElement(PDFDownloadLink,{document:/*#__PURE__*/React.createElement(Prescription,{TableDetail:tcmPrescriptionList,MainInfo:tcmPrescriptionMain,accountHeader:accountHeader,Flag:1,landscape:false})},function(_ref){var blob=_ref.blob,url=_ref.url,loading=_ref.loading,error=_ref.error;return!loading&&url?_this2.handlePrintPdfFormat(url):null;}):null);}}]);return TCMPaymentListClass;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{// filter: state.dashboard\ntokenDetails:state.authStore.tokenDetails};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return bindActionCreators({getTcmApi:getTcmApi,tcmCreateApi:tcmCreateApi,updateForm:updateForm},dispatch);};export var TCMPaymentList=withTranslation()(connect(mapStateToProps,mapDispatchToProps)(TCMPaymentListClass));","map":{"version":3,"sources":["E:/newfrontend/webfe/src/component/Admin/TCM/TCMPaymentList/index.js"],"names":["React","NormalButton","NormalSelect","TableWrapper","NormalModal","getTcmApi","tcmCreateApi","updateForm","connect","bindActionCreators","_","history","withTranslation","dateFormat","PDFViewer","PDFDownloadLink","BlobProvider","Prescription","closeIcon","TCMPaymentListClass","state","headerDetails","label","divClass","tcmPaymentList","pageMeta","active","currentIndex","isPrintPdfClick","accountHeader","name","address","logo","tcmPrescriptionMain","tcmPrescriptionList","isConfirmOpen","AppointmentCode","queryHandler","data","payload","siteCode","props","tokenDetails","site_code","date","Date","then","res","console","log","result","success","setState","handleGotoCart","formFields","custId","custName","customerId","customerName","push","handleSendBack","apptCode","handlecloseDialog","handleSendBackConfirm","status","handlePrescription","prescriptionNo","handlePrintPdfFormat","url","a","document","createElement","setAttribute","click","window","open","t","length","filter","acc","String","apptStatus","toUpperCase","map","index","customerCode","custNRIC","gender","customerAge","apptDate","physician","paymentAmount","blob","loading","error","Component","mapStateToProps","authStore","mapDispatchToProps","dispatch","TCMPaymentList"],"mappings":"wjBAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OACEC,YADF,CAEEC,YAFF,CAGEC,YAHF,CAIEC,WAJF,KAKO,kBALP,CAMA,OAASC,SAAT,CAAoBC,YAApB,KAAwC,mBAAxC,CACA,OAASC,UAAT,KAA2B,sBAA3B,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAASC,kBAAT,KAAmC,OAAnC,CACA,MAAOC,CAAAA,CAAP,KAAc,QAAd,CACA,OAASC,OAAT,KAAwB,SAAxB,CACA,OAASC,eAAT,KAAgC,eAAhC,CACA,OAASC,UAAT,KAA2B,yBAA3B,CACA,OAASC,SAAT,CAAoBC,eAApB,CAAqCC,YAArC,KAAyD,qBAAzD,CACA,MAAOC,CAAAA,YAAP,KAAyB,wBAAzB,CACA,MAAOC,CAAAA,SAAP,KAAsB,yBAAtB,CAEA,UAAaC,CAAAA,mBAAb,2XACEC,KADF,CACU,CACNC,aAAa,CAAE,CACb,CAAEC,KAAK,CAAE,eAAT,CADa,CAEb,CAAEA,KAAK,CAAE,eAAT,CAFa,CAGb,CAAEA,KAAK,CAAE,MAAT,CAHa,CAIb,CAAEA,KAAK,CAAE,QAAT,CAJa,CAKb,CAAEA,KAAK,CAAE,KAAT,CALa,CAMb,CAAEA,KAAK,CAAE,MAAT,CAAiBC,QAAQ,CAAE,gCAA3B,CANa,CAOb,CAAED,KAAK,CAAE,WAAT,CAPa,CAQb,CAAEA,KAAK,CAAE,QAAT,CARa,CASb,CAAEA,KAAK,CAAE,cAAT,CAAyBC,QAAQ,CAAE,gCAAnC,CATa,CAUb,CAAED,KAAK,CAAE,EAAT,CAVa,CAWb,CAAEA,KAAK,CAAE,EAAT,CAXa,CAYb,CAAEA,KAAK,CAAE,EAAT,CAZa,CADT,CAeNE,cAAc,CAAE,EAfV,CAgBNC,QAAQ,CAAE,EAhBJ,CAiBNC,MAAM,CAAE,KAjBF,CAkBNC,YAAY,CAAE,CAAC,CAlBT,CAmBNC,eAAe,CAAE,KAnBX,CAoBNC,aAAa,CAAE,CAAEC,IAAI,CAAE,cAAR,CAAwBC,OAAO,CAAE,EAAjC,CAAqCC,IAAI,CAAE,EAA3C,CApBT,CAqBNC,mBAAmB,CAAE,EArBf,CAsBNC,mBAAmB,CAAE,EAtBf,CAuBNC,aAAa,CAAE,KAvBT,CAwBNC,eAAe,CAAE,EAxBX,CADV,OAiCEC,YAjCF,CAiCiB,SAAAC,IAAI,CAAI,CACrB,GAAIC,CAAAA,OAAO,CAAG,CACZC,QAAQ,CAAE,MAAKC,KAAL,CAAWC,YAAX,CAAwBC,SADtB,CAEZC,IAAI,CAAE/B,UAAU,CAAC,GAAIgC,CAAAA,IAAJ,EAAD,CAAa,YAAb,CAFJ,CAAd,CAIA,MAAKJ,KAAL,CAAWnC,YAAX,4BAAoDiC,OAApD,EAA6DO,IAA7D,CAAkE,SAAAC,GAAG,CAAI,CACvEC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAiB,WAAjB,EACA,GAAMG,CAAAA,MAAN,CAA0BH,GAA1B,CAAMG,MAAN,CAAcC,OAAd,CAA0BJ,GAA1B,CAAcI,OAAd,CACA,GAAM3B,CAAAA,cAAN,CAAyB,MAAKJ,KAA9B,CAAMI,cAAN,CACA,GAAI2B,OAAO,EAAI,GAAX,EAAkBD,MAAtB,CAA8B,CAC5B1B,cAAc,CAAG0B,MAAjB,CACA,MAAKE,QAAL,CAAc,CACZ5B,cAAc,CAAdA,cADY,CAAd,EAGD,CACF,CAVD,EAWD,CAjDH,OAmDE6B,cAnDF,CAmDmB,SAAAf,IAAI,CAAI,CACvB,GAAIgB,CAAAA,UAAU,CAAG,CAAEC,MAAM,CAAE,CAAV,CAAaC,QAAQ,CAAE,EAAvB,CAAjB,CACAF,UAAU,CAAC,QAAD,CAAV,CAAuBhB,IAAI,CAACmB,UAA5B,CACAH,UAAU,CAAC,UAAD,CAAV,CAAyBhB,IAAI,CAACoB,YAA9B,CACA,MAAKjB,KAAL,CAAWlC,UAAX,CAAsB,iBAAtB,CAAyC+C,UAAzC,EAEA3C,OAAO,CAACgD,IAAR,CAAa,aAAb,EACD,CA1DH,OA2DEC,cA3DF,CA2DmB,SAAAtB,IAAI,CAAI,CACvB,MAAKc,QAAL,CAAc,CACZjB,aAAa,CAAE,IADH,CAEZC,eAAe,CAAEE,IAAI,CAACuB,QAFV,CAAd,EAID,CAhEH,OAiEEC,iBAjEF,CAiEsB,UAAM,CACxB,GAAM3B,CAAAA,aAAN,CAAwB,MAAKf,KAA7B,CAAMe,aAAN,CACA,MAAKiB,QAAL,CAAc,CACZjB,aAAa,CAAE,CAACA,aADJ,CAAd,EAGD,CAtEH,OAuEE4B,qBAvEF,CAuE0B,UAAM,CAC5B,GAAIxB,CAAAA,OAAO,CAAG,CACZH,eAAe,CAAE,MAAKhB,KAAL,CAAWgB,eADhB,CAEZ4B,MAAM,CAAE,QAFI,CAGZxB,QAAQ,CAAE,MAAKC,KAAL,CAAWC,YAAX,CAAwBC,SAHtB,CAAd,CAKA,MAAKF,KAAL,CAAWnC,YAAX,yBAAiDiC,OAAjD,EAA0DO,IAA1D,CAA+D,SAAAC,GAAG,CAAI,CACpEC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAiB,uBAAjB,EACA,GAAMG,CAAAA,MAAN,CAA0BH,GAA1B,CAAMG,MAAN,CAAcC,OAAd,CAA0BJ,GAA1B,CAAcI,OAAd,CACA,GAAIA,OAAO,EAAI,GAAX,EAAkBD,MAAtB,CAA8B,CAC5B,MAAKb,YAAL,CAAkB,EAAlB,EACD,CACF,CAND,EAOA,MAAKyB,iBAAL,GACD,CArFH,OAuFEG,kBAvFF,CAuFuB,SAAA3B,IAAI,CAAI,CAC3B,MAAKG,KAAL,CACGpC,SADH,kDAE8CiC,IAAI,CAAC4B,cAFnD,GAIGpB,IAJH,CAIQ,SAAAC,GAAG,CAAI,CACX,GAAMG,CAAAA,MAAN,CAA0BH,GAA1B,CAAMG,MAAN,CAAcC,OAAd,CAA0BJ,GAA1B,CAAcI,OAAd,CACA,GAAIA,OAAO,EAAI,GAAX,EAAkBD,MAAtB,CAA8B,CAC5BF,OAAO,CAACC,GAAR,CAAYC,MAAZ,CAAoB,+BAApB,EACA,MAAKE,QAAL,CAAc,CACZnB,mBAAmB,CAAEiB,MADT,CAAd,EAGA,MAAKT,KAAL,CACGpC,SADH,2CACgDiC,IAAI,CAAC4B,cADrD,GAEGpB,IAFH,CAEQ,SAAAC,GAAG,CAAI,CACX,GAAMG,CAAAA,MAAN,CAA0BH,GAA1B,CAAMG,MAAN,CAAcC,OAAd,CAA0BJ,GAA1B,CAAcI,OAAd,CACA,GAAIA,OAAO,EAAI,GAAX,EAAkBD,MAAtB,CAA8B,CAC5BF,OAAO,CAACC,GAAR,CAAYC,MAAZ,CAAoB,+BAApB,EACA,MAAKE,QAAL,CAAc,CACZlB,mBAAmB,CAAEgB,MADT,CAAd,EAGA,MAAKE,QAAL,CAAc,CAAExB,eAAe,CAAE,IAAnB,CAAd,EACD,CACF,CAXH,EAYD,CACF,CAxBH,EAyBD,CAjHH,OAkHEuC,oBAlHF,CAkHyB,SAAAC,GAAG,CAAI,CAC5B,GAAMnC,CAAAA,mBAAN,CAA8B,MAAKb,KAAnC,CAAMa,mBAAN,CACAe,OAAO,CAACC,GAAR,CAAYhB,mBAAZ,CAAiC,kBAAjC,EACA,MAAKmB,QAAL,CAAc,CACZxB,eAAe,CAAE,KADL,CAAd,EAGA,GAAIyC,CAAAA,CAAC,CAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAR,CACAF,CAAC,CAACG,YAAF,CAAe,UAAf,WAA8BvC,mBAAmB,CAAC,CAAD,CAAnB,CAAuBiC,cAArD,UACAG,CAAC,CAACG,YAAF,CAAe,MAAf,CAAuBJ,GAAvB,EACAC,CAAC,CAACI,KAAF,GACAC,MAAM,CAACC,IAAP,CAAYP,GAAZ,EACD,CA7HH,gFA4BE,4BAAoB,CAClB,KAAK/B,YAAL,CAAkB,EAAlB,EACD,CAED;AAhCF,sBA8HE,iBAAS,iBACP,gBAUI,KAAKjB,KAVT,CACEC,aADF,aACEA,aADF,CAEEG,cAFF,aAEEA,cAFF,CAGEC,QAHF,aAGEA,QAHF,CAIEE,YAJF,aAIEA,YAJF,CAKEO,mBALF,aAKEA,mBALF,CAMEN,eANF,aAMEA,eANF,CAOEC,aAPF,aAOEA,aAPF,CAQEI,mBARF,aAQEA,mBARF,CASEE,aATF,aASEA,aATF,CAWA,GAAMyC,CAAAA,CAAN,CAAY,KAAKnC,KAAjB,CAAMmC,CAAN,CACA,mBACE,qDACE,2BAAK,SAAS,CAAC,sBAAf,eACE,oBAAC,YAAD,EACE,aAAa,CAAEvD,aACf;AACA;AAHF,EAKGG,cAAc,CAACqD,MAAf,CAAwB,CAAxB,CACGrD,cAAc,CACXsD,MADH,CAEI,SAAAC,GAAG,QACDC,CAAAA,MAAM,CAACD,GAAG,CAACE,UAAL,CAAN,CAAuBC,WAAvB,KAAyC,QAAzC,EACAF,MAAM,CAACD,GAAG,CAACE,UAAL,CAAN,CAAuBC,WAAvB,KACE,kBAHD,EAFP,EAOGC,GAPH,CAOO,SAAC7C,IAAD,CAAO8C,KAAP,CAAiB,CACpB,mBACE,0BAAI,GAAG,CAAEA,KAAT,eACE,2CACE,2BAAK,SAAS,CAAC,WAAf,EAA4B9C,IAAI,CAAC+C,YAAjC,CADF,CADF,cAIE,2CACE,2BAAK,SAAS,CAAC,WAAf,EAA4B/C,IAAI,CAACoB,YAAjC,CADF,CAJF,cAOE,2CACE,2BAAK,SAAS,CAAC,WAAf,EAA4BpB,IAAI,CAACgD,QAAjC,CADF,CAPF,cAUE,2CACE,2BAAK,SAAS,CAAC,WAAf,EAA4BhD,IAAI,CAACiD,MAAjC,CADF,CAVF,cAaE,2CACE,2BAAK,SAAS,CAAC,WAAf,EAA4BjD,IAAI,CAACkD,WAAjC,CADF,CAbF,cAgBE,2CACE,2BAAK,SAAS,CAAC,YAAf,EAA6BlD,IAAI,CAACmD,QAAlC,CADF,CAhBF,cAmBE,2CACE,2BAAK,SAAS,CAAC,WAAf,EAA4BnD,IAAI,CAACoD,SAAjC,CADF,CAnBF,cAsBE,2CACE,2BAAK,SAAS,CAAC,WAAf,EAA4BpD,IAAI,CAAC2C,UAAjC,CADF,CAtBF,cAyBE,2CACE,2BAAK,SAAS,CAAC,YAAf,EAA6B3C,IAAI,CAACqD,aAAlC,CADF,CAzBF,cA4BE,2CACE,2BAAK,SAAS,CAAC,aAAf,eACE,oBAAC,YAAD,EACE,SAAS,QADX,CAEE,KAAK,CAAC,WAFR,CAGE,SAAS,CAAE,IAHb,CAIE,OAAO,CAAE,yBAAM,CAAA,MAAI,CAAC1B,kBAAL,CAAwB3B,IAAxB,CAAN,EAJX,EADF,CADF,CA5BF,cAsCE,2CACE,2BAAK,SAAS,CAAC,aAAf,eACE,oBAAC,YAAD,EACE,SAAS,CAAC,OADZ,CAEE,KAAK,CAAC,SAFR,CAGE,SAAS,CAAE,IAHb,CAIE,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACe,cAAL,CAAoBf,IAApB,CAAN,EAJX,CAKE,QAAQ,CACN0C,MAAM,CAAC1C,IAAI,CAAC2C,UAAN,CAAN,CAAwBC,WAAxB,KAA0C,MAA1C,CACI,IADJ,CAEI,KARR,EADF,CADF,CAtCF,cAqDE,2CACE,2BAAK,SAAS,CAAC,aAAf,eACE,oBAAC,YAAD,EACE,SAAS,CAAC,aADZ,CAEE,KAAK,CAAC,WAFR,CAGE,SAAS,CAAE,IAHb,CAIE,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACtB,cAAL,CAAoBtB,IAApB,CAAN,EAJX,CAKE,QAAQ,CACN0C,MAAM,CAAC1C,IAAI,CAAC2C,UAAN,CAAN,CAAwBC,WAAxB,KACA,kBADA,CAEI,KAFJ,CAGI,IATR,EADF,CADF,CArDF,CADF,CAwED,CAhFH,CADH,CAkFG,IAvFN,CADF,cA0FE,oBAAC,WAAD,EACE,SAAS,CAAE,sBADb,CAEE,KAAK,CAAE/C,aACP;AAHF,CAIE,WAAW,CAAE,sBAAM,CAAE,CAJvB,eAME,2BAAK,SAAS,CAAC,SAAf,eACE,2BAAK,SAAS,CAAC,eAAf,EAAgCyC,CAAC,CAAC,SAAD,CAAjC,CADF,cAGE,2BAAK,SAAS,CAAC,WAAf,EACGA,CAAC,CAAC,6BAAD,CADJ,KAHF,cAOE,2BAAK,SAAS,CAAC,yCAAf,eACE,oBAAC,YAAD,EACE,WAAW,CAAE,MADf,CAEE,MAAM,CAAE,IAFV,CAGE,SAAS,CAAC,0BAHZ,CAIE,KAAK,CAAE,QAJT,CAKE,OAAO,CAAE,KAAKd,iBALhB,EADF,cAQE,oBAAC,YAAD,EACE,WAAW,CAAE,MADf,CAEE,SAAS,CAAE,IAFb,CAGE,SAAS,CAAC,gCAHZ,CAIE,KAAK,CAAE,SAJT,CAKE,OAAO,CAAE,KAAKC,qBALhB,EARF,CAPF,CANF,CA1FF,CADF,CA4HGnC,eAAe,cACd,oBAAC,eAAD,EACE,QAAQ,cACN,oBAAC,YAAD,EACE,WAAW,CAAEM,mBADf,CAEE,QAAQ,CAAED,mBAFZ,CAGE,aAAa,CAAEJ,aAHjB,CAIE,IAAI,CAAE,CAJR,CAKE,SAAS,CAAE,KALb,EAFJ,EAWG,kBAAG+D,CAAAA,IAAH,MAAGA,IAAH,CAASxB,GAAT,MAASA,GAAT,CAAcyB,OAAd,MAAcA,OAAd,CAAuBC,KAAvB,MAAuBA,KAAvB,OACC,CAACD,OAAD,EAAYzB,GAAZ,CAAkB,MAAI,CAACD,oBAAL,CAA0BC,GAA1B,CAAlB,CAAmD,IADpD,EAXH,CADc,CAgBZ,IA5IN,CADF,CAgJD,CA3RH,iCAAyCpE,KAAK,CAAC+F,SAA/C,EA8RA,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAA5E,KAAK,QAAK,CAChC;AACAsB,YAAY,CAAEtB,KAAK,CAAC6E,SAAN,CAAgBvD,YAFE,CAAL,EAA7B,CAKA,GAAMwD,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAAAC,QAAQ,CAAI,CACrC,MAAO1F,CAAAA,kBAAkB,CACvB,CACEJ,SAAS,CAATA,SADF,CAEEC,YAAY,CAAZA,YAFF,CAGEC,UAAU,CAAVA,UAHF,CADuB,CAMvB4F,QANuB,CAAzB,CAQD,CATD,CAWA,MAAO,IAAMC,CAAAA,cAAc,CAAGxF,eAAe,GAC3CJ,OAAO,CAACwF,eAAD,CAAkBE,kBAAlB,CAAP,CAA6C/E,mBAA7C,CAD2C,CAAtC","sourcesContent":["import React from \"react\";\r\nimport {\r\n  NormalButton,\r\n  NormalSelect,\r\n  TableWrapper,\r\n  NormalModal,\r\n} from \"component/common\";\r\nimport { getTcmApi, tcmCreateApi } from \"redux/actions/TCM\";\r\nimport { updateForm } from \"redux/actions/common\";\r\nimport { connect } from \"react-redux\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport _ from \"lodash\";\r\nimport { history } from \"helpers\";\r\nimport { withTranslation } from \"react-i18next\";\r\nimport { dateFormat } from \"service/helperFunctions\";\r\nimport { PDFViewer, PDFDownloadLink, BlobProvider } from \"@react-pdf/renderer\";\r\nimport Prescription from \"../Report/Prescription\";\r\nimport closeIcon from \"assets/images/close.png\";\r\n\r\nexport class TCMPaymentListClass extends React.Component {\r\n  state = {\r\n    headerDetails: [\r\n      { label: \"Customer Code\" },\r\n      { label: \"Customer Name\" },\r\n      { label: \"NRIC\" },\r\n      { label: \"Gender\" },\r\n      { label: \"Age\" },\r\n      { label: \"Date\", divClass: \"justify-content-end text-right\" },\r\n      { label: \"Physician\" },\r\n      { label: \"Status\" },\r\n      { label: \"Total Amount\", divClass: \"justify-content-end text-right\" },\r\n      { label: \"\" },\r\n      { label: \"\" },\r\n      { label: \"\" },\r\n    ],\r\n    tcmPaymentList: [],\r\n    pageMeta: {},\r\n    active: false,\r\n    currentIndex: -1,\r\n    isPrintPdfClick: false,\r\n    accountHeader: { name: \"Prescription\", address: \"\", logo: \"\" },\r\n    tcmPrescriptionMain: [],\r\n    tcmPrescriptionList: [],\r\n    isConfirmOpen: false,\r\n    AppointmentCode: \"\",\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.queryHandler({});\r\n  }\r\n\r\n  // api call for list\r\n  queryHandler = data => {\r\n    let payload = {\r\n      siteCode: this.props.tokenDetails.site_code,\r\n      date: dateFormat(new Date(), \"yyyy-mm-dd\"),\r\n    };\r\n    this.props.tcmCreateApi(`tcmCustomerListFronDesk/`, payload).then(res => {\r\n      console.log(res, \"dsfdfaafg\");\r\n      let { result, success } = res;\r\n      let { tcmPaymentList } = this.state;\r\n      if (success == \"1\" && result) {\r\n        tcmPaymentList = result;\r\n        this.setState({\r\n          tcmPaymentList,\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  handleGotoCart = data => {\r\n    let formFields = { custId: 0, custName: \"\" };\r\n    formFields[\"custId\"] = data.customerId;\r\n    formFields[\"custName\"] = data.customerName;\r\n    this.props.updateForm(\"basicApptDetail\", formFields);\r\n\r\n    history.push(\"/admin/cart\");\r\n  };\r\n  handleSendBack = data => {\r\n    this.setState({\r\n      isConfirmOpen: true,\r\n      AppointmentCode: data.apptCode,\r\n    });\r\n  };\r\n  handlecloseDialog = () => {\r\n    let { isConfirmOpen } = this.state;\r\n    this.setState({\r\n      isConfirmOpen: !isConfirmOpen,\r\n    });\r\n  };\r\n  handleSendBackConfirm = () => {\r\n    let payload = {\r\n      AppointmentCode: this.state.AppointmentCode,\r\n      status: \"Verify\",\r\n      siteCode: this.props.tokenDetails.site_code,\r\n    };\r\n    this.props.tcmCreateApi(`tcmAppointmentStatus/`, payload).then(res => {\r\n      console.log(res, \"dsfdfaafgcustomerlist\");\r\n      let { result, success } = res;\r\n      if (success == \"1\" && result) {\r\n        this.queryHandler({});\r\n      }\r\n    });\r\n    this.handlecloseDialog();\r\n  };\r\n\r\n  handlePrescription = data => {\r\n    this.props\r\n      .getTcmApi(\r\n        `tcmPrescriptionReceipt/?PrescriptionNo=${data.prescriptionNo}`\r\n      )\r\n      .then(res => {\r\n        let { result, success } = res;\r\n        if (success == \"1\" && result) {\r\n          console.log(result, \"dsfdfaafgprescriptionresponse\");\r\n          this.setState({\r\n            tcmPrescriptionMain: result,\r\n          });\r\n          this.props\r\n            .getTcmApi(`tcmPrescription/?PrescriptionNo=${data.prescriptionNo}`)\r\n            .then(res => {\r\n              let { result, success } = res;\r\n              if (success == \"1\" && result) {\r\n                console.log(result, \"dsfdfaafgprescriptionresponse\");\r\n                this.setState({\r\n                  tcmPrescriptionList: result,\r\n                });\r\n                this.setState({ isPrintPdfClick: true });\r\n              }\r\n            });\r\n        }\r\n      });\r\n  };\r\n  handlePrintPdfFormat = url => {\r\n    let { tcmPrescriptionMain } = this.state;\r\n    console.log(tcmPrescriptionMain, \"prescriptionmain\");\r\n    this.setState({\r\n      isPrintPdfClick: false,\r\n    });\r\n    var a = document.createElement(\"a\");\r\n    a.setAttribute(\"download\", `${tcmPrescriptionMain[0].prescriptionNo}.pdf`);\r\n    a.setAttribute(\"href\", url);\r\n    a.click();\r\n    window.open(url);\r\n  };\r\n  render() {\r\n    let {\r\n      headerDetails,\r\n      tcmPaymentList,\r\n      pageMeta,\r\n      currentIndex,\r\n      tcmPrescriptionList,\r\n      isPrintPdfClick,\r\n      accountHeader,\r\n      tcmPrescriptionMain,\r\n      isConfirmOpen,\r\n    } = this.state;\r\n    let { t } = this.props;\r\n    return (\r\n      <>\r\n        <div className=\"table-container mt-3\">\r\n          <TableWrapper\r\n            headerDetails={headerDetails}\r\n            // queryHandler={this.handlePagination}\r\n            // pageMeta={pageMeta}\r\n          >\r\n            {tcmPaymentList.length > 0\r\n              ? tcmPaymentList\r\n                  .filter(\r\n                    acc =>\r\n                      String(acc.apptStatus).toUpperCase() === \"VERIFY\" ||\r\n                      String(acc.apptStatus).toUpperCase() ===\r\n                        \"AWAITING PAYMENT\"\r\n                  )\r\n                  .map((data, index) => {\r\n                    return (\r\n                      <tr key={index}>\r\n                        <td>\r\n                          <div className=\"text-left\">{data.customerCode}</div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"text-left\">{data.customerName}</div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"text-left\">{data.custNRIC}</div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"text-left\">{data.gender}</div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"text-left\">{data.customerAge}</div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"text-right\">{data.apptDate}</div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"text-left\">{data.physician}</div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"text-left\">{data.apptStatus}</div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"text-right\">{data.paymentAmount}</div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex py-0\">\r\n                            <NormalButton\r\n                              className={`fs-12`}\r\n                              label=\"Prescribe\"\r\n                              mainbgrev={true}\r\n                              onClick={() => this.handlePrescription(data)}\r\n                            />\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex py-0\">\r\n                            <NormalButton\r\n                              className=\"fs-12\"\r\n                              label=\"Payment\"\r\n                              styleFive={true}\r\n                              onClick={() => this.handleGotoCart(data)}\r\n                              disabled={\r\n                                String(data.apptStatus).toUpperCase() === \"DONE\"\r\n                                  ? true\r\n                                  : false\r\n                              }\r\n                            />\r\n                          </div>\r\n                        </td>\r\n                        <td>\r\n                          <div className=\"d-flex py-0\">\r\n                            <NormalButton\r\n                              className=\"w-100 fs-12\"\r\n                              label=\"Send Back\"\r\n                              styleFour={true}\r\n                              onClick={() => this.handleSendBack(data)}\r\n                              disabled={\r\n                                String(data.apptStatus).toUpperCase() ===\r\n                                \"AWAITING PAYMENT\"\r\n                                  ? false\r\n                                  : true\r\n                              }\r\n                            />\r\n                          </div>\r\n                        </td>\r\n                      </tr>\r\n                    );\r\n                  })\r\n              : null}\r\n          </TableWrapper>\r\n          <NormalModal\r\n            className={\"multiple-appointment\"}\r\n            modal={isConfirmOpen}\r\n            //style={{ minWidth: \"30%\" }}\r\n            handleModal={() => {}}\r\n          >\r\n            <div className=\"row m-2\">\r\n              <div className=\"col-12 h4 p-0\">{t(\"Confirm\")}</div>\r\n\r\n              <div className=\"col-12 h6\">\r\n                {t(\"Are you sure want to update\")}?\r\n              </div>\r\n\r\n              <div className=\"d-flex justify-content-start mt-4 w-100\">\r\n                <NormalButton\r\n                  buttonClass={\"mx-2\"}\r\n                  mainbg={true}\r\n                  className=\"col-12 multiple-customer\"\r\n                  label={\"Cancel\"}\r\n                  onClick={this.handlecloseDialog}\r\n                />\r\n                <NormalButton\r\n                  buttonClass={\"mx-2\"}\r\n                  mainbgrev={true}\r\n                  className=\"col-12 fs-15 multiple-customer\"\r\n                  label={\"Confirm\"}\r\n                  onClick={this.handleSendBackConfirm}\r\n                />\r\n              </div>\r\n            </div>\r\n          </NormalModal>\r\n        </div>\r\n\r\n        {isPrintPdfClick ? (\r\n          <PDFDownloadLink\r\n            document={\r\n              <Prescription\r\n                TableDetail={tcmPrescriptionList}\r\n                MainInfo={tcmPrescriptionMain}\r\n                accountHeader={accountHeader}\r\n                Flag={1}\r\n                landscape={false}\r\n              />\r\n            }\r\n          >\r\n            {({ blob, url, loading, error }) =>\r\n              !loading && url ? this.handlePrintPdfFormat(url) : null\r\n            }\r\n          </PDFDownloadLink>\r\n        ) : null}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n  // filter: state.dashboard\r\n  tokenDetails: state.authStore.tokenDetails,\r\n});\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return bindActionCreators(\r\n    {\r\n      getTcmApi,\r\n      tcmCreateApi,\r\n      updateForm,\r\n    },\r\n    dispatch\r\n  );\r\n};\r\n\r\nexport const TCMPaymentList = withTranslation()(\r\n  connect(mapStateToProps, mapDispatchToProps)(TCMPaymentListClass)\r\n);\r\n"]},"metadata":{},"sourceType":"module"}