{"ast":null,"code":"/**\r\n * DevExtreme (ui/html_editor/modules/mentions.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nexports.default = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../../../core/renderer\"));\n\nvar _devextremeQuill = _interopRequireDefault(require(\"devextreme-quill\"));\n\nvar _data = require(\"../../../core/utils/data\");\n\nvar _type = require(\"../../../core/utils/type\");\n\nvar _extend = require(\"../../../core/utils/extend\");\n\nvar _element = require(\"../../../core/element\");\n\nvar _events_engine = _interopRequireDefault(require(\"../../../events/core/events_engine\"));\n\nvar _popup = _interopRequireDefault(require(\"./popup\"));\n\nvar _mention = _interopRequireDefault(require(\"../formats/mention\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (\"function\" !== typeof superClass && null !== superClass) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n\n  if (superClass) {\n    _setPrototypeOf(subClass, superClass);\n  }\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function (o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function () {\n    var result,\n        Super = _getPrototypeOf(Derived);\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (void 0 === self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (\"undefined\" === typeof Reflect || !Reflect.construct) {\n    return false;\n  }\n\n  if (Reflect.construct.sham) {\n    return false;\n  }\n\n  if (\"function\" === typeof Proxy) {\n    return true;\n  }\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _get(target, property, receiver) {\n  if (\"undefined\" !== typeof Reflect && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function (target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) {\n        return;\n      }\n\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n\n    if (null === object) {\n      break;\n    }\n  }\n\n  return object;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function (o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nvar MentionModule = {};\n\nif (_devextremeQuill.default) {\n  var USER_ACTION = \"user\";\n  var SILENT_ACTION = \"silent\";\n  var DEFAULT_MARKER = \"@\";\n  var KEYS = {\n    ARROW_UP: \"upArrow\",\n    ARROW_DOWN: \"downArrow\",\n    ARROW_LEFT: \"leftArrow\",\n    ARROW_RIGHT: \"rightArrow\",\n    ENTER: \"enter\",\n    ESCAPE: \"escape\",\n    SPACE: \"space\",\n    PAGE_UP: \"pageUp\",\n    PAGE_DOWN: \"pageDown\",\n    END: \"end\",\n    HOME: \"home\"\n  };\n  var NAVIGATION_KEYS = [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT, KEYS.PAGE_UP, KEYS.PAGE_DOWN, KEYS.END, KEYS.HOME];\n  var ALLOWED_PREFIX_CHARS = [\" \", \"\\n\"];\n  var DISABLED_STATE_CLASS = \"dx-state-disabled\";\n\n  _devextremeQuill.default.register({\n    \"formats/mention\": _mention.default\n  }, true);\n\n  MentionModule = function (_PopupModule) {\n    _inherits(MentionModule, _PopupModule);\n\n    var _super = _createSuper(MentionModule);\n\n    _createClass(MentionModule, [{\n      key: \"_getDefaultOptions\",\n      value: function () {\n        var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getDefaultOptions\", this).call(this);\n\n        return (0, _extend.extend)(baseConfig, {\n          itemTemplate: \"item\",\n          valueExpr: \"this\",\n          displayExpr: \"this\",\n          template: null,\n          searchExpr: null,\n          searchTimeout: 500,\n          minSearchLength: 0\n        });\n      }\n    }]);\n\n    function MentionModule(quill, options) {\n      var _this;\n\n      _classCallCheck(this, MentionModule);\n\n      _this = _super.call(this, quill, options);\n      _this._mentions = {};\n      _this.editorInstance = options.editorInstance;\n      options.mentions.forEach(function (item) {\n        var marker = item.marker;\n\n        if (!marker) {\n          item.marker = marker = DEFAULT_MARKER;\n        }\n\n        var template = item.template;\n\n        if (template) {\n          var preparedTemplate = _this.editorInstance._getTemplate(template);\n\n          preparedTemplate && _mention.default.addTemplate(marker, preparedTemplate);\n        }\n\n        _this._mentions[marker] = (0, _extend.extend)({}, _this._getDefaultOptions(), item);\n      });\n\n      _this._attachKeyboardHandlers();\n\n      _this.editorInstance.addCleanCallback(_this.clean.bind(_assertThisInitialized(_this)));\n\n      _this.quill.on(\"text-change\", _this.onTextChange.bind(_assertThisInitialized(_this)));\n\n      return _this;\n    }\n\n    _createClass(MentionModule, [{\n      key: \"_attachKeyboardHandlers\",\n      value: function () {\n        this.quill.keyboard.addBinding({\n          key: KEYS.ARROW_UP\n        }, this._moveToItem.bind(this, \"prev\"));\n        this.quill.keyboard.addBinding({\n          key: KEYS.ARROW_DOWN\n        }, this._moveToItem.bind(this, \"next\"));\n        this.quill.keyboard.addBinding({\n          key: [KEYS.ENTER, KEYS.SPACE]\n        }, this._selectItemHandler.bind(this));\n        var enterBindings = this.quill.keyboard.bindings[KEYS.ENTER];\n        enterBindings.unshift(enterBindings.pop());\n        this.quill.keyboard.addBinding({\n          key: KEYS.ESCAPE\n        }, this._escapeKeyHandler.bind(this));\n        this.quill.keyboard.addBinding({\n          key: [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT],\n          shiftKey: true\n        }, this._ignoreKeyHandler.bind(this));\n        this.quill.keyboard.addBinding({\n          key: NAVIGATION_KEYS\n        }, this._ignoreKeyHandler.bind(this));\n      }\n    }, {\n      key: \"_moveToItem\",\n      value: function (direction) {\n        var dataSource = this._list.getDataSource();\n\n        if (this._isMentionActive && !dataSource.isLoading()) {\n          var $focusedItem = (0, _renderer.default)(this._list.option(\"focusedElement\"));\n          var defaultItemPosition = \"next\" === direction ? \"first\" : \"last\";\n          var $nextItem = $focusedItem[direction]();\n          $nextItem = $nextItem.length ? $nextItem : this._activeListItems[defaultItemPosition]();\n\n          this._list.option(\"focusedElement\", (0, _element.getPublicElement)($nextItem));\n\n          this._list.scrollToItem($nextItem);\n        }\n\n        return !this._isMentionActive;\n      }\n    }, {\n      key: \"_ignoreKeyHandler\",\n      value: function () {\n        return !this._isMentionActive;\n      }\n    }, {\n      key: \"_fitIntoRange\",\n      value: function (value, start, end) {\n        if (value > end) {\n          return start;\n        }\n\n        if (value < start) {\n          return end;\n        }\n\n        return value;\n      }\n    }, {\n      key: \"_selectItemHandler\",\n      value: function () {\n        if (this._isMentionActive) {\n          this._list.selectItem(this._list.option(\"focusedElement\"));\n        }\n\n        return !this._isMentionActive;\n      }\n    }, {\n      key: \"_escapeKeyHandler\",\n      value: function () {\n        if (this._isMentionActive) {\n          this._popup.hide();\n        }\n\n        return !this._isMentionActive;\n      }\n    }, {\n      key: \"renderList\",\n      value: function ($container, options) {\n        this.compileGetters(this.options);\n\n        _get(_getPrototypeOf(MentionModule.prototype), \"renderList\", this).call(this, $container, options);\n      }\n    }, {\n      key: \"compileGetters\",\n      value: function (_ref) {\n        var displayExpr = _ref.displayExpr,\n            valueExpr = _ref.valueExpr;\n        this._valueGetter = (0, _data.compileGetter)(displayExpr);\n        this._idGetter = (0, _data.compileGetter)(valueExpr);\n      }\n    }, {\n      key: \"_getListConfig\",\n      value: function (options) {\n        var _this2 = this;\n\n        var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getListConfig\", this).call(this, options);\n\n        return (0, _extend.extend)(baseConfig, {\n          itemTemplate: this.options.itemTemplate,\n          onContentReady: function () {\n            if (_this2._hasSearch) {\n              _this2._popup.repaint();\n\n              _this2._focusFirstElement();\n\n              _this2._hasSearch = false;\n            }\n          }\n        });\n      }\n    }, {\n      key: \"insertEmbedContent\",\n      value: function () {\n        var markerLength = this._activeMentionConfig.marker.length;\n        var textLength = markerLength + this._searchValue.length;\n        var caretPosition = this.getPosition();\n        var startIndex = Math.max(0, caretPosition - markerLength);\n\n        var selectedItem = this._list.option(\"selectedItem\");\n\n        var value = {\n          value: this._valueGetter(selectedItem),\n          id: this._idGetter(selectedItem),\n          marker: this._activeMentionConfig.marker\n        };\n        setTimeout(function () {\n          this.quill.insertText(startIndex, \" \", SILENT_ACTION);\n          this.quill.deleteText(startIndex + 1, textLength, SILENT_ACTION);\n          this.quill.insertEmbed(startIndex, \"mention\", value);\n          this.quill.setSelection(startIndex + 2);\n        }.bind(this));\n      }\n    }, {\n      key: \"_getLastInsertOperation\",\n      value: function (ops) {\n        var lastOperation = ops[ops.length - 1];\n        var isLastOperationInsert = (\"insert\" in lastOperation);\n\n        if (isLastOperationInsert) {\n          return lastOperation;\n        }\n\n        var isLastOperationDelete = (\"delete\" in lastOperation);\n\n        if (isLastOperationDelete && ops.length >= 2) {\n          var penultOperation = ops[ops.length - 2];\n          var isPenultOperationInsert = (\"insert\" in penultOperation);\n          var isSelectionReplacing = isLastOperationDelete && isPenultOperationInsert;\n\n          if (isSelectionReplacing) {\n            return penultOperation;\n          }\n        }\n\n        return null;\n      }\n    }, {\n      key: \"onTextChange\",\n      value: function (newDelta, oldDelta, source) {\n        if (source === USER_ACTION) {\n          var lastOperation = newDelta.ops[newDelta.ops.length - 1];\n\n          if (this._isMentionActive && this._isPopupVisible) {\n            this._processSearchValue(lastOperation) && this._filterList(this._searchValue);\n          } else {\n            var ops = newDelta.ops;\n\n            var lastInsertOperation = this._getLastInsertOperation(ops);\n\n            if (lastInsertOperation) {\n              this.checkMentionRequest(lastInsertOperation, ops);\n            }\n          }\n        }\n      }\n    }, {\n      key: \"_processSearchValue\",\n      value: function (operation) {\n        var isInsertOperation = (\"insert\" in operation);\n\n        if (isInsertOperation) {\n          this._searchValue += operation.insert;\n        } else {\n          if (!this._searchValue.length || operation.delete > 1) {\n            this._popup.hide();\n\n            return false;\n          } else {\n            this._searchValue = this._searchValue.slice(0, -1);\n          }\n        }\n\n        return true;\n      }\n    }, {\n      key: \"checkMentionRequest\",\n      value: function (_ref2, ops) {\n        var insert = _ref2.insert;\n        var caret = this.quill.getSelection();\n\n        if (!insert || !(0, _type.isString)(insert) || !caret || this._isMarkerPartOfText(ops[0].retain)) {\n          return;\n        }\n\n        this._activeMentionConfig = this._mentions[insert];\n\n        if (this._activeMentionConfig) {\n          this._updateList(this._activeMentionConfig);\n\n          this.savePosition(caret.index);\n\n          this._popup.option(\"position\", this._popupPosition);\n\n          this._searchValue = \"\";\n\n          this._popup.show();\n        }\n      }\n    }, {\n      key: \"_isMarkerPartOfText\",\n      value: function (retain) {\n        if (!retain || ALLOWED_PREFIX_CHARS.indexOf(this._getCharByIndex(retain - 1)) !== -1) {\n          return false;\n        }\n\n        return true;\n      }\n    }, {\n      key: \"_getCharByIndex\",\n      value: function (index) {\n        return this.quill.getContents(index, 1).ops[0].insert;\n      }\n    }, {\n      key: \"_updateList\",\n      value: function (_ref3) {\n        var dataSource = _ref3.dataSource,\n            displayExpr = _ref3.displayExpr,\n            valueExpr = _ref3.valueExpr,\n            itemTemplate = _ref3.itemTemplate,\n            searchExpr = _ref3.searchExpr;\n        this.compileGetters({\n          displayExpr: displayExpr,\n          valueExpr: valueExpr\n        });\n\n        this._list.unselectAll();\n\n        this._list.option({\n          dataSource: dataSource,\n          displayExpr: displayExpr,\n          itemTemplate: itemTemplate,\n          searchExpr: searchExpr\n        });\n      }\n    }, {\n      key: \"_filterList\",\n      value: function (searchValue) {\n        var _this3 = this;\n\n        if (!this._isMinSearchLengthExceeded(searchValue)) {\n          this._resetFilter();\n\n          return;\n        }\n\n        var searchTimeout = this._activeMentionConfig.searchTimeout;\n\n        if (searchTimeout) {\n          clearTimeout(this._searchTimer);\n          this._searchTimer = setTimeout(function () {\n            _this3._search(searchValue);\n          }, searchTimeout);\n        } else {\n          this._search(searchValue);\n        }\n      }\n    }, {\n      key: \"_isMinSearchLengthExceeded\",\n      value: function (searchValue) {\n        return searchValue.length >= this._activeMentionConfig.minSearchLength;\n      }\n    }, {\n      key: \"_resetFilter\",\n      value: function () {\n        clearTimeout(this._searchTimer);\n\n        this._search(null);\n      }\n    }, {\n      key: \"_search\",\n      value: function (searchValue) {\n        this._hasSearch = true;\n\n        this._list.option(\"searchValue\", searchValue);\n      }\n    }, {\n      key: \"_focusFirstElement\",\n      value: function () {\n        if (!this._list) {\n          return;\n        }\n\n        var $firstItem = this._activeListItems.first();\n\n        this._list.option(\"focusedElement\", (0, _element.getPublicElement)($firstItem));\n\n        this._list.scrollToItem($firstItem);\n      }\n    }, {\n      key: \"_getPopupConfig\",\n      value: function () {\n        var _this4 = this;\n\n        return (0, _extend.extend)(_get(_getPrototypeOf(MentionModule.prototype), \"_getPopupConfig\", this).call(this), {\n          closeOnTargetScroll: false,\n          onShown: function () {\n            _this4._isMentionActive = true;\n            _this4._hasSearch = false;\n\n            _this4._focusFirstElement();\n          },\n          onHidden: function () {\n            _this4._list.unselectAll();\n\n            _this4._list.option(\"focusedElement\", null);\n\n            _this4._isMentionActive = false;\n\n            _this4._search(null);\n          },\n          focusStateEnabled: false\n        });\n      }\n    }, {\n      key: \"clean\",\n      value: function () {\n        var _this5 = this;\n\n        Object.keys(this._mentions).forEach(function (marker) {\n          if (_this5._mentions[marker].template) {\n            _mention.default.removeTemplate(marker);\n          }\n        });\n      }\n    }, {\n      key: \"_isPopupVisible\",\n      get: function () {\n        var _this$_popup;\n\n        return null === (_this$_popup = this._popup) || void 0 === _this$_popup ? void 0 : _this$_popup.option(\"visible\");\n      }\n    }, {\n      key: \"_popupPosition\",\n      get: function () {\n        var position = this.getPosition();\n\n        var _this$quill$getBounds = this.quill.getBounds(position ? position - 1 : position),\n            mentionLeft = _this$quill$getBounds.left,\n            mentionTop = _this$quill$getBounds.top,\n            mentionHeight = _this$quill$getBounds.height;\n\n        var _$$offset = (0, _renderer.default)(this.quill.root).offset(),\n            leftOffset = _$$offset.left,\n            topOffset = _$$offset.top;\n\n        var positionEvent = _events_engine.default.Event(\"positionEvent\", {\n          pageX: leftOffset + mentionLeft,\n          pageY: topOffset + mentionTop\n        });\n\n        return {\n          of: positionEvent,\n          offset: {\n            v: mentionHeight\n          },\n          my: \"top left\",\n          at: \"top left\",\n          collision: {\n            y: \"flip\",\n            x: \"flipfit\"\n          }\n        };\n      }\n    }, {\n      key: \"_activeListItems\",\n      get: function () {\n        return this._list.itemElements().filter(\":not(.\".concat(DISABLED_STATE_CLASS, \")\"));\n      }\n    }]);\n\n    return MentionModule;\n  }(_popup.default);\n}\n\nvar _default = MentionModule;\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["E:/newfrontend/webfe/node_modules/devextreme/ui/html_editor/modules/mentions.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","exports","default","_renderer","_interopRequireDefault","require","_devextremeQuill","_data","_type","_extend","_element","_events_engine","_popup","_mention","__esModule","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","_inherits","subClass","superClass","create","value","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","result","Super","_getPrototypeOf","NewTarget","Reflect","construct","arguments","apply","_possibleConstructorReturn","self","call","_assertThisInitialized","ReferenceError","sham","Proxy","Date","toString","e","_get","property","receiver","get","base","_superPropBase","desc","getOwnPropertyDescriptor","object","hasOwnProperty","getPrototypeOf","MentionModule","USER_ACTION","SILENT_ACTION","DEFAULT_MARKER","KEYS","ARROW_UP","ARROW_DOWN","ARROW_LEFT","ARROW_RIGHT","ENTER","ESCAPE","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","NAVIGATION_KEYS","ALLOWED_PREFIX_CHARS","DISABLED_STATE_CLASS","register","_PopupModule","_super","baseConfig","extend","itemTemplate","valueExpr","displayExpr","template","searchExpr","searchTimeout","minSearchLength","quill","options","_this","_mentions","editorInstance","mentions","forEach","item","marker","preparedTemplate","_getTemplate","addTemplate","_getDefaultOptions","_attachKeyboardHandlers","addCleanCallback","clean","bind","on","onTextChange","keyboard","addBinding","_moveToItem","_selectItemHandler","enterBindings","bindings","unshift","pop","_escapeKeyHandler","shiftKey","_ignoreKeyHandler","direction","dataSource","_list","getDataSource","_isMentionActive","isLoading","$focusedItem","option","defaultItemPosition","$nextItem","_activeListItems","getPublicElement","scrollToItem","start","end","selectItem","hide","$container","compileGetters","_ref","_valueGetter","compileGetter","_idGetter","_this2","onContentReady","_hasSearch","repaint","_focusFirstElement","markerLength","_activeMentionConfig","textLength","_searchValue","caretPosition","getPosition","startIndex","Math","max","selectedItem","id","setTimeout","insertText","deleteText","insertEmbed","setSelection","ops","lastOperation","isLastOperationInsert","isLastOperationDelete","penultOperation","isPenultOperationInsert","isSelectionReplacing","newDelta","oldDelta","source","_isPopupVisible","_processSearchValue","_filterList","lastInsertOperation","_getLastInsertOperation","checkMentionRequest","operation","isInsertOperation","insert","delete","slice","_ref2","caret","getSelection","isString","_isMarkerPartOfText","retain","_updateList","savePosition","index","_popupPosition","show","indexOf","_getCharByIndex","getContents","_ref3","unselectAll","searchValue","_this3","_isMinSearchLengthExceeded","_resetFilter","clearTimeout","_searchTimer","_search","$firstItem","first","_this4","closeOnTargetScroll","onShown","onHidden","focusStateEnabled","_this5","keys","removeTemplate","_this$_popup","position","_this$quill$getBounds","getBounds","mentionLeft","left","mentionTop","top","mentionHeight","height","_$$offset","root","offset","leftOffset","topOffset","positionEvent","Event","pageX","pageY","of","v","my","at","collision","y","x","itemElements","filter","concat","_default","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/html_editor/modules/mentions.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\n\r\nfunction _typeof(obj) {\r\n    \"@babel/helpers - typeof\";\r\n    if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\r\n        _typeof = function(obj) {\r\n            return typeof obj\r\n        }\r\n    } else {\r\n        _typeof = function(obj) {\r\n            return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj\r\n        }\r\n    }\r\n    return _typeof(obj)\r\n}\r\nexports.default = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../../../core/renderer\"));\r\nvar _devextremeQuill = _interopRequireDefault(require(\"devextreme-quill\"));\r\nvar _data = require(\"../../../core/utils/data\");\r\nvar _type = require(\"../../../core/utils/type\");\r\nvar _extend = require(\"../../../core/utils/extend\");\r\nvar _element = require(\"../../../core/element\");\r\nvar _events_engine = _interopRequireDefault(require(\"../../../events/core/events_engine\"));\r\nvar _popup = _interopRequireDefault(require(\"./popup\"));\r\nvar _mention = _interopRequireDefault(require(\"../formats/mention\"));\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n        throw new TypeError(\"Cannot call a class as a function\")\r\n    }\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n    for (var i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if (\"value\" in descriptor) {\r\n            descriptor.writable = true\r\n        }\r\n        Object.defineProperty(target, descriptor.key, descriptor)\r\n    }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n    if (protoProps) {\r\n        _defineProperties(Constructor.prototype, protoProps)\r\n    }\r\n    if (staticProps) {\r\n        _defineProperties(Constructor, staticProps)\r\n    }\r\n    return Constructor\r\n}\r\n\r\nfunction _inherits(subClass, superClass) {\r\n    if (\"function\" !== typeof superClass && null !== superClass) {\r\n        throw new TypeError(\"Super expression must either be null or a function\")\r\n    }\r\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\r\n        constructor: {\r\n            value: subClass,\r\n            writable: true,\r\n            configurable: true\r\n        }\r\n    });\r\n    if (superClass) {\r\n        _setPrototypeOf(subClass, superClass)\r\n    }\r\n}\r\n\r\nfunction _setPrototypeOf(o, p) {\r\n    _setPrototypeOf = Object.setPrototypeOf || function(o, p) {\r\n        o.__proto__ = p;\r\n        return o\r\n    };\r\n    return _setPrototypeOf(o, p)\r\n}\r\n\r\nfunction _createSuper(Derived) {\r\n    var hasNativeReflectConstruct = _isNativeReflectConstruct();\r\n    return function() {\r\n        var result, Super = _getPrototypeOf(Derived);\r\n        if (hasNativeReflectConstruct) {\r\n            var NewTarget = _getPrototypeOf(this).constructor;\r\n            result = Reflect.construct(Super, arguments, NewTarget)\r\n        } else {\r\n            result = Super.apply(this, arguments)\r\n        }\r\n        return _possibleConstructorReturn(this, result)\r\n    }\r\n}\r\n\r\nfunction _possibleConstructorReturn(self, call) {\r\n    if (call && (\"object\" === _typeof(call) || \"function\" === typeof call)) {\r\n        return call\r\n    }\r\n    return _assertThisInitialized(self)\r\n}\r\n\r\nfunction _assertThisInitialized(self) {\r\n    if (void 0 === self) {\r\n        throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\")\r\n    }\r\n    return self\r\n}\r\n\r\nfunction _isNativeReflectConstruct() {\r\n    if (\"undefined\" === typeof Reflect || !Reflect.construct) {\r\n        return false\r\n    }\r\n    if (Reflect.construct.sham) {\r\n        return false\r\n    }\r\n    if (\"function\" === typeof Proxy) {\r\n        return true\r\n    }\r\n    try {\r\n        Date.prototype.toString.call(Reflect.construct(Date, [], function() {}));\r\n        return true\r\n    } catch (e) {\r\n        return false\r\n    }\r\n}\r\n\r\nfunction _get(target, property, receiver) {\r\n    if (\"undefined\" !== typeof Reflect && Reflect.get) {\r\n        _get = Reflect.get\r\n    } else {\r\n        _get = function(target, property, receiver) {\r\n            var base = _superPropBase(target, property);\r\n            if (!base) {\r\n                return\r\n            }\r\n            var desc = Object.getOwnPropertyDescriptor(base, property);\r\n            if (desc.get) {\r\n                return desc.get.call(receiver)\r\n            }\r\n            return desc.value\r\n        }\r\n    }\r\n    return _get(target, property, receiver || target)\r\n}\r\n\r\nfunction _superPropBase(object, property) {\r\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\r\n        object = _getPrototypeOf(object);\r\n        if (null === object) {\r\n            break\r\n        }\r\n    }\r\n    return object\r\n}\r\n\r\nfunction _getPrototypeOf(o) {\r\n    _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function(o) {\r\n        return o.__proto__ || Object.getPrototypeOf(o)\r\n    };\r\n    return _getPrototypeOf(o)\r\n}\r\nvar MentionModule = {};\r\nif (_devextremeQuill.default) {\r\n    var USER_ACTION = \"user\";\r\n    var SILENT_ACTION = \"silent\";\r\n    var DEFAULT_MARKER = \"@\";\r\n    var KEYS = {\r\n        ARROW_UP: \"upArrow\",\r\n        ARROW_DOWN: \"downArrow\",\r\n        ARROW_LEFT: \"leftArrow\",\r\n        ARROW_RIGHT: \"rightArrow\",\r\n        ENTER: \"enter\",\r\n        ESCAPE: \"escape\",\r\n        SPACE: \"space\",\r\n        PAGE_UP: \"pageUp\",\r\n        PAGE_DOWN: \"pageDown\",\r\n        END: \"end\",\r\n        HOME: \"home\"\r\n    };\r\n    var NAVIGATION_KEYS = [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT, KEYS.PAGE_UP, KEYS.PAGE_DOWN, KEYS.END, KEYS.HOME];\r\n    var ALLOWED_PREFIX_CHARS = [\" \", \"\\n\"];\r\n    var DISABLED_STATE_CLASS = \"dx-state-disabled\";\r\n    _devextremeQuill.default.register({\r\n        \"formats/mention\": _mention.default\r\n    }, true);\r\n    MentionModule = function(_PopupModule) {\r\n        _inherits(MentionModule, _PopupModule);\r\n        var _super = _createSuper(MentionModule);\r\n        _createClass(MentionModule, [{\r\n            key: \"_getDefaultOptions\",\r\n            value: function() {\r\n                var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getDefaultOptions\", this).call(this);\r\n                return (0, _extend.extend)(baseConfig, {\r\n                    itemTemplate: \"item\",\r\n                    valueExpr: \"this\",\r\n                    displayExpr: \"this\",\r\n                    template: null,\r\n                    searchExpr: null,\r\n                    searchTimeout: 500,\r\n                    minSearchLength: 0\r\n                })\r\n            }\r\n        }]);\r\n\r\n        function MentionModule(quill, options) {\r\n            var _this;\r\n            _classCallCheck(this, MentionModule);\r\n            _this = _super.call(this, quill, options);\r\n            _this._mentions = {};\r\n            _this.editorInstance = options.editorInstance;\r\n            options.mentions.forEach(function(item) {\r\n                var marker = item.marker;\r\n                if (!marker) {\r\n                    item.marker = marker = DEFAULT_MARKER\r\n                }\r\n                var template = item.template;\r\n                if (template) {\r\n                    var preparedTemplate = _this.editorInstance._getTemplate(template);\r\n                    preparedTemplate && _mention.default.addTemplate(marker, preparedTemplate)\r\n                }\r\n                _this._mentions[marker] = (0, _extend.extend)({}, _this._getDefaultOptions(), item)\r\n            });\r\n            _this._attachKeyboardHandlers();\r\n            _this.editorInstance.addCleanCallback(_this.clean.bind(_assertThisInitialized(_this)));\r\n            _this.quill.on(\"text-change\", _this.onTextChange.bind(_assertThisInitialized(_this)));\r\n            return _this\r\n        }\r\n        _createClass(MentionModule, [{\r\n            key: \"_attachKeyboardHandlers\",\r\n            value: function() {\r\n                this.quill.keyboard.addBinding({\r\n                    key: KEYS.ARROW_UP\r\n                }, this._moveToItem.bind(this, \"prev\"));\r\n                this.quill.keyboard.addBinding({\r\n                    key: KEYS.ARROW_DOWN\r\n                }, this._moveToItem.bind(this, \"next\"));\r\n                this.quill.keyboard.addBinding({\r\n                    key: [KEYS.ENTER, KEYS.SPACE]\r\n                }, this._selectItemHandler.bind(this));\r\n                var enterBindings = this.quill.keyboard.bindings[KEYS.ENTER];\r\n                enterBindings.unshift(enterBindings.pop());\r\n                this.quill.keyboard.addBinding({\r\n                    key: KEYS.ESCAPE\r\n                }, this._escapeKeyHandler.bind(this));\r\n                this.quill.keyboard.addBinding({\r\n                    key: [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT],\r\n                    shiftKey: true\r\n                }, this._ignoreKeyHandler.bind(this));\r\n                this.quill.keyboard.addBinding({\r\n                    key: NAVIGATION_KEYS\r\n                }, this._ignoreKeyHandler.bind(this))\r\n            }\r\n        }, {\r\n            key: \"_moveToItem\",\r\n            value: function(direction) {\r\n                var dataSource = this._list.getDataSource();\r\n                if (this._isMentionActive && !dataSource.isLoading()) {\r\n                    var $focusedItem = (0, _renderer.default)(this._list.option(\"focusedElement\"));\r\n                    var defaultItemPosition = \"next\" === direction ? \"first\" : \"last\";\r\n                    var $nextItem = $focusedItem[direction]();\r\n                    $nextItem = $nextItem.length ? $nextItem : this._activeListItems[defaultItemPosition]();\r\n                    this._list.option(\"focusedElement\", (0, _element.getPublicElement)($nextItem));\r\n                    this._list.scrollToItem($nextItem)\r\n                }\r\n                return !this._isMentionActive\r\n            }\r\n        }, {\r\n            key: \"_ignoreKeyHandler\",\r\n            value: function() {\r\n                return !this._isMentionActive\r\n            }\r\n        }, {\r\n            key: \"_fitIntoRange\",\r\n            value: function(value, start, end) {\r\n                if (value > end) {\r\n                    return start\r\n                }\r\n                if (value < start) {\r\n                    return end\r\n                }\r\n                return value\r\n            }\r\n        }, {\r\n            key: \"_selectItemHandler\",\r\n            value: function() {\r\n                if (this._isMentionActive) {\r\n                    this._list.selectItem(this._list.option(\"focusedElement\"))\r\n                }\r\n                return !this._isMentionActive\r\n            }\r\n        }, {\r\n            key: \"_escapeKeyHandler\",\r\n            value: function() {\r\n                if (this._isMentionActive) {\r\n                    this._popup.hide()\r\n                }\r\n                return !this._isMentionActive\r\n            }\r\n        }, {\r\n            key: \"renderList\",\r\n            value: function($container, options) {\r\n                this.compileGetters(this.options);\r\n                _get(_getPrototypeOf(MentionModule.prototype), \"renderList\", this).call(this, $container, options)\r\n            }\r\n        }, {\r\n            key: \"compileGetters\",\r\n            value: function(_ref) {\r\n                var displayExpr = _ref.displayExpr,\r\n                    valueExpr = _ref.valueExpr;\r\n                this._valueGetter = (0, _data.compileGetter)(displayExpr);\r\n                this._idGetter = (0, _data.compileGetter)(valueExpr)\r\n            }\r\n        }, {\r\n            key: \"_getListConfig\",\r\n            value: function(options) {\r\n                var _this2 = this;\r\n                var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getListConfig\", this).call(this, options);\r\n                return (0, _extend.extend)(baseConfig, {\r\n                    itemTemplate: this.options.itemTemplate,\r\n                    onContentReady: function() {\r\n                        if (_this2._hasSearch) {\r\n                            _this2._popup.repaint();\r\n                            _this2._focusFirstElement();\r\n                            _this2._hasSearch = false\r\n                        }\r\n                    }\r\n                })\r\n            }\r\n        }, {\r\n            key: \"insertEmbedContent\",\r\n            value: function() {\r\n                var markerLength = this._activeMentionConfig.marker.length;\r\n                var textLength = markerLength + this._searchValue.length;\r\n                var caretPosition = this.getPosition();\r\n                var startIndex = Math.max(0, caretPosition - markerLength);\r\n                var selectedItem = this._list.option(\"selectedItem\");\r\n                var value = {\r\n                    value: this._valueGetter(selectedItem),\r\n                    id: this._idGetter(selectedItem),\r\n                    marker: this._activeMentionConfig.marker\r\n                };\r\n                setTimeout(function() {\r\n                    this.quill.insertText(startIndex, \" \", SILENT_ACTION);\r\n                    this.quill.deleteText(startIndex + 1, textLength, SILENT_ACTION);\r\n                    this.quill.insertEmbed(startIndex, \"mention\", value);\r\n                    this.quill.setSelection(startIndex + 2)\r\n                }.bind(this))\r\n            }\r\n        }, {\r\n            key: \"_getLastInsertOperation\",\r\n            value: function(ops) {\r\n                var lastOperation = ops[ops.length - 1];\r\n                var isLastOperationInsert = \"insert\" in lastOperation;\r\n                if (isLastOperationInsert) {\r\n                    return lastOperation\r\n                }\r\n                var isLastOperationDelete = \"delete\" in lastOperation;\r\n                if (isLastOperationDelete && ops.length >= 2) {\r\n                    var penultOperation = ops[ops.length - 2];\r\n                    var isPenultOperationInsert = \"insert\" in penultOperation;\r\n                    var isSelectionReplacing = isLastOperationDelete && isPenultOperationInsert;\r\n                    if (isSelectionReplacing) {\r\n                        return penultOperation\r\n                    }\r\n                }\r\n                return null\r\n            }\r\n        }, {\r\n            key: \"onTextChange\",\r\n            value: function(newDelta, oldDelta, source) {\r\n                if (source === USER_ACTION) {\r\n                    var lastOperation = newDelta.ops[newDelta.ops.length - 1];\r\n                    if (this._isMentionActive && this._isPopupVisible) {\r\n                        this._processSearchValue(lastOperation) && this._filterList(this._searchValue)\r\n                    } else {\r\n                        var ops = newDelta.ops;\r\n                        var lastInsertOperation = this._getLastInsertOperation(ops);\r\n                        if (lastInsertOperation) {\r\n                            this.checkMentionRequest(lastInsertOperation, ops)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }, {\r\n            key: \"_processSearchValue\",\r\n            value: function(operation) {\r\n                var isInsertOperation = \"insert\" in operation;\r\n                if (isInsertOperation) {\r\n                    this._searchValue += operation.insert\r\n                } else {\r\n                    if (!this._searchValue.length || operation.delete > 1) {\r\n                        this._popup.hide();\r\n                        return false\r\n                    } else {\r\n                        this._searchValue = this._searchValue.slice(0, -1)\r\n                    }\r\n                }\r\n                return true\r\n            }\r\n        }, {\r\n            key: \"checkMentionRequest\",\r\n            value: function(_ref2, ops) {\r\n                var insert = _ref2.insert;\r\n                var caret = this.quill.getSelection();\r\n                if (!insert || !(0, _type.isString)(insert) || !caret || this._isMarkerPartOfText(ops[0].retain)) {\r\n                    return\r\n                }\r\n                this._activeMentionConfig = this._mentions[insert];\r\n                if (this._activeMentionConfig) {\r\n                    this._updateList(this._activeMentionConfig);\r\n                    this.savePosition(caret.index);\r\n                    this._popup.option(\"position\", this._popupPosition);\r\n                    this._searchValue = \"\";\r\n                    this._popup.show()\r\n                }\r\n            }\r\n        }, {\r\n            key: \"_isMarkerPartOfText\",\r\n            value: function(retain) {\r\n                if (!retain || ALLOWED_PREFIX_CHARS.indexOf(this._getCharByIndex(retain - 1)) !== -1) {\r\n                    return false\r\n                }\r\n                return true\r\n            }\r\n        }, {\r\n            key: \"_getCharByIndex\",\r\n            value: function(index) {\r\n                return this.quill.getContents(index, 1).ops[0].insert\r\n            }\r\n        }, {\r\n            key: \"_updateList\",\r\n            value: function(_ref3) {\r\n                var dataSource = _ref3.dataSource,\r\n                    displayExpr = _ref3.displayExpr,\r\n                    valueExpr = _ref3.valueExpr,\r\n                    itemTemplate = _ref3.itemTemplate,\r\n                    searchExpr = _ref3.searchExpr;\r\n                this.compileGetters({\r\n                    displayExpr: displayExpr,\r\n                    valueExpr: valueExpr\r\n                });\r\n                this._list.unselectAll();\r\n                this._list.option({\r\n                    dataSource: dataSource,\r\n                    displayExpr: displayExpr,\r\n                    itemTemplate: itemTemplate,\r\n                    searchExpr: searchExpr\r\n                })\r\n            }\r\n        }, {\r\n            key: \"_filterList\",\r\n            value: function(searchValue) {\r\n                var _this3 = this;\r\n                if (!this._isMinSearchLengthExceeded(searchValue)) {\r\n                    this._resetFilter();\r\n                    return\r\n                }\r\n                var searchTimeout = this._activeMentionConfig.searchTimeout;\r\n                if (searchTimeout) {\r\n                    clearTimeout(this._searchTimer);\r\n                    this._searchTimer = setTimeout(function() {\r\n                        _this3._search(searchValue)\r\n                    }, searchTimeout)\r\n                } else {\r\n                    this._search(searchValue)\r\n                }\r\n            }\r\n        }, {\r\n            key: \"_isMinSearchLengthExceeded\",\r\n            value: function(searchValue) {\r\n                return searchValue.length >= this._activeMentionConfig.minSearchLength\r\n            }\r\n        }, {\r\n            key: \"_resetFilter\",\r\n            value: function() {\r\n                clearTimeout(this._searchTimer);\r\n                this._search(null)\r\n            }\r\n        }, {\r\n            key: \"_search\",\r\n            value: function(searchValue) {\r\n                this._hasSearch = true;\r\n                this._list.option(\"searchValue\", searchValue)\r\n            }\r\n        }, {\r\n            key: \"_focusFirstElement\",\r\n            value: function() {\r\n                if (!this._list) {\r\n                    return\r\n                }\r\n                var $firstItem = this._activeListItems.first();\r\n                this._list.option(\"focusedElement\", (0, _element.getPublicElement)($firstItem));\r\n                this._list.scrollToItem($firstItem)\r\n            }\r\n        }, {\r\n            key: \"_getPopupConfig\",\r\n            value: function() {\r\n                var _this4 = this;\r\n                return (0, _extend.extend)(_get(_getPrototypeOf(MentionModule.prototype), \"_getPopupConfig\", this).call(this), {\r\n                    closeOnTargetScroll: false,\r\n                    onShown: function() {\r\n                        _this4._isMentionActive = true;\r\n                        _this4._hasSearch = false;\r\n                        _this4._focusFirstElement()\r\n                    },\r\n                    onHidden: function() {\r\n                        _this4._list.unselectAll();\r\n                        _this4._list.option(\"focusedElement\", null);\r\n                        _this4._isMentionActive = false;\r\n                        _this4._search(null)\r\n                    },\r\n                    focusStateEnabled: false\r\n                })\r\n            }\r\n        }, {\r\n            key: \"clean\",\r\n            value: function() {\r\n                var _this5 = this;\r\n                Object.keys(this._mentions).forEach(function(marker) {\r\n                    if (_this5._mentions[marker].template) {\r\n                        _mention.default.removeTemplate(marker)\r\n                    }\r\n                })\r\n            }\r\n        }, {\r\n            key: \"_isPopupVisible\",\r\n            get: function() {\r\n                var _this$_popup;\r\n                return null === (_this$_popup = this._popup) || void 0 === _this$_popup ? void 0 : _this$_popup.option(\"visible\")\r\n            }\r\n        }, {\r\n            key: \"_popupPosition\",\r\n            get: function() {\r\n                var position = this.getPosition();\r\n                var _this$quill$getBounds = this.quill.getBounds(position ? position - 1 : position),\r\n                    mentionLeft = _this$quill$getBounds.left,\r\n                    mentionTop = _this$quill$getBounds.top,\r\n                    mentionHeight = _this$quill$getBounds.height;\r\n                var _$$offset = (0, _renderer.default)(this.quill.root).offset(),\r\n                    leftOffset = _$$offset.left,\r\n                    topOffset = _$$offset.top;\r\n                var positionEvent = _events_engine.default.Event(\"positionEvent\", {\r\n                    pageX: leftOffset + mentionLeft,\r\n                    pageY: topOffset + mentionTop\r\n                });\r\n                return {\r\n                    of: positionEvent,\r\n                    offset: {\r\n                        v: mentionHeight\r\n                    },\r\n                    my: \"top left\",\r\n                    at: \"top left\",\r\n                    collision: {\r\n                        y: \"flip\",\r\n                        x: \"flipfit\"\r\n                    }\r\n                }\r\n            }\r\n        }, {\r\n            key: \"_activeListItems\",\r\n            get: function() {\r\n                return this._list.itemElements().filter(\":not(.\".concat(DISABLED_STATE_CLASS, \")\"))\r\n            }\r\n        }]);\r\n        return MentionModule\r\n    }(_popup.default)\r\n}\r\nvar _default = MentionModule;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}