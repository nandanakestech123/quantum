{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/ui.scheduler.appointment_model.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _config = _interopRequireDefault(require(\"../../core/config\"));\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _date_serialization = _interopRequireDefault(require(\"../../core/utils/date_serialization\"));\n\nvar _recurrence = require(\"./recurrence\");\n\nvar _date = _interopRequireDefault(require(\"../../core/utils/date\"));\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _query = _interopRequireDefault(require(\"../../data/query\"));\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar toMs = _date.default.dateToMilliseconds;\nvar DATE_FILTER_POSITION = 0;\nvar USER_FILTER_POSITION = 1;\n\nvar FilterMaker = function () {\n  function FilterMaker(dataAccessors) {\n    _classCallCheck(this, FilterMaker);\n\n    this._filterRegistry = null;\n    this._dataAccessors = dataAccessors;\n  }\n\n  _createClass(FilterMaker, [{\n    key: \"isRegistered\",\n    value: function () {\n      return !!this._filterRegistry;\n    }\n  }, {\n    key: \"clearRegistry\",\n    value: function () {\n      delete this._filterRegistry;\n    }\n  }, {\n    key: \"make\",\n    value: function (type, args) {\n      if (!this._filterRegistry) {\n        this._filterRegistry = {};\n      }\n\n      this._make(type).apply(this, args);\n    }\n  }, {\n    key: \"_make\",\n    value: function (type) {\n      var _this = this;\n\n      switch (type) {\n        case \"date\":\n          return function (min, max, useAccessors) {\n            var startDate = useAccessors ? _this._dataAccessors.getter.startDate : _this._dataAccessors.expr.startDateExpr;\n            var endDate = useAccessors ? _this._dataAccessors.getter.endDate : _this._dataAccessors.expr.endDateExpr;\n            var recurrenceRule = _this._dataAccessors.expr.recurrenceRuleExpr;\n            _this._filterRegistry.date = [[[endDate, \">\", min], [startDate, \"<\", max]], \"or\", [recurrenceRule, \"startswith\", \"freq\"], \"or\", [[endDate, min], [startDate, min]]];\n\n            if (!recurrenceRule) {\n              _this._filterRegistry.date.splice(1, 2);\n            }\n          };\n\n        case \"user\":\n          return function (userFilter) {\n            _this._filterRegistry.user = userFilter;\n          };\n      }\n    }\n  }, {\n    key: \"combine\",\n    value: function () {\n      var filter = [];\n      this._filterRegistry.date && filter.push(this._filterRegistry.date);\n      this._filterRegistry.user && filter.push(this._filterRegistry.user);\n      return filter;\n    }\n  }, {\n    key: \"dateFilter\",\n    value: function () {\n      return this._filterRegistry.date;\n    }\n  }]);\n\n  return FilterMaker;\n}();\n\nvar compareDateWithStartDayHour = function (startDate, endDate, startDayHour, allDay, severalDays) {\n  var startTime = _date.default.dateTimeFromDecimal(startDayHour);\n\n  var result = startDate.getHours() >= startTime.hours && startDate.getMinutes() >= startTime.minutes || endDate.getHours() === startTime.hours && endDate.getMinutes() > startTime.minutes || endDate.getHours() > startTime.hours || severalDays || allDay;\n  return result;\n};\n\nvar compareDateWithEndDayHour = function (startDate, endDate, startDayHour, endDayHour, allDay, severalDays, max, min) {\n  var hiddenInterval = (24 - endDayHour + startDayHour) * toMs(\"hour\");\n  var apptDuration = endDate.getTime() - startDate.getTime();\n  var delta = (hiddenInterval - apptDuration) / toMs(\"hour\");\n  var apptStartHour = startDate.getHours();\n  var apptStartMinutes = startDate.getMinutes();\n  var result;\n\n  var endTime = _date.default.dateTimeFromDecimal(endDayHour);\n\n  var startTime = _date.default.dateTimeFromDecimal(startDayHour);\n\n  result = apptStartHour < endTime.hours || apptStartHour === endTime.hours && apptStartMinutes < endTime.minutes || allDay && startDate <= max || severalDays && startDate < max && endDate > min && (apptStartHour < endTime.hours || 60 * endDate.getHours() + endDate.getMinutes() > 60 * startTime.hours);\n\n  if (apptDuration < hiddenInterval) {\n    if (apptStartHour > endTime.hours && apptStartMinutes > endTime.minutes && delta <= apptStartHour - endDayHour) {\n      result = false;\n    }\n  }\n\n  return result;\n};\n\nvar AppointmentModel = function () {\n  function AppointmentModel(dataSource, dataAccessors, baseAppointmentDuration) {\n    _classCallCheck(this, AppointmentModel);\n\n    this.setDataAccessors(dataAccessors);\n    this.setDataSource(dataSource);\n    this._updatedAppointmentKeys = [];\n    this._filterMaker = new FilterMaker(dataAccessors);\n    this._baseAppointmentDuration = baseAppointmentDuration;\n  }\n\n  _createClass(AppointmentModel, [{\n    key: \"_createFilter\",\n    value: function (min, max, remoteFiltering, dateSerializationFormat) {\n      this._filterMaker.make(\"date\", [min, max]);\n\n      var userFilterPosition = this._excessFiltering() ? this._dataSource.filter()[USER_FILTER_POSITION] : this._dataSource.filter();\n\n      this._filterMaker.make(\"user\", [userFilterPosition]);\n\n      if (remoteFiltering) {\n        this._dataSource.filter(this._combineRemoteFilter(dateSerializationFormat));\n      }\n    }\n  }, {\n    key: \"_excessFiltering\",\n    value: function () {\n      var dateFilter = this._filterMaker.dateFilter();\n\n      var dataSourceFilter = this._dataSource.filter();\n\n      return dataSourceFilter && ((0, _common.equalByValue)(dataSourceFilter, dateFilter) || dataSourceFilter.length && (0, _common.equalByValue)(dataSourceFilter[DATE_FILTER_POSITION], dateFilter));\n    }\n  }, {\n    key: \"_combineFilter\",\n    value: function () {\n      return this._filterMaker.combine();\n    }\n  }, {\n    key: \"_getStoreKey\",\n    value: function (target) {\n      var store = this._dataSource.store();\n\n      return store.keyOf(target);\n    }\n  }, {\n    key: \"_filterAppointmentByResources\",\n    value: function (appointment, resources) {\n      var _this2 = this;\n\n      var result = false;\n      var i;\n      var len;\n      var resourceName;\n\n      var checkAppointmentResourceValues = function () {\n        var resourceGetter = _this2._dataAccessors.getter.resources[resourceName];\n        var resource;\n\n        if ((0, _type.isFunction)(resourceGetter)) {\n          resource = resourceGetter(appointment);\n        }\n\n        var appointmentResourceValues = (0, _array.wrapToArray)(resource);\n        var resourceData = (0, _iterator.map)(resources[i].items, function (item) {\n          return item.id;\n        });\n\n        for (var j = 0, itemDataCount = appointmentResourceValues.length; j < itemDataCount; j++) {\n          if ((0, _array.inArray)(appointmentResourceValues[j], resourceData) > -1) {\n            return true;\n          }\n        }\n\n        return false;\n      };\n\n      for (i = 0, len = resources.length; i < len; i++) {\n        resourceName = resources[i].name;\n        result = checkAppointmentResourceValues.call(this);\n\n        if (!result) {\n          return false;\n        }\n      }\n\n      return result;\n    }\n  }, {\n    key: \"_filterAppointmentByRRule\",\n    value: function (appointment, min, max, startDayHour, endDayHour, firstDayOfWeek) {\n      var recurrenceRule = appointment.recurrenceRule;\n      var recurrenceException = appointment.recurrenceException;\n      var allDay = appointment.allDay;\n      var result = true;\n      var appointmentStartDate = appointment.startDate;\n      var appointmentEndDate = appointment.endDate;\n      var recurrenceProcessor = (0, _recurrence.getRecurrenceProcessor)();\n\n      if (allDay || this._appointmentPartInInterval(appointmentStartDate, appointmentEndDate, startDayHour, endDayHour)) {\n        var trimmedDates = this._trimDates(min, max);\n\n        min = trimmedDates.min;\n        max = new Date(trimmedDates.max.getTime() - toMs(\"minute\"));\n      }\n\n      if (recurrenceRule && !recurrenceProcessor.isValidRecurrenceRule(recurrenceRule)) {\n        result = appointmentEndDate > min && appointmentStartDate <= max;\n      }\n\n      if (result && recurrenceProcessor.isValidRecurrenceRule(recurrenceRule)) {\n        result = recurrenceProcessor.hasRecurrence({\n          rule: recurrenceRule,\n          exception: recurrenceException,\n          start: appointmentStartDate,\n          end: appointmentEndDate,\n          min: min,\n          max: max,\n          firstDayOfWeek: firstDayOfWeek\n        });\n      }\n\n      return result;\n    }\n  }, {\n    key: \"_appointmentPartInInterval\",\n    value: function (startDate, endDate, startDayHour, endDayHour) {\n      var apptStartDayHour = startDate.getHours();\n      var apptEndDayHour = endDate.getHours();\n      return apptStartDayHour <= startDayHour && apptEndDayHour <= endDayHour && apptEndDayHour >= startDayHour || apptEndDayHour >= endDayHour && apptStartDayHour <= endDayHour && apptStartDayHour >= startDayHour;\n    }\n  }, {\n    key: \"_createCombinedFilter\",\n    value: function (filterOptions, timeZoneCalculator) {\n      var dataAccessors = this._dataAccessors;\n      var min = new Date(filterOptions.min);\n      var max = new Date(filterOptions.max);\n      var getRecurrenceException = filterOptions.recurrenceException;\n      var startDayHour = filterOptions.startDayHour,\n          endDayHour = filterOptions.endDayHour,\n          viewStartDayHour = filterOptions.viewStartDayHour,\n          viewEndDayHour = filterOptions.viewEndDayHour,\n          resources = filterOptions.resources,\n          firstDayOfWeek = filterOptions.firstDayOfWeek;\n      var that = this;\n      return [[function (appointment) {\n        var result = true;\n        var startDate = new Date(dataAccessors.getter.startDate(appointment));\n        var endDate = new Date(dataAccessors.getter.endDate(appointment));\n        var appointmentTakesAllDay = that.appointmentTakesAllDay(appointment, viewStartDayHour, viewEndDayHour);\n        var appointmentTakesSeveralDays = that.appointmentTakesSeveralDays(appointment);\n        var isAllDay = dataAccessors.getter.allDay(appointment);\n        var appointmentIsLong = appointmentTakesSeveralDays || appointmentTakesAllDay;\n        var useRecurrence = (0, _type.isDefined)(dataAccessors.getter.recurrenceRule);\n        var recurrenceRule;\n\n        if (useRecurrence) {\n          recurrenceRule = dataAccessors.getter.recurrenceRule(appointment);\n        }\n\n        if (resources && resources.length) {\n          result = that._filterAppointmentByResources(appointment, resources);\n        }\n\n        if (appointmentTakesAllDay && false === filterOptions.allDay) {\n          result = false;\n        }\n\n        var startDateTimeZone = dataAccessors.getter.startDateTimeZone(appointment);\n        var endDateTimeZone = dataAccessors.getter.endDateTimeZone(appointment);\n        var comparableStartDate = timeZoneCalculator.createDate(startDate, {\n          appointmentTimeZone: startDateTimeZone,\n          path: \"toGrid\"\n        });\n        var comparableEndDate = timeZoneCalculator.createDate(endDate, {\n          appointmentTimeZone: endDateTimeZone,\n          path: \"toGrid\"\n        });\n\n        if (result && useRecurrence) {\n          var recurrenceException = getRecurrenceException ? getRecurrenceException(appointment) : dataAccessors.getter.recurrenceException(appointment);\n          result = that._filterAppointmentByRRule({\n            startDate: comparableStartDate,\n            endDate: comparableEndDate,\n            recurrenceRule: recurrenceRule,\n            recurrenceException: recurrenceException,\n            allDay: appointmentTakesAllDay\n          }, min, max, startDayHour, endDayHour, firstDayOfWeek);\n        }\n\n        if (result && comparableEndDate < min && appointmentIsLong && !isAllDay && (!useRecurrence || useRecurrence && !recurrenceRule)) {\n          result = false;\n        }\n\n        if (result && void 0 !== startDayHour && (!useRecurrence || !filterOptions.isVirtualScrolling)) {\n          result = compareDateWithStartDayHour(comparableStartDate, comparableEndDate, startDayHour, appointmentTakesAllDay, appointmentTakesSeveralDays);\n        }\n\n        if (result && void 0 !== endDayHour) {\n          result = compareDateWithEndDayHour(comparableStartDate, comparableEndDate, startDayHour, endDayHour, appointmentTakesAllDay, appointmentTakesSeveralDays, max, min);\n        }\n\n        if (result && useRecurrence && !recurrenceRule) {\n          if (comparableEndDate < min && !isAllDay) {\n            result = false;\n          }\n        }\n\n        return result;\n      }]];\n    }\n  }, {\n    key: \"setDataSource\",\n    value: function (dataSource) {\n      this._dataSource = dataSource;\n      this.cleanModelState();\n\n      this._initStoreChangeHandlers();\n\n      this._filterMaker && this._filterMaker.clearRegistry();\n    }\n  }, {\n    key: \"_initStoreChangeHandlers\",\n    value: function () {\n      var _this3 = this;\n\n      var dataSource = this._dataSource;\n      var store = null === dataSource || void 0 === dataSource ? void 0 : dataSource.store();\n\n      if (store) {\n        store.on(\"updating\", function (newItem) {\n          _this3._updatedAppointment = newItem;\n        });\n        store.on(\"push\", function (pushItems) {\n          var items = dataSource.items();\n          var keyName = store.key();\n          pushItems.forEach(function (pushItem) {\n            var itemExists = 0 !== items.filter(function (item) {\n              return item[keyName] === pushItem.key;\n            }).length;\n\n            if (itemExists) {\n              _this3._updatedAppointmentKeys.push({\n                key: keyName,\n                value: pushItem.key\n              });\n            } else {\n              items.push(pushItem.data);\n            }\n          });\n        });\n      }\n    }\n  }, {\n    key: \"getUpdatedAppointment\",\n    value: function () {\n      return this._updatedAppointment;\n    }\n  }, {\n    key: \"getUpdatedAppointmentKeys\",\n    value: function () {\n      return this._updatedAppointmentKeys;\n    }\n  }, {\n    key: \"cleanModelState\",\n    value: function () {\n      this._updatedAppointment = null;\n      this._updatedAppointmentKeys = [];\n    }\n  }, {\n    key: \"setDataAccessors\",\n    value: function (dataAccessors) {\n      this._dataAccessors = dataAccessors;\n      this._filterMaker = new FilterMaker(dataAccessors);\n    }\n  }, {\n    key: \"filterByDate\",\n    value: function (min, max, remoteFiltering, dateSerializationFormat) {\n      if (!this._dataSource) {\n        return;\n      }\n\n      var trimmedDates = this._trimDates(min, max);\n\n      if (!this._filterMaker.isRegistered()) {\n        this._createFilter(trimmedDates.min, trimmedDates.max, remoteFiltering, dateSerializationFormat);\n      } else {\n        var _this$_dataSource$fil;\n\n        this._filterMaker.make(\"date\", [trimmedDates.min, trimmedDates.max]);\n\n        if ((null === (_this$_dataSource$fil = this._dataSource.filter()) || void 0 === _this$_dataSource$fil ? void 0 : _this$_dataSource$fil.length) > 1) {\n          var userFilter = this._serializeRemoteFilter([this._dataSource.filter()[1]], dateSerializationFormat);\n\n          this._filterMaker.make(\"user\", userFilter);\n        }\n\n        if (remoteFiltering) {\n          this._dataSource.filter(this._combineRemoteFilter(dateSerializationFormat));\n        }\n      }\n    }\n  }, {\n    key: \"_combineRemoteFilter\",\n    value: function (dateSerializationFormat) {\n      var combinedFilter = this._filterMaker.combine();\n\n      return this._serializeRemoteFilter(combinedFilter, dateSerializationFormat);\n    }\n  }, {\n    key: \"_serializeRemoteFilter\",\n    value: function (filter, dateSerializationFormat) {\n      if (!Array.isArray(filter)) {\n        return filter;\n      }\n\n      filter = (0, _extend.extend)([], filter);\n      var startDate = this._dataAccessors.expr.startDateExpr;\n      var endDate = this._dataAccessors.expr.endDateExpr;\n\n      if ((0, _type.isString)(filter[0])) {\n        if ((0, _config.default)().forceIsoDateParsing && filter.length > 1) {\n          if (filter[0] === startDate || filter[0] === endDate) {\n            filter[filter.length - 1] = _date_serialization.default.serializeDate(new Date(filter[filter.length - 1]), dateSerializationFormat);\n          }\n        }\n      }\n\n      for (var i = 0; i < filter.length; i++) {\n        filter[i] = this._serializeRemoteFilter(filter[i], dateSerializationFormat);\n      }\n\n      return filter;\n    }\n  }, {\n    key: \"_createAppointmentFilter\",\n    value: function (filterOptions, timeZoneCalculator) {\n      var combinedFilter = this._createCombinedFilter(filterOptions, timeZoneCalculator);\n\n      if (this._filterMaker.isRegistered()) {\n        this._filterMaker.make(\"user\", void 0);\n\n        var trimmedDates = this._trimDates(filterOptions.min, filterOptions.max);\n\n        this._filterMaker.make(\"date\", [trimmedDates.min, trimmedDates.max, true]);\n\n        var dateFilter = this.customizeDateFilter(this._filterMaker.combine(), timeZoneCalculator);\n        combinedFilter.push([dateFilter]);\n      }\n\n      return combinedFilter;\n    }\n  }, {\n    key: \"filterLoadedAppointments\",\n    value: function (filterOption, timeZoneCalculator) {\n      var combinedFilter = this._createAppointmentFilter(filterOption, timeZoneCalculator);\n\n      return (0, _query.default)(this.getPreparedDataItems()).filter(combinedFilter).toArray();\n    }\n  }, {\n    key: \"getPreparedDataItems\",\n    value: function () {\n      var _this4 = this;\n\n      var dataItems = this._dataSource.items();\n\n      return (0, _iterator.map)(dataItems, function (item) {\n        var startDate = new Date(_this4._dataAccessors.getter.startDate(item));\n        var endDate = new Date(_this4._dataAccessors.getter.endDate(item));\n\n        _this4.replaceWrongEndDate(item, startDate, endDate);\n\n        return item;\n      });\n    }\n  }, {\n    key: \"replaceWrongEndDate\",\n    value: function (appointment, startDate, endDate) {\n      if (this._isEndDateWrong(startDate, endDate)) {\n        var isAllDay = this._dataAccessors.getter.allDay(appointment);\n\n        var calculatedEndDate = this._calculateAppointmentEndDate(isAllDay, startDate);\n\n        this._dataAccessors.setter.endDate(appointment, calculatedEndDate);\n      }\n    }\n  }, {\n    key: \"filterLoadedVirtualAppointments\",\n    value: function (filterOptions, timeZoneCalculator, groupCount) {\n      var _this5 = this;\n\n      var combinedFilters = [];\n      var itemsToFilter = this.getPreparedDataItems();\n      var needPreFilter = groupCount > 0;\n\n      if (needPreFilter) {\n        itemsToFilter = itemsToFilter.filter(function (item) {\n          for (var i = 0; i < filterOptions.length; ++i) {\n            var resources = filterOptions[i].resources;\n\n            if (_this5._filterAppointmentByResources(item, resources)) {\n              return true;\n            }\n          }\n        });\n      }\n\n      filterOptions.forEach(function (filterOption) {\n        combinedFilters.length && combinedFilters.push(\"or\");\n\n        var filter = _this5._createAppointmentFilter(filterOption, timeZoneCalculator);\n\n        combinedFilters.push(filter);\n      });\n      return (0, _query.default)(itemsToFilter).filter(combinedFilters).toArray();\n    }\n  }, {\n    key: \"_trimDates\",\n    value: function (min, max) {\n      var minCopy = _date.default.trimTime(new Date(min));\n\n      var maxCopy = _date.default.trimTime(new Date(max));\n\n      maxCopy.setDate(maxCopy.getDate() + 1);\n      return {\n        min: minCopy,\n        max: maxCopy\n      };\n    }\n  }, {\n    key: \"hasAllDayAppointments\",\n    value: function (items, startDayHour, endDayHour) {\n      if (!items) {\n        return false;\n      }\n\n      var that = this;\n      var result = false;\n      (0, _iterator.each)(items, function (index, item) {\n        if (that.appointmentTakesAllDay(item, startDayHour, endDayHour)) {\n          result = true;\n          return false;\n        }\n      });\n      return result;\n    }\n  }, {\n    key: \"appointmentTakesAllDay\",\n    value: function (appointment, startDayHour, endDayHour) {\n      var dataAccessors = this._dataAccessors;\n      var startDate = dataAccessors.getter.startDate(appointment);\n      var endDate = dataAccessors.getter.endDate(appointment);\n      var allDay = dataAccessors.getter.allDay(appointment);\n      return allDay || this._appointmentHasAllDayDuration(startDate, endDate, startDayHour, endDayHour);\n    }\n  }, {\n    key: \"_appointmentHasAllDayDuration\",\n    value: function (startDate, endDate, startDayHour, endDayHour) {\n      startDate = new Date(startDate);\n      endDate = new Date(endDate);\n      var dayDuration = 24;\n\n      var appointmentDurationInHours = this._getAppointmentDurationInHours(startDate, endDate);\n\n      return appointmentDurationInHours >= dayDuration || this._appointmentHasShortDayDuration(startDate, endDate, startDayHour, endDayHour);\n    }\n  }, {\n    key: \"_appointmentHasShortDayDuration\",\n    value: function (startDate, endDate, startDayHour, endDayHour) {\n      var appointmentDurationInHours = this._getAppointmentDurationInHours(startDate, endDate);\n\n      var shortDayDurationInHours = endDayHour - startDayHour;\n      return appointmentDurationInHours >= shortDayDurationInHours && startDate.getHours() === startDayHour && endDate.getHours() === endDayHour;\n    }\n  }, {\n    key: \"_getAppointmentDurationInHours\",\n    value: function (startDate, endDate) {\n      return (endDate.getTime() - startDate.getTime()) / toMs(\"hour\");\n    }\n  }, {\n    key: \"appointmentTakesSeveralDays\",\n    value: function (appointment) {\n      var dataAccessors = this._dataAccessors;\n      var startDate = new Date(dataAccessors.getter.startDate(appointment));\n      var endDate = new Date(dataAccessors.getter.endDate(appointment));\n      return !_date.default.sameDate(startDate, endDate);\n    }\n  }, {\n    key: \"customizeDateFilter\",\n    value: function (dateFilter, timeZoneCalculator) {\n      var _this6 = this;\n\n      var currentFilter = (0, _extend.extend)(true, [], dateFilter);\n      return function (appointment) {\n        var startDate = new Date(_this6._dataAccessors.getter.startDate(appointment));\n        var endDate = new Date(_this6._dataAccessors.getter.endDate(appointment));\n        appointment = (0, _extend.extend)(true, {}, appointment);\n\n        var startDateTimeZone = _this6._dataAccessors.getter.startDateTimeZone(appointment);\n\n        var endDateTimeZone = _this6._dataAccessors.getter.endDateTimeZone(appointment);\n\n        var comparableStartDate = timeZoneCalculator.createDate(startDate, {\n          appointmentTimeZone: startDateTimeZone,\n          path: \"toGrid\"\n        });\n        var comparableEndDate = timeZoneCalculator.createDate(endDate, {\n          appointmentTimeZone: endDateTimeZone,\n          path: \"toGrid\"\n        });\n\n        _this6._dataAccessors.setter.startDate(appointment, comparableStartDate);\n\n        _this6._dataAccessors.setter.endDate(appointment, comparableEndDate);\n\n        return (0, _query.default)([appointment]).filter(currentFilter).toArray().length > 0;\n      }.bind(this);\n    }\n  }, {\n    key: \"_calculateAppointmentEndDate\",\n    value: function (isAllDay, startDate) {\n      if (isAllDay) {\n        return _date.default.setToDayEnd(new Date(startDate));\n      }\n\n      return new Date(startDate.getTime() + this._baseAppointmentDuration * toMs(\"minute\"));\n    }\n  }, {\n    key: \"_isEndDateWrong\",\n    value: function (startDate, endDate) {\n      return !endDate || isNaN(endDate.getTime()) || startDate.getTime() > endDate.getTime();\n    }\n  }, {\n    key: \"add\",\n    value: function (data) {\n      var _this7 = this;\n\n      return this._dataSource.store().insert(data).done(function () {\n        _this7._dataSource.load();\n      }.bind(this));\n    }\n  }, {\n    key: \"update\",\n    value: function (target, data) {\n      var _this8 = this;\n\n      var key = this._getStoreKey(target);\n\n      var d = new _deferred.Deferred();\n\n      this._dataSource.store().update(key, data).done(function () {\n        _this8._dataSource.load().done(d.resolve).fail(d.reject);\n      }).fail(d.reject);\n\n      return d.promise();\n    }\n  }, {\n    key: \"remove\",\n    value: function (target) {\n      var _this9 = this;\n\n      var key = this._getStoreKey(target);\n\n      return this._dataSource.store().remove(key).done(function () {\n        _this9._dataSource.load();\n      }.bind(this));\n    }\n  }, {\n    key: \"keyName\",\n    get: function () {\n      var store = this._dataSource.store();\n\n      return store.key();\n    }\n  }]);\n\n  return AppointmentModel;\n}();\n\nvar _default = AppointmentModel;\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["C:/Users/hp/Downloads/quantumCode20082022/node_modules/devextreme/ui/scheduler/ui.scheduler.appointment_model.js"],"names":["exports","default","_config","_interopRequireDefault","require","_iterator","_date_serialization","_recurrence","_date","_common","_type","_array","_extend","_query","_deferred","obj","__esModule","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","toMs","dateToMilliseconds","DATE_FILTER_POSITION","USER_FILTER_POSITION","FilterMaker","dataAccessors","_filterRegistry","_dataAccessors","value","type","args","_make","apply","_this","min","max","useAccessors","startDate","getter","expr","startDateExpr","endDate","endDateExpr","recurrenceRule","recurrenceRuleExpr","date","splice","userFilter","user","filter","push","compareDateWithStartDayHour","startDayHour","allDay","severalDays","startTime","dateTimeFromDecimal","result","getHours","hours","getMinutes","minutes","compareDateWithEndDayHour","endDayHour","hiddenInterval","apptDuration","getTime","delta","apptStartHour","apptStartMinutes","endTime","AppointmentModel","dataSource","baseAppointmentDuration","setDataAccessors","setDataSource","_updatedAppointmentKeys","_filterMaker","_baseAppointmentDuration","remoteFiltering","dateSerializationFormat","make","userFilterPosition","_excessFiltering","_dataSource","_combineRemoteFilter","dateFilter","dataSourceFilter","equalByValue","combine","store","keyOf","appointment","resources","_this2","len","resourceName","checkAppointmentResourceValues","resourceGetter","resource","isFunction","appointmentResourceValues","wrapToArray","resourceData","map","items","item","id","j","itemDataCount","inArray","name","call","firstDayOfWeek","recurrenceException","appointmentStartDate","appointmentEndDate","recurrenceProcessor","getRecurrenceProcessor","_appointmentPartInInterval","trimmedDates","_trimDates","Date","isValidRecurrenceRule","hasRecurrence","rule","exception","start","end","apptStartDayHour","apptEndDayHour","filterOptions","timeZoneCalculator","getRecurrenceException","viewStartDayHour","viewEndDayHour","that","appointmentTakesAllDay","appointmentTakesSeveralDays","isAllDay","appointmentIsLong","useRecurrence","isDefined","_filterAppointmentByResources","startDateTimeZone","endDateTimeZone","comparableStartDate","createDate","appointmentTimeZone","path","comparableEndDate","_filterAppointmentByRRule","isVirtualScrolling","cleanModelState","_initStoreChangeHandlers","clearRegistry","_this3","on","newItem","_updatedAppointment","pushItems","keyName","forEach","pushItem","itemExists","data","isRegistered","_createFilter","_this$_dataSource$fil","_serializeRemoteFilter","combinedFilter","Array","isArray","extend","isString","forceIsoDateParsing","serializeDate","_createCombinedFilter","customizeDateFilter","filterOption","_createAppointmentFilter","getPreparedDataItems","toArray","_this4","dataItems","replaceWrongEndDate","_isEndDateWrong","calculatedEndDate","_calculateAppointmentEndDate","setter","groupCount","_this5","combinedFilters","itemsToFilter","needPreFilter","minCopy","trimTime","maxCopy","setDate","getDate","each","index","_appointmentHasAllDayDuration","dayDuration","appointmentDurationInHours","_getAppointmentDurationInHours","_appointmentHasShortDayDuration","shortDayDurationInHours","sameDate","_this6","currentFilter","bind","setToDayEnd","isNaN","_this7","insert","done","load","_this8","_getStoreKey","d","Deferred","update","resolve","fail","reject","promise","_this9","remove","get","_default","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/ui.scheduler.appointment_model.js)\r\n * Version: 20.2.5\r\n * Build date: Fri Jan 15 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _config = _interopRequireDefault(require(\"../../core/config\"));\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _date_serialization = _interopRequireDefault(require(\"../../core/utils/date_serialization\"));\r\nvar _recurrence = require(\"./recurrence\");\r\nvar _date = _interopRequireDefault(require(\"../../core/utils/date\"));\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _query = _interopRequireDefault(require(\"../../data/query\"));\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n        throw new TypeError(\"Cannot call a class as a function\")\r\n    }\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n    for (var i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if (\"value\" in descriptor) {\r\n            descriptor.writable = true\r\n        }\r\n        Object.defineProperty(target, descriptor.key, descriptor)\r\n    }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n    if (protoProps) {\r\n        _defineProperties(Constructor.prototype, protoProps)\r\n    }\r\n    if (staticProps) {\r\n        _defineProperties(Constructor, staticProps)\r\n    }\r\n    return Constructor\r\n}\r\nvar toMs = _date.default.dateToMilliseconds;\r\nvar DATE_FILTER_POSITION = 0;\r\nvar USER_FILTER_POSITION = 1;\r\nvar FilterMaker = function() {\r\n    function FilterMaker(dataAccessors) {\r\n        _classCallCheck(this, FilterMaker);\r\n        this._filterRegistry = null;\r\n        this._dataAccessors = dataAccessors\r\n    }\r\n    _createClass(FilterMaker, [{\r\n        key: \"isRegistered\",\r\n        value: function() {\r\n            return !!this._filterRegistry\r\n        }\r\n    }, {\r\n        key: \"clearRegistry\",\r\n        value: function() {\r\n            delete this._filterRegistry\r\n        }\r\n    }, {\r\n        key: \"make\",\r\n        value: function(type, args) {\r\n            if (!this._filterRegistry) {\r\n                this._filterRegistry = {}\r\n            }\r\n            this._make(type).apply(this, args)\r\n        }\r\n    }, {\r\n        key: \"_make\",\r\n        value: function(type) {\r\n            var _this = this;\r\n            switch (type) {\r\n                case \"date\":\r\n                    return function(min, max, useAccessors) {\r\n                        var startDate = useAccessors ? _this._dataAccessors.getter.startDate : _this._dataAccessors.expr.startDateExpr;\r\n                        var endDate = useAccessors ? _this._dataAccessors.getter.endDate : _this._dataAccessors.expr.endDateExpr;\r\n                        var recurrenceRule = _this._dataAccessors.expr.recurrenceRuleExpr;\r\n                        _this._filterRegistry.date = [\r\n                            [\r\n                                [endDate, \">\", min],\r\n                                [startDate, \"<\", max]\r\n                            ], \"or\", [recurrenceRule, \"startswith\", \"freq\"], \"or\", [\r\n                                [endDate, min],\r\n                                [startDate, min]\r\n                            ]\r\n                        ];\r\n                        if (!recurrenceRule) {\r\n                            _this._filterRegistry.date.splice(1, 2)\r\n                        }\r\n                    };\r\n                case \"user\":\r\n                    return function(userFilter) {\r\n                        _this._filterRegistry.user = userFilter\r\n                    }\r\n            }\r\n        }\r\n    }, {\r\n        key: \"combine\",\r\n        value: function() {\r\n            var filter = [];\r\n            this._filterRegistry.date && filter.push(this._filterRegistry.date);\r\n            this._filterRegistry.user && filter.push(this._filterRegistry.user);\r\n            return filter\r\n        }\r\n    }, {\r\n        key: \"dateFilter\",\r\n        value: function() {\r\n            return this._filterRegistry.date\r\n        }\r\n    }]);\r\n    return FilterMaker\r\n}();\r\nvar compareDateWithStartDayHour = function(startDate, endDate, startDayHour, allDay, severalDays) {\r\n    var startTime = _date.default.dateTimeFromDecimal(startDayHour);\r\n    var result = startDate.getHours() >= startTime.hours && startDate.getMinutes() >= startTime.minutes || endDate.getHours() === startTime.hours && endDate.getMinutes() > startTime.minutes || endDate.getHours() > startTime.hours || severalDays || allDay;\r\n    return result\r\n};\r\nvar compareDateWithEndDayHour = function(startDate, endDate, startDayHour, endDayHour, allDay, severalDays, max, min) {\r\n    var hiddenInterval = (24 - endDayHour + startDayHour) * toMs(\"hour\");\r\n    var apptDuration = endDate.getTime() - startDate.getTime();\r\n    var delta = (hiddenInterval - apptDuration) / toMs(\"hour\");\r\n    var apptStartHour = startDate.getHours();\r\n    var apptStartMinutes = startDate.getMinutes();\r\n    var result;\r\n    var endTime = _date.default.dateTimeFromDecimal(endDayHour);\r\n    var startTime = _date.default.dateTimeFromDecimal(startDayHour);\r\n    result = apptStartHour < endTime.hours || apptStartHour === endTime.hours && apptStartMinutes < endTime.minutes || allDay && startDate <= max || severalDays && startDate < max && endDate > min && (apptStartHour < endTime.hours || 60 * endDate.getHours() + endDate.getMinutes() > 60 * startTime.hours);\r\n    if (apptDuration < hiddenInterval) {\r\n        if (apptStartHour > endTime.hours && apptStartMinutes > endTime.minutes && delta <= apptStartHour - endDayHour) {\r\n            result = false\r\n        }\r\n    }\r\n    return result\r\n};\r\nvar AppointmentModel = function() {\r\n    function AppointmentModel(dataSource, dataAccessors, baseAppointmentDuration) {\r\n        _classCallCheck(this, AppointmentModel);\r\n        this.setDataAccessors(dataAccessors);\r\n        this.setDataSource(dataSource);\r\n        this._updatedAppointmentKeys = [];\r\n        this._filterMaker = new FilterMaker(dataAccessors);\r\n        this._baseAppointmentDuration = baseAppointmentDuration\r\n    }\r\n    _createClass(AppointmentModel, [{\r\n        key: \"_createFilter\",\r\n        value: function(min, max, remoteFiltering, dateSerializationFormat) {\r\n            this._filterMaker.make(\"date\", [min, max]);\r\n            var userFilterPosition = this._excessFiltering() ? this._dataSource.filter()[USER_FILTER_POSITION] : this._dataSource.filter();\r\n            this._filterMaker.make(\"user\", [userFilterPosition]);\r\n            if (remoteFiltering) {\r\n                this._dataSource.filter(this._combineRemoteFilter(dateSerializationFormat))\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_excessFiltering\",\r\n        value: function() {\r\n            var dateFilter = this._filterMaker.dateFilter();\r\n            var dataSourceFilter = this._dataSource.filter();\r\n            return dataSourceFilter && ((0, _common.equalByValue)(dataSourceFilter, dateFilter) || dataSourceFilter.length && (0, _common.equalByValue)(dataSourceFilter[DATE_FILTER_POSITION], dateFilter))\r\n        }\r\n    }, {\r\n        key: \"_combineFilter\",\r\n        value: function() {\r\n            return this._filterMaker.combine()\r\n        }\r\n    }, {\r\n        key: \"_getStoreKey\",\r\n        value: function(target) {\r\n            var store = this._dataSource.store();\r\n            return store.keyOf(target)\r\n        }\r\n    }, {\r\n        key: \"_filterAppointmentByResources\",\r\n        value: function(appointment, resources) {\r\n            var _this2 = this;\r\n            var result = false;\r\n            var i;\r\n            var len;\r\n            var resourceName;\r\n            var checkAppointmentResourceValues = function() {\r\n                var resourceGetter = _this2._dataAccessors.getter.resources[resourceName];\r\n                var resource;\r\n                if ((0, _type.isFunction)(resourceGetter)) {\r\n                    resource = resourceGetter(appointment)\r\n                }\r\n                var appointmentResourceValues = (0, _array.wrapToArray)(resource);\r\n                var resourceData = (0, _iterator.map)(resources[i].items, function(item) {\r\n                    return item.id\r\n                });\r\n                for (var j = 0, itemDataCount = appointmentResourceValues.length; j < itemDataCount; j++) {\r\n                    if ((0, _array.inArray)(appointmentResourceValues[j], resourceData) > -1) {\r\n                        return true\r\n                    }\r\n                }\r\n                return false\r\n            };\r\n            for (i = 0, len = resources.length; i < len; i++) {\r\n                resourceName = resources[i].name;\r\n                result = checkAppointmentResourceValues.call(this);\r\n                if (!result) {\r\n                    return false\r\n                }\r\n            }\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_filterAppointmentByRRule\",\r\n        value: function(appointment, min, max, startDayHour, endDayHour, firstDayOfWeek) {\r\n            var recurrenceRule = appointment.recurrenceRule;\r\n            var recurrenceException = appointment.recurrenceException;\r\n            var allDay = appointment.allDay;\r\n            var result = true;\r\n            var appointmentStartDate = appointment.startDate;\r\n            var appointmentEndDate = appointment.endDate;\r\n            var recurrenceProcessor = (0, _recurrence.getRecurrenceProcessor)();\r\n            if (allDay || this._appointmentPartInInterval(appointmentStartDate, appointmentEndDate, startDayHour, endDayHour)) {\r\n                var trimmedDates = this._trimDates(min, max);\r\n                min = trimmedDates.min;\r\n                max = new Date(trimmedDates.max.getTime() - toMs(\"minute\"))\r\n            }\r\n            if (recurrenceRule && !recurrenceProcessor.isValidRecurrenceRule(recurrenceRule)) {\r\n                result = appointmentEndDate > min && appointmentStartDate <= max\r\n            }\r\n            if (result && recurrenceProcessor.isValidRecurrenceRule(recurrenceRule)) {\r\n                result = recurrenceProcessor.hasRecurrence({\r\n                    rule: recurrenceRule,\r\n                    exception: recurrenceException,\r\n                    start: appointmentStartDate,\r\n                    end: appointmentEndDate,\r\n                    min: min,\r\n                    max: max,\r\n                    firstDayOfWeek: firstDayOfWeek\r\n                })\r\n            }\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_appointmentPartInInterval\",\r\n        value: function(startDate, endDate, startDayHour, endDayHour) {\r\n            var apptStartDayHour = startDate.getHours();\r\n            var apptEndDayHour = endDate.getHours();\r\n            return apptStartDayHour <= startDayHour && apptEndDayHour <= endDayHour && apptEndDayHour >= startDayHour || apptEndDayHour >= endDayHour && apptStartDayHour <= endDayHour && apptStartDayHour >= startDayHour\r\n        }\r\n    }, {\r\n        key: \"_createCombinedFilter\",\r\n        value: function(filterOptions, timeZoneCalculator) {\r\n            var dataAccessors = this._dataAccessors;\r\n            var min = new Date(filterOptions.min);\r\n            var max = new Date(filterOptions.max);\r\n            var getRecurrenceException = filterOptions.recurrenceException;\r\n            var startDayHour = filterOptions.startDayHour,\r\n                endDayHour = filterOptions.endDayHour,\r\n                viewStartDayHour = filterOptions.viewStartDayHour,\r\n                viewEndDayHour = filterOptions.viewEndDayHour,\r\n                resources = filterOptions.resources,\r\n                firstDayOfWeek = filterOptions.firstDayOfWeek;\r\n            var that = this;\r\n            return [\r\n                [function(appointment) {\r\n                    var result = true;\r\n                    var startDate = new Date(dataAccessors.getter.startDate(appointment));\r\n                    var endDate = new Date(dataAccessors.getter.endDate(appointment));\r\n                    var appointmentTakesAllDay = that.appointmentTakesAllDay(appointment, viewStartDayHour, viewEndDayHour);\r\n                    var appointmentTakesSeveralDays = that.appointmentTakesSeveralDays(appointment);\r\n                    var isAllDay = dataAccessors.getter.allDay(appointment);\r\n                    var appointmentIsLong = appointmentTakesSeveralDays || appointmentTakesAllDay;\r\n                    var useRecurrence = (0, _type.isDefined)(dataAccessors.getter.recurrenceRule);\r\n                    var recurrenceRule;\r\n                    if (useRecurrence) {\r\n                        recurrenceRule = dataAccessors.getter.recurrenceRule(appointment)\r\n                    }\r\n                    if (resources && resources.length) {\r\n                        result = that._filterAppointmentByResources(appointment, resources)\r\n                    }\r\n                    if (appointmentTakesAllDay && false === filterOptions.allDay) {\r\n                        result = false\r\n                    }\r\n                    var startDateTimeZone = dataAccessors.getter.startDateTimeZone(appointment);\r\n                    var endDateTimeZone = dataAccessors.getter.endDateTimeZone(appointment);\r\n                    var comparableStartDate = timeZoneCalculator.createDate(startDate, {\r\n                        appointmentTimeZone: startDateTimeZone,\r\n                        path: \"toGrid\"\r\n                    });\r\n                    var comparableEndDate = timeZoneCalculator.createDate(endDate, {\r\n                        appointmentTimeZone: endDateTimeZone,\r\n                        path: \"toGrid\"\r\n                    });\r\n                    if (result && useRecurrence) {\r\n                        var recurrenceException = getRecurrenceException ? getRecurrenceException(appointment) : dataAccessors.getter.recurrenceException(appointment);\r\n                        result = that._filterAppointmentByRRule({\r\n                            startDate: comparableStartDate,\r\n                            endDate: comparableEndDate,\r\n                            recurrenceRule: recurrenceRule,\r\n                            recurrenceException: recurrenceException,\r\n                            allDay: appointmentTakesAllDay\r\n                        }, min, max, startDayHour, endDayHour, firstDayOfWeek)\r\n                    }\r\n                    if (result && comparableEndDate < min && appointmentIsLong && !isAllDay && (!useRecurrence || useRecurrence && !recurrenceRule)) {\r\n                        result = false\r\n                    }\r\n                    if (result && void 0 !== startDayHour && (!useRecurrence || !filterOptions.isVirtualScrolling)) {\r\n                        result = compareDateWithStartDayHour(comparableStartDate, comparableEndDate, startDayHour, appointmentTakesAllDay, appointmentTakesSeveralDays)\r\n                    }\r\n                    if (result && void 0 !== endDayHour) {\r\n                        result = compareDateWithEndDayHour(comparableStartDate, comparableEndDate, startDayHour, endDayHour, appointmentTakesAllDay, appointmentTakesSeveralDays, max, min)\r\n                    }\r\n                    if (result && useRecurrence && !recurrenceRule) {\r\n                        if (comparableEndDate < min && !isAllDay) {\r\n                            result = false\r\n                        }\r\n                    }\r\n                    return result\r\n                }]\r\n            ]\r\n        }\r\n    }, {\r\n        key: \"setDataSource\",\r\n        value: function(dataSource) {\r\n            this._dataSource = dataSource;\r\n            this.cleanModelState();\r\n            this._initStoreChangeHandlers();\r\n            this._filterMaker && this._filterMaker.clearRegistry()\r\n        }\r\n    }, {\r\n        key: \"_initStoreChangeHandlers\",\r\n        value: function() {\r\n            var _this3 = this;\r\n            var dataSource = this._dataSource;\r\n            var store = null === dataSource || void 0 === dataSource ? void 0 : dataSource.store();\r\n            if (store) {\r\n                store.on(\"updating\", function(newItem) {\r\n                    _this3._updatedAppointment = newItem\r\n                });\r\n                store.on(\"push\", function(pushItems) {\r\n                    var items = dataSource.items();\r\n                    var keyName = store.key();\r\n                    pushItems.forEach(function(pushItem) {\r\n                        var itemExists = 0 !== items.filter(function(item) {\r\n                            return item[keyName] === pushItem.key\r\n                        }).length;\r\n                        if (itemExists) {\r\n                            _this3._updatedAppointmentKeys.push({\r\n                                key: keyName,\r\n                                value: pushItem.key\r\n                            })\r\n                        } else {\r\n                            items.push(pushItem.data)\r\n                        }\r\n                    })\r\n                })\r\n            }\r\n        }\r\n    }, {\r\n        key: \"getUpdatedAppointment\",\r\n        value: function() {\r\n            return this._updatedAppointment\r\n        }\r\n    }, {\r\n        key: \"getUpdatedAppointmentKeys\",\r\n        value: function() {\r\n            return this._updatedAppointmentKeys\r\n        }\r\n    }, {\r\n        key: \"cleanModelState\",\r\n        value: function() {\r\n            this._updatedAppointment = null;\r\n            this._updatedAppointmentKeys = []\r\n        }\r\n    }, {\r\n        key: \"setDataAccessors\",\r\n        value: function(dataAccessors) {\r\n            this._dataAccessors = dataAccessors;\r\n            this._filterMaker = new FilterMaker(dataAccessors)\r\n        }\r\n    }, {\r\n        key: \"filterByDate\",\r\n        value: function(min, max, remoteFiltering, dateSerializationFormat) {\r\n            if (!this._dataSource) {\r\n                return\r\n            }\r\n            var trimmedDates = this._trimDates(min, max);\r\n            if (!this._filterMaker.isRegistered()) {\r\n                this._createFilter(trimmedDates.min, trimmedDates.max, remoteFiltering, dateSerializationFormat)\r\n            } else {\r\n                var _this$_dataSource$fil;\r\n                this._filterMaker.make(\"date\", [trimmedDates.min, trimmedDates.max]);\r\n                if ((null === (_this$_dataSource$fil = this._dataSource.filter()) || void 0 === _this$_dataSource$fil ? void 0 : _this$_dataSource$fil.length) > 1) {\r\n                    var userFilter = this._serializeRemoteFilter([this._dataSource.filter()[1]], dateSerializationFormat);\r\n                    this._filterMaker.make(\"user\", userFilter)\r\n                }\r\n                if (remoteFiltering) {\r\n                    this._dataSource.filter(this._combineRemoteFilter(dateSerializationFormat))\r\n                }\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_combineRemoteFilter\",\r\n        value: function(dateSerializationFormat) {\r\n            var combinedFilter = this._filterMaker.combine();\r\n            return this._serializeRemoteFilter(combinedFilter, dateSerializationFormat)\r\n        }\r\n    }, {\r\n        key: \"_serializeRemoteFilter\",\r\n        value: function(filter, dateSerializationFormat) {\r\n            if (!Array.isArray(filter)) {\r\n                return filter\r\n            }\r\n            filter = (0, _extend.extend)([], filter);\r\n            var startDate = this._dataAccessors.expr.startDateExpr;\r\n            var endDate = this._dataAccessors.expr.endDateExpr;\r\n            if ((0, _type.isString)(filter[0])) {\r\n                if ((0, _config.default)().forceIsoDateParsing && filter.length > 1) {\r\n                    if (filter[0] === startDate || filter[0] === endDate) {\r\n                        filter[filter.length - 1] = _date_serialization.default.serializeDate(new Date(filter[filter.length - 1]), dateSerializationFormat)\r\n                    }\r\n                }\r\n            }\r\n            for (var i = 0; i < filter.length; i++) {\r\n                filter[i] = this._serializeRemoteFilter(filter[i], dateSerializationFormat)\r\n            }\r\n            return filter\r\n        }\r\n    }, {\r\n        key: \"_createAppointmentFilter\",\r\n        value: function(filterOptions, timeZoneCalculator) {\r\n            var combinedFilter = this._createCombinedFilter(filterOptions, timeZoneCalculator);\r\n            if (this._filterMaker.isRegistered()) {\r\n                this._filterMaker.make(\"user\", void 0);\r\n                var trimmedDates = this._trimDates(filterOptions.min, filterOptions.max);\r\n                this._filterMaker.make(\"date\", [trimmedDates.min, trimmedDates.max, true]);\r\n                var dateFilter = this.customizeDateFilter(this._filterMaker.combine(), timeZoneCalculator);\r\n                combinedFilter.push([dateFilter])\r\n            }\r\n            return combinedFilter\r\n        }\r\n    }, {\r\n        key: \"filterLoadedAppointments\",\r\n        value: function(filterOption, timeZoneCalculator) {\r\n            var combinedFilter = this._createAppointmentFilter(filterOption, timeZoneCalculator);\r\n            return (0, _query.default)(this.getPreparedDataItems()).filter(combinedFilter).toArray()\r\n        }\r\n    }, {\r\n        key: \"getPreparedDataItems\",\r\n        value: function() {\r\n            var _this4 = this;\r\n            var dataItems = this._dataSource.items();\r\n            return (0, _iterator.map)(dataItems, function(item) {\r\n                var startDate = new Date(_this4._dataAccessors.getter.startDate(item));\r\n                var endDate = new Date(_this4._dataAccessors.getter.endDate(item));\r\n                _this4.replaceWrongEndDate(item, startDate, endDate);\r\n                return item\r\n            })\r\n        }\r\n    }, {\r\n        key: \"replaceWrongEndDate\",\r\n        value: function(appointment, startDate, endDate) {\r\n            if (this._isEndDateWrong(startDate, endDate)) {\r\n                var isAllDay = this._dataAccessors.getter.allDay(appointment);\r\n                var calculatedEndDate = this._calculateAppointmentEndDate(isAllDay, startDate);\r\n                this._dataAccessors.setter.endDate(appointment, calculatedEndDate)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"filterLoadedVirtualAppointments\",\r\n        value: function(filterOptions, timeZoneCalculator, groupCount) {\r\n            var _this5 = this;\r\n            var combinedFilters = [];\r\n            var itemsToFilter = this.getPreparedDataItems();\r\n            var needPreFilter = groupCount > 0;\r\n            if (needPreFilter) {\r\n                itemsToFilter = itemsToFilter.filter(function(item) {\r\n                    for (var i = 0; i < filterOptions.length; ++i) {\r\n                        var resources = filterOptions[i].resources;\r\n                        if (_this5._filterAppointmentByResources(item, resources)) {\r\n                            return true\r\n                        }\r\n                    }\r\n                })\r\n            }\r\n            filterOptions.forEach(function(filterOption) {\r\n                combinedFilters.length && combinedFilters.push(\"or\");\r\n                var filter = _this5._createAppointmentFilter(filterOption, timeZoneCalculator);\r\n                combinedFilters.push(filter)\r\n            });\r\n            return (0, _query.default)(itemsToFilter).filter(combinedFilters).toArray()\r\n        }\r\n    }, {\r\n        key: \"_trimDates\",\r\n        value: function(min, max) {\r\n            var minCopy = _date.default.trimTime(new Date(min));\r\n            var maxCopy = _date.default.trimTime(new Date(max));\r\n            maxCopy.setDate(maxCopy.getDate() + 1);\r\n            return {\r\n                min: minCopy,\r\n                max: maxCopy\r\n            }\r\n        }\r\n    }, {\r\n        key: \"hasAllDayAppointments\",\r\n        value: function(items, startDayHour, endDayHour) {\r\n            if (!items) {\r\n                return false\r\n            }\r\n            var that = this;\r\n            var result = false;\r\n            (0, _iterator.each)(items, function(index, item) {\r\n                if (that.appointmentTakesAllDay(item, startDayHour, endDayHour)) {\r\n                    result = true;\r\n                    return false\r\n                }\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"appointmentTakesAllDay\",\r\n        value: function(appointment, startDayHour, endDayHour) {\r\n            var dataAccessors = this._dataAccessors;\r\n            var startDate = dataAccessors.getter.startDate(appointment);\r\n            var endDate = dataAccessors.getter.endDate(appointment);\r\n            var allDay = dataAccessors.getter.allDay(appointment);\r\n            return allDay || this._appointmentHasAllDayDuration(startDate, endDate, startDayHour, endDayHour)\r\n        }\r\n    }, {\r\n        key: \"_appointmentHasAllDayDuration\",\r\n        value: function(startDate, endDate, startDayHour, endDayHour) {\r\n            startDate = new Date(startDate);\r\n            endDate = new Date(endDate);\r\n            var dayDuration = 24;\r\n            var appointmentDurationInHours = this._getAppointmentDurationInHours(startDate, endDate);\r\n            return appointmentDurationInHours >= dayDuration || this._appointmentHasShortDayDuration(startDate, endDate, startDayHour, endDayHour)\r\n        }\r\n    }, {\r\n        key: \"_appointmentHasShortDayDuration\",\r\n        value: function(startDate, endDate, startDayHour, endDayHour) {\r\n            var appointmentDurationInHours = this._getAppointmentDurationInHours(startDate, endDate);\r\n            var shortDayDurationInHours = endDayHour - startDayHour;\r\n            return appointmentDurationInHours >= shortDayDurationInHours && startDate.getHours() === startDayHour && endDate.getHours() === endDayHour\r\n        }\r\n    }, {\r\n        key: \"_getAppointmentDurationInHours\",\r\n        value: function(startDate, endDate) {\r\n            return (endDate.getTime() - startDate.getTime()) / toMs(\"hour\")\r\n        }\r\n    }, {\r\n        key: \"appointmentTakesSeveralDays\",\r\n        value: function(appointment) {\r\n            var dataAccessors = this._dataAccessors;\r\n            var startDate = new Date(dataAccessors.getter.startDate(appointment));\r\n            var endDate = new Date(dataAccessors.getter.endDate(appointment));\r\n            return !_date.default.sameDate(startDate, endDate)\r\n        }\r\n    }, {\r\n        key: \"customizeDateFilter\",\r\n        value: function(dateFilter, timeZoneCalculator) {\r\n            var _this6 = this;\r\n            var currentFilter = (0, _extend.extend)(true, [], dateFilter);\r\n            return function(appointment) {\r\n                var startDate = new Date(_this6._dataAccessors.getter.startDate(appointment));\r\n                var endDate = new Date(_this6._dataAccessors.getter.endDate(appointment));\r\n                appointment = (0, _extend.extend)(true, {}, appointment);\r\n                var startDateTimeZone = _this6._dataAccessors.getter.startDateTimeZone(appointment);\r\n                var endDateTimeZone = _this6._dataAccessors.getter.endDateTimeZone(appointment);\r\n                var comparableStartDate = timeZoneCalculator.createDate(startDate, {\r\n                    appointmentTimeZone: startDateTimeZone,\r\n                    path: \"toGrid\"\r\n                });\r\n                var comparableEndDate = timeZoneCalculator.createDate(endDate, {\r\n                    appointmentTimeZone: endDateTimeZone,\r\n                    path: \"toGrid\"\r\n                });\r\n                _this6._dataAccessors.setter.startDate(appointment, comparableStartDate);\r\n                _this6._dataAccessors.setter.endDate(appointment, comparableEndDate);\r\n                return (0, _query.default)([appointment]).filter(currentFilter).toArray().length > 0\r\n            }.bind(this)\r\n        }\r\n    }, {\r\n        key: \"_calculateAppointmentEndDate\",\r\n        value: function(isAllDay, startDate) {\r\n            if (isAllDay) {\r\n                return _date.default.setToDayEnd(new Date(startDate))\r\n            }\r\n            return new Date(startDate.getTime() + this._baseAppointmentDuration * toMs(\"minute\"))\r\n        }\r\n    }, {\r\n        key: \"_isEndDateWrong\",\r\n        value: function(startDate, endDate) {\r\n            return !endDate || isNaN(endDate.getTime()) || startDate.getTime() > endDate.getTime()\r\n        }\r\n    }, {\r\n        key: \"add\",\r\n        value: function(data) {\r\n            var _this7 = this;\r\n            return this._dataSource.store().insert(data).done(function() {\r\n                _this7._dataSource.load()\r\n            }.bind(this))\r\n        }\r\n    }, {\r\n        key: \"update\",\r\n        value: function(target, data) {\r\n            var _this8 = this;\r\n            var key = this._getStoreKey(target);\r\n            var d = new _deferred.Deferred;\r\n            this._dataSource.store().update(key, data).done(function() {\r\n                _this8._dataSource.load().done(d.resolve).fail(d.reject)\r\n            }).fail(d.reject);\r\n            return d.promise()\r\n        }\r\n    }, {\r\n        key: \"remove\",\r\n        value: function(target) {\r\n            var _this9 = this;\r\n            var key = this._getStoreKey(target);\r\n            return this._dataSource.store().remove(key).done(function() {\r\n                _this9._dataSource.load()\r\n            }.bind(this))\r\n        }\r\n    }, {\r\n        key: \"keyName\",\r\n        get: function() {\r\n            var store = this._dataSource.store();\r\n            return store.key()\r\n        }\r\n    }]);\r\n    return AppointmentModel\r\n}();\r\nvar _default = AppointmentModel;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}