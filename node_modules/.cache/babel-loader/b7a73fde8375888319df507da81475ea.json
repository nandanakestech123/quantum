{"ast":null,"code":"import _regeneratorRuntime from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _classCallCheck from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"E:\\\\newfrontend\\\\webfe\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{NormalInput,NormalButton,NormalSelect}from\"component/common\";import CanvasDraw from\"react-canvas-draw\";import{connect}from\"react-redux\";import{bindActionCreators}from\"redux\";import Webcam from\"react-webcam\";import{withTranslation}from\"react-i18next\";import{addDiagosisPhoto,updateDiagosisPhoto}from\"redux/actions/customerPlus\";export var AddPhotoPopupClass=/*#__PURE__*/function(_Component){_inherits(AddPhotoPopupClass,_Component);var _super=_createSuper(AddPhotoPopupClass);function AddPhotoPopupClass(){var _this;_classCallCheck(this,AddPhotoPopupClass);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={image:null,isCameraAvailable:true,remarks:\"\",layoutData:\"\",brushRadius:\"2\",diagnosis_code:null,brushColor:\"yellow\",brushColorOptions:[{label:\"Yellow\",value:\"yellow\"},{label:\"Red\",value:\"red\"},{label:\"White\",value:\"white\"},{label:\"Black\",value:\"black\"},{label:\"Green\",value:\"green\"},{label:\"Blue\",value:\"blue\"}],isMounted:true};_this.updateState=function(data){if(_this.state.isMounted)_this.setState(data);};_this.setRef=function(webcam){_this.webcam=webcam;};_this.capture=function(){var imageSrc=_this.webcam.getScreenshot();_this.updateState({image:imageSrc});};_this.handleChange=function(e){_this.updateState(_defineProperty({},e.target.name,e.target.value));};_this.handleSubmit=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var dataURLtoFile,_this$state,remarks,image,diagnosis_code,_this$props,cust_no,onDone,pic_data1,formData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dataURLtoFile=function _dataURLtoFile(dataurl,filename){var arr=dataurl.split(\",\"),mime=arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]),n=bstr.length,u8arr=new Uint8Array(n);while(n--){u8arr[n]=bstr.charCodeAt(n);}return new File([u8arr],filename,{type:mime});};_this$state=_this.state,remarks=_this$state.remarks,image=_this$state.image,diagnosis_code=_this$state.diagnosis_code;_this$props=_this.props,cust_no=_this$props.cust_no,onDone=_this$props.onDone;pic_data1=\"\".concat(_this.canvasDraw.getSaveData());formData=new FormData();formData.append(\"remarks\",remarks);formData.append(\"cust_no\",cust_no);formData.append(\"pic_data1\",pic_data1);if(!(diagnosis_code==null)){_context.next=16;break;}formData.append(\"diagnosis_date\",new Date().toISOString());formData.append(\"date_pic_take\",new Date().toISOString());formData.append(\"pic_path\",dataURLtoFile(image,\"\".concat(Date.now().toLocaleString(\"en-GB\"),\".jpeg\")));_context.next=14;return _this.props.addDiagosisPhoto(formData);case 14:_context.next=18;break;case 16:_context.next=18;return _this.props.updateDiagosisPhoto(diagnosis_code,formData);case 18:onDone();case 19:case\"end\":return _context.stop();}}},_callee);}));return _this;}_createClass(AddPhotoPopupClass,[{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.state.isMounted=false;}},{key:\"componentWillMount\",value:function componentWillMount(){var _this2=this;navigator.getMedia=navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.mediaDevices.getUserMedia({video:true},function(){_this2.updateState({isCameraAvailable:true});},function(){_this2.updateState({isCameraAvailable:false});});}},{key:\"componentDidMount\",value:function componentDidMount(){var _this$props2=this.props,image=_this$props2.image,remarks=_this$props2.remarks,layoutData=_this$props2.layoutData,diagnosis_code=_this$props2.diagnosis_code;console.log(this.props);if(image&&remarks){this.updateState({image:image,remarks:remarks,layoutData:layoutData,diagnosis_code:diagnosis_code});}document.getElementById(\"get_file\").onclick=function(){document.getElementById(\"my_file\").click();};}},{key:\"render\",value:function render(){var _this3=this;var _this$state2=this.state,image=_this$state2.image,isCameraAvailable=_this$state2.isCameraAvailable,remarks=_this$state2.remarks,brushRadius=_this$state2.brushRadius,brushColor=_this$state2.brushColor,brushColorOptions=_this$state2.brushColorOptions,layoutData=_this$state2.layoutData;var videoConstraints={width:1280,height:720,facingMode:\"user\"};var t=this.props.t;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"container-fluid mb-4 mt-2 product-details\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-6\"},/*#__PURE__*/React.createElement(\"h4\",null,t(\"Add Photo\"))),image==null?null:/*#__PURE__*/React.createElement(\"div\",{className:\"col-6\"},/*#__PURE__*/React.createElement(NormalButton,{mainbg:true,className:\"col-12 fs-15 \",label:\"Done\",onClick:function onClick(){return _this3.handleSubmit();}}))),image==null?/*#__PURE__*/React.createElement(\"div\",{className:\"row pl-5 pr-5 mt-4\"},isCameraAvailable?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"col-12\"},/*#__PURE__*/React.createElement(Webcam,{audio:false,ref:this.setRef,screenshotFormat:\"image/jpeg\",width:\"100%\",videoConstraints:videoConstraints})),/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 mb-4\"},/*#__PURE__*/React.createElement(NormalButton,{mainbg:true,className:\"col-12 fs-15 \",label:\"Capture\",onClick:function onClick(){return _this3.capture();}}))):null,/*#__PURE__*/React.createElement(\"div\",{className:\"col-12\"},/*#__PURE__*/React.createElement(\"input\",{type:\"button\",id:\"get_file\",value:\"Browse\",className:\"btn cursor-pointer mainbg-btn\"}),/*#__PURE__*/React.createElement(\"input\",{type:\"file\",id:\"my_file\",className:\"d-none\",accept:\"image/*\",onChange:function onChange(e){if(e.target.value||e.target.value!=null){var reader=new FileReader();reader.onload=function(e){_this3.updateState({image:e.target.result});};reader.readAsDataURL(e.target.files[0]);}}}))):/*#__PURE__*/React.createElement(\"div\",{className:\"row pl-5 pr-5 mt-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-12  mb-4\"},/*#__PURE__*/React.createElement(\"div\",{class:\"d-flex mt-5 align-items-center justify-content-center\"},/*#__PURE__*/React.createElement(CanvasDraw,{imgSrc:this.state.image,ref:function ref(_ref2){return _this3.canvasDraw=_ref2;},brushRadius:brushRadius,brushColor:brushColor,saveData:layoutData&&JSON.stringify(layoutData)}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 mb-4\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-left text-black common-label-text fs-17 pb-2\"},t(\"Brush Radius\")),/*#__PURE__*/React.createElement(\"input\",{className:\"col-12\",type:\"range\",min:\"1\",max:\"20\",value:brushRadius,onChange:function onChange(e){return _this3.updateState({brushRadius:e.target.value});}})),/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 mb-4\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-left text-black common-label-text fs-17 pb-2\"},t(\"Brush Color\")),/*#__PURE__*/React.createElement(NormalSelect,{options:brushColorOptions,value:brushColor,onChange:function onChange(e){return _this3.updateState({brushColor:e.target.value});}})),/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 mb-4\"},/*#__PURE__*/React.createElement(NormalButton,{mainbg:true,className:\"col-12 fs-15 \",label:\"Clear\",onClick:function onClick(){_this3.canvasDraw.clear();}})),/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 mb-4\"},/*#__PURE__*/React.createElement(\"label\",{className:\"text-left text-black common-label-text fs-17 pb-2\"},t(\"Remarks\")),/*#__PURE__*/React.createElement(\"div\",{className:\"input-group\"},/*#__PURE__*/React.createElement(NormalInput,{placeholder:\"Enter remarks\",value:remarks,name:\"remarks\",onChange:this.handleChange}))))));}}]);return AddPhotoPopupClass;}(Component);var mapStateToProps=function mapStateToProps(state){return{};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return bindActionCreators({addDiagosisPhoto:addDiagosisPhoto,updateDiagosisPhoto:updateDiagosisPhoto},dispatch);};export var AddPhotoPopup=withTranslation()(connect(mapStateToProps,mapDispatchToProps)(AddPhotoPopupClass));","map":{"version":3,"sources":["E:/newfrontend/webfe/src/component/Admin/CustomerPlus/CustomerDetailsPlus/Details/AddPhotoPopup.js"],"names":["React","Component","NormalInput","NormalButton","NormalSelect","CanvasDraw","connect","bindActionCreators","Webcam","withTranslation","addDiagosisPhoto","updateDiagosisPhoto","AddPhotoPopupClass","state","image","isCameraAvailable","remarks","layoutData","brushRadius","diagnosis_code","brushColor","brushColorOptions","label","value","isMounted","updateState","data","setState","setRef","webcam","capture","imageSrc","getScreenshot","handleChange","e","target","name","handleSubmit","dataURLtoFile","dataurl","filename","arr","split","mime","match","bstr","atob","n","length","u8arr","Uint8Array","charCodeAt","File","type","props","cust_no","onDone","pic_data1","canvasDraw","getSaveData","formData","FormData","append","Date","toISOString","now","toLocaleString","navigator","getMedia","mediaDevices","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","video","console","log","document","getElementById","onclick","click","videoConstraints","width","height","facingMode","t","reader","FileReader","onload","result","readAsDataURL","files","ref","JSON","stringify","clear","mapStateToProps","mapDispatchToProps","dispatch","AddPhotoPopup"],"mappings":"6+BAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,WAAT,CAAsBC,YAAtB,CAAoCC,YAApC,KAAwD,kBAAxD,CACA,MAAOC,CAAAA,UAAP,KAAuB,mBAAvB,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAASC,kBAAT,KAAmC,OAAnC,CACA,MAAOC,CAAAA,MAAP,KAAmB,cAAnB,CACA,OAASC,eAAT,KAAgC,eAAhC,CACA,OACEC,gBADF,CAEEC,mBAFF,KAGO,4BAHP,CAKA,UAAaC,CAAAA,kBAAb,2WACEC,KADF,CACU,CACNC,KAAK,CAAE,IADD,CAENC,iBAAiB,CAAE,IAFb,CAGNC,OAAO,CAAE,EAHH,CAINC,UAAU,CAAE,EAJN,CAKNC,WAAW,CAAE,GALP,CAMNC,cAAc,CAAE,IANV,CAONC,UAAU,CAAE,QAPN,CAQNC,iBAAiB,CAAE,CACjB,CAAEC,KAAK,CAAE,QAAT,CAAmBC,KAAK,CAAE,QAA1B,CADiB,CAEjB,CAAED,KAAK,CAAE,KAAT,CAAgBC,KAAK,CAAE,KAAvB,CAFiB,CAGjB,CAAED,KAAK,CAAE,OAAT,CAAkBC,KAAK,CAAE,OAAzB,CAHiB,CAIjB,CAAED,KAAK,CAAE,OAAT,CAAkBC,KAAK,CAAE,OAAzB,CAJiB,CAKjB,CAAED,KAAK,CAAE,OAAT,CAAkBC,KAAK,CAAE,OAAzB,CALiB,CAMjB,CAAED,KAAK,CAAE,MAAT,CAAiBC,KAAK,CAAE,MAAxB,CANiB,CARb,CAgBNC,SAAS,CAAE,IAhBL,CADV,OAwBEC,WAxBF,CAwBgB,SAAAC,IAAI,CAAI,CACpB,GAAI,MAAKb,KAAL,CAAWW,SAAf,CAA0B,MAAKG,QAAL,CAAcD,IAAd,EAC3B,CA1BH,OAyDEE,MAzDF,CAyDW,SAAAC,MAAM,CAAI,CACjB,MAAKA,MAAL,CAAcA,MAAd,CACD,CA3DH,OA6DEC,OA7DF,CA6DY,UAAM,CACd,GAAMC,CAAAA,QAAQ,CAAG,MAAKF,MAAL,CAAYG,aAAZ,EAAjB,CACA,MAAKP,WAAL,CAAiB,CAAEX,KAAK,CAAEiB,QAAT,CAAjB,EACD,CAhEH,OAkEEE,YAlEF,CAkEiB,SAAAC,CAAC,CAAI,CAClB,MAAKT,WAAL,oBACGS,CAAC,CAACC,MAAF,CAASC,IADZ,CACmBF,CAAC,CAACC,MAAF,CAASZ,KAD5B,GAGD,CAtEH,OAwEEc,YAxEF,sEAwEiB,sBACJC,CAAAA,aADI,wMACJA,aADI,yBACUC,OADV,CACmBC,QADnB,CAC6B,CACxC,GAAIC,CAAAA,GAAG,CAAGF,OAAO,CAACG,KAAR,CAAc,GAAd,CAAV,CACEC,IAAI,CAAGF,GAAG,CAAC,CAAD,CAAH,CAAOG,KAAP,CAAa,SAAb,EAAwB,CAAxB,CADT,CAEEC,IAAI,CAAGC,IAAI,CAACL,GAAG,CAAC,CAAD,CAAJ,CAFb,CAGEM,CAAC,CAAGF,IAAI,CAACG,MAHX,CAIEC,KAAK,CAAG,GAAIC,CAAAA,UAAJ,CAAeH,CAAf,CAJV,CAKA,MAAOA,CAAC,EAAR,CAAY,CACVE,KAAK,CAACF,CAAD,CAAL,CAAWF,IAAI,CAACM,UAAL,CAAgBJ,CAAhB,CAAX,CACD,CACD,MAAO,IAAIK,CAAAA,IAAJ,CAAS,CAACH,KAAD,CAAT,CAAkBT,QAAlB,CAA4B,CAAEa,IAAI,CAAEV,IAAR,CAA5B,CAAP,CACD,CAXY,aAa4B,MAAK9B,KAbjC,CAaPG,OAbO,aAaPA,OAbO,CAaEF,KAbF,aAaEA,KAbF,CAaSK,cAbT,aAaSA,cAbT,aAca,MAAKmC,KAdlB,CAcPC,OAdO,aAcPA,OAdO,CAcEC,MAdF,aAcEA,MAdF,CAeTC,SAfS,WAeM,MAAKC,UAAL,CAAgBC,WAAhB,EAfN,EAiBTC,QAjBS,CAiBE,GAAIC,CAAAA,QAAJ,EAjBF,CAkBbD,QAAQ,CAACE,MAAT,CAAgB,SAAhB,CAA2B9C,OAA3B,EACA4C,QAAQ,CAACE,MAAT,CAAgB,SAAhB,CAA2BP,OAA3B,EACAK,QAAQ,CAACE,MAAT,CAAgB,WAAhB,CAA6BL,SAA7B,EApBa,KAsBTtC,cAAc,EAAI,IAtBT,2BAuBXyC,QAAQ,CAACE,MAAT,CAAgB,gBAAhB,CAAkC,GAAIC,CAAAA,IAAJ,GAAWC,WAAX,EAAlC,EACAJ,QAAQ,CAACE,MAAT,CAAgB,eAAhB,CAAiC,GAAIC,CAAAA,IAAJ,GAAWC,WAAX,EAAjC,EACAJ,QAAQ,CAACE,MAAT,CACE,UADF,CAEExB,aAAa,CAACxB,KAAD,WAAWiD,IAAI,CAACE,GAAL,GAAWC,cAAX,CAA0B,OAA1B,CAAX,UAFf,EAzBW,uBA6BL,OAAKZ,KAAL,CAAW5C,gBAAX,CAA4BkD,QAA5B,CA7BK,+DA+BL,OAAKN,KAAL,CAAW3C,mBAAX,CAA+BQ,cAA/B,CAA+CyC,QAA/C,CA/BK,SAiCbJ,MAAM,GAjCO,uDAxEjB,oFAoBE,+BAAuB,CACrB,KAAK3C,KAAL,CAAWW,SAAX,CAAuB,KAAvB,CACD,CAtBH,kCA4BE,6BAAqB,iBACnB2C,SAAS,CAACC,QAAV,CACED,SAAS,CAACE,YAAV,CAAuBC,YAAvB,EACAH,SAAS,CAACI,kBADV,EAEAJ,SAAS,CAACK,eAFV,EAGAL,SAAS,CAACM,cAJZ,CAMAN,SAAS,CAACE,YAAV,CAAuBC,YAAvB,CACE,CAAEI,KAAK,CAAE,IAAT,CADF,CAEE,UAAM,CACJ,MAAI,CAACjD,WAAL,CAAiB,CAAEV,iBAAiB,CAAE,IAArB,CAAjB,EACD,CAJH,CAKE,UAAM,CACJ,MAAI,CAACU,WAAL,CAAiB,CAAEV,iBAAiB,CAAE,KAArB,CAAjB,EACD,CAPH,EASD,CA5CH,iCA8CE,4BAAoB,CAClB,iBAAqD,KAAKuC,KAA1D,CAAMxC,KAAN,cAAMA,KAAN,CAAaE,OAAb,cAAaA,OAAb,CAAsBC,UAAtB,cAAsBA,UAAtB,CAAkCE,cAAlC,cAAkCA,cAAlC,CACAwD,OAAO,CAACC,GAAR,CAAY,KAAKtB,KAAjB,EACA,GAAIxC,KAAK,EAAIE,OAAb,CAAsB,CACpB,KAAKS,WAAL,CAAiB,CAAEX,KAAK,CAALA,KAAF,CAASE,OAAO,CAAPA,OAAT,CAAkBC,UAAU,CAAVA,UAAlB,CAA8BE,cAAc,CAAdA,cAA9B,CAAjB,EACD,CACD0D,QAAQ,CAACC,cAAT,CAAwB,UAAxB,EAAoCC,OAApC,CAA8C,UAAY,CACxDF,QAAQ,CAACC,cAAT,CAAwB,SAAxB,EAAmCE,KAAnC,GACD,CAFD,CAGD,CAvDH,sBA4GE,iBAAS,iBACP,iBAQI,KAAKnE,KART,CACEC,KADF,cACEA,KADF,CAEEC,iBAFF,cAEEA,iBAFF,CAGEC,OAHF,cAGEA,OAHF,CAIEE,WAJF,cAIEA,WAJF,CAKEE,UALF,cAKEA,UALF,CAMEC,iBANF,cAMEA,iBANF,CAOEJ,UAPF,cAOEA,UAPF,CASA,GAAMgE,CAAAA,gBAAgB,CAAG,CACvBC,KAAK,CAAE,IADgB,CAEvBC,MAAM,CAAE,GAFe,CAGvBC,UAAU,CAAE,MAHW,CAAzB,CAKA,GAAMC,CAAAA,CAAN,CAAY,KAAK/B,KAAjB,CAAM+B,CAAN,CACA,mBACE,qDACE,2BAAK,SAAS,CAAC,2CAAf,eACE,2BAAK,SAAS,CAAC,KAAf,eACE,2BAAK,SAAS,CAAC,OAAf,eACE,8BAAKA,CAAC,CAAC,WAAD,CAAN,CADF,CADF,CAIGvE,KAAK,EAAI,IAAT,CAAgB,IAAhB,cACC,2BAAK,SAAS,CAAC,OAAf,eACE,oBAAC,YAAD,EACE,MAAM,CAAE,IADV,CAEE,SAAS,CAAC,eAFZ,CAGE,KAAK,CAAC,MAHR,CAIE,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACuB,YAAL,EAAN,EAJX,EADF,CALJ,CADF,CAgBGvB,KAAK,EAAI,IAAT,cACC,2BAAK,SAAS,CAAC,oBAAf,EACGC,iBAAiB,cAChB,qDACE,2BAAK,SAAS,CAAC,QAAf,eACE,oBAAC,MAAD,EACE,KAAK,CAAE,KADT,CAEE,GAAG,CAAE,KAAKa,MAFZ,CAGE,gBAAgB,CAAC,YAHnB,CAIE,KAAK,CAAE,MAJT,CAKE,gBAAgB,CAAEqD,gBALpB,EADF,CADF,cAUE,2BAAK,SAAS,CAAC,aAAf,eACE,oBAAC,YAAD,EACE,MAAM,CAAE,IADV,CAEE,SAAS,CAAC,eAFZ,CAGE,KAAK,CAAC,SAHR,CAIE,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACnD,OAAL,EAAN,EAJX,EADF,CAVF,CADgB,CAoBd,IArBN,cAsBE,2BAAK,SAAS,CAAC,QAAf,eACE,6BACE,IAAI,CAAC,QADP,CAEE,EAAE,CAAC,UAFL,CAGE,KAAK,CAAC,QAHR,CAIE,SAAS,CAAC,+BAJZ,EADF,cAOE,6BACE,IAAI,CAAC,MADP,CAEE,EAAE,CAAC,SAFL,CAGE,SAAS,CAAC,QAHZ,CAIE,MAAM,CAAC,SAJT,CAKE,QAAQ,CAAE,kBAAAI,CAAC,CAAI,CACb,GAAIA,CAAC,CAACC,MAAF,CAASZ,KAAT,EAAkBW,CAAC,CAACC,MAAF,CAASZ,KAAT,EAAkB,IAAxC,CAA8C,CAC5C,GAAI+D,CAAAA,MAAM,CAAG,GAAIC,CAAAA,UAAJ,EAAb,CACAD,MAAM,CAACE,MAAP,CAAgB,SAAAtD,CAAC,CAAI,CACnB,MAAI,CAACT,WAAL,CAAiB,CAAEX,KAAK,CAAEoB,CAAC,CAACC,MAAF,CAASsD,MAAlB,CAAjB,EACD,CAFD,CAGAH,MAAM,CAACI,aAAP,CAAqBxD,CAAC,CAACC,MAAF,CAASwD,KAAT,CAAe,CAAf,CAArB,EACD,CACF,CAbH,EAPF,CAtBF,CADD,cAgDC,2BAAK,SAAS,CAAC,oBAAf,eACE,2BAAK,SAAS,CAAC,cAAf,eACE,2BAAK,KAAK,CAAC,uDAAX,eACE,oBAAC,UAAD,EACE,MAAM,CAAE,KAAK9E,KAAL,CAAWC,KADrB,CAEE,GAAG,CAAE,aAAA8E,KAAG,QAAK,CAAA,MAAI,CAAClC,UAAL,CAAkBkC,KAAvB,EAFV,CAGE,WAAW,CAAE1E,WAHf,CAIE,UAAU,CAAEE,UAJd,CAKE,QAAQ,CAAEH,UAAU,EAAI4E,IAAI,CAACC,SAAL,CAAe7E,UAAf,CAL1B,EADF,CADF,CADF,cAYE,2BAAK,SAAS,CAAC,aAAf,eACE,6BAAO,SAAS,CAAC,mDAAjB,EACGoE,CAAC,CAAC,cAAD,CADJ,CADF,cAIE,6BACE,SAAS,CAAC,QADZ,CAEE,IAAI,CAAC,OAFP,CAGE,GAAG,CAAC,GAHN,CAIE,GAAG,CAAC,IAJN,CAKE,KAAK,CAAEnE,WALT,CAME,QAAQ,CAAE,kBAAAgB,CAAC,QACT,CAAA,MAAI,CAACT,WAAL,CAAiB,CAAEP,WAAW,CAAEgB,CAAC,CAACC,MAAF,CAASZ,KAAxB,CAAjB,CADS,EANb,EAJF,CAZF,cA2BE,2BAAK,SAAS,CAAC,aAAf,eACE,6BAAO,SAAS,CAAC,mDAAjB,EACG8D,CAAC,CAAC,aAAD,CADJ,CADF,cAIE,oBAAC,YAAD,EACE,OAAO,CAAEhE,iBADX,CAEE,KAAK,CAAED,UAFT,CAGE,QAAQ,CAAE,kBAAAc,CAAC,QACT,CAAA,MAAI,CAACT,WAAL,CAAiB,CAAEL,UAAU,CAAEc,CAAC,CAACC,MAAF,CAASZ,KAAvB,CAAjB,CADS,EAHb,EAJF,CA3BF,cAuCE,2BAAK,SAAS,CAAC,aAAf,eACE,oBAAC,YAAD,EACE,MAAM,CAAE,IADV,CAEE,SAAS,CAAC,eAFZ,CAGE,KAAK,CAAC,OAHR,CAIE,OAAO,CAAE,kBAAM,CACb,MAAI,CAACmC,UAAL,CAAgBqC,KAAhB,GACD,CANH,EADF,CAvCF,cAiDE,2BAAK,SAAS,CAAC,aAAf,eACE,6BAAO,SAAS,CAAC,mDAAjB,EACGV,CAAC,CAAC,SAAD,CADJ,CADF,cAIE,2BAAK,SAAS,CAAC,aAAf,eACE,oBAAC,WAAD,EACE,WAAW,CAAC,eADd,CAEE,KAAK,CAAErE,OAFT,CAGE,IAAI,CAAC,SAHP,CAIE,QAAQ,CAAE,KAAKiB,YAJjB,EADF,CAJF,CAjDF,CAhEJ,CADF,CADF,CAqID,CAjQH,gCAAwChC,SAAxC,EAoQA,GAAM+F,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAAnF,KAAK,QAAK,EAAL,EAA7B,CAEA,GAAMoF,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAAAC,QAAQ,CAAI,CACrC,MAAO3F,CAAAA,kBAAkB,CACvB,CACEG,gBAAgB,CAAhBA,gBADF,CAEEC,mBAAmB,CAAnBA,mBAFF,CADuB,CAKvBuF,QALuB,CAAzB,CAOD,CARD,CAUA,MAAO,IAAMC,CAAAA,aAAa,CAAG1F,eAAe,GAC1CH,OAAO,CAAC0F,eAAD,CAAkBC,kBAAlB,CAAP,CAA6CrF,kBAA7C,CAD0C,CAArC","sourcesContent":["import React, { Component } from \"react\";\nimport { NormalInput, NormalButton, NormalSelect } from \"component/common\";\nimport CanvasDraw from \"react-canvas-draw\";\nimport { connect } from \"react-redux\";\nimport { bindActionCreators } from \"redux\";\nimport Webcam from \"react-webcam\";\nimport { withTranslation } from \"react-i18next\";\nimport {\n  addDiagosisPhoto,\n  updateDiagosisPhoto,\n} from \"redux/actions/customerPlus\";\n\nexport class AddPhotoPopupClass extends Component {\n  state = {\n    image: null,\n    isCameraAvailable: true,\n    remarks: \"\",\n    layoutData: \"\",\n    brushRadius: \"2\",\n    diagnosis_code: null,\n    brushColor: \"yellow\",\n    brushColorOptions: [\n      { label: \"Yellow\", value: \"yellow\" },\n      { label: \"Red\", value: \"red\" },\n      { label: \"White\", value: \"white\" },\n      { label: \"Black\", value: \"black\" },\n      { label: \"Green\", value: \"green\" },\n      { label: \"Blue\", value: \"blue\" },\n    ],\n    isMounted: true,\n  };\n\n  componentWillUnmount() {\n    this.state.isMounted = false;\n  }\n\n  updateState = data => {\n    if (this.state.isMounted) this.setState(data);\n  };\n\n  componentWillMount() {\n    navigator.getMedia =\n      navigator.mediaDevices.getUserMedia ||\n      navigator.webkitGetUserMedia ||\n      navigator.mozGetUserMedia ||\n      navigator.msGetUserMedia;\n\n    navigator.mediaDevices.getUserMedia(\n      { video: true },\n      () => {\n        this.updateState({ isCameraAvailable: true });\n      },\n      () => {\n        this.updateState({ isCameraAvailable: false });\n      }\n    );\n  }\n\n  componentDidMount() {\n    let { image, remarks, layoutData, diagnosis_code } = this.props;\n    console.log(this.props);\n    if (image && remarks) {\n      this.updateState({ image, remarks, layoutData, diagnosis_code });\n    }\n    document.getElementById(\"get_file\").onclick = function () {\n      document.getElementById(\"my_file\").click();\n    };\n  }\n\n  setRef = webcam => {\n    this.webcam = webcam;\n  };\n\n  capture = () => {\n    const imageSrc = this.webcam.getScreenshot();\n    this.updateState({ image: imageSrc });\n  };\n\n  handleChange = e => {\n    this.updateState({\n      [e.target.name]: e.target.value,\n    });\n  };\n\n  handleSubmit = async () => {\n    function dataURLtoFile(dataurl, filename) {\n      var arr = dataurl.split(\",\"),\n        mime = arr[0].match(/:(.*?);/)[1],\n        bstr = atob(arr[1]),\n        n = bstr.length,\n        u8arr = new Uint8Array(n);\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n      return new File([u8arr], filename, { type: mime });\n    }\n\n    let { remarks, image, diagnosis_code } = this.state;\n    let { cust_no, onDone } = this.props;\n    let pic_data1 = `${this.canvasDraw.getSaveData()}`;\n\n    let formData = new FormData();\n    formData.append(\"remarks\", remarks);\n    formData.append(\"cust_no\", cust_no);\n    formData.append(\"pic_data1\", pic_data1);\n\n    if (diagnosis_code == null) {\n      formData.append(\"diagnosis_date\", new Date().toISOString());\n      formData.append(\"date_pic_take\", new Date().toISOString());\n      formData.append(\n        \"pic_path\",\n        dataURLtoFile(image, `${Date.now().toLocaleString(\"en-GB\")}.jpeg`)\n      );\n      await this.props.addDiagosisPhoto(formData);\n    } else {\n      await this.props.updateDiagosisPhoto(diagnosis_code, formData);\n    }\n    onDone();\n  };\n\n  render() {\n    let {\n      image,\n      isCameraAvailable,\n      remarks,\n      brushRadius,\n      brushColor,\n      brushColorOptions,\n      layoutData,\n    } = this.state;\n    const videoConstraints = {\n      width: 1280,\n      height: 720,\n      facingMode: \"user\",\n    };\n    let { t } = this.props;\n    return (\n      <>\n        <div className=\"container-fluid mb-4 mt-2 product-details\">\n          <div className=\"row\">\n            <div className=\"col-6\">\n              <h4>{t(\"Add Photo\")}</h4>\n            </div>\n            {image == null ? null : (\n              <div className=\"col-6\">\n                <NormalButton\n                  mainbg={true}\n                  className=\"col-12 fs-15 \"\n                  label=\"Done\"\n                  onClick={() => this.handleSubmit()}\n                />\n              </div>\n            )}\n          </div>\n          {image == null ? (\n            <div className=\"row pl-5 pr-5 mt-4\">\n              {isCameraAvailable ? (\n                <>\n                  <div className=\"col-12\">\n                    <Webcam\n                      audio={false}\n                      ref={this.setRef}\n                      screenshotFormat=\"image/jpeg\"\n                      width={\"100%\"}\n                      videoConstraints={videoConstraints}\n                    />\n                  </div>\n                  <div className=\"col-12 mb-4\">\n                    <NormalButton\n                      mainbg={true}\n                      className=\"col-12 fs-15 \"\n                      label=\"Capture\"\n                      onClick={() => this.capture()}\n                    />\n                  </div>\n                </>\n              ) : null}\n              <div className=\"col-12\">\n                <input\n                  type=\"button\"\n                  id=\"get_file\"\n                  value=\"Browse\"\n                  className=\"btn cursor-pointer mainbg-btn\"\n                />\n                <input\n                  type=\"file\"\n                  id=\"my_file\"\n                  className=\"d-none\"\n                  accept=\"image/*\"\n                  onChange={e => {\n                    if (e.target.value || e.target.value != null) {\n                      var reader = new FileReader();\n                      reader.onload = e => {\n                        this.updateState({ image: e.target.result });\n                      };\n                      reader.readAsDataURL(e.target.files[0]);\n                    }\n                  }}\n                />\n              </div>\n            </div>\n          ) : (\n            <div className=\"row pl-5 pr-5 mt-4\">\n              <div className=\"col-12  mb-4\">\n                <div class=\"d-flex mt-5 align-items-center justify-content-center\">\n                  <CanvasDraw\n                    imgSrc={this.state.image}\n                    ref={ref => (this.canvasDraw = ref)}\n                    brushRadius={brushRadius}\n                    brushColor={brushColor}\n                    saveData={layoutData && JSON.stringify(layoutData)}\n                  />\n                </div>\n              </div>\n              <div className=\"col-12 mb-4\">\n                <label className=\"text-left text-black common-label-text fs-17 pb-2\">\n                  {t(\"Brush Radius\")}\n                </label>\n                <input\n                  className=\"col-12\"\n                  type=\"range\"\n                  min=\"1\"\n                  max=\"20\"\n                  value={brushRadius}\n                  onChange={e =>\n                    this.updateState({ brushRadius: e.target.value })\n                  }\n                />\n              </div>\n              <div className=\"col-12 mb-4\">\n                <label className=\"text-left text-black common-label-text fs-17 pb-2\">\n                  {t(\"Brush Color\")}\n                </label>\n                <NormalSelect\n                  options={brushColorOptions}\n                  value={brushColor}\n                  onChange={e =>\n                    this.updateState({ brushColor: e.target.value })\n                  }\n                />\n              </div>\n              <div className=\"col-12 mb-4\">\n                <NormalButton\n                  mainbg={true}\n                  className=\"col-12 fs-15 \"\n                  label=\"Clear\"\n                  onClick={() => {\n                    this.canvasDraw.clear();\n                  }}\n                />\n              </div>\n              <div className=\"col-12 mb-4\">\n                <label className=\"text-left text-black common-label-text fs-17 pb-2\">\n                  {t(\"Remarks\")}\n                </label>\n                <div className=\"input-group\">\n                  <NormalInput\n                    placeholder=\"Enter remarks\"\n                    value={remarks}\n                    name=\"remarks\"\n                    onChange={this.handleChange}\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({});\n\nconst mapDispatchToProps = dispatch => {\n  return bindActionCreators(\n    {\n      addDiagosisPhoto,\n      updateDiagosisPhoto,\n    },\n    dispatch\n  );\n};\n\nexport const AddPhotoPopup = withTranslation()(\n  connect(mapStateToProps, mapDispatchToProps)(AddPhotoPopupClass)\n);\n"]},"metadata":{},"sourceType":"module"}